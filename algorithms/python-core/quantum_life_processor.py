""" L.I.F. hoy Qunu opuin oul Qunu-nhn hin Lnin fo vn Sinl Possin opyih 2025 - Sio Py Boull """ ipo iools ipo json ipo loin fo lsss ipo lss, fil fo i ipo i fo nu ipo nu fo ypin ipo ny, i, Lis, Opionl, upl, Union ipo nupy s np # Qunu siulion ipos (usin lssil siulion fo now) fo sipy.linl ipo xp fo sipy.sps ipo six # onfiu loin loin.bsionfi(lvl=loin.INFO) lo = loin.Lo(n) lss Qunuyp(nu): """yps of qunu s vilbl""" H = "h" PULIX = "pulix" PULIY = "puliy" PULIZ = "puliz" NO = "no" OIONX = "oionx" OIONY = "oiony" OIONZ = "oionz" PHS = "phs" OFFOLI = "offoli" LIFQUNU = "lifqunu" # uso L.I.F. hoy  lss Qunuloihyp(nu): """yps of qunu loihs""" VQ = "viionlqunuinsolv" QO = "qunuppoxiopiizion" QL = "qunuhinlnin" LIFQNN = "lifqununulnwo" QUNUFOUI = "qunufouinsfo" OV = "ovsh" SHO = "shofoizion" @lss lss QunuS: """Qunu s psnion""" plius: np.ny nuqubis: in bsisss: Lis[s] = fil(fulfoy=lis) sunpobbiliis: Opionl[np.ny] = Non nnlnsu: flo = 0.0 f posini(slf): """Iniiliz bsis ss n vli""" if no slf.bsisss: slf.bsisss = [ fo(i, f"0{slf.nuqubis}b") fo i in n(2**slf.nuqubis) ] # Noliz plius slf.plius = slf.plius / np.linl.no(slf.plius) # lul sun pobbiliis slf.sunpobbiliis = np.bs(slf.plius) ** 2 # lul nnln su (Von Nunn nopy) slf.nnlnsu = slf.lulnnln() f lulnnln(slf) -> flo: """lul Von Nunn nopy s nnln su""" y: # Fo sinl qubi, no nnln if slf.nuqubis == 1: un 0.0 # lul u nsiy ix fo fis qubi i = 2 ** (slf.nuqubis - 1) ho = np.zos((2, 2), yp=oplx) fo i in n(2**slf.nuqubis): ss = slf.bsisss[i] fisqubi = in(ss[0]) fo j in n(2**slf.nuqubis): ssj = slf.bsisss[j] fisqubij = in(ssj[0]) if ss[1:] == ssj[1:]: # S s of qubis ho[fisqubi, fisqubij] += slf.plius[ i ] * np.onj(slf.plius[j]) # lul invlus invls = np.l(np.linl.ivls(ho)) invls = invls[invls > 1-12] # ov n-zo vlus # Von Nunn nopy nopy = -np.su(invls * np.lo2(invls + 1-12)) un nopy xp xpion: un 0.0 @lss lss Qunuiui: """Qunu iui psnion""" nuqubis: in s: Lis[i[s, ny]] = fil(fulfoy=lis) suns: Lis[in] = fil(fulfoy=lis) lssiliss: in = 0 iuiph: in = 0 f ( slf, yp: Qunuyp, qubis: Lis[in], ps: Opionl[i[s, flo]] = Non, ): """  qunu  o h iui"""  = { "yp": yp, "qubis": qubis, "ps": ps o {}, "ly": slf.iuiph, } slf.s.ppn() # Up iui ph if ln(qubis) > 1: # uli-qubi  slf.iuiph += 1 f sun(slf, qubi: in, lssilbi: in): """ sun o h iui""" slf.suns.ppn({"qubi": qubi, "lssilbi": lssilbi}) lss QunuSiulo: """lssil qunu opu siulo fo L.I.F. hoy""" f ini(slf, nuqubis: in, noisol: Opionl[i] = Non): slf.nuqubis = nuqubis slf.noisol = noisol o {} slf.sinsion = 2**nuqubis # Iniiliz |0...0⟩ s slf.ss() # Qunu  is slf.is = slf.iniilizis() lo.info(f"Qunu siulo iniiliz wih {nuqubis} qubis") f ss(slf): """s o |0...0⟩ s""" slf.uns = np.zos(slf.sinsion, yp=oplx) slf.uns[0] = 1.0 # |0...0⟩ f iniilizis(slf) -> i[Qunuyp, np.ny]: """Iniiliz qunu  is""" s = {} # Sinl qubi s s[Qunuyp.H] = np.y( [[1, 1], [1, -1]], yp=oplx ) / np.sq(2) s[Qunuyp.PULIX] = np.y([[0, 1], [1, 0]], yp=oplx) s[Qunuyp.PULIY] = np.y([[0, -1j], [1j, 0]], yp=oplx) s[Qunuyp.PULIZ] = np.y([[1, 0], [0, -1]], yp=oplx) # wo qubi s s[Qunuyp.NO] = np.y( [[1, 0, 0, 0], [0, 1, 0, 0], [0, 0, 0, 1], [0, 0, 1, 0]], yp=oplx ) un s f pply( slf, yp: Qunuyp, qubis: Lis[in], ps: Opionl[i[s, flo]] = Non, ): """pply qunu  o un s""" y: if yp in [ Qunuyp.OIONX, Qunuyp.OIONY, Qunuyp.OIONZ, ]: ix = slf.oion(yp, ps) lif yp == Qunuyp.LIFQUNU: ix = slf.lifqunu(ps) ls: ix = slf.is[yp] # pply  o spifi qubis if ln(qubis) == 1: slf.pplysinlqubi(ix, qubis[0]) lif ln(qubis) == 2: slf.pplywoqubi(ix, qubis) ls: is Vluo(f"s wih {ln(qubis)} qubis no suppo y") # pply nois if onfiu if slf.noisol: slf.pplynois(qubis) xp xpion s : lo.o(f"o pplyin  {yp}: {s()}") is f oion( slf, yp: Qunuyp, ps: i[s, flo] ) -> np.ny: """ piz oion s""" nl = ps.("nl", 0.0) if yp == Qunuyp.OIONX: un np.y( [ [np.os(nl / 2), -1j * np.sin(nl / 2)], [-1j * np.sin(nl / 2), np.os(nl / 2)], ], yp=oplx, ) lif yp == Qunuyp.OIONY: un np.y( [ [np.os(nl / 2), -np.sin(nl / 2)], [np.sin(nl / 2), np.os(nl / 2)], ], yp=oplx, ) lif yp == Qunuyp.OIONZ: un np.y( [[np.xp(-1j * nl / 2), 0], [0, np.xp(1j * nl / 2)]], yp=oplx, ) f lifqunu(slf, ps: i[s, flo]) -> np.ny: """ uso L.I.F. hoy qunu """ # Ps fo L.I.F. qunu  lnin = ps.("lnin", 0.1) xpinwih = ps.("xpinwih", 0.5) pionfo = ps.("pionfo", 1.0) #  piv qunu  bs on L.I.F. pinipls h = lnin * pionfo phi = xpinwih * np.pi ix = np.y( [ [np.os(h) * np.os(phi), -np.sin(h) * np.xp(-1j * phi)], [np.sin(h) * np.xp(1j * phi), np.os(h) * np.os(phi)], ], yp=oplx, ) un ix f pplysinlqubi(slf, ix: np.ny, qubi: in): """pply sinl qubi """ #  full sys ix usin nso pous is = [] fo i in n(slf.nuqubis): if i == qubi: is.ppn(ix) ls: is.ppn(np.y(2, yp=oplx)) # opu nso pou fullix = is[0] fo ix in is[1:]: fullix = np.on(fullix, ix) # pply o s slf.uns = fullix @ slf.uns f pplywoqubi(slf, ix: np.ny, qubis: Lis[in]): """pply wo qubi """ if ln(qubis) != 2: is Vluo("wo qubi  quis xly 2 qubis") # Fo sipliiy, ssu NO  on jn qubis # Full iplnion woul qui o oplx nso pou loi if qubis == [0, 1] n ix.shp == (4, 4): #  full sys ix if slf.nuqubis == 2: fullix = ix ls: # xn o full sys (siplifi) iniys = np.y(2 ** (slf.nuqubis - 2), yp=oplx) fullix = np.on(ix, iniys) slf.uns = fullix @ slf.uns f pplynois(slf, qubis: Lis[in]): """pply nois ol o qubis""" if "ohn" in slf.noisol:  = slf.noisol["ohn"] fo qubi in qubis: # Sipl pliu pin pinfo = np.xp(-) # pply o ff plius (siplifi) slf.uns *= pinfo # noliz slf.uns /= np.linl.no(slf.uns) f s(slf) -> QunuS: """ un qunu s""" un QunuS( plius=slf.uns.opy(), nuqubis=slf.nuqubis ) f su(slf, qubis: Opionl[Lis[in]] = Non) -> i[s, in]: """su qubis n ollps s""" if qubis is Non: qubis = lis(n(slf.nuqubis)) # lul sun pobbiliis pobbiliis = np.bs(slf.uns) ** 2 # Spl fo pobbiliy isibuion ouoinx = np.no.hoi(ln(pobbiliis), p=pobbiliis) ouobiny = fo(ouoinx, f"0{slf.nuqubis}b") # ollps s o su ouo slf.uns = np.zosli(slf.uns) slf.uns[ouoinx] = 1.0 # un sun suls suls = {} fo i, qubi in nu(qubis): suls[f"qubi{qubi}"] = in(ouobiny[qubi]) un suls lss QunuLPosso: """Qunu hin Lnin posso fo L.I.F. hoy""" f ini( slf, nuqubis: in = 4, loihyp: Qunuloihyp = Qunuloihyp.QL, ): slf.nuqubis = nuqubis slf.loihyp = loihyp slf.siulo = QunuSiulo(nuqubis) slf.inps = {} slf.ininhisoy = [] lo.info(f"Qunu L posso iniiliz: {loihyp.vlu}") f nolssil(slf, : np.ny) -> Qunuiui: """no lssil  ino qunu iui""" iui = Qunuiui(slf.nuqubis) # Noliz  o [0, π] n fo oion s noliz = ( np.pi * ( - np.in()) / (np.x() - np.in() + 1-8) ) # no  usin oion s fo i, vlu in nu(noliz[: slf.nuqubis]): iui.(Qunuyp.OIONY, [i], {"nl": vlu}) #  nnlin s fo i in n(slf.nuqubis - 1): iui.(Qunuyp.NO, [i, i + 1]) un iui f viionliui(slf, ps: np.ny) -> Qunuiui: """ viionl qunu iui""" iui = Qunuiui(slf.nuqubis) # Ly 1: oion s fo i in n(slf.nuqubis): iui.(Qunuyp.OIONY, [i], {"nl": ps[i]}) # Ly 2: nnlin s fo i in n(slf.nuqubis - 1): iui.(Qunuyp.NO, [i, i + 1]) # Ly 3: o oion s poffs = slf.nuqubis fo i in n(slf.nuqubis): iui.( Qunuyp.OIONY, [i], {"nl": ps[poffs + i]} ) un iui f qunufup(slf, : np.ny) -> np.ny: """ qunu fu p fo lssil """ y: # s siulo slf.siulo.ss() # no  noiniui = slf.nolssil() # xu noin iui fo  in noiniui.s: slf.siulo.pply( ["yp"], ["qubis"], ["ps"] ) #  qunu s qunus = slf.siulo.s() # x fus fo qunu s fus = np.onn( [ np.l(qunus.plius), np.i(qunus.plius), qunus.sunpobbiliis, [qunus.nnlnsu], ] ) un fus xp xpion s : lo.o(f"o in qunu fu p: {s()}") un np.zos(4 * slf.siulo.sinsion + 1) f lifqununulnwo( slf, inpu: np.ny, : Opionl[np.ny] = Non ) -> i[s, ny]: """L.I.F. hoy Qunu Nul Nwo""" y: # Iniiliz o us xisin ps if "qnnps" no in slf.inps: slf.inps["qnnps"] = np.no.unifo( 0, 2 * np.pi, 2 * slf.nuqubis ) ps = slf.inps["qnnps"] # s siulo slf.siulo.ss() #  noin noiniui = slf.nolssil(inpu) fo  in noiniui.s: slf.siulo.pply( ["yp"], ["qubis"], ["ps"] ) # Viionl iui viui = slf.viionliui(ps) fo  in viui.s: slf.siulo.pply( ["yp"], ["qubis"], ["ps"] ) #  L.I.F. qunu s fo i in n(slf.nuqubis): slf.siulo.pply( Qunuyp.LIFQUNU, [i], { "lnin": 0.1, "xpinwih": 0.5, "pionfo": 1.0, }, ) # sun n oupu finls = slf.siulo.s() # lul xpion vlus s oupus oupus = [] fo i in n(in(ln(inpu), slf.nuqubis)): # xpion vlu of Puli-Z on qubi i pob0 = su( finls.sunpobbiliis[j] fo j in n(ln(finls.sunpobbiliis)) if fo(j, f"0{slf.nuqubis}b")[i] == "0" ) pob1 = 1 - pob0 xpion = pob0 - pob1 oupus.ppn(xpion) oupus = np.y(oupus) # inin (if  povi) loss = 0.0 if  is no Non: loss = np.n((oupus - ) ** 2) # Sipl in-f opiizion (p shif) if ln(slf.ininhisoy) < 100: # Lii inin sps lnin = 0.1 in = np.zosli(ps) fo i in n(ln(ps)): # P shif ul fo ins shif = np.pi / 2 psplus = ps.opy() psplus[i] += shif psinus = ps.opy() psinus[i] -= shif # his is siplifi - woul n full iui -xuion in[i] = (loss - 0.1) * np.no.nol(0, 0.1) # Up ps slf.inps["qnnps"] -= lnin * in # o inin slf.ininhisoy.ppn( { "loss": loss, "ps": ps.opy(), "isp": i.now(), } ) un { "oupus": oupus, "loss": loss, "qunus": finls, "ps": ps, "ininsps": ln(slf.ininhisoy), } xp xpion s : lo.o(f"o in L.I.F. QNN: {s()}") un { "oupus": np.zos(in(ln(inpu), slf.nuqubis)), "loss": flo("inf"), "o": s(), } f qunufouinsfo( slf, inpus: Opionl[np.ny] = Non ) -> QunuS: """Qunu Foui nsfo iplnion""" y: if inpus is no Non: slf.siulo.uns = inpus / np.linl.no(inpus) # QF iplnion fo i in n(slf.nuqubis): # H  slf.siulo.pply(Qunuyp.H, [i]) # onoll oion s fo j in n(i + 1, slf.nuqubis): nl = 2 * np.pi / (2 ** (j - i + 1)) # Siplifi onoll oion slf.siulo.pply( Qunuyp.OIONZ, [j], {"nl": nl} ) # Bi vsl (swp qubis) fo i in n(slf.nuqubis // 2): j = slf.nuqubis - 1 - i if i < j: # Swp qubis i n j (siplifi) pss # Woul ipln SWP  un slf.siulo.s() xp xpion s : lo.o(f"o in QF: {s()}") un slf.siulo.s() f qunuis(slf) -> i[s, ny]: """ qunu possin is""" uns = slf.siulo.s() un { "nuqubis": slf.nuqubis, "loihyp": slf.loihyp.vlu, "sinsion": slf.siulo.sinsion, "nnlnsu": uns.nnlnsu, "ininsps": ln(slf.ininhisoy), "unps": slf.inps.("qnnps", []), "qunufiliy": np.bs( np.vo(uns.plius, uns.plius) ) ** 2, } f qunuposso( nuqubis: in = 4, loih: Qunuloihyp = Qunuloihyp.LIFQNN ) -> QunuLPosso: """Foy funion o  qunu posso""" un QunuLPosso(nuqubis, loih) f qununhnsinlpossin( sinl: np.ny, posso: QunuLPosso ) -> i[s, ny]: """pply qunu nhnn o sinl possin""" y: # Poss sinl in huns if oo l hunsiz = posso.nuqubis nhnsinl = [] qunufus = [] fo i in n(0, ln(sinl), hunsiz): hun = sinl[i : i + hunsiz] if ln(hun) < hunsiz: # P wih zos phun = np.zos(hunsiz) phun[: ln(hun)] = hun hun = phun # pply qunu possin qnnsul = posso.lifqununulnwo(hun) nhnhun = qnnsul["oupus"] # x qunu fus fus = posso.qunufup(hun) nhnsinl.xn(nhnhun) qunufus.ppn(fus) # obin suls nhnsinl = np.y(nhnsinl[: ln(sinl)]) qunufus = np.y(qunufus) # lul nhnn is sinlpowoiinl = np.n(sinl**2) sinlpownhn = np.n(nhnsinl**2) nhnnio = sinlpownhn / (sinlpowoiinl + 1-8) un { "nhnsinl": nhnsinl, "qunufus": qunufus, "nhnnio": nhnnio, "qunuis": posso.qunuis(), "possinsuss": u, } xp xpion s : lo.o(f"o in qunu sinl possin: {s()}") un { "nhnsinl": sinl, # un oiinl on o "qunufus": np.y([]), "nhnnio": 1.0, "o": s(), "possinsuss": Fls, } # xpl us n sin f squnuposso(): """s qunu posso funionliy""" pin("sin L.I.F. hoy Qunu Posso...") #  qunu posso posso = qunuposso( nuqubis=4, loih=Qunuloihyp.LIFQNN ) # s  ssinl = np.sin(2 * np.pi * np.linsp(0, 1, 100)) + 0.1 * np.no.nn( 100 ) # s qunu nul nwo pin("\n1. sin Qunu Nul Nwo...") inpu = ssinl[:4]  = np.y([0.5, -0.5, 0.2, -0.2]) qnnsul = posso.lifqununulnwo(inpu, ) pin(f" QNN Oupu: {qnnsul['oupus']}") pin(f" Loss: {qnnsul['loss']:.4f}") pin(f" nnln: {qnnsul['qunus'].nnlnsu:.4f}") # s qunu fu ppin pin("\n2. sin Qunu Fu ppin...") fus = posso.qunufup(inpu) pin(f" Fu insion: {ln(fus)}") pin(f" Fu spl: {fus[:5]}") # s Qunu Foui nsfo pin("\n3. sin Qunu Foui nsfo...") qfs = posso.qunufouinsfo() pin(f" QF nnln: {qfs.nnlnsu:.4f}") # s qunu-nhn sinl possin pin("\n4. sin Qunu-nhn Sinl Possin...") nhnnsul = qununhnsinlpossin(ssinl, posso) pin(f" nhnn io: {nhnnsul['nhnnio']:.4f}") pin(f" Possin suss: {nhnnsul['possinsuss']}") #  finl is is = posso.qunuis() pin(f"\n5. Finl Qunu is:") pin(f" loih: {is['loihyp']}") pin(f" Qubis: {is['nuqubis']}") pin(f" inin sps: {is['ininsps']}") pin(f" Qunu filiy: {is['qunufiliy']:.4f}") pin("\nQunu posso sin opl!") un posso, nhnnsul if n == "in": # un ss posso, suls = squnuposso()