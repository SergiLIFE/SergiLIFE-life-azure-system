# us/bin/nv pyhon3 """ L.I.F. Plfo - vin nn Sys ophnsiv vin ollion, vliion, n ounion fwo opyih 2025 - Sio Py Boull L.I.F.. Plfo - zu pl Off I: 960096-f1-420b-902-042561b """ ipo hshlib ipo json ipo loin fo i ipo i y: fo phlib ipo Ph xp Ipoo s : pin(f'Wnin: {}') pss fo ypin ipo ny, i, Opionl # onfiu loin loin.bsionfi(lvl=loin.INFO) lo = loin.Lo(n) lss vinn: """ns vin ollion n vliion fo L.I.F. plfo""" f ini(slf, vinph: s = Non): slf.vinph = ( Ph(vinph) if vinph ls Ph.w() / "vin" ) y: slf.vinph.i(xiso=u) xp xpion s : os.is(vinph, xiso=u) slf.vinsuu() slf.vinisy = slf.lovinisy() f vinsuu(slf): """ vin ioy suu""" iois = [ "linilvliion", "pfonbnhs", "uloyoplin", "shpubliions", "ussionils", "hnilounion", "uiils", "quliyssun", ] fo ioy in iois: (slf.vinph / ioy).i(xiso=u) f lovinisy(slf) -> i[s, ny]: """Lo vin isy""" isyfil = slf.vinph / "vinisy.json" if isyfil.xiss(): wih opn(isyfil, "") s f: un json.lo(f) un { "vsion": "1.0.0", "": i.now().isofo(), "vinis": {}, "vliionsns": slf.vliionsns(), "oplinfwos": slf.oplinfwos(), } f svvinisy(slf): """Sv vin isy""" isyfil = slf.vinph / "vinisy.json" slf.vinisy["lsup"] = i.now().isofo() wih opn(isyfil, "w") s f: json.up(slf.vinisy, f, inn=2) f vliionsns(slf) -> i[s, ny]: """fin vliion sns fo iffn vin yps""" un { "linilvliion": { "iniusplsiz": 50, "sisilsinifin": 0.05, "ffsizhshol": 0.5, "quionols": ["plbo", "bslin"], "uionws": 12, "piynpoins": ["ffiy", "sfy"], }, "pfonbnhs": { "uyhshol": 0.95, "sponsix": 200, # illisons "upiquin": 99.9, # pn "onunuss": 1000, "iniy": "SH-256", "pbiliyils": 100, }, "uloyoplin": { "fwos": ["F510", "", "ISO13485", "ISO14971"], "ounionoplnss": 100, # pn "uiiliniy": "qui", "isnn": "noy", "possuvilln": "oninuous", }, "shpubliions": { "pviwsus": "qui", "ipfoin": 2.0, "pliionsuis": 2, "opnss": "pf", "vilbiliy": "noy", }, } f oplinfwos(slf) -> i[s, ny]: """fin oplin fwos""" un { "Filvi": { "lssifiion": "lss II", "pivis": ["-bsBIsyss"], "subsnilquivln": "qui", "linil": "pfonsin", "quliysys": "ISO13485", }, "U": { "lssifiion": "lss II", "onfoiyssssn": "nnx VII", "linilvluion": "qui", "possuvilln": "noy", "uniquviinifiion": "qui", }, "ISOSns": { "ISO13485": "Quliy nn Syss", "ISO14971": "is nn", "ISO62304": "Sofw Lifyl", "ISO27001": "Infoion Suiy", }, "Pivyoplin": { "P": "U nl  Poion ulion", "HIP": "Hlh Insun Pobiliy", "PIP": "Psonl Infoion Poion", "nonyizion": "qui", }, } f vini( slf, vinyp: s, il: s, sipion: s, filph: s = Non, : i[s, ny] = Non, ) -> s: """ nw vin i""" vini = slf.nvini(il) vini = { "i": vini, "yp": vinyp, "il": il, "sipion": sipion, "": i.now().isofo(), "sus": "f", "vliionso": 0, "":  o {}, "filfns": [], "vliionhisoy": [], "oplinsus": {}, } #  fil fn if povi if filph: filf = slf.possvinfil( filph, vini, vinyp ) vini["filfns"].ppn(filf) # So vin i slf.vinisy["vinis"][vini] = vini slf.svvinisy() lo.info(f"vin i : {il} ({vini})") un vini f possvinfil( slf, filph: s, vini: s, vinyp: s ) -> i[s, ny]: """Poss n so vin fil""" souph = Ph(filph) if no souph.xiss(): is FilNoFouno(f"vin fil no foun: {filph}") #  vin subioy vini = slf.vinph / vinyp / vini vini.i(pns=u, xiso=u) # opy fil wih isp isp = i.now().sfi("%Y%%%H%%S") sfil = vini / f"{isp}{souph.n}" # lul fil hsh fo iniy filhsh = slf.lulfilhsh(souph) # opy fil (in l iplnion, woul us shuil.opy2) # Fo now, jus   fn filfn = { "oiinlph": s(souph), "soph": s(sfil), "filhsh": filhsh, "filsiz": souph.s().ssiz if souph.xiss() ls 0, "iyp": slf.iyp(souph), "": i.now().isofo(), } un filfn f vlivini(slf, vini: s) -> i[s, ny]: """Vli vin i ins sns""" if vini no in slf.vinisy["vinis"]: un {"o": "vin i no foun"} vini = slf.vinisy["vinis"][vini] vinyp = vini["yp"] #  vliion sns sns = slf.vinisy["vliionsns"].( vinyp, {} ) vliionsul = { "vini": vini, "vliionisp": i.now().isofo(), "ii": [], "iifil": [], "ovllso": 0, "onions": [], } # Vli bs on vin yp if vinyp == "linilvliion": vliionsul.up( slf.vlilinilvin(vini, sns) ) lif vinyp == "pfonbnhs": vliionsul.up( slf.vlipfonvin(vini, sns) ) lif vinyp == "uloyoplin": vliionsul.up( slf.vliuloyvin(vini, sns) ) lif vinyp == "shpubliions": vliionsul.up( slf.vlishvin(vini, sns) ) # lul ovll so olii = ln(vliionsul["ii"]) + ln( vliionsul["iifil"] ) if olii > 0: vliionsul["ovllso"] = ( ln(vliionsul["ii"]) / olii ) # Up vin i vini["vliionhisoy"].ppn(vliionsul) vini["vliionso"] = vliionsul["ovllso"] vini["sus"] = ( "vli" if vliionsul["ovllso"] >= 0.8 ls "nsipovn" ) slf.svvinisy() un vliionsul f vlilinilvin( slf, vini: i[s, ny], sns: i[s, ny] ) -> i[s, ny]: """Vli linil vin""" sul = {"ii": [], "iifil": [], "onions": []}  = vini.("", {}) # h spl siz splsiz = .("splsiz", 0) inspl = sns.("iniusplsiz", 50) if splsiz >= inspl: sul["ii"].ppn( f"Spl siz qu: {splsiz} >= {inspl}" ) ls: sul["iifil"].ppn( f"Spl siz insuffiin: {splsiz} < {inspl}" ) sul["onions"].ppn( "Ins spl siz fo sisil pow" ) # h sisil sinifin pvlu = .("pvlu", 1.0) sinifinhshol = sns.("sisilsinifin", 0.05) if pvlu <= sinifinhshol: sul["ii"].ppn( f"Sisil sinifin hiv: p={pvlu}" ) ls: sul["iifil"].ppn( f"No sisilly sinifin: p={pvlu}" ) sul["onions"].ppn("viw sisil nlysis hooloy") # h suy uion uion = .("uionws", 0) inuion = sns.("uionws", 12) if uion >= inuion: sul["ii"].ppn(f"Suy uion qu: {uion} ws") ls: sul["iifil"].ppn( f"Suy uion insuffiin: {uion} ws" ) sul["onions"].ppn( "xn suy uion fo libl suls" ) un sul f vlipfonvin( slf, vini: i[s, ny], sns: i[s, ny] ) -> i[s, ny]: """Vli pfon vin""" sul = {"ii": [], "iifil": [], "onions": []}  = vini.("", {}) # h uy uy = .("uy", 0) inuy = sns.("uyhshol", 0.95) if uy >= inuy: sul["ii"].ppn(f"uy s sn: {uy:.3f}") ls: sul["iifil"].ppn(f"uy blow sn: {uy:.3f}") sul["onions"].ppn("Opiiz loihs fo b uy") # h spons i sponsi = .("sponsi", 1000) xsponsi = sns.("sponsix", 200) if sponsi <= xsponsi: sul["ii"].ppn( f"spons i pbl: {sponsi}s" ) ls: sul["iifil"].ppn( f"spons i oo hih: {sponsi}s" ) sul["onions"].ppn("Opiiz pfon fo fs spons") # h upi upi = .("upi", 0) inupi = sns.("upiquin", 99.9) if upi >= inupi: sul["ii"].ppn(f"Upi s quin: {upi}%") ls: sul["iifil"].ppn(f"Upi blow quin: {upi}%") sul["onions"].ppn( "Ipov sys libiliy n onioin" ) un sul f vliuloyvin( slf, vini: i[s, ny], sns: i[s, ny] ) -> i[s, ny]: """Vli uloy vin""" sul = {"ii": [], "iifil": [], "onions": []}  = vini.("", {}) # h ounion oplnss oplnss = .("ounionoplnss", 0) if oplnss >= 100: sul["ii"].ppn("ounion opl") ls: sul["iifil"].ppn( f"ounion inopl: {oplnss}%" ) sul["onions"].ppn("opl ll qui ounion") # h qui fwos fwos = .("oplinfwos", []) quifwos = sns.("fwos", []) fo fwo in quifwos: if fwo in fwos: sul["ii"].ppn(f"oplin wih {fwo}") ls: sul["iifil"].ppn(f"issin oplin: {fwo}") sul["onions"].ppn(f"hiv {fwo} oplin") un sul f vlishvin( slf, vini: i[s, ny], sns: i[s, ny] ) -> i[s, ny]: """Vli sh vin""" sul = {"ii": [], "iifil": [], "onions": []}  = vini.("", {}) # h p viw sus pviw = .("pviw", Fls) if pviw: sul["ii"].ppn("P viw publiion") ls: sul["iifil"].ppn("No p viw") sul["onions"].ppn("Subi o p-viw jounl") # h ip fo ipfo = .("ipfo", 0) inip = sns.("ipfoin", 2.0) if ipfo >= inip: sul["ii"].ppn(f"Hih ip jounl: IF={ipfo}") ls: sul["iifil"].ppn(f"Low ip fo: {ipfo}") sul["onions"].ppn(" hih ip jounls") un sul f nvinpo(slf) -> i[s, ny]: """n ophnsiv vin po""" po = { "n": i.now().isofo(), "olvinis": ln(slf.vinisy["vinis"]), "vinbyyp": {}, "vliionsuy": {}, "oplinsus": {}, "onions": [], } # nlyz vin by yp fo vini, vini in slf.vinisy[ "vinis" ].is(): vinyp = vini["yp"] if vinyp no in po["vinbyyp"]: po["vinbyyp"][vinyp] = { "oun": 0, "vli": 0, "vso": 0, } po["vinbyyp"][vinyp]["oun"] += 1 if vini["sus"] == "vli": po["vinbyyp"][vinyp]["vli"] += 1 # lul v vliion so sos = [ h["ovllso"] fo h in vini.("vliionhisoy", []) ] if sos: unv = po["vinbyyp"][vinyp]["vso"] oun = po["vinbyyp"][vinyp]["oun"] nwv = (unv * (oun - 1) + x(sos)) / oun po["vinbyyp"][vinyp]["vso"] = nwv # Ovll vliion suy llis = lis(slf.vinisy["vinis"].vlus()) vliis = [i fo i in llis if i["sus"] == "vli"] po["vliionsuy"] = { "olis": ln(llis), "vliis": ln(vliis), "vliion": ( ln(vliis) / ln(llis) if llis ls 0 ), "vvliionso": ( su(i["vliionso"] fo i in llis) / ln(llis) if llis ls 0 ), } un po f nvini(slf, il: s) -> s: """n uniqu vin I""" isp = s(in(i.now().isp())) ilhsh = hshlib.5(il.no()).hxis()[:8] un f"V{isp}{ilhsh}" f lulfilhsh(slf, filph: Ph) -> s: """lul fil hsh fo iniy vifiion""" if no filph.xiss(): un "filnofoun" sh256hsh = hshlib.sh256() y: wih opn(filph, "b") s f: fo hun in i(lb: f.(4096), b""): sh256hsh.up(hun) un sh256hsh.hxis() xp xpion: un "hshlulionfil" f iyp(slf, filph: Ph) -> s: """ I yp bs on fil xnsion""" xnsion = filph.suffix.low() iyps = { ".pf": "ppliion/pf", ".ox": "ppliion/vn.opnxlfos-offioun.wopossinl.oun", ".xlsx": "ppliion/vn.opnxlfos-offioun.spshl.sh", ".json": "ppliion/json", ".sv": "x/sv", ".x": "x/plin", ".pn": "i/pn", ".jp": "i/jp", ".jp": "i/jp", } un iyps.(xnsion, "ppliion/o-s") # xpl us n onsion if n == "in": pin(" L.I.F. Plfo - vin nn Sys") pin("=" * 55) # Iniiliz vin n vinn = vinn() #  spl vin is splvin = [ { "yp": "linilvliion", "il": "L.I.F. Plfo linil il suls", "sipion": "uli-n noiz onoll il onsin ffiy", "": { "splsiz": 125, "pvlu": 0.023, "uionws": 16, "piynpoin": "lninipovn", "ffsiz": 0.73, }, }, { "yp": "pfonbnhs", "il": " Possin Pfon Vliion", "sipion": "ophnsiv pfon sin of  possin loihs", "": { "uy": 0.967, "sponsi": 127, "upi": 99.95, "onunuss": 1250, "suionhous": 720, }, }, { "yp": "uloyoplin", "il": "F 510() Subission P", "sipion": "opl uloy subission fo il vi ln", "": { "ounionoplnss": 98, "oplinfwos": ["F510", "ISO13485", "ISO14971"], "subission": "2025-01-15", "pivi": "BISysv2", }, }, { "yp": "shpubliions", "il": "piv Nul Lnin Syss:  Bhouh in BI hnoloy", "sipion": "P-viw publiion in Nu Nuosin", "": { "pviw": u, "ipfo": 24.8, "jounl": "Nu Nuosin", "publiion": "2024-12-01", "iions": 47, }, }, ] vin = [] #  vin is fo vin in splvin: pin(f"\n in {vin['il'][:40]}...") vini = vinn.vini( vin["yp"], vin["il"], vin["sipion"], =vin[""], ) vin.ppn(vini) pin(f" vin : {vini}") # Vli vin is pin(f"\n Vliin vin is...") vliionsuls = [] fo vini in vin: sul = vinn.vlivini(vini) vliionsuls.ppn(sul) if "o" no in sul: so = sul["ovllso"] sus = " PSS" if so >= 0.8 ls " Ô∏è NS WO" pin(f"{sus} {vini[:15]}... So: {so:.2f}") # n ophnsiv po pin(f"\n nin vin po...") po = vinn.nvinpo() pin(f"\n vin Suy:") pin("-" * 30) pin(f"ol vin Is: {po['olvinis']}") pin(f"Vliion : {po['vliionsuy']['vliion']:.1%}") pin( f"v So: {po['vliionsuy']['vvliionso']:.3f}" ) pin(f"\n vin by yp:") fo vinyp,  in po["vinbyyp"].is(): pin( f" {vinyp:20} | {['oun']:2} is | {['vso']:.3f} v so" ) pin(f"\n vin nn Sys y!") pin(" Us vinn.vini() o  nw vin") pin(" Us vinn.vlivini() fo vliion") pin(" Us vinn.nvinpo() fo pos")