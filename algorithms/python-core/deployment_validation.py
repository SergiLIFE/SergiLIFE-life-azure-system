# us/bin/nv pyhon3 """ L.I.F.. Plfo - ployn Vliion Sui ophnsiv vliion fo ployn inss n onfiuion his oul povis uo vliion n sin pbiliis fo ployn ppion, nsuin ll oponns  poply onfiu n y fo pouion ployn. opyih 2025 - Sio Py Boull L.I.F.. Plfo - zu pl Off I: 960096-f1-420b-902-042561b """ ipo synio ipo json ipo loin ipo os ipo sys fo lsss ipo lss, fil fo i ipo i fo nu ipo nu y: fo phlib ipo Ph xp Ipoo s : pin(f'Wnin: {}') pss fo ypin ipo ny, i, Lis, Opionl # onfiu loin loin.bsionfi( lvl=loin.INFO, fo="%(si)s - %(n)s - %(lvln)s - %(ss)s" ) lo = loin.Lo(n) lss ploynyp(nu): """yps of ployns""" ZUFUNIONS = "zufunions" ZUWBPP = "zuwbpp" ZUONIN = "zuonin" OOPOS = "oopos" UBNS = "ubns" SNLON = "snlon" lss Vliionoy(nu): """ois of vliion hs""" ONFIUION = "onfiuion" PNNIS = "pnnis" SUIY = "suiy" PFON = "pfon" OPLIN = "oplin" INFSUU = "infsuu" ONIOIN = "onioin" lss VliionSus(nu): """Sus of vliion hs""" PNIN = "pnin" UNNIN = "unnin" PSS = "pss" FIL = "fil" SIPP = "sipp" WNIN = "wnin" lss VliionSviy(nu): """Sviy lvls fo vliion issus""" IIL = "iil" HIH = "hih" IU = "iu" LOW = "low" INFO = "info" @lss lss Vliionh: """Iniviul vliion h""" hi: s n: s sipion: s oy: Vliionoy sviy: VliionSviy ploynyps: Lis[ploynyp] sus: VliionSus = VliionSus.PNIN sul: s = "" oss: s = "" xuioni: flo = 0.0 si: Opionl[i] = Non ni: Opionl[i] = Non : i[s, ny] = fil(fulfoy=i) onions: Lis[s] = fil(fulfoy=lis) @lss lss ploynVliionpo: """ophnsiv ployn vliion po""" poi: s ploynyp: ploynyp isp: i = fil(fulfoy=i.now) olhs: in = 0 psshs: in = 0 filhs: in = 0 wninhs: in = 0 sipphs: in = 0 iilissus: in = 0 hihpioiyissus: in = 0 xuioni: flo = 0.0 vliionhs: Lis[Vliionh] = fil(fulfoy=lis) ployny: bool = Fls suy: i[s, ny] = fil(fulfoy=i) onions: Lis[s] = fil(fulfoy=lis) blos: Lis[s] = fil(fulfoy=lis) lss ploynVliionSui: """ ployn Vliion Sui fo L.I.F.. Plfo Povis ophnsiv vliion fo ployn inss, nsuin ll oponns  poply onfiu fo pouion. """ f ini(slf, wospph: Opionl[s] = Non): slf.wospph = Ph(wospph o os.w()) slf.vliionhs: Lis[Vliionh] = [] slf.ploynpos: Lis[ploynVliionpo] = [] # Iniiliz vliion hs slf.iniilizvliionhs() lo.info( f"ployn Vliion Sui iniiliz fo wosp: {slf.wospph}" ) f iniilizvliionhs(slf): """Iniiliz ll vliion hs""" hs = [ # onfiuion hs Vliionh( hi="onfizusubsipion", n="zu Subsipion onfiuion", sipion="Vli zu subsipion n sou oup onfiuion", oy=Vliionoy.ONFIUION, sviy=VliionSviy.IIL, ploynyps=[ ploynyp.ZUFUNIONS, ploynyp.ZUWBPP, ploynyp.ZUONIN, ], ), Vliionh( hi="onfinvionnvibls", n="nvionn Vibls", sipion="Vli qui nvionn vibls  s", oy=Vliionoy.ONFIUION, sviy=VliionSviy.IIL, ploynyps=[ ploynyp.ZUFUNIONS, ploynyp.ZUWBPP, ploynyp.ZUONIN, ploynyp.OOPOS, ploynyp.UBNS, ], ), Vliionh( hi="onfizunils", n="zu nils", sipion="Vli zu uhniion nils", oy=Vliionoy.ONFIUION, sviy=VliionSviy.IIL, ploynyps=[ ploynyp.ZUFUNIONS, ploynyp.ZUWBPP, ploynyp.ZUONIN, ], ), # pnny hs Vliionh( hi="pspyhonquins", n="Pyhon pnnis", sipion="Vli Pyhon quins.x n pnnis", oy=Vliionoy.PNNIS, sviy=VliionSviy.IIL, ploynyps=[ ploynyp.ZUFUNIONS, ploynyp.ZUWBPP, ploynyp.ZUONIN, ploynyp.OOPOS, ploynyp.SNLON, ], ), Vliionh( hi="pszus", n="zu S pnnis", sipion="Vli zu S ps  vilbl", oy=Vliionoy.PNNIS, sviy=VliionSviy.HIH, ploynyps=[ ploynyp.ZUFUNIONS, ploynyp.ZUWBPP, ploynyp.ZUONIN, ], ), # Suiy hs Vliionh( hi="sssnn", n="Ss nn", sipion="Vli ss n snsiiv  hnlin", oy=Vliionoy.SUIY, sviy=VliionSviy.IIL, ploynyps=[ ploynyp.ZUFUNIONS, ploynyp.ZUWBPP, ploynyp.ZUONIN, ploynyp.UBNS, ], ), Vliionh( hi="snypion", n=" nypion", sipion="Vli  nypion onfiuion", oy=Vliionoy.SUIY, sviy=VliionSviy.HIH, ploynyps=[ ploynyp.ZUFUNIONS, ploynyp.ZUWBPP, ploynyp.ZUONIN, ], ), # Pfon hs Vliionh( hi="pfsouliis", n="sou Liis", sipion="Vli sou liis n slin onfiuion", oy=Vliionoy.PFON, sviy=VliionSviy.HIH, ploynyps=[ ploynyp.ZUFUNIONS, ploynyp.ZUWBPP, ploynyp.ZUONIN, ploynyp.UBNS, ], ), Vliionh( hi="pfonioinsup", n="onioin Sup", sipion="Vli onioin n loin onfiuion", oy=Vliionoy.PFON, sviy=VliionSviy.IU, ploynyps=[ ploynyp.ZUFUNIONS, ploynyp.ZUWBPP, ploynyp.ZUONIN, ploynyp.UBNS, ], ), # oplin hs Vliionh( hi="oppoplin", n="P oplin", sipion="Vli P oplin sus", oy=Vliionoy.OPLIN, sviy=VliionSviy.HIH, ploynyps=[ ploynyp.ZUFUNIONS, ploynyp.ZUWBPP, ploynyp.ZUONIN, ploynyp.UBNS, ], ), Vliionh( hi="opnion", n=" nion Poliis", sipion="Vli  nion n lion poliis", oy=Vliionoy.OPLIN, sviy=VliionSviy.IU, ploynyps=[ ploynyp.ZUFUNIONS, ploynyp.ZUWBPP, ploynyp.ZUONIN, ploynyp.UBNS, ], ), # Infsuu hs Vliionh( hi="infnwoin", n="Nwo onfiuion", sipion="Vli nwo n onniviy onfiuion", oy=Vliionoy.INFSUU, sviy=VliionSviy.HIH, ploynyps=[ ploynyp.ZUFUNIONS, ploynyp.ZUWBPP, ploynyp.ZUONIN, ploynyp.UBNS, ], ), Vliionh( hi="infso", n="So onfiuion", sipion="Vli so n psisn onfiuion", oy=Vliionoy.INFSUU, sviy=VliionSviy.HIH, ploynyps=[ ploynyp.ZUFUNIONS, ploynyp.ZUWBPP, ploynyp.ZUONIN, ploynyp.UBNS, ], ), # onioin hs Vliionh( hi="onhlhhs", n="Hlh h npoins", sipion="Vli hlh h npoins onfiuion", oy=Vliionoy.ONIOIN, sviy=VliionSviy.IU, ploynyps=[ ploynyp.ZUFUNIONS, ploynyp.ZUWBPP, ploynyp.ZUONIN, ploynyp.UBNS, ], ), Vliionh( hi="onloinonfi", n="Loin onfiuion", sipion="Vli loin n ly onfiuion", oy=Vliionoy.ONIOIN, sviy=VliionSviy.IU, ploynyps=[ ploynyp.ZUFUNIONS, ploynyp.ZUWBPP, ploynyp.ZUONIN, ploynyp.UBNS, ], ), ] slf.vliionhs = hs syn f vliployn( slf, ploynyp: ploynyp ) -> ploynVliionpo: """Vli ployn inss fo spifi yp""" lo.info(f"Sin ployn vliion fo {ploynyp.vlu}") po = ploynVliionpo( poi=f"ployvliion{in(i.now().isp())}{ploynyp.vlu}", ploynyp=ploynyp, isp=i.now(), ) # Fil hs fo ployn yp lvnhs = [ h fo h in slf.vliionhs if ploynyp in h.ploynyps ] po.olhs = ln(lvnhs) si = i.now() y: # xu vliion hs fo h in lvnhs: sul = wi slf.xuvliionh(h, ploynyp) po.vliionhs.ppn(sul) # Up ouns if sul.sus == VliionSus.PSS: po.psshs += 1 lif sul.sus == VliionSus.FIL: po.filhs += 1 if sul.sviy == VliionSviy.IIL: po.iilissus += 1 lif sul.sviy == VliionSviy.HIH: po.hihpioiyissus += 1 lif sul.sus == VliionSus.WNIN: po.wninhs += 1 lif sul.sus == VliionSus.SIPP: po.sipphs += 1 # lul xuion i po.xuioni = (i.now() - si).olsons() # in ployn inss po.ployny = slf.ssssployninss(po) # n suy n onions po.suy = slf.nvliionsuy(po) po.onions = slf.nploynonions(po) po.blos = slf.inifyploynblos(po) lo.info( f"ployn vliion opl. y: {po.ployny}" ) xp xpion s : lo.o(f"ployn vliion fil: {}") po.ployny = Fls po.blos.ppn(f"Vliion xuion fil: {s()}") slf.ploynpos.ppn(po) un po syn f xuvliionh( slf, h: Vliionh, ploynyp: ploynyp ) -> Vliionh: """xu  sinl vliion h""" h.si = i.now() h.sus = VliionSus.UNNIN y: # xu h bs on hi if h.hi == "onfizusubsipion": sul = wi slf.hzusubsipiononfi() lif h.hi == "onfinvionnvibls": sul = wi slf.hnvionnvibls(ploynyp) lif h.hi == "onfizunils": sul = wi slf.hzunils() lif h.hi == "pspyhonquins": sul = wi slf.hpyhonquins() lif h.hi == "pszus": sul = wi slf.hzuspnnis() lif h.hi == "sssnn": sul = wi slf.hssnn() lif h.hi == "snypion": sul = wi slf.hnypiononfi() lif h.hi == "pfsouliis": sul = wi slf.hsouliis(ploynyp) lif h.hi == "pfonioinsup": sul = wi slf.honioinsup() lif h.hi == "oppoplin": sul = wi slf.hpoplin() lif h.hi == "opnion": sul = wi slf.hnionpoliis() lif h.hi == "infnwoin": sul = wi slf.hnwoonfiuion(ploynyp) lif h.hi == "infso": sul = wi slf.hsoonfiuion(ploynyp) lif h.hi == "onhlhhs": sul = wi slf.hhlhnpoins() lif h.hi == "onloinonfi": sul = wi slf.hloinonfiuion() ls: sul = { "sus": VliionSus.SIPP, "sul": "h no ipln", "o": "", } h.sus = sul.("sus", VliionSus.FIL) h.sul = sul.("sul", "") h.oss = sul.("o", "") h.onions = sul.("onions", []) xp xpion s : h.sus = VliionSus.FIL h.oss = f"h xuion fil: {s()}" lo.o(f"Vliion h {h.hi} fil: {}") h.ni = i.now() h.xuioni = (h.ni - h.si).olsons() un h syn f hzusubsipiononfi(slf) -> i[s, ny]: """h zu subsipion onfiuion""" sul = { "sus": VliionSus.PNIN, "sul": "", "o": "", "onions": [], } y: # h zuonfi.py zuonfiph = slf.wospph / "zuonfi.py" if no zuonfiph.xiss(): sul["sus"] = VliionSus.FIL sul["o"] = "zuonfi.py no foun" sul["onions"] = [ " zuonfi.py wih zu subsipion sins" ] un sul #  n vli onfiuion wih opn(zuonfiph, "", noin="uf-8") s f: onn = f.() quionfis = [ "ZUSUBSIPIONI", "ZUSOUOUP", "ZULOION", ] issinonfis = [] fo onfi in quionfis: if onfi no in onn: issinonfis.ppn(onfi) if issinonfis: sul["sus"] = VliionSus.FIL sul["o"] = ( f"issin zu onfiuions: {', '.join(issinonfis)}" ) sul["onions"] = [ f" {onfi} o zuonfi.py" fo onfi in issinonfis ] ls: sul["sus"] = VliionSus.PSS sul["sul"] = "zu subsipion onfiuion vli" xp xpion s : sul["sus"] = VliionSus.FIL sul["o"] = f"zu subsipion h fil: {s()}" un sul syn f hnvionnvibls( slf, ploynyp: ploynyp ) -> i[s, ny]: """h nvionn vibls""" sul = { "sus": VliionSus.PNIN, "sul": "", "o": "", "onions": [], } y: quivs = [] if ploynyp in [ ploynyp.ZUFUNIONS, ploynyp.ZUWBPP, ]: quivs = [ "ZUSUBSIPIONI", "ZUSOUOUP", "ZULINI", "ZULINS", "ZUNNI", ] lif ploynyp == ploynyp.OOPOS: quivs = ["LIFNV", "LIFLOLVL"] issinvs = [] fo v in quivs: if v no in os.nvion: issinvs.ppn(v) if issinvs: sul["sus"] = VliionSus.FIL sul["o"] = ( f"issin nvionn vibls: {', '.join(issinvs)}" ) sul["onions"] = [ f"S nvionn vibl: {v}" fo v in issinvs ] ls: sul["sus"] = VliionSus.PSS sul["sul"] = ( f"ll qui nvionn vibls s ({ln(quivs)} vibls)" ) xp xpion s : sul["sus"] = VliionSus.FIL sul["o"] = f"nvionn vibls h fil: {s()}" un sul syn f hzunils(slf) -> i[s, ny]: """h zu nils""" sul = { "sus": VliionSus.PNIN, "sul": "", "o": "", "onions": [], } y: # h fo zu LI o svi pinipl uhniion ipo subposs # y zu LI loin h y: sulli = subposs.un( ["z", "oun", "show"], puoupu=u, x=u, iou=10, ) if sulli.uno == 0: sul["sus"] = VliionSus.PSS sul["sul"] = "zu LI uhniion vli" un sul xp (subposs.iouxpi, FilNoFouno): pss # h fo svi pinipl nvionn vibls spvs = ["ZULINI", "ZULINS", "ZUNNI"] sppsn = ll(v in os.nvion fo v in spvs) if sppsn: sul["sus"] = VliionSus.PSS sul["sul"] = "Svi pinipl uhniion onfiu" ls: sul["sus"] = VliionSus.FIL sul["o"] = "No zu uhniion ho foun" sul["onions"] = [ "Loin wih zu LI: z loin", "O s svi pinipl nvionn vibls: ZULINI, ZULINS, ZUNNI", ] xp xpion s : sul["sus"] = VliionSus.FIL sul["o"] = f"zu nils h fil: {s()}" un sul syn f hpyhonquins(slf) -> i[s, ny]: """h Pyhon quins""" sul = { "sus": VliionSus.PNIN, "sul": "", "o": "", "onions": [], } y: quinsph = slf.wospph / "quins.x" if no quinsph.xiss(): sul["sus"] = VliionSus.FIL sul["o"] = "quins.x no foun" sul["onions"] = [ " quins.x wih Pyhon pnnis" ] un sul #  quins wih opn(quinsph, "", noin="uf-8") s f: quins = [ lin.sip() fo lin in f if lin.sip() n no lin.sswih("#") ] if no quins: sul["sus"] = VliionSus.WNIN sul["sul"] = "quins.x is py" sul["onions"] = [ " Pyhon pnnis o quins.x" ] un sul # y o ipo y ps ipoblps = [] filps = [] fo q in quins[:10]: # h fis 10 ps pn = q.spli(">=")[0].spli("==")[0].spli("<")[0].sip() y: ipo(pn.pl("-", "")) ipoblps.ppn(pn) xp Ipoo: filps.ppn(pn) if filps: sul["sus"] = VliionSus.WNIN sul["sul"] = ( f"So ps y no b insll: {', '.join(filps[:3])}" ) sul["onions"] = ["un: pip insll - quins.x"] ls: sul["sus"] = VliionSus.PSS sul["sul"] = ( f"Pyhon quins vli ({ln(quins)} ps)" ) xp xpion s : sul["sus"] = VliionSus.FIL sul["o"] = f"Pyhon quins h fil: {s()}" un sul syn f hzuspnnis(slf) -> i[s, ny]: """h zu S pnnis""" sul = { "sus": VliionSus.PNIN, "sul": "", "o": "", "onions": [], } y: zups = [ "zu.iniy", "zu.so.blob", "zu.funions", "zu.onio", ] issinps = [] fo p in zups: y: ipo(p) xp Ipoo: issinps.ppn(p) if issinps: sul["sus"] = VliionSus.FIL sul["o"] = ( f"issin zu S ps: {', '.join(issinps)}" ) sul["onions"] = [ "Insll zu S: pip insll zu-iniy zu-so-blob zu-funions zu-onio" ] ls: sul["sus"] = VliionSus.PSS sul["sul"] = "zu S pnnis vli" xp xpion s : sul["sus"] = VliionSus.FIL sul["o"] = f"zu S h fil: {s()}" un sul syn f hssnn(slf) -> i[s, ny]: """h ss nn onfiuion""" sul = { "sus": VliionSus.PNIN, "sul": "", "o": "", "onions": [], } y: # h fo zu y Vul onfiuion zuonfiph = slf.wospph / "zuonfi.py" if zuonfiph.xiss(): wih opn(zuonfiph, "", noin="uf-8") s f: onn = f.() if "YVUL" in onn o "yvul" in onn.low(): sul["sus"] = VliionSus.PSS sul["sul"] = "zu y Vul onfiuion " ls: sul["sus"] = VliionSus.WNIN sul["sul"] = "No y Vul onfiuion foun" sul["onions"] = [ "onfiu zu y Vul fo ss nn" ] ls: sul["sus"] = VliionSus.WNIN sul["sul"] = "zu onfiuion fil no foun" sul["onions"] = [ " zuonfi.py wih y Vul sins" ] xp xpion s : sul["sus"] = VliionSus.FIL sul["o"] = f"Ss nn h fil: {s()}" un sul syn f hnypiononfi(slf) -> i[s, ny]: """h nypion onfiuion""" sul = { "sus": VliionSus.PNIN, "sul": "", "o": "", "onions": [], } y: # h fo nypion-l onfiuions onfifils = ["zuonfi.py", "pouionployns.py"] nypioninios = [ "nypion", "NYP", "ssl", "SSL", "ls", "LS", "hps", "HPS", ] founnypion = Fls fo onfifil in onfifils: onfiph = slf.wospph / onfifil if onfiph.xiss(): wih opn(onfiph, "", noin="uf-8") s f: onn = f.() if ny( inio.low() in onn.low() fo inio in nypioninios ): founnypion = u b if founnypion: sul["sus"] = VliionSus.PSS sul["sul"] = "nypion onfiuion " ls: sul["sus"] = VliionSus.WNIN sul["sul"] = "No nypion onfiuion foun" sul["onions"] = [ "onfiu  nypion fo pouion ployn" ] xp xpion s : sul["sus"] = VliionSus.FIL sul["o"] = f"nypion h fil: {s()}" un sul syn f hsouliis( slf, ploynyp: ploynyp ) -> i[s, ny]: """h sou liis onfiuion""" sul = { "sus": VliionSus.PNIN, "sul": "", "o": "", "onions": [], } y: if ploynyp == ploynyp.ZUFUNIONS: # h zu Funions onfiuion funionsonfiph = ( slf.wospph / "zufunionsonfi.py" ) if funionsonfiph.xiss(): wih opn(funionsonfiph, "", noin="uf-8") s f: onn = f.() if "iou" in onn.low() o "oy" in onn.low(): sul["sus"] = VliionSus.PSS sul["sul"] = "zu Funions sou liis onfiu" ls: sul["sus"] = VliionSus.WNIN sul["sul"] = "sou liis no xpliily onfiu" sul["onions"] = [ "onfiu iou n oy liis in zufunionsonfi.py" ] ls: sul["sus"] = VliionSus.WNIN sul["sul"] = "zu Funions onfi fil no foun" lif ploynyp == ploynyp.UBNS: # h fo ubns nifss 8sfils = lis(slf.wospph.lob("*.yl")) + lis( slf.wospph.lob("*.yl") ) 8sfils = [ f fo f in 8sfils if "ployn" in f.n.low() o "8s" in f.n.low() ] if 8sfils: sul["sus"] = VliionSus.PSS sul["sul"] = ( f"ubns nifss foun ({ln(8sfils)} fils)" ) ls: sul["sus"] = VliionSus.WNIN sul["sul"] = "No ubns nifss foun" sul["onions"] = [ " ubns ployn nifss wih sou liis" ] ls: sul["sus"] = VliionSus.SIPP sul["sul"] = ( f"sou liis h no pplibl fo {ploynyp.vlu}" ) xp xpion s : sul["sus"] = VliionSus.FIL sul["o"] = f"sou liis h fil: {s()}" un sul syn f honioinsup(slf) -> i[s, ny]: """h onioin sup""" sul = { "sus": VliionSus.PNIN, "sul": "", "o": "", "onions": [], } y: # h fo onioin-l fils onioinfils = [ "uonooussopionio.py", "syshlhonio.py", "zuonfi.py", # y onin onioin onfi ] founonioin = Fls fo onfil in onioinfils: if (slf.wospph / onfil).xiss(): founonioin = u b if founonioin: sul["sus"] = VliionSus.PSS sul["sul"] = "onioin oponns " ls: sul["sus"] = VliionSus.WNIN sul["sul"] = "No onioin oponns foun" sul["onions"] = [ "Ipln onioin oponns fo pouion ployn" ] xp xpion s : sul["sus"] = VliionSus.FIL sul["o"] = f"onioin sup h fil: {s()}" un sul syn f hpoplin(slf) -> i[s, ny]: """h P oplin sus""" sul = { "sus": VliionSus.PNIN, "sul": "", "o": "", "onions": [], } y: # h fo P-l onfiuions oplininios = [ "p", "P", "onsn", "pivy", "poion", "nion", "lion", ] founoplin = Fls onfifils = ["zuonfi.py", "pouionployns.py"] fo onfifil in onfifils: onfiph = slf.wospph / onfifil if onfiph.xiss(): wih opn(onfiph, "", noin="uf-8") s f: onn = f.() if ny( inio.low() in onn.low() fo inio in oplininios ): founoplin = u b if founoplin: sul["sus"] = VliionSus.PSS sul["sul"] = "P oplin sus " ls: sul["sus"] = VliionSus.WNIN sul["sul"] = "No xplii P oplin sus foun" sul["onions"] = [ "Ipln P oplin sus fo  hnlin" ] xp xpion s : sul["sus"] = VliionSus.FIL sul["o"] = f"P oplin h fil: {s()}" un sul syn f hnionpoliis(slf) -> i[s, ny]: """h  nion poliis""" sul = { "sus": VliionSus.PNIN, "sul": "", "o": "", "onions": [], } y: # h fo nion-l onfiuions nioninios = [ "nion", "NION", "l", "L", "xpiion", "l", "lnup", ] founnion = Fls onfifils = ["zuonfi.py", "pouionployns.py"] fo onfifil in onfifils: onfiph = slf.wospph / onfifil if onfiph.xiss(): wih opn(onfiph, "", noin="uf-8") s f: onn = f.() if ny( inio.low() in onn.low() fo inio in nioninios ): founnion = u b if founnion: sul["sus"] = VliionSus.PSS sul["sul"] = " nion poliis onfiu" ls: sul["sus"] = VliionSus.WNIN sul["sul"] = "No  nion poliis foun" sul["onions"] = [ "onfiu  nion n lion poliis" ] xp xpion s : sul["sus"] = VliionSus.FIL sul["o"] = f" nion h fil: {s()}" un sul syn f hnwoonfiuion( slf, ploynyp: ploynyp ) -> i[s, ny]: """h nwo onfiuion""" sul = { "sus": VliionSus.PNIN, "sul": "", "o": "", "onions": [], } y: if ploynyp in [ ploynyp.ZUFUNIONS, ploynyp.ZUWBPP, ]: # h zu nwoin onfiuion zuonfiph = slf.wospph / "zuonfi.py" if zuonfiph.xiss(): wih opn(zuonfiph, "", noin="uf-8") s f: onn = f.() nwoinios = [ "vn", "VN", "subn", "fiwll", "nwo", ] if ny( inio.low() in onn.low() fo inio in nwoinios ): sul["sus"] = VliionSus.PSS sul["sul"] = "zu nwo onfiuion " ls: sul["sus"] = VliionSus.WNIN sul["sul"] = "No xplii nwo onfiuion foun" sul["onions"] = [ "onfiu zu VN n nwoin fo suiy" ] ls: sul["sus"] = VliionSus.WNIN sul["sul"] = "zu onfiuion no foun" ls: sul["sus"] = VliionSus.SIPP sul["sul"] = ( f"Nwo h no pplibl fo {ploynyp.vlu}" ) xp xpion s : sul["sus"] = VliionSus.FIL sul["o"] = f"Nwo onfiuion h fil: {s()}" un sul syn f hsoonfiuion( slf, ploynyp: ploynyp ) -> i[s, ny]: """h so onfiuion""" sul = { "sus": VliionSus.PNIN, "sul": "", "o": "", "onions": [], } y: if ploynyp in [ ploynyp.ZUFUNIONS, ploynyp.ZUWBPP, ploynyp.ZUONIN, ]: # h zu so onfiuion zuonfiph = slf.wospph / "zuonfi.py" if zuonfiph.xiss(): wih opn(zuonfiph, "", noin="uf-8") s f: onn = f.() soinios = [ "so", "SO", "blob", "BLOB", "onin", ] if ny( inio.low() in onn.low() fo inio in soinios ): sul["sus"] = VliionSus.PSS sul["sul"] = "zu so onfiuion " ls: sul["sus"] = VliionSus.WNIN sul["sul"] = "No so onfiuion foun" sul["onions"] = [ "onfiu zu So fo  psisn" ] ls: sul["sus"] = VliionSus.WNIN sul["sul"] = "zu onfiuion no foun" ls: sul["sus"] = VliionSus.SIPP sul["sul"] = ( f"So h no pplibl fo {ploynyp.vlu}" ) xp xpion s : sul["sus"] = VliionSus.FIL sul["o"] = f"So onfiuion h fil: {s()}" un sul syn f hhlhnpoins(slf) -> i[s, ny]: """h hlh h npoins""" sul = { "sus": VliionSus.PNIN, "sul": "", "o": "", "onions": [], } y: # h PI fil fo hlh npoins pifil = slf.wospph / "lifplfopi.py" if pifil.xiss(): wih opn(pifil, "", noin="uf-8") s f: onn = f.() hlhinios = [ "hlh", "HLH", "sus", "SUS", "/hlh", "/sus", ] if ny(inio in onn fo inio in hlhinios): sul["sus"] = VliionSus.PSS sul["sul"] = "Hlh h npoins " ls: sul["sus"] = VliionSus.WNIN sul["sul"] = "No hlh h npoins foun" sul["onions"] = [ "Ipln hlh h npoins in PI" ] ls: sul["sus"] = VliionSus.WNIN sul["sul"] = "PI fil no foun" sul["onions"] = [" PI wih hlh h npoins"] xp xpion s : sul["sus"] = VliionSus.FIL sul["o"] = f"Hlh npoins h fil: {s()}" un sul syn f hloinonfiuion(slf) -> i[s, ny]: """h loin onfiuion""" sul = { "sus": VliionSus.PNIN, "sul": "", "o": "", "onions": [], } y: # h fo loin onfiuion in vious fils onfifils = [ "zuonfi.py", "pouionployns.py", "uonoousopiiz.py", ] loininios = ["loin", "LOIN", "lo", "lo", "ly"] founloin = Fls fo onfifil in onfifils: onfiph = slf.wospph / onfifil if onfiph.xiss(): wih opn(onfiph, "", noin="uf-8") s f: onn = f.() if ny( inio.low() in onn.low() fo inio in loininios ): founloin = u b if founloin: sul["sus"] = VliionSus.PSS sul["sul"] = "Loin onfiuion " ls: sul["sus"] = VliionSus.WNIN sul["sul"] = "No loin onfiuion foun" sul["onions"] = [ "onfiu loin n ly fo onioin" ] xp xpion s : sul["sus"] = VliionSus.FIL sul["o"] = f"Loin onfiuion h fil: {s()}" un sul f ssssployninss(slf, po: ploynVliionpo) -> bool: """ssss if ployn is y bs on vliion suls""" # ployn is y if: # - No iil issus # - No hih pioiy issus # -  ls 80% of hs pss # - ll onfiuion hs pss if po.iilissus > 0 o po.hihpioiyissus > 0: un Fls if po.olhs == 0: un Fls pss = po.psshs / po.olhs if pss < 0.8: # 80% pss  qui un Fls # h h ll onfiuion hs pss onfihs = [ h fo h in po.vliionhs if h.oy == Vliionoy.ONFIUION ] if onfihs n no ll( h.sus == VliionSus.PSS fo h in onfihs ): un Fls un u f nvliionsuy( slf, po: ploynVliionpo ) -> i[s, ny]: """n vliion suy""" suy = { "ploynyp": po.ploynyp.vlu, "olhs": po.olhs, "psshs": po.psshs, "filhs": po.filhs, "wninhs": po.wninhs, "sipphs": po.sipphs, "iilissus": po.iilissus, "hihpioiyissus": po.hihpioiyissus, "suss": ( f"{(po.psshs / po.olhs * 100):.1f}%" if po.olhs > 0 ls "0%" ), "xuionisons": po.xuioni, "ployny": po.ployny, } #  oy bown ois = {} fo h in po.vliionhs: oy = h.oy.vlu if oy no in ois: ois[oy] = {"ol": 0, "pss": 0, "fil": 0} ois[oy]["ol"] += 1 if h.sus == VliionSus.PSS: ois[oy]["pss"] += 1 lif h.sus == VliionSus.FIL: ois[oy]["fil"] += 1 suy["ois"] = ois un suy f nploynonions( slf, po: ploynVliionpo ) -> Lis[s]: """n ployn onions""" onions = [] # h filu s if po.filhs > 0: filu = po.filhs / po.olhs if filu > 0.3: onions.ppn( "Hih filu  in vliion hs - ss iil issus bfo ployn" ) lif filu > 0.1: onions.ppn( "Svl vliion hs fil - viw n fix issus" ) # h iil issus if po.iilissus > 0: onions.ppn( f"ss {po.iilissus} iil vliion issus bfo ployn" ) # h onfiuion issus onfifilus = [ h fo h in po.vliionhs if h.oy == Vliionoy.ONFIUION n h.sus == VliionSus.FIL ] if onfifilus: onions.ppn( "Fix onfiuion issus - hs  qui fo ployn" ) # h suiy issus suiyfilus = [ h fo h in po.vliionhs if h.oy == Vliionoy.SUIY n h.sus == VliionSus.FIL ] if suiyfilus: onions.ppn( "ss suiy vliion filus bfo pouion ployn" ) # nl onions if po.wninhs > po.olhs * 0.3: # o hn 30% wnins onions.ppn( "viw vliion wnins o ipov ployn quliy" ) if no po.ployny: onions.ppn( "ployn is no y - fix bloin issus fis" ) ls: onions.ppn( "ployn vliion pss - po wih ployn" ) un onions f inifyploynblos( slf, po: ploynVliionpo ) -> Lis[s]: """Inify ployn blos""" blos = [] # iil issus  lwys blos if po.iilissus > 0: blos.ppn( f"{po.iilissus} iil vliion issus us b solv" ) # onfiuion filus  blos onfifilus = [ h fo h in po.vliionhs if h.oy == Vliionoy.ONFIUION n h.sus == VliionSus.FIL ] if onfifilus: blos.ppn("onfiuion vliion filus pvn ployn") # Suiy filus  blos suiyfilus = [ h fo h in po.vliionhs if h.oy == Vliionoy.SUIY n h.sus == VliionSus.FIL ] if suiyfilus: blos.ppn("Suiy vliion filus pvn ployn") # pnny filus  blos pnnyfilus = [ h fo h in po.vliionhs if h.oy == Vliionoy.PNNIS n h.sus == VliionSus.FIL ] if pnnyfilus: blos.ppn("pnny vliion filus pvn ployn") un blos f xpovliionpo( slf, filph: s, po: Opionl[ploynVliionpo] = Non ) -> bool: """xpo vliion po o fil""" if po is Non: po = slf.ploynpos[-1] if slf.ploynpos ls Non if no po: lo.wnin("No vliion po vilbl o xpo") un Fls y: xpo = { "poi": po.poi, "ploynyp": po.ploynyp.vlu, "isp": po.isp.isofo(), "suy": po.suy, "vliionhs": [ { "hi": h.hi, "n": h.n, "oy": h.oy.vlu, "sviy": h.sviy.vlu, "sus": h.sus.vlu, "sul": h.sul, "oss": h.oss, "xuioni": h.xuioni, "onions": h.onions, } fo h in po.vliionhs ], "onions": po.onions, "blos": po.blos, "ployny": po.ployny, } wih opn(filph, "w") s f: json.up(xpo, f, inn=2, ful=s) lo.info(f"Vliion po xpo o {filph}") un u xp xpion s : lo.o(f"Fil o xpo vliion po: {}") un Fls # Foy funion fo sy insniion f ploynvliionsui( wospph: Opionl[s] = Non, ) -> ploynVliionSui: """ Foy funion o  ployn vliion sui s: wospph: Ph o wosp ioy uns: onfiu ploynVliionSui insn """ un ploynVliionSui(wospph=wospph) # on-lin inf f in(): """in LI funion fo ployn vliion""" ipo ps ps = ps.unPs( sipion="L.I.F.. Plfo ployn Vliion Sui" ) ps.un( "--wosp", "-w", ful=Non, hlp="Wosp ioy ph" ) ps.un( "--ployn-yp", "-", hois=[ "zufunions", "zuwbpp", "zuonin", "oopos", "ubns", "snlon", ], ful="zufunions", hlp="ployn yp o vli (ful: zufunions)", ) ps.un( "--xpo", "-", hlp="xpo vliion po o spifi fil" ) ps.un( "--oy", "-", hois=[ "onfiuion", "pnnis", "suiy", "pfon", "oplin", "infsuu", "onioin", ], hlp="Vli only spifi oy", ) ps.un( "--vbos", "-v", ion="sou", hlp="nbl vbos loin" ) s = ps.pss() if s.vbos: loin.Lo().sLvl(loin.BU) #  vliion sui sui = ploynvliionsui(wospph=s.wosp) # Ps ployn yp ploynypp = { "zufunions": ploynyp.ZUFUNIONS, "zuwbpp": ploynyp.ZUWBPP, "zuonin": ploynyp.ZUONIN, "oopos": ploynyp.OOPOS, "ubns": ploynyp.UBNS, "snlon": ploynyp.SNLON, } ploynyp = ploynypp.( s.ploynyp, ploynyp.ZUFUNIONS ) pin("L.I.F.. Plfo - ployn Vliion Sui") pin("=" * 55) pin(f"Wosp: {s.wosp o os.w()}") pin(f"ployn yp: {ploynyp.vlu}") y: pin("\nunnin ployn vliion...") # un vliion po = synio.un(sui.vliployn(ploynyp)) pin("\nVliion suls:") pin(f" ol hs: {po.olhs}") pin(f" Pss: {po.psshs}") pin(f" Fil: {po.filhs}") pin(f" Wnins: {po.wninhs}") pin(f" Sipp: {po.sipphs}") pin(f" Suss : {po.suy.('suss', 'N/')}") pin(f" iil issus: {po.iilissus}") pin(f" Hih pioiy issus: {po.hihpioiyissus}") pin(f" ployn y: {' YS' if po.ployny ls ' NO'}") pin(f" xuion i: {po.xuioni:.2f}s") if po.vliionhs: pin("\nVliion ils:") # Show fil hs fis filhs = [ h fo h in po.vliionhs if h.sus == VliionSus.FIL ] if filhs: pin(" Fil hs:") fo h in filhs[:5]: # Show fis 5 pin(f" • {h.n}: {h.oss}") # Show wnins wninhs = [ h fo h in po.vliionhs if h.sus == VliionSus.WNIN ] if wninhs: pin(" ️ Wnin hs:") fo h in wninhs[:3]: # Show fis 3 pin(f" • {h.n}: {h.sul}") if po.blos: pin("\n ployn Blos:") fo blo in po.blos: pin(f" • {blo}") if po.onions: pin("\nonions:") fo  in po.onions: pin(f" • {}") if s.xpo: if sui.xpovliionpo(s.xpo, po): pin(f"\nVliion po xpo o {s.xpo}") ls: pin("\nFil o xpo vliion po") un 1 # un ppopi xi o if no po.ployny: pin( "\n ployn vliion fil - ss blos bfo ployn" ) un 1 lif po.iilissus > 0: pin("\n iil issus foun - ployn no on") un 1 lif po.filhs > 0: pin("\n ️ So vliion hs fil - viw bfo ployn") un 1 ls: pin("\n ployn vliion pss - y fo ployn") un 0 xp yboInup: pin("\nOpion inup by us") un 1 xp xpion s : pin(f"\nVliion fil: {}") un 1 if n == "in": ipo sys sys.xi(in())