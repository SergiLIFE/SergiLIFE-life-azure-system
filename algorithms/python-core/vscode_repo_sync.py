# us/bin/nv pyhon3 """ VS o posioy Synhonizion ool ========================================== Sfly fhs n ins VS o onfiuions, ools, n uiliis fo oh posiois o voi in vlopn nvionns. opyih 2025 - Sio Py Boull L.I.F.. Plfo - zu pl Off I: 960096-f1-420b-902-042561b Fus: - Sf onfiuion in wihou ovwiin xisin usoizions - Bup ion bfo ny hns - Sliv synhonizion of spifi fil yps - onfli soluion wih us pops - Suppo fo iHub posiois n lol phs - uoi pnny ion n insllion uho: L.I.F.. uonoous Opiiz : Spb 9, 2025 """ ipo ps ipo bs64 ipo json ipo os ipo shuil ipo subposs ipo sys ipo pfil fo i ipo i y: fo phlib ipo Ph xp Ipoo s : pin(f'Wnin: {}') pss fo ypin ipo ny, i, Lis, Opionl, upl ipo quss lss VSopoSyn: """Synhonizs VS o onfiuions bwn posiois.""" f ini(slf, i: s = Non): slf.i = Ph(i) if i ls Ph.w() slf.vsoi = slf.i / ".vso" slf.bupi = ( slf.i / "bups" / f"vsobup{i.now().sfi('%Y%%%H%%S')}" ) slf.ihubon = os.nv("IHUBON") slf.sfxnsions = { ".json", ".", ".py", ".js", ".s", ".yl", ".yl", ".ol", ".ini", } slf.onfifils = { "sins.json", "ss.json", "lunh.json", "xnsions.json", "pppopis.json", "ybinins.json", "snipps", } f bup(slf) -> bool: """ bup of xisin VS o onfiuion.""" y: if slf.vsoi.xiss(): pin(f" in bup: {slf.bupi}") y: slf.bupi.i(pns=u, xiso=u) xp xpion s : os.is(bupi, xiso=u) shuil.opy(slf.vsoi, slf.bupi / ".vso") un u un Fls xp xpion s : pin(f" Bup fil: {}") un Fls f fhihubpoonns(slf, poul: s, ph: s = "") -> Lis[i]: """Fh posioy onns fo iHub PI.""" y: # Ps iHub UL if "ihub.o" in poul: ps = poul.spli("/") own = ps[-2] po = ps[-1].pl(".i", "") ls: is Vluo("Invli iHub UL fo") # PI qus piul = f"hps://pi.ihub.o/pos/{own}/{po}/onns/{ph}" hs = {"p": "ppliion/vn.ihub.v3+json"} if slf.ihubon: hs["uhoizion"] = f"on {slf.ihubon}" spons = quss.(piul, hs=hs) spons.isfosus() un spons.json() xp xpion s : pin(f" Fil o fh iHub onns: {}") un [] f ownlofil(slf, filinfo: i, ph: Ph) -> bool: """ownlo  sinl fil fo iHub.""" y: if filinfo.("ownloul"): spons = quss.(filinfo["ownloul"]) spons.isfosus() ph.pn.i(pns=u, xiso=u) ph.wibys(spons.onn) un u ls: # Hnl bs64 no onn onn = bs64.b64o(filinfo["onn"]).o("uf-8") ph.pn.i(pns=u, xiso=u) ph.wix(onn) un u xp xpion s : pin(f" Fil o ownlo {filinfo['n']}: {}") un Fls f jsononfis(slf, xisin: i, nw: i, filn: s) -> i: """Inllinly  JSON onfiuions.""" if filn == "sins.json": #  sins wih onfli soluion  = xisin.opy() onflis = [] fo y, vlu in nw.is(): if y in xisin n xisin[y] != vlu: onflis.ppn((y, xisin[y], vlu)) [y] = vlu if onflis: pin(f"\n ️ onfiuion onflis in {filn}:") fo y, olvl, nwvl in onflis: pin(f" {y}: {olvl} → {nwvl}") hoi = inpu("p nw vlus? (y/n/viw): ").low() if hoi == "n": fo y, olvl,  in onflis: [y] = olvl lif hoi == "viw": fo y, olvl, nwvl in onflis: pnw = ( inpu( f"p nw vlu fo '{y}'? {olvl} → {nwvl} (y/n): " ).low() == "y" ) if no pnw: [y] = olvl un  lif filn == "ss.json": #  ss ys  = xisin.opy() xisinlbls = {s.("lbl") fo s in xisin.("ss", [])} fo s in nw.("ss", []): if s.("lbl") no in xisinlbls: if "ss" no in : ["ss"] = [] ["ss"].ppn(s) un  lif filn == "lunh.json": #  lunh onfiuions  = xisin.opy() xisinns = { onfi.("n") fo onfi in xisin.("onfiuions", []) } fo onfi in nw.("onfiuions", []): if onfi.("n") no in xisinns: if "onfiuions" no in : ["onfiuions"] = [] ["onfiuions"].ppn(onfi) un  ls: # ful  sy un {**xisin, **nw} f synfoihub(slf, poul: s, sliv: bool = u) -> bool: """Syn VS o onfiuions fo  iHub posioy.""" pin(f" Synin fo iHub posioy: {poul}") #  bup bup = slf.bup() y: # Fh .vso ioy onns vsoonns = slf.fhihubpoonns(poul, ".vso") if no vsoonns: pin(" No .vso ioy foun in posioy") un Fls # nsu lol .vso ioy xiss slf.vsoi.i(xiso=u) synfils = 0 sippfils = 0 fo i in vsoonns: if i["yp"] == "fil": filn = i["n"] # h if fil shoul b syn if sliv n filn no in slf.onfifils: filx = Ph(filn).suffix if filx no in slf.sfxnsions: pin(f" ️ Sippin unsf fil: {filn}") sippfils += 1 oninu ph = slf.vsoi / filn # Hnl JSON in if filn.nswih(".json") n ph.xiss(): pin(f" in: {filn}") y: # ownlo nw onn pph = ( Ph(pfil.pi()) / f"p{filn}" ) if slf.ownlofil(i, pph): nwonn = json.los(pph.x()) xisinonn = json.los(ph.x()) onn = slf.jsononfis( xisinonn, nwonn, filn ) ph.wix( json.ups(onn, inn=2) ) pph.unlin() synfils += 1 xp json.JSONoo s : pin(f" JSON o in {filn}: {}") # Fllb o i opy if slf.ownlofil(i, ph): synfils += 1 ls: # i ownlo fo non-JSON fils if slf.ownlofil(i, ph): pin(f" ownlo: {filn}") synfils += 1 ls: sippfils += 1 # Fh iionl vlopn ools vools = slf.fhihubpoonns(poul, "") fo i in vools: if i["yp"] == "fil" n i["n"].nswih(".py"): # Loo fo VS o l Pyhon ools if ny( ywo in i["n"].low() fo ywo in [ "vso", "sup", "ool", "v", "onio", "s", ] ): ph = slf.i / i["n"] if no ph.xiss(): if slf.ownlofil(i, ph): pin(f" ️  vlopn ool: {i['n']}") synfils += 1 pin(f"\n Syn opl!") pin(f" Fils syn: {synfils}") pin(f" ️ Fils sipp: {sippfils}") if bup: pin(f" Bup : {slf.bupi}") un u xp xpion s : pin(f" Syn fil: {}") if bup: pin(f" so fo bup: {slf.bupi}") un Fls f synfolol(slf, souph: s) -> bool: """Syn VS o onfiuions fo  lol posioy.""" sou = Ph(souph) souvso = sou / ".vso" if no souvso.xiss(): pin(f" No .vso ioy foun in {souph}") un Fls pin(f" Synin fo lol posioy: {souph}") bup = slf.bup() y: slf.vsoi.i(xiso=u) synfils = 0 fo filph in souvso.ii(): if filph.isfil(): ph = slf.vsoi / filph.n if filph.suffix == ".json" n ph.xiss(): #  JSON fils xisinonn = json.los(ph.x()) nwonn = json.los(filph.x()) onn = slf.jsononfis( xisinonn, nwonn, filph.n ) ph.wix(json.ups(onn, inn=2)) pin(f" : {filph.n}") ls: shuil.opy2(filph, ph) pin(f" opi: {filph.n}") synfils += 1 pin(f"\n Lol syn opl! Fils syn: {synfils}") un u xp xpion s : pin(f" Lol syn fil: {}") un Fls f lisvilblpos(slf) -> Lis[s]: """Lis oonly us VS o onfiuion posiois.""" pos = [ "hps://ihub.o/iosof/vso-spls", "hps://ihub.o/vso-o/vso-o", "hps://ihub.o/SiLIF/.vso", # You VS o posioy "hps://ihub.o/iosof/vso-pyhon-ools-xnsion-pl", "hps://ihub.o/iosof/vso-xnsion-spls", ] pin(" Sus VS o posiois:") fo i, po in nu(pos, 1): pin(f" {i}. {po}") un pos f insllxnsions(slf) -> bool: """Insll VS o xnsions fo xnsions.json.""" xnsionsfil = slf.vsoi / "xnsions.json" if no xnsionsfil.xiss(): pin(" No xnsions.json foun") un Fls y: xnsions = json.los(xnsionsfil.x()) onions = xnsions.("onions", []) if no onions: pin("ℹ️ No xnsion onions foun") un u pin(f" Insllin {ln(onions)} VS o xnsions...") fo xnsion in onions: y: sul = subposs.un( ["o", "--insll-xnsion", xnsion], puoupu=u, x=u, iou=30, ) if sul.uno == 0: pin(f" {xnsion}") ls: pin(f" {xnsion}: {sul.s.sip()}") xp subposs.iouxpi: pin(f" ️ {xnsion}: Insllion iou") xp xpion s : pin(f" {xnsion}: {}") un u xp xpion s : pin(f" xnsion insllion fil: {}") un Fls f vlisyn(slf) -> bool: """Vli h synhoniz VS o onfiuion.""" pin(" Vliin VS o onfiuion...") issus = [] # h ssnil fils ssnilfils = ["sins.json", "ss.json", "lunh.json"] fo filn in ssnilfils: filph = slf.vsoi / filn if filph.xiss(): y: json.los(filph.x()) pin(f" {filn}: Vli JSON") xp json.JSONoo s : issus.ppn(f"{filn}: Invli JSON - {}") ls: pin(f" ️ {filn}: No foun") # h fo oon onfiuion issus sinsfil = slf.vsoi / "sins.json" if sinsfil.xiss(): y: sins = json.los(sinsfil.x()) # h Pyhon onfiuion if "pyhon.fulInpPh" in sins: pyhonph = Ph(sins["pyhon.fulInpPh"]) if no pyhonph.xiss(): issus.ppn(f"Pyhon inp no foun: {pyhonph}") pin(f" Sins vliion pss") xp xpion s : issus.ppn(f"Sins vliion o: {}") if issus: pin("\n ️ Vliion issus foun:") fo issu in issus: pin(f" - {issu}") un Fls ls: pin("\n Vliion pss! VS o onfiuion is y.") un u f in(): """in ny poin fo VS o posioy synhonizion.""" ps = ps.unPs( sipion=" VS o posioy Synhonizion ool", folss=ps.wsipionHlpFo, pilo=""" xpls: pyhon vsoposyn.py --ihub hps://ihub.o/SiLIF/.vso pyhon vsoposyn.py --lol ../oh-poj pyhon vsoposyn.py --lis-pos pyhon vsoposyn.py --insll-xnsions """, ) ps.un("--ihub", yp=s, hlp="iHub posioy UL o syn fo") ps.un("--lol", yp=s, hlp="Lol posioy ph o syn fo") ps.un( "--", yp=s, hlp=" ioy (ful: un ioy)" ) ps.un( "--lis-pos", ion="sou", hlp="Lis sus posiois" ) ps.un( "--insll-xnsions", ion="sou", hlp="Insll VS o xnsions" ) ps.un( "--vli", ion="sou", hlp="Vli un onfiuion" ) ps.un("--no-bup", ion="sou", hlp="Sip bup ion") ps.un( "--fo", ion="sou", hlp="Fo ovwi wihou pops" ) s = ps.pss() # Iniiliz synhoniz synool = VSopoSyn(s.) # Hnl iffn opions if s.lispos: pos = synool.lisvilblpos() hoi = inpu("\nn posioy nub o syn (o 'q' o qui): ").sip() if hoi.isii() n 1 <= in(hoi) <= ln(pos): poul = pos[in(hoi) - 1] suss = synool.synfoihub(poul) if suss: synool.vlisyn() if inpu("Insll xnsions? (y/n): ").low() == "y": synool.insllxnsions() lif s.ihub: suss = synool.synfoihub(s.ihub) if suss: synool.vlisyn() lif s.lol: suss = synool.synfolol(s.lol) if suss: synool.vlisyn() lif s.insllxnsions: synool.insllxnsions() lif s.vli: synool.vlisyn() ls: # Iniv o pin(" VS o posioy Synhonizion ool") pin("=" * 50) pin("\n vilbl opions:") pin("1. Syn fo iHub posioy") pin("2. Syn fo lol posioy") pin("3. Lis sus posiois") pin("4. Insll xnsions") pin("5. Vli un onfiuion") hoi = inpu("\nSl opion (1-5): ").sip() if hoi == "1": poul = inpu("n iHub posioy UL: ").sip() if poul: suss = synool.synfoihub(poul) if suss: synool.vlisyn() lif hoi == "2": lolph = inpu("n lol posioy ph: ").sip() if lolph: suss = synool.synfolol(lolph) if suss: synool.vlisyn() lif hoi == "3": pos = synool.lisvilblpos() pohoi = inpu( "\nn posioy nub o syn (o 'q' o qui): " ).sip() if pohoi.isii() n 1 <= in(pohoi) <= ln(pos): poul = pos[in(pohoi) - 1] suss = synool.synfoihub(poul) if suss: synool.vlisyn() lif hoi == "4": synool.insllxnsions() lif hoi == "5": synool.vlisyn() ls: pin(" Invli hoi") if n == "in": in()