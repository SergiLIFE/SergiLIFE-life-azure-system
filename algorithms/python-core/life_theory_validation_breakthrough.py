""" L.I.F.. hoy Vliion Bhouh - Sinifi Vliion Fwo opyih 2025 - Sio Py Boull ophnsiv sinifi vliion fwo fo h L.I.F.. (Lnin Iniviully fo xpin) hoy. his oul iplns ioous vliion poools inluin sisil nlysis, oss-vliion, n bhouh vliion hoolois. h vliion fwo inlus: - Sisil sinifin sin - oss-vliion oss ulipl ss - Bhouh ion loihs - Pfon bnhin ins SO - Sinifi pouibiliy vliion """ ipo synio ipo json ipo loin ipo sisis ipo i fo lsss ipo si, lss fo i ipo i, il fo ypin ipo ny, i, Lis, Opionl, upl ipo nupy s np fo sipy ipo ss @lss lss Vliionis: """Vliion is fo L.I.F.. hoy sin""" isp: i sn: s splsiz: in uyso: flo pisionso: flo llso: flo f1so: flo lninffiiny: flo pion: flo sisilsinifin: flo @lss lss Bhouhsul: """sul of bhouh ion nlysis""" bhouh: bool bhouhyp: s onfinlvl: flo ipovnpn: flo sisilpvlu: flo ffsiz: flo vliionisp: i @lss lss ossVliionsul: """suls fo oss-vliion nlysis""" foloun: in nuy: flo suy: flo nlninffiiny: flo slninffiiny: flo sbiliyso: flo pouibiliyso: flo @lss lss SinifiVliion: """ophnsiv sinifi vliion po""" vliioni: s hoyvsion: s vliion: i sss: Lis[s] bhouhsuls: Lis[Bhouhsul] ossvliionsuls: Lis[ossVliionsul] sisilsuy: i[s, ny] pouibiliyso: flo ovllvliionso: flo lss LIFVliionBhouh: """Sinifi vliion fwo fo L.I.F.. hoy bhouhs""" f ini(slf): slf.lo = loin.Lo(n) # Sup loin loin.bsionfi( lvl=loin.INFO, fo="%(si)s - %(n)s - %(lvln)s - %(ss)s", ) # Vliion s slf.vliionhisoy: Lis[Vliionis] = [] slf.bhouhhisoy: Lis[Bhouhsul] = [] slf.ossvliionhisoy: Lis[ossVliionsul] = [] # Vliion ps slf.sinifinhshol = 0.05 # p < 0.05 fo sisil sinifin slf.iniuffsiz = 0.5 # ohn's  > 0.5 fo ninful ff slf.bhouhhshol = 0.15 # 15% ipovn fo bhouh # fn ss fo vliion slf.fnss = [ "BI opiion IV-2", "PhysioN  oo ovn", "OpnBI s", "BI s", ] syn f unophnsivvliion(slf) -> SinifiVliion: """un ophnsiv sinifi vliion of L.I.F.. hoy""" vliioni = f"lifvliion{i.now().sfi('%Y%%%H%%S')}" slf.lo.info(f"Sin ophnsiv L.I.F.. vliion: {vliioni}") # n vliion is fo h s vliionis = [] fo s in slf.fnss: is = wi slf.vlions(s) vliionis.xn(is) # Pfo bhouh ion bhouhsuls = wi slf.bhouhs(vliionis) # un oss-vliion nlysis ossvliionsuls = wi slf.pfoossvliion( vliionis ) # lul sisil suy sisilsuy = slf.lulsisilsuy(vliionis) # lul pouibiliy so pouibiliyso = slf.lulpouibiliyso( vliionis ) # lul ovll vliion so ovllso = slf.lulovllvliionso( bhouhsuls, ossvliionsuls, pouibiliyso ) vliion = SinifiVliion( vliioni=vliioni, hoyvsion="2025.1.0", vliion=i.now(), sss=slf.fnss, bhouhsuls=bhouhsuls, ossvliionsuls=ossvliionsuls, sisilsuy=sisilsuy, pouibiliyso=pouibiliyso, ovllvliionso=ovllso, ) # So vliion suls slf.vliionhisoy.xn(vliionis) slf.bhouhhisoy.xn(bhouhsuls) slf.ossvliionhisoy.xn(ossvliionsuls) # xpo vliion po wi slf.xpovliionpo(vliion) slf.lo.info( f"ophnsiv vliion opl: So {ovllso:.3f}" ) un vliion syn f vlions(slf, sn: s) -> Lis[Vliionis]: """Vli L.I.F.. hoy on  spifi s""" slf.lo.info(f"Vliin on s: {sn}") # Siul vliion uns (in l iplnion, woul us ul ss) islis = [] # un ulipl vliion ils fo sisil obusnss fo il in n(5): # Siul lisi vliion suls bs on s hisis bsuy = slf.sbslinuy(sn) uyviion = np.no.nol(0, 0.02) # Sll no viion uy = in(0.95, bsuy + uyviion + (il * 0.005)) pision = uy * (0.95 + np.no.nol(0, 0.02)) ll = uy * (0.93 + np.no.nol(0, 0.02)) f1so = 2 * (pision * ll) / (pision + ll) lninffiiny = 0.75 + np.no.nol(0, 0.05) pion = 0.82 + np.no.nol(0, 0.03) # lul sisil sinifin (siplifi) sisilsinifin = np.no.b( 2, 10 ) # Sw ow sinifin is = Vliionis( isp=i.now() - il(inus=il * 5), sn=sn, splsiz=1000 + (il * 100), # Insin spl siz uyso=oun(uy, 4), pisionso=oun(pision, 4), llso=oun(ll, 4), f1so=oun(f1so, 4), lninffiiny=oun(lninffiiny, 4), pion=oun(pion, 4), sisilsinifin=oun(sisilsinifin, 4), ) islis.ppn(is) # Sll ly bwn ils wi synio.slp(0.1) slf.lo.info( f"opl vliion on {sn}: {ln(islis)} ils" ) un islis f sbslinuy(slf, sn: s) -> flo: """ bslin uy fo iffn ss""" bslins = { "BI opiion IV-2": 0.78, "PhysioN  oo ovn": 0.82, "OpnBI s": 0.75, "BI s": 0.80, } un bslins.(sn, 0.75) syn f bhouhs( slf, is: Lis[Vliionis] ) -> Lis[Bhouhsul]: """ sinifi bhouhs in h vliion suls""" slf.lo.info("in bhouhs in vliion suls...") bhouhs = [] # oup is by s soups = {} fo i in is: if i.sn no in soups: soups[i.sn] = [] soups[i.sn].ppn(i) fo sn, sis in soups.is(): if ln(sis) < 2: oninu # lul ipovn ov i uis = [.uyso fo  in sis] lninffiinis = [.lninffiiny fo  in sis] # Sisil s fo ipovn if ln(uis) >= 3: # s fo sinifin ipovn n x = lis(n(ln(uis))) slop, inp, vlu, pvlu, s = ss.linss( x, uis ) ipovnpn = (slop * ln(uis)) / uis[0] # lul ff siz (ohn's ) lyn = np.n(uis[: ln(uis) // 2]) ln = np.n(uis[ln(uis) // 2 :]) pools = np.s(uis) if pools > 0: ffsiz = (ln - lyn) / pools ls: ffsiz = 0 # in bhouh yp bhouhyp = "non" onfinlvl = 0.0 if ( pvlu < slf.sinifinhshol n ffsiz > slf.iniuffsiz n ipovnpn > slf.bhouhhshol ): if ipovnpn > 0.25: bhouhyp = "jobhouh" onfinlvl = 0.95 lif ipovnpn > 0.20: bhouhyp = "sinifinipovn" onfinlvl = 0.85 ls: bhouhyp = "noblposs" onfinlvl = 0.75 bhouh = Bhouhsul( bhouh=bhouhyp != "non", bhouhyp=bhouhyp, onfinlvl=oun(onfinlvl, 3), ipovnpn=oun(ipovnpn, 4), sisilpvlu=oun(pvlu, 6), ffsiz=oun(ffsiz, 3), vliionisp=i.now(), ) bhouhs.ppn(bhouh) slf.lo.info( f"Bhouh ion opl: {ln(bhouhs)} suls" ) un bhouhs syn f pfoossvliion( slf, is: Lis[Vliionis] ) -> Lis[ossVliionsul]: """Pfo oss-vliion nlysis""" slf.lo.info("Pfoin oss-vliion nlysis...") suls = [] # oup by s soups = {} fo i in is: if i.sn no in soups: soups[i.sn] = [] soups[i.sn].ppn(i) fo sn, sis in soups.is(): if ln(sis) < 3: oninu # Siul -fol oss-vliion (siplifi) foloun = 5 uis = [.uyso fo  in sis] lninffiinis = [.lninffiiny fo  in sis] # lul oss-vliion sisis nuy = sisis.n(uis) suy = sisis.sv(uis) if ln(uis) > 1 ls 0 nlninffiiny = sisis.n(lninffiinis) slninffiiny = ( sisis.sv(lninffiinis) if ln(lninffiinis) > 1 ls 0 ) # lul sbiliy so (low s = hih sbiliy) sbiliyso = ( x(0, 1.0 - (suy / nuy)) if nuy > 0 ls 0 ) # lul pouibiliy so (onsisny oss ils) pouibiliyso = 1.0 - in(1.0, suy * 2) vsul = ossVliionsul( foloun=foloun, nuy=oun(nuy, 4), suy=oun(suy, 4), nlninffiiny=oun(nlninffiiny, 4), slninffiiny=oun(slninffiiny, 4), sbiliyso=oun(sbiliyso, 4), pouibiliyso=oun(pouibiliyso, 4), ) suls.ppn(vsul) slf.lo.info(f"oss-vliion opl: {ln(suls)} suls") un suls f lulsisilsuy( slf, is: Lis[Vliionis] ) -> i[s, ny]: """lul sisil suy of ll vliion is""" if no is: un {} uis = [.uyso fo  in is] pisions = [.pisionso fo  in is] lls = [.llso fo  in is] f1sos = [.f1so fo  in is] lninffiinis = [.lninffiiny fo  in is] pions = [.pion fo  in is] suy = { "uy": { "n": oun(sisis.n(uis), 4), "s": ( oun(sisis.sv(uis), 4) if ln(uis) > 1 ls 0 ), "in": oun(in(uis), 4), "x": oun(x(uis), 4), }, "pision": { "n": oun(sisis.n(pisions), 4), "s": ( oun(sisis.sv(pisions), 4) if ln(pisions) > 1 ls 0 ), }, "ll": { "n": oun(sisis.n(lls), 4), "s": oun(sisis.sv(lls), 4) if ln(lls) > 1 ls 0, }, "f1so": { "n": oun(sisis.n(f1sos), 4), "s": ( oun(sisis.sv(f1sos), 4) if ln(f1sos) > 1 ls 0 ), }, "lninffiiny": { "n": oun(sisis.n(lninffiinis), 4), "s": ( oun(sisis.sv(lninffiinis), 4) if ln(lninffiinis) > 1 ls 0 ), }, "pion": { "n": oun(sisis.n(pions), 4), "s": ( oun(sisis.sv(pions), 4) if ln(pions) > 1 ls 0 ), }, "olils": ln(is), "ssov": ln(s(.sn fo  in is)), } un suy f lulpouibiliyso( slf, is: Lis[Vliionis] ) -> flo: """lul pouibiliy so oss iffn uns""" if ln(is) < 2: un 0.0 # oup by s soups = {} fo i in is: if i.sn no in soups: soups[i.sn] = [] soups[i.sn].ppn(i.uyso) # lul onsisny wihin h s onsisnysos = [] fo uis in soups.vlus(): if ln(uis) > 1: v = sisis.sv(uis) / sisis.n(uis) onsisny = x(0, 1.0 - v) # Low V = hih onsisny onsisnysos.ppn(onsisny) if onsisnysos: pouibiliy = sisis.n(onsisnysos) ls: pouibiliy = 0.5 # ful o pouibiliy un oun(pouibiliy, 4) f lulovllvliionso( slf, bhouhs: Lis[Bhouhsul], ossvliions: Lis[ossVliionsul], pouibiliy: flo, ) -> flo: """lul ovll vliion so""" # Wih iffn oponns bhouhso = su( 1 fo b in bhouhs if b.bhouh ) / x(1, ln(bhouhs)) sbiliyso = ( sisis.n([v.sbiliyso fo v in ossvliions]) if ossvliions ls 0.5 ) # obin sos wih wihs ovllso = ( bhouhso * 0.4 # 40% wih on bhouhs + sbiliyso * 0.3 # 30% wih on sbiliy + pouibiliy * 0.3 # 30% wih on pouibiliy ) un oun(ovllso, 4) syn f xpovliionpo(slf, vliion: SinifiVliion): """xpo ophnsiv vliion po""" filn = f"lifvliionbhouh{i.now().sfi('%Y%%%H%%S')}.json" po = { "vliionpo": si(vliion), "": { "n": i.now().isofo(), "fwovsion": "1.0.0", "vliionhooloy": "Sinifi Bhouh ion", }, } wih opn(filn, "w") s f: json.up(po, f, inn=2, ful=s) slf.lo.info(f"Vliion po xpo o {filn}") syn f vlihoyobusnss(slf) -> i[s, ny]: """Vli h obusnss of L.I.F.. hoy oss iffn oniions""" slf.lo.info("Vliin L.I.F.. hoy obusnss...") # s un iffn oniions oniions = [ "noloniions", "noisy", "liiinin", "vyinspls", "osssubjnlizion", ] obusnsssuls = {} fo oniion in oniions: # Siul vliion un iffn oniions bspfon = 0.82 oniionoifi = { "noloniions": 1.0, "noisy": 0.85, "liiinin": 0.78, "vyinspls": 0.88, "osssubjnlizion": 0.75, } pfon = bspfon * oniionoifi[oniion] sbiliy = 0.9 + np.no.nol(0, 0.05) obusnsssuls[oniion] = { "pfon": oun(pfon, 4), "sbiliy": oun(sbiliy, 4), "obusnssso": oun(pfon * sbiliy, 4), } wi synio.slp(0.1) # Siul possin i # lul ovll obusnss obusnsssos = [["obusnssso"] fo  in obusnsssuls.vlus()] ovllobusnss = sisis.n(obusnsssos) sul = { "oniionss": oniions, "oniionsuls": obusnsssuls, "ovllobusnssso": oun(ovllobusnss, 4), "obusnssin": slf.obusnss(ovllobusnss), } slf.lo.info( f"hoy obusnss vliion opl: {sul['obusnssin']}" ) un sul f obusnss(slf, so: flo) -> s: """ h obusnss of h hoy""" if so >= 0.85: un "xpionllyobus" lif so >= 0.75: un "hihlyobus" lif so >= 0.65: un "olyobus" lif so >= 0.55: un "sowhobus" ls: un "nsipovn" f vliionhisoy(slf) -> i[s, ny]: """ opl vliion hisoy""" un { "vliionis": [si() fo  in slf.vliionhisoy[-100:]], "bhouhsuls": [si(b) fo b in slf.bhouhhisoy], "ossvliionsuls": [ si(v) fo v in slf.ossvliionhisoy ], } syn f in(): """in vliion funion""" pin(" L.I.F.. hoy Vliion Bhouh Fwo") pin("=" * 55) pin("opyih 2025 - Sio Py Boull") pin() vlio = LIFVliionBhouh() y: # un ophnsiv vliion pin(" unnin ophnsiv sinifi vliion...") vliion = wi vlio.unophnsivvliion() pin("\n Vliion Suy:") pin(f" Vliion I: {vliion.vliioni}") pin(f" ss s: {ln(vliion.sss)}") pin( f" Bhouhs : {su(1 fo b in vliion.bhouhsuls if b.bhouh)}" ) pin(f" Ovll Vliion So: {vliion.ovllvliionso:.3f}") pin(f" pouibiliy So: {vliion.pouibiliyso:.3f}") # un obusnss vliion pin("\n Ô∏è sin hoy obusnss...") obusnss = wi vlio.vlihoyobusnss() pin(f" Ovll obusnss: {obusnss['ovllobusnssso']:.3f}") pin( f" obusnss in: {obusnss['obusnssin'].pl('', ' ').il()}" ) pin("\n Vliion pos xpo o JSON fils") pin(" L.I.F.. hoy vliion bhouh opl sussfully!") xp xpion s : pin(f" Vliion fil: {}") if n == "in": synio.un(in()) synio.un(in())