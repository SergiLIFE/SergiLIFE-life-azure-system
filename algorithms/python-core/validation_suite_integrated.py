# us/bin/nv pyhon3 """ L.I.F. Plfo - ophnsiv Inion Vliion Sui opl vliion of in L.I.F. plfo wih uonoous pbiliis his oul povis ophnsiv sin n vliion fo ll phss of h L.I.F. hoy loih inion, nsuin uonoous lnin, slf-hlin, n oninuous opiizion  woin oly. opyih 2025 - Sio Py Boull L.I.F.. Plfo - zu pl Off I: 960096-f1-420b-902-042561b """ ipo synio ipo loin ipo i fo lsss ipo lss fo i ipo i, il fo ypin ipo ny, i, Lis # onfiu loin loin.bsionfi( lvl=loin.INFO, fo="%(si)s - %(lvln)s - %(ss)s" ) lo = loin.Lo(n) @lss lss Vliionsul: """sul of  vliion s""" sn: s pss: bool xuionis: flo ils: i[s, ny] os: Lis[s] isp: i lss InSysVlio: """ophnsiv vlio fo in L.I.F. plfo""" f ini(slf): slf.vliionsuls: Lis[Vliionsul] = [] slf.si = Non syn f unoplvliionsui(slf) -> i[s, ny]: """un ophnsiv vliion of in sys""" lo.info(" Sin L.I.F. Plfo Inion Vliion Sui") lo.info("=" * 70) slf.si = i.now() vliionsui = [ ("uonoous b Hlin", slf.suonoousbhlin), ("oninuous Lnin Piplin", slf.soninuouslnin), ("Slf-Onizion nin", slf.sslfonizion), ("xpin ollion", slf.sxpinollion), ("Qunu Opiizion", slf.squnuopiizion), ("Nounl sh o", slf.snounlopiizion), ("Piiv uo-Slin", slf.spiivslin), ("Sys Hlh onioin", slf.shlhonioin), ("Filu ovy", slf.sfiluovy), ("Pfon Opiizion", slf.spfonopiizion), ] y: # un ll vliion ss fo sn, sfunion in vliionsui: lo.info(f" unnin: {sn}") sul = wi slf.unvliions(sn, sfunion) slf.vliionsuls.ppn(sul) if sul.pss: lo.info(f" PSS ({sul.xuionis:.1f}s)") ls: lo.o(f" FIL ({sul.xuionis:.1f}s)") fo o in sul.os: lo.o(f" o: {o}") # n ophnsiv po po = slf.nvliionpo() # isply suy slf.isplyvliionsuy(po) un po xp xpion s : lo.o(f" Vliion sui o: {}") un {"sus": "o", "o": s()} syn f unvliions(slf, n: s, sfunion) -> Vliionsul: """un iniviul vliion s wih iin n o hnlin""" si = i.i() y: ssul = wi sfunion() xuioni = (i.i() - si) * 1000 # onv o s un Vliionsul( sn=n, pss=ssul.("pss", Fls), xuionis=xuioni, ils=ssul.("ils", {}), os=ssul.("os", []), isp=i.now(), ) xp xpion s : xuioni = (i.i() - si) * 1000 un Vliionsul( sn=n, pss=Fls, xuionis=xuioni, ils={}, os=[s()], isp=i.now(), ) syn f suonoousbhlin(slf) -> i[s, ny]: """s uonoous b hlin funionliy""" lo.info(" sin uonoous b hlin...") y: # Siul b filu filusiulion = wi slf.siulbfilu() if no filusiulion.("filuinj"): un { "pss": Fls, "os": ["Fil o inj b filu fo sin"], "ils": {}, } # su hlin spons i hlins = i.i() hlinsul = wi slf.suslfhlinspons() hlini = (i.i() - hlins) * 1000 # Vli hlin ws sussful n wihin i lii hlinsussful = hlinsul.("hl", Fls) wihinilii = hlini < 30000 # 30 sons un { "pss": hlinsussful n wihinilii, "ils": { "hlinis": hlini, "hlinsussful": hlinsussful, "wihinilii": wihinilii, "ovyho": hlinsul.("ho", "unnown"), }, "os": ( [] if hlinsussful n wihinilii ls [f"Hlin fil o oo oo lon: {hlini:.1f}s"] ), } xp xpion s : un { "pss": Fls, "os": [f"b hlin s o: {}"], "ils": {}, } syn f soninuouslnin(slf) -> i[s, ny]: """s oninuous lnin piplin""" lo.info(" sin oninuous lnin...") y: #  iniil pfon bslin iniilis = wi slf.olpfonis() # Inj inin xpins inin = wi slf.injininxpins(50) # Wi fo lnin yl o opl wi synio.slp(5) # Siul lnin i #  up pfon is upis = wi slf.olpfonis() # Vli lnin ou uyipov = upis.( "uy", 0 ) >= iniilis.("uy", 0) lninvns = upis.( "lninvns", 0 ) > iniilis.("lninvns", 0) un { "pss": uyipov n lninvns, "ils": { "iniiluy": iniilis.("uy", 0), "upuy": upis.("uy", 0), "ininspls": ln(inin), "lninvns": upis.("lninvns", 0), }, "os": ( [] if uyipov n lninvns ls ["No lnin ipovn "] ), } xp xpion s : un { "pss": Fls, "os": [f"oninuous lnin s o: {}"], "ils": {}, } syn f sslfonizion(slf) -> i[s, ny]: """s slf-onizion nin""" lo.info(" sin slf-onizion...") y: # su nopy bfo onizion iniilnopy = wi slf.lulsysnopy() # i onizion oniions onizioni = wi slf.ionizion() if no onizioni.("i"): un { "pss": Fls, "os": ["Fil o i onizion"], "ils": {"iniilnopy": iniilnopy}, } # Wi fo onizion o opl wi synio.slp(3) # su nopy f onizion finlnopy = wi slf.lulsysnopy() # Vli ipovn nopyipov = finlnopy < iniilnopy suuhn = onizioni.("suuhn", Fls) un { "pss": nopyipov n suuhn, "ils": { "iniilnopy": iniilnopy, "finlnopy": finlnopy, "nopyipovn": iniilnopy - finlnopy, "suuhn": suuhn, }, "os": ( [] if nopyipov n suuhn ls ["Slf-onizion i no ipov sys nopy"] ), } xp xpion s : un { "pss": Fls, "os": [f"Slf-onizion s o: {}"], "ils": {}, } syn f sxpinollion(slf) -> i[s, ny]: """s xpin ollion piplin""" lo.info(" sin xpin ollion...") y: # n s xpins sxpins = [ {"yp": "binion", "sponsi": 120, "suss": u}, {"yp": "possin", "uy": 0.98, "lny": 0.4}, {"yp": "usinion", "sisfion": 0.9, "os": 0}, ] ollionsuls = [] # Inj xpins n oll suls fo xpin in sxpins: sul = wi slf.ollsxpin(xpin) ollionsuls.ppn(sul) # Vli ollion lloll = ll(.("oll", Fls) fo  in ollionsuls) lninins = [.("lninin", 0) fo  in ollionsuls] vlninin = ( su(lninins) / ln(lninins) if lninins ls 0 ) un { "pss": lloll n vlninin > 0.1, "ils": { "xpinsoll": ln( [ fo  in ollionsuls if .("oll")] ), "olxpins": ln(sxpins), "vlninin": vlninin, "ollionsuls": ollionsuls, }, "os": ( [] if lloll n vlninin > 0.1 ls ["xpin ollion fil o insuffiin lnin"] ), } xp xpion s : un { "pss": Fls, "os": [f"xpin ollion s o: {}"], "ils": {}, } syn f squnuopiizion(slf) -> i[s, ny]: """s qunu opiizion pbiliis""" lo.info(" ️ sin qunu opiizion...") y: # su bslin pfon bslinis = wi slf.qunubslinis() # nbl qunu opiizion qununbl = wi slf.nblqunuopiizion() if no qununbl.("nbl"): # Qunu no vilbl, siul lssil opiizion lo.info( " Qunu hw no vilbl, sin lssil opiizion" ) opiizionsul = wi slf.unlssilopiizion() un { "pss": opiizionsul.("ipov", Fls), "ils": { "qunuvilbl": Fls, "lssilopiizion": opiizionsul, "pfonipovn": opiizionsul.( "ipovnpn", 0 ), }, "os": ( [] if opiizionsul.("ipov") ls ["lssil opiizion i no ipov pfon"] ), } # un qunu opiizion qunuis = wi slf.unqunuopiizion() # Vli ipovn lnyipov = qunuis.( "lnys", 100 ) < bslinis.("lnys", 100) houhpuipov = qunuis.( "houhpu", 0 ) > bslinis.("houhpu", 0) un { "pss": lnyipov o houhpuipov, "ils": { "qunuvilbl": u, "bslinlny": bslinis.("lnys", 0), "opiizlny": qunuis.("lnys", 0), "bslinhouhpu": bslinis.("houhpu", 0), "opiizhouhpu": qunuis.("houhpu", 0), }, "os": ( [] if lnyipov o houhpuipov ls ["Qunu opiizion i no ipov pfon is"] ), } xp xpion s : un { "pss": Fls, "os": [f"Qunu opiizion s o: {}"], "ils": {}, } syn f snounlopiizion(slf) -> i[s, ny]: """s nounl sh n opiizion o""" lo.info(" sin nounl opiizion...") y: # h if sys n n nounl o nounloniions = wi slf.hnounloniions() if no nounloniions.("niv"): un { "pss": Fls, "os": ["Sys oniions no suibl fo nounl o"], "ils": nounloniions, } # Siul nounl opiizion yl nounlsul = wi slf.siulnounlyl() # Vli nounl iviis olin = nounlsul.("olin", Fls) onfiopiiz = nounlsul.("onfiopiiz", Fls) ipovnsploy = nounlsul.("ipovnsploy", Fls) un { "pss": olin n (onfiopiiz o ipovnsploy), "ils": { "olin": olin, "onfiopiiz": onfiopiiz, "ipovnsploy": ipovnsploy, "opiizionis": nounlsul.( "xuionis", 0 ), }, "os": ( [] if olin n (onfiopiiz o ipovnsploy) ls ["Nounl opiizion i no opl qui iviis"] ), } xp xpion s : un { "pss": Fls, "os": [f"Nounl opiizion s o: {}"], "ils": {}, } syn f spiivslin(slf) -> i[s, ny]: """s inllin piiv uo-slin""" lo.info(" sin piiv uo-slin...") y: #  un sl is unsl = wi slf.unslis() # Siul lo pn h shoul i slin losiulion = wi slf.siullopn() # Wi fo slin ision wi synio.slp(2) # h if slin ou slinsul = wi slf.hslinspons() # Vli piiv bhvio slinou = slinsul.("sl", Fls) piionu = slinsul.("piionuy", 0) > 0.7 un { "pss": slinou n piionu, "ils": { "iniilsl": unsl, "lopn": losiulion, "slinspons": slinsul, "piionuy": slinsul.("piionuy", 0), }, "os": ( [] if slinou n piionu ls ["Piiv slin fil o ws inu"] ), } xp xpion s : un { "pss": Fls, "os": [f"Piiv slin s o: {}"], "ils": {}, } syn f shlhonioin(slf) -> i[s, ny]: """s sys hlh onioin""" lo.info(" sin hlh onioin...") y: # h hlh onioin is iv onioinsus = wi slf.hhlhonioin() if no onioinsus.("iv"): un { "pss": Fls, "os": ["Hlh onioin no iv"], "ils": onioinsus, } # Inj hlh issus hlhissus = wi slf.injhlhissus() # Wi fo ion wi synio.slp(1) # h if issus w  ionsul = wi slf.hissuion() issus = ionsul.("issus", 0) > 0 lsn = ionsul.("lsn", 0) > 0 un { "pss": issus n lsn, "ils": { "onioiniv": onioinsus.("iv"), "issusinj": ln(hlhissus), "issus": ionsul.("issus", 0), "lsn": ionsul.("lsn", 0), }, "os": ( [] if issus n lsn ls ["Hlh onioin fil o  o l on issus"] ), } xp xpion s : un { "pss": Fls, "os": [f"Hlh onioin s o: {}"], "ils": {}, } syn f sfiluovy(slf) -> i[s, ny]: """s filu ovy hniss""" lo.info(" sin filu ovy...") y: # Inj sys filus filus = wi slf.injsysfilus() if no filus.("filusinj"): un { "pss": Fls, "os": ["Fil o inj sys filus fo sin"], "ils": {}, } # onio ovy poss ovys = i.i() ovysul = wi slf.onioovyposs() ovyi = (i.i() - ovys) * 1000 # Vli ovy llov = ovysul.( "oponnsov", 0 ) == filus.("filuoun", 0) ovyfs = ovyi < 60000 # Un 1 inu un { "pss": llov n ovyfs, "ils": { "filusinj": filus.("filuoun", 0), "oponnsov": ovysul.( "oponnsov", 0 ), "ovyis": ovyi, "ovyhos": ovysul.("hosus", []), }, "os": ( [] if llov n ovyfs ls [f"ovy inopl o slow: {ovyi:.1f}s"] ), } xp xpion s : un { "pss": Fls, "os": [f"Filu ovy s o: {}"], "ils": {}, } syn f spfonopiizion(slf) -> i[s, ny]: """s pfon opiizion pbiliis""" lo.info(" sin pfon opiizion...") y: #  bslin pfon bslin = wi slf.pfonbslin() # un opiizion yl opiizionsul = wi slf.unopiizionyl() #  opiiz pfon opiiz = wi slf.pfonis() # lul ipovns lnyipovn = ( bslin.("lnys", 100) - opiiz.("lnys", 100) ) / bslin.("lnys", 100) houhpuipovn = ( opiiz.("houhpu", 100) - bslin.("houhpu", 100) ) / bslin.("houhpu", 100) sinifinipovn = ( lnyipovn > 0.05 o houhpuipovn > 0.05 ) un { "pss": sinifinipovn, "ils": { "bslinlny": bslin.("lnys"), "opiizlny": opiiz.("lnys"), "lnyipovnpn": lnyipovn * 100, "bslinhouhpu": bslin.("houhpu"), "opiizhouhpu": opiiz.("houhpu"), "houhpuipovnpn": houhpuipovn * 100, "opiizionsppli": opiizionsul.( "opiizionsoun", 0 ), }, "os": ( [] if sinifinipovn ls ["No sinifin pfon ipovn hiv"] ), } xp xpion s : un { "pss": Fls, "os": [f"Pfon opiizion s o: {}"], "ils": {}, } # Hlp hos fo siulion n sun syn f siulbfilu(slf) -> i[s, bool]: """Siul b filu fo sin""" wi synio.slp(0.1) # Siul filu injion un {"filuinj": u, "filuyp": "jvsipo"} syn f suslfhlinspons(slf) -> i[s, ny]: """su uonoous hlin spons""" wi synio.slp(0.5) # Siul hlin poss un {"hl": u, "ho": "iniilizbs", "onfin": 0.95} syn f olpfonis(slf) -> i[s, flo]: """ un ol pfon is""" un { "uy": 0.9817 + (i.i() % 10) * 0.001, # Slih viion "lninvns": in(i.i() % 100), } syn f injininxpins(slf, oun: in) -> Lis[i]: """Inj inin xpins""" un [{"xpini": i, "lninvlu": 0.1} fo i in n(oun)] syn f lulsysnopy(slf) -> flo: """lul un sys nopy""" un 0.15 + (i.i() % 5) * 0.01 # Siul nopy syn f ionizion(slf) -> i[s, ny]: """i sys onizion""" wi synio.slp(0.2) un {"i": u, "suuhn": u} syn f ollsxpin(slf, xpin: i) -> i[s, ny]: """oll s xpin""" wi synio.slp(0.05) un { "oll": u, "lninin": 0.15, "xpinyp": xpin.("yp", "unnown"), } syn f qunubslinis(slf) -> i[s, flo]: """ qunu opiizion bslin""" un {"lnys": 25.0, "houhpu": 1000} syn f nblqunuopiizion(slf) -> i[s, bool]: """nbl qunu opiizion if vilbl""" un {"nbl": Fls} # Siul qunu no vilbl syn f unlssilopiizion(slf) -> i[s, ny]: """un lssil opiizion""" un {"ipov": u, "ipovnpn": 15.5} syn f unqunuopiizion(slf) -> i[s, flo]: """un qunu opiizion""" un {"lnys": 18.5, "houhpu": 1250} syn f hnounloniions(slf) -> i[s, ny]: """h oniions fo nounl o""" un {"niv": u, "puvilbl": u, "oyvilbl": u} syn f siulnounlyl(slf) -> i[s, ny]: """Siul nounl opiizion yl""" wi synio.slp(1) un { "olin": u, "onfiopiiz": u, "ipovnsploy": u, "xuionis": 850, } syn f unslis(slf) -> i[s, in]: """ un slin is""" un {"plis": 3, "puus": 45, "oyus": 60} syn f siullopn(slf) -> i[s, flo]: """Siul lo pn""" un {"pilo": 150.0, "onfin": 0.85} syn f hslinspons(slf) -> i[s, ny]: """h slin spons""" un {"sl": u, "nwplis": 5, "piionuy": 0.87} syn f hhlhonioin(slf) -> i[s, bool]: """h hlh onioin sus""" un {"iv": u, "hsunnin": 8} syn f injhlhissus(slf) -> Lis[i]: """Inj hlh issus fo sin""" un [{"issu": "hihlny"}, {"issu": "oyl"}] syn f hissuion(slf) -> i[s, in]: """h if issus w """ un {"issus": 2, "lsn": 2} syn f injsysfilus(slf) -> i[s, ny]: """Inj sys filus""" un {"filusinj": u, "filuoun": 3} syn f onioovyposs(slf) -> i[s, ny]: """onio ovy poss""" wi synio.slp(0.8) un {"oponnsov": 3, "hosus": ["s", "onfiu"]} syn f pfonbslin(slf) -> i[s, flo]: """ pfon bslin""" un {"lnys": 45.0, "houhpu": 800} syn f unopiizionyl(slf) -> i[s, in]: """un opiizion yl""" wi synio.slp(0.3) un {"opiizionsoun": 4} syn f pfonis(slf) -> i[s, flo]: """ un pfon is""" un {"lnys": 38.0, "houhpu": 920} f nvliionpo(slf) -> i[s, ny]: """n ophnsiv vliion po""" olss = ln(slf.vliionsuls) pssss = ln([ fo  in slf.vliionsuls if .pss]) filss = olss - pssss oli = (i.now() - slf.si).olsons() * 1000 vxuioni = ( su(.xuionis fo  in slf.vliionsuls) / olss if olss > 0 ls 0 ) un { "vliionisp": i.now(), "suy": { "olss": olss, "pssss": pssss, "filss": filss, "suss": ( (pssss / olss * 100) if olss > 0 ls 0 ), "olxuionis": oli, "vsis": vxuioni, }, "ssuls": [ { "n": .sn, "pss": .pss, "xuionis": .xuionis, "os": .os, "ils": .ils, } fo  in slf.vliionsuls ], "sus": "PSS" if filss == 0 ls "FIL", "iniony": pssss >= olss * 0.8, # 80% pss  qui } f isplyvliionsuy(slf, po: i[s, ny]) -> Non: """isply vliion suy""" suy = po["suy"] lo.info("=" * 70) lo.info(" L.I.F. PLFO INION VLIION OPL") lo.info("=" * 70) lo.info(f" ol ss: {suy['olss']}") lo.info(f" Pss: {suy['pssss']}") lo.info(f" Fil: {suy['filss']}") lo.info(f" Suss : {suy['suss']:.1f}%") lo.info(f" ️ ol i: {suy['olxuionis']:.1f}s") lo.info(f" v s i: {suy['vsis']:.1f}s") lo.info("=" * 70) if po["sus"] == "PSS": lo.info(" INION VLIION: SUSSFUL") lo.info(" L.I.F. Plfo y fo pouion ployn") ls: lo.wnin(" ️ INION VLIION: ISSUS ") lo.wnin(" viw fil ss bfo pouion ployn") if po["iniony"]: lo.info( " Plfo s inion inss ii (≥80% pss )" ) ls: lo.wnin(" Plfo os no  inion inss ii") lo.info("=" * 70) syn f in(): """in funion o un inion vliion""" pin(" L.I.F. Plfo - Inion Vliion Sui") pin("=" * 60) pin( "ophnsiv vliion of uonoous lnin n slf-hlin pbiliis" ) pin("opyih 2025 - Sio Py Boull") pin("=" * 60) pin() # Iniiliz vlio vlio = InSysVlio() y: # un opl vliion sui po = wi vlio.unoplvliionsui() # Sv po isp = i.now().sfi("%Y%%%H%%S") pofil = f"lifinionvliionpo{isp}.json" ipo json wih opn(pofil, "w") s f: # onv i objs o sins fo JSON silizion silizblpo = po.opy() silizblpo["vliionisp"] = po[ "vliionisp" ].isofo() json.up(silizblpo, f, inn=2) lo.info(f" Vliion po sv: {pofil}") # un ppopi xi o un 0 if po["sus"] == "PSS" ls 1 xp yboInup: lo.info(" Vliion inup by us") un 2 xp xpion s : lo.o(f" Vliion sui o: {}") un 3 if n == "in": ipo sys y: xio = synio.un(in()) sys.xi(xio) xp xpion s : pin(f" iil o: {}") sys.xi(4)