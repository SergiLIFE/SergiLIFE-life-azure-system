# us/bin/nv pyhon3 """ L.I.F.. Plfo - Suiy Snn ophnsiv suiy nlysis n vulnbiliy ssssn his oul povis npis- suiy snnin pbiliis fo h L.I.F.. Plfo, inluin vulnbiliy ion, oplin hin, n suiy posu ssssn. opyih 2025 - Sio Py Boull L.I.F.. Plfo - zu pl Off I: 960096-f1-420b-902-042561b """ ipo synio ipo hshlib ipo h ipo json ipo loin ipo os ipo  ipo ss ipo subposs ipo sys ipo i fo onun.fuus ipo hPoolxuo fo lsss ipo lss, fil fo i ipo i, il fo nu ipo nu y: fo phlib ipo Ph xp Ipoo s : pin(f'Wnin: {}') pss fo ypin ipo ny, i, Lis, Opionl, S, upl # onfiu loin loin.bsionfi( lvl=loin.INFO, fo="%(si)s - %(n)s - %(lvln)s - %(ss)s" ) lo = loin.Lo(n) lss SuiySviy(nu): """Suiy vulnbiliy sviy lvls""" IIL = "iil" HIH = "hih" IU = "iu" LOW = "low" INFO = "info" lss Suiyoy(nu): """Suiy vulnbiliy ois""" INJION = "injion" UHNIION = "uhniion" UHOIZION = "uhoizion" NYPION = "nypion" ONFIUION = "onfiuion" PNNY = "pnny" OQULIY = "oquliy" OPLIN = "oplin" INFSUU = "infsuu" POION = "poion" lss oplinSn(nu): """oplin sns""" HIP = "hip" P = "p" SO2 = "so2" ISO27001 = "iso27001" NIS = "nis" PISS = "piss" ZUSUIY = "zusuiy" @lss lss SuiyVulnbiliy: """Suiy vulnbiliy finin""" vulnbiliyi: s il: s sipion: s sviy: SuiySviy oy: Suiyoy filph: Opionl[s] = Non linnub: Opionl[in] = Non osnipp: Opionl[s] = Non wi: Opionl[s] = Non vssso: Opionl[flo] = Non iion: s = "" fns: Lis[s] = fil(fulfoy=lis) isov: i = fil(fulfoy=i.now) sus: s = "opn" # opn, fix, flsposiiv, pis @lss lss SuiySnsul: """Suiy sn sul""" sni: s snyp: s ph: s si: i ni: Opionl[i] = Non uionsons: flo = 0.0 vulnbiliisfoun: in = 0 vulnbiliisbysviy: i[s, in] = fil(fulfoy=i) vulnbiliisbyoy: i[s, in] = fil(fulfoy=i) oplinso: flo = 100.0 ovllislvl: s = "low" suy: i[s, ny] = fil(fulfoy=i) ilfinins: Lis[SuiyVulnbiliy] = fil(fulfoy=lis) @lss lss oplinh: """oplin h sul""" sn: oplinSn quin: s sipion: s sus: s # oplin, nonoplin, nopplibl vin: Lis[s] = fil(fulfoy=lis) iion: s = "" sviy: SuiySviy = SuiySviy.IU lss SuiySnn: """ Suiy Snn fo L.I.F.. Plfo Povis ophnsiv suiy nlysis inluin: - o vulnbiliy snnin - pnny nlysis - onfiuion suiy - oplin ssssn - Infsuu suiy """ f ini(slf, wospph: Opionl[s] = Non, sniou: in = 300): slf.wospph = Ph(wospph o os.w()) slf.sniou = sniou # Suiy pns n uls slf.vulnbiliypns = slf.iniilizvulnbiliypns() slf.oplinhs = slf.iniilizoplinhs() # Sn suls so slf.snhisoy: Lis[SuiySnsul] = [] slf.nownvulnbiliis: S[s] = s() # h pool fo plll snnin slf.xuo = hPoolxuo(xwos=4) lo.info( f"Suiy Snn iniiliz fo wosp: {slf.wospph}" ) f iniilizvulnbiliypns(slf) -> i[s, i[s, ny]]: """Iniiliz vulnbiliy ion pns""" un { "hoss": { "pn": "(?i)(psswo|s|y|on)\s*[=:]\s*['\"]([^'\"]{8,})['\"]", "sviy": SuiySviy.HIH, "oy": Suiyoy.ONFIUION, "sipion": "Ho ss o nils ", }, "sqlinjion": { "pn": "(?i)(sl|ins|up|l)\s+.*\+.*['\"]|.*fo\(.*%.*\)", "sviy": SuiySviy.IIL, "oy": Suiyoy.INJION, "sipion": "Ponil SQL injion vulnbiliy", }, "xssvulnbl": { "pn": "innHL\s*[=:]\s*.*\+|oun\.wi\(.*\+", "sviy": SuiySviy.HIH, "oy": Suiyoy.INJION, "sipion": "Ponil XSS vulnbiliy", }, "wypo": { "pn": "(?i)(5|sh1)\(|hshlib\.(5|sh1)", "sviy": SuiySviy.IU, "oy": Suiyoy.NYPION, "sipion": "W ypophi loih us", }, "insuno": { "pn": "no\.(no|nin|hoi)", "sviy": SuiySviy.IU, "oy": Suiyoy.NYPION, "sipion": "Insu no nub nion", }, "bunbl": { "pn": "BU\s*[=:]\s*u|bu\s*[=:]\s*u", "sviy": SuiySviy.LOW, "oy": Suiyoy.ONFIUION, "sipion": "bu o nbl in pouion", }, "vlus": { "pn": "\bvl\s*\(", "sviy": SuiySviy.HIH, "oy": Suiyoy.OQULIY, "sipion": "nous vl() funion us", }, "xus": { "pn": "\bx\s*\(", "sviy": SuiySviy.HIH, "oy": Suiyoy.OQULIY, "sipion": "nous x() funion us", }, } f iniilizoplinhs(slf) -> Lis[oplinh]: """Iniiliz oplin hs""" un [ oplinh( sn=oplinSn.HIP, quin=" nypion", sipion="Snsiiv hlh  us b nyp  s n in nsi", sus="nopplibl", sviy=SuiySviy.HIH, ), oplinh( sn=oplinSn.P, quin=" Poion", sipion="Psonl  possin us oply wih P pinipls", sus="nopplibl", sviy=SuiySviy.HIH, ), oplinh( sn=oplinSn.ZUSUIY, quin="zu y Vul Us", sipion="Ss us b so in zu y Vul", sus="oplin", sviy=SuiySviy.IU, ), oplinh( sn=oplinSn.NIS, quin="ss onol", sipion="Ipln ol-bs ss onol", sus="oplin", sviy=SuiySviy.IU, ), oplinh( sn=oplinSn.ISO27001, quin="Infoion Suiy nn", sipion="Ipln ISS wih suiy onols", sus="oplin", sviy=SuiySviy.IU, ), ] syn f pfoophnsivsn( slf, snyp: s = "full", inlupnnis: bool = u ) -> SuiySnsul: """ Pfo ophnsiv suiy sn s: snyp: yp of sn (full, qui, ) inlupnnis: Whh o inlu pnny nlysis uns: SuiySnsul wih finins """ snsul = SuiySnsul( sni=f"ssn{in(i.now().isp())}", snyp=snyp, ph=s(slf.wospph), si=i.now(), ) lo.info(f"Sin {snyp} suiy sn of {slf.wospph}") y: # un iffn sn yps if snyp == "full": wi slf.unfullsn(snsul, inlupnnis) lif snyp == "qui": wi slf.unquisn(snsul) lif snyp == "": wi slf.unsn(snsul) # lul is snsul.ni = i.now() snsul.uionsons = ( snsul.ni - snsul.si ).olsons() slf.lulsnis(snsul) # n suy snsul.suy = slf.nsnsuy(snsul) xp xpion s : lo.o(f"Suiy sn fil: {}") snsul.suy["o"] = s() slf.snhisoy.ppn(snsul) lo.info(f"Suiy sn opl in {snsul.uionsons:.2f}s") un snsul syn f unfullsn( slf, snsul: SuiySnsul, inlupnnis: bool ) -> Non: """un full suiy sn""" # o nlysis wi slf.snovulnbiliis(snsul) # onfiuion nlysis wi slf.snonfiuionsuiy(snsul) # Infsuu nlysis wi slf.sninfsuusuiy(snsul) # oplin nlysis wi slf.snoplin(snsul) if inlupnnis: wi slf.snpnnis(snsul) syn f unquisn(slf, snsul: SuiySnsul) -> Non: """un qui suiy sn""" # Only iil n hih-sviy hs wi slf.snovulnbiliis( snsul, sviyfil=[SuiySviy.IIL, SuiySviy.HIH], ) syn f unsn(slf, snsul: SuiySnsul) -> Non: """un  suiy sn""" # Fous on spifi hih-is s wi slf.snonfiuionsuiy(snsul) wi slf.sninfsuusuiy(snsul) syn f snovulnbiliis( slf, snsul: SuiySnsul, sviyfil: Opionl[Lis[SuiySviy]] = Non, ) -> Non: """Sn o fo vulnbiliis""" lo.info("Snnin o fo vulnbiliis...") # Fin ll Pyhon fils pyhonfils = lis(slf.wospph.lob("*.py")) fo filph in pyhonfils: y: wih opn(filph, "", noin="uf-8", os="ino") s f: onn = f.() # h h vulnbiliy pn fo vulnn, vulnonfi in slf.vulnbiliypns.is(): if ( sviyfil n vulnonfi["sviy"] no in sviyfil ): oninu hs = .fini(vulnonfi["pn"], onn, .ULILIN) fo h in hs: #  vulnbiliy finin vulnbiliy = SuiyVulnbiliy( vulnbiliyi=f"{vulnn}{filph.n}{h.s()}", il=f"{vulnonfi['sipion']}", sipion=f"Pn h fo {vulnn} in {filph.n}", sviy=vulnonfi["sviy"], oy=vulnonfi["oy"], filph=s(filph), linnub=slf.linnub(onn, h.s()), osnipp=slf.xosnipp( onn, h.s() ), iion=slf.iionvi(vulnn), ) snsul.ilfinins.ppn(vulnbiliy) xp xpion s : lo.wnin(f"Fil o sn {filph}: {}") f linnub(slf, onn: s, posiion: in) -> in: """ lin nub fo h posiion""" un onn[:posiion].oun("\n") + 1 f xosnipp( slf, onn: s, posiion: in, onxlins: in = 2 ) -> s: """x o snipp oun posiion""" lins = onn.spli("\n") linnu = slf.linnub(onn, posiion) slin = x(0, linnu - onxlins - 1) nlin = in(ln(lins), linnu + onxlins) snipplins = [] fo i in n(slin, nlin):  = ">>> " if i + 1 == linnu ls " " snipplins.ppn(f"{}{i + 1:4}: {lins[i]}") un "\n".join(snipplins) f iionvi(slf, vulnn: s) -> s: """ iion vi fo vulnbiliy""" vi = { "hoss": "ov ss o nvionn vibls o zu y Vul", "sqlinjion": "Us piz quis o O wih pop sniizion", "xssvulnbl": "Us pop oupu noin n onn Suiy Poliy", "wypo": "Us SH-256 o son loihs fo hshin", "insuno": "Us ss oul fo ypophilly su no nubs", "bunbl": "isbl bu o in pouion nvionns", "vlus": "voi vl() - us sf lnivs li s.lilvl", "xus": "voi x() - fo o us pop funion lls", } un vi.(vulnn, "viw n fix h suiy issu") syn f snonfiuionsuiy( slf, snsul: SuiySnsul ) -> Non: """Sn onfiuion fils fo suiy issus""" lo.info("Snnin onfiuion suiy...") onfifils = [ "zuonfi.py", "zufunionsonfi.py", "quins.x", "ofil", "zu.yl", ".nv", "onfi.json", "sins.py", ] fo onfifil in onfifils: filph = slf.wospph / onfifil if no filph.xiss(): oninu y: wih opn(filph, "", noin="uf-8", os="ino") s f: onn = f.() # h fo insu onfiuions issus = slf.honfiuionissus(onn, onfifil) fo issu in issus: snsul.ilfinins.ppn(issu) xp xpion s : lo.wnin(f"Fil o sn onfi {onfifil}: {}") f honfiuionissus( slf, onn: s, filn: s ) -> Lis[SuiyVulnbiliy]: """h onfiuion onn fo suiy issus""" issus = [] # h fo bu o if .sh("BU\s*[=:]\s*u", onn, .INOS): issus.ppn( SuiyVulnbiliy( vulnbiliyi=f"bunbl{filn}", il="bu o nbl", sipion="bu o is nbl in onfiuion", sviy=SuiySviy.IU, oy=Suiyoy.ONFIUION, filph=filn, iion="isbl bu o in pouion", ) ) # h fo insu ss so if .sh( "(?i)(psswo|s|y)\s*[=:]\s*['\"]([^'\"]{4,})['\"]", onn ): issus.ppn( SuiyVulnbiliy( vulnbiliyi=f"hoss{filn}", il="Ho Ss", sipion="onfiuion onins ho ss", sviy=SuiySviy.HIH, oy=Suiyoy.ONFIUION, filph=filn, iion="Us zu y Vul o nvionn vibls", ) ) # h fo w pissions (if pplibl) if "pissions" in onn.low(): if .sh("777|wxwxwx", onn): issus.ppn( SuiyVulnbiliy( vulnbiliyi=f"wpissions{filn}", il="W Fil Pissions", sipion="Ovly pissiv fil pissions ", sviy=SuiySviy.IU, oy=Suiyoy.ONFIUION, filph=filn, iion="Us pinipl of ls pivil fo pissions", ) ) un issus syn f sninfsuusuiy( slf, snsul: SuiySnsul ) -> Non: """Sn infsuu onfiuion fo suiy issus""" lo.info("Snnin infsuu suiy...") # h zu onfiuions zufils = ["zu.yl", "zuonfi.py", "ZUOISUP."] fo zufil in zufils: filph = slf.wospph / zufil if no filph.xiss(): oninu y: wih opn(filph, "", noin="uf-8", os="ino") s f: onn = f.() # h zu suiy onfiuions issus = slf.hzusuiy(onn, zufil) fo issu in issus: snsul.ilfinins.ppn(issu) xp xpion s : lo.wnin(f"Fil o sn zu onfi {zufil}: {}") f hzusuiy( slf, onn: s, filn: s ) -> Lis[SuiyVulnbiliy]: """h zu onfiuion fo suiy issus""" issus = [] # h fo issin nypion if "so" in onn.low() n "nyp" no in onn.low(): issus.ppn( SuiyVulnbiliy( vulnbiliyi=f"issinnypion{filn}", il="issin So nypion", sipion="zu so y no hv nypion nbl", sviy=SuiySviy.HIH, oy=Suiyoy.INFSUU, filph=filn, iion="nbl zu So nypion  s", ) ) # h fo publi ss if .sh("publi.*ss|llow.*publi", onn, .INOS): issus.ppn( SuiyVulnbiliy( vulnbiliyi=f"publiss{filn}", il="Ponil Publi ss", sipion="onfiuion y llow publi ss", sviy=SuiySviy.HIH, oy=Suiyoy.INFSUU, filph=filn, iion="si ss o piv nwos only", ) ) # h fo issin B if "ol" no in onn.low() n "b" no in onn.low(): issus.ppn( SuiyVulnbiliy( vulnbiliyi=f"issinb{filn}", il="issin B onfiuion", sipion="ol-bs ss onol y no b onfiu", sviy=SuiySviy.IU, oy=Suiyoy.INFSUU, filph=filn, iion="Ipln zu B fo ss onol", ) ) un issus syn f snoplin(slf, snsul: SuiySnsul) -> Non: """Sn fo oplin wih suiy sns""" lo.info("Snnin oplin...") # Up oplin h sus bs on finins fo h in slf.oplinhs: if h.sn == oplinSn.ZUSUIY: # h if zu y Vul is bin us yvulus = slf.hyvulus() if no yvulus: h.sus = "nonoplin" h.iion = ( "Ipln zu y Vul fo ss nn" ) f hyvulus(slf) -> bool: """h if zu y Vul is bin us""" # Loo fo y Vul fns in o pyhonfils = lis(slf.wospph.lob("*.py")) fo filph in pyhonfils: y: wih opn(filph, "", noin="uf-8", os="ino") s f: onn = f.() if "yvul" in onn.low() o "yvul" in onn.low(): un u xp xpion: oninu un Fls syn f snpnnis(slf, snsul: SuiySnsul) -> Non: """Sn pnnis fo nown vulnbiliis""" lo.info("Snnin pnnis...") quinsfil = slf.wospph / "quins.x" if no quinsfil.xiss(): un y: wih opn(quinsfil, "") s f: pnnis = f.().spli("\n") # h fo nown vulnbl ps (siplifi h) vulnblps = {"insu-p": "1.0.0", "ol-ypo": "2.1.0"} fo p in pnnis: if no p.sip() o p.sswih("#"): oninu pn = p.spli("==")[0].sip() if pn in vulnblps: snsul.ilfinins.ppn( SuiyVulnbiliy( vulnbiliyi=f"vulnblpnny{pn}", il=f"Vulnbl pnny: {pn}", sipion=f"P {pn} hs nown suiy vulnbiliis", sviy=SuiySviy.HIH, oy=Suiyoy.PNNY, iion=f"Up {pn} o ls su vsion", ) ) xp xpion s : lo.wnin(f"Fil o sn pnnis: {}") f lulsnis(slf, snsul: SuiySnsul) -> Non: """lul sn sul is""" finins = snsul.ilfinins # oun by sviy sviyouns = {} fo sviy in SuiySviy: sviyouns[sviy.vlu] = 0 # oun by oy oyouns = {} fo oy in Suiyoy: oyouns[oy.vlu] = 0 fo finin in finins: sviyouns[finin.sviy.vlu] += 1 oyouns[finin.oy.vlu] += 1 snsul.vulnbiliisfoun = ln(finins) snsul.vulnbiliisbysviy = sviyouns snsul.vulnbiliisbyoy = oyouns # lul oplin so snsul.oplinso = slf.luloplinso(finins) # in ovll is lvl snsul.ovllislvl = slf.lulislvl(finins) f luloplinso( slf, finins: Lis[SuiyVulnbiliy] ) -> flo: """lul oplin so bs on finins""" if no finins: un 100.0 # Wih finins by sviy sviywihs = { SuiySviy.IIL: 10, SuiySviy.HIH: 7, SuiySviy.IU: 4, SuiySviy.LOW: 2, SuiySviy.INFO: 1, } olwih = 0 fo finin in finins: olwih += sviywihs.(finin.sviy, 1) # onv o so (hih wih = low so) so = x(0, 100 - (olwih * 2)) un oun(so, 1) f lulislvl(slf, finins: Lis[SuiyVulnbiliy]) -> s: """lul ovll is lvl""" iiloun = su( 1 fo f in finins if f.sviy == SuiySviy.IIL ) hihoun = su(1 fo f in finins if f.sviy == SuiySviy.HIH) if iiloun > 0: un "iil" lif hihoun > 2: un "hih" lif hihoun > 0 o ln(finins) > 5: un "iu" lif ln(finins) > 0: un "low" ls: un "inil" f nsnsuy(slf, snsul: SuiySnsul) -> i[s, ny]: """n sn suy""" un { "snyp": snsul.snyp, "olfilssnn": ln(lis(slf.wospph.lob("*.py"))), "vulnbiliisfoun": snsul.vulnbiliisfoun, "oplinso": snsul.oplinso, "islvl": snsul.ovllislvl, "snuion": snsul.uionsons, "opois": so( snsul.vulnbiliisbyoy.is(), y=lb x: x[1], vs=u, )[:3], } f snhisoy(slf, lii: in = 10) -> Lis[SuiySnsul]: """ sn hisoy""" un slf.snhisoy[-lii:] f vulnbiliyns(slf, ys: in = 30) -> i[s, ny]: """ vulnbiliy ns ov i""" uoff = i.now() - il(ys=ys) lvnsns = [ sn fo sn in slf.snhisoy if sn.si >= uoff ] ns = { "pioys": ys, "olsns": ln(lvnsns), "vulnbiliyn": [], "oplinn": [], } fo sn in so(lvnsns, y=lb x: x.si): ns["vulnbiliyn"].ppn( { "": sn.si.().isofo(), "oun": sn.vulnbiliisfoun, } ) ns["oplinn"].ppn( { "": sn.si.().isofo(), "so": sn.oplinso, } ) un ns f xposnpo( slf, snsul: SuiySnsul, filph: s ) -> bool: """xpo suiy sn po""" y: xpo = { "sni": snsul.sni, "snyp": snsul.snyp, "ph": snsul.ph, "si": snsul.si.isofo(), "ni": ( snsul.ni.isofo() if snsul.ni ls Non ), "uionsons": snsul.uionsons, "suy": snsul.suy, "vulnbiliisbysviy": snsul.vulnbiliisbysviy, "vulnbiliisbyoy": snsul.vulnbiliisbyoy, "finins": [ { "i": finin.vulnbiliyi, "il": finin.il, "sviy": finin.sviy.vlu, "oy": finin.oy.vlu, "fil": finin.filph, "lin": finin.linnub, "iion": finin.iion, } fo finin in snsul.ilfinins ], } wih opn(filph, "w") s f: json.up(xpo, f, inn=2, ful=s) lo.info(f"Suiy sn po xpo o {filph}") un u xp xpion s : lo.o(f"Fil o xpo sn po: {}") un Fls # Foy funion fo sy insniion f suiysnn( wospph: Opionl[s] = Non, sniou: in = 300 ) -> SuiySnn: """ Foy funion o  suiy snn s: wospph: Ph o wosp ioy sniou: Sn iou in sons uns: onfiu SuiySnn insn """ un SuiySnn(wospph=wospph, sniou=sniou) # on-lin inf f in(): """in LI funion fo suiy snnin""" ipo ps ps = ps.unPs(sipion="L.I.F.. Plfo Suiy Snn") ps.un( "--wosp", "-w", ful=Non, hlp="Wosp ioy ph" ) ps.un( "--sn-yp", "-", hois=["full", "qui", ""], ful="full", hlp="yp of suiy sn o pfo", ) ps.un( "--no-pnnis", ion="sou", hlp="Sip pnny vulnbiliy snnin", ) ps.un( "--xpo", "-", hlp="xpo sn suls o spifi JSON fil" ) ps.un( "--iou", yp=in, ful=300, hlp="Sn iou in sons" ) ps.un( "--vbos", "-v", ion="sou", hlp="nbl vbos loin" ) s = ps.pss() if s.vbos: loin.Lo().sLvl(loin.BU) #  suiy snn snn = suiysnn( wospph=s.wosp, sniou=s.iou ) pin("L.I.F.. Plfo - Suiy Snn") pin("=" * 40) y: # Pfo sn pin(f"Pfoin {s.snyp} suiy sn...") snsul = synio.un( snn.pfoophnsivsn( snyp=s.snyp, inlupnnis=no s.nopnnis ) ) pin("\nSn suls:") pin(f" Sn I: {snsul.sni}") pin(f" yp: {snsul.snyp}") pin(f" uion: {snsul.uionsons:.2f}s") pin(f" Vulnbiliis Foun: {snsul.vulnbiliisfoun}") pin(f" oplin So: {snsul.oplinso:.1f}/100") pin(f" is Lvl: {snsul.ovllislvl}") if snsul.vulnbiliisfoun > 0: pin("\nVulnbiliis by Sviy:") fo sviy, oun in snsul.vulnbiliisbysviy.is(): if oun > 0: pin(f" {sviy.piliz()}: {oun}") pin("\nop Finins:") fo finin in snsul.ilfinins[:5]: # Show fis 5 pin(f" [{finin.sviy.vlu.upp()}] {finin.il}") if finin.filph: pin(f" Fil: {finin.filph}") if finin.iion: pin(f" Fix: {finin.iion}") pin() if s.xpo: if snn.xposnpo(snsul, s.xpo): pin(f"\nSn po xpo o {s.xpo}") ls: pin("\nFil o xpo sn po") un 1 # xi wih ppopi o bs on finins if snsul.ovllislvl in ["iil", "hih"]: pin("\n ️ HIH IS: iil suiy issus foun!") un 1 lif snsul.ovllislvl == "iu": pin("\n ️ IU IS: Suiy ipovns on") un 0 ls: pin("\n Suiy sn pss") un 0 xp yboInup: pin("\nSn inup by us") un 1 xp xpion s : pin(f"\nSuiy sn fil: {}") un 1 if n == "in": ipo sys sys.xi(in())