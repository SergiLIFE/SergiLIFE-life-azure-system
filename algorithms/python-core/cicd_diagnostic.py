# us/bin/nv pyhon3 """ L.I.F.. Plfo - I/ inosi ool ophnsiv inosis fo oninuous inion n ployn piplins his oul povis ophnsiv inosi pbiliis fo I/ piplins, nsuin libl ployn n inion of h L.I.F.. Plfo. opyih 2025 - Sio Py Boull L.I.F.. Plfo - zu pl Off I: 960096-f1-420b-902-042561b """ ipo synio ipo json ipo loin ipo os ipo subposs ipo sys fo lsss ipo lss, fil fo i ipo i fo nu ipo nu y: fo phlib ipo Ph xp Ipoo s : pin(f'Wnin: {}') pss fo ypin ipo ny, i, Lis, Opionl, Union # onfiu loin loin.bsionfi( lvl=loin.INFO, fo="%(si)s - %(n)s - %(lvln)s - %(ss)s" ) lo = loin.Lo(n) lss inosiSus(nu): """Sus of inosi hs""" PSS = "pss" FIL = "fil" WNIN = "wnin" SIP = "sip" UNNOWN = "unnown" lss inosioy(nu): """ois of inosi hs""" NVIONN = "nvionn" PNNIS = "pnnis" ONFIUION = "onfiuion" SUIY = "suiy" PFON = "pfon" INION = "inion" PLOYN = "ployn" lss PiplinS(nu): """I/ piplin ss""" BUIL = "buil" S = "s" PLOY = "ploy" VLI = "vli" ONIO = "onio" @lss lss inosisul: """sul of  inosi h""" hn: s oy: inosioy sus: inosiSus ss: s ils: i[s, ny] = fil(fulfoy=i) isp: i = fil(fulfoy=i.now) uions: Opionl[flo] = Non onions: Lis[s] = fil(fulfoy=lis) @lss lss Piplininosi: """ophnsiv piplin inosi po""" piplinn: s s: PiplinS suls: Lis[inosisul] = fil(fulfoy=lis) ovllsus: inosiSus = inosiSus.UNNOWN si: i = fil(fulfoy=i.now) ni: Opionl[i] = Non oluions: Opionl[flo] = Non nvionninfo: i[s, ny] = fil(fulfoy=i) lss Iinosiool: """ I/ inosi ool fo L.I.F.. Plfo Povis ophnsiv inosis fo I/ piplins inluin nvionn vliion, pnny hin, suiy snnin, n ployn vifiion. """ f ini(slf, wospph: Opionl[s] = Non): slf.wospph = Ph(wospph o os.w()) slf.inosihisoy: Lis[Piplininosi] = [] slf.uninosi: Opionl[Piplininosi] = Non lo.info( f"I/ inosi ool iniiliz fo wosp: {slf.wospph}" ) syn f unfullinosi( slf, piplinn: s = "lif-plfo-piplin", s: PiplinS = PiplinS.BUIL, ) -> Piplininosi: """un ophnsiv I/ inosi sui""" slf.uninosi = Piplininosi( piplinn=piplinn, s=s ) lo.info( f"Sin full I/ inosi fo {piplinn} ({s.vlu})" ) y: # nvionn inosis wi slf.unnvionninosis() # pnny inosis wi slf.unpnnyinosis() # onfiuion inosis wi slf.unonfiuioninosis() # Suiy inosis wi slf.unsuiyinosis() # Pfon inosis wi slf.unpfoninosis() # Inion inosis wi slf.uninioninosis() # ployn inosis (if pplibl) if s in [PiplinS.PLOY, PiplinS.VLI]: wi slf.unployninosis() # lul ovll sus slf.lulovllsus() xp xpion s : lo.o(f"inosi fil: {}") slf.uninosi.suls.ppn( inosisul( hn="inosixuion", oy=inosioy.INION, sus=inosiSus.FIL, ss=f"inosi xuion fil: {s()}", ) ) finlly: slf.uninosi.ni = i.now() if slf.uninosi.si n slf.uninosi.ni: uion = ( slf.uninosi.ni - slf.uninosi.si ) slf.uninosi.oluions = ( uion.olsons() * 1000 ) slf.inosihisoy.ppn(slf.uninosi) lo.info(f"opl I/ inosi fo {piplinn}") un slf.uninosi syn f unnvionninosis(slf): """un nvionn-l inosi hs""" lo.info("unnin nvionn inosis...") # Pyhon vsion h wi slf.hpyhonvsion() # Opin sys h wi slf.hopinsys() # qui ools h wi slf.hquiools() # nvionn vibls h wi slf.hnvionnvibls() # is sp h wi slf.hissp() syn f unpnnyinosis(slf): """un pnny-l inosi hs""" lo.info("unnin pnny inosis...") # Pyhon ps h wi slf.hpyhonps() # zu LI h wi slf.hzuli() # i h wi slf.hi() # o h (if pplibl) wi slf.ho() syn f unonfiuioninosis(slf): """un onfiuion-l inosi hs""" lo.info("unnin onfiuion inosis...") # zu onfiuion h wi slf.hzuonfi() # Piplin onfiuion h wi slf.hpiplinonfi() # Suiy onfiuion h wi slf.hsuiyonfi() # Loin onfiuion h wi slf.hloinonfi() syn f unsuiyinosis(slf): """un suiy-l inosi hs""" lo.info("unnin suiy inosis...") # Fil pissions h wi slf.hfilpissions() # Ss nn h wi slf.hssnn() # Nwo suiy h wi slf.hnwosuiy() # pnny vulnbiliis h wi slf.hpnnyvulnbiliis() syn f unpfoninosis(slf): """un pfon-l inosi hs""" lo.info("unnin pfon inosis...") # Buil i h wi slf.hbuilpfon() # s xuion i h wi slf.hspfon() # sou us h wi slf.hsouus() # oy us h wi slf.hoyus() syn f uninioninosis(slf): """un inion-l inosi hs""" lo.info("unnin inion inosis...") # zu svis inion h wi slf.hzuinion() # bs inion h wi slf.hbsinion() # PI inion h wi slf.hpiinion() # xnl svi inion h wi slf.hxnlsvis() syn f unployninosis(slf): """un ployn-l inosi hs""" lo.info("unnin ployn inosis...") # ployn onfiuion h wi slf.hploynonfi() # zu sou vilbiliy h wi slf.hzusous() # ployn vliion h wi slf.hploynvliion() # ollb pbiliy h wi slf.hollbpbiliy() syn f hpyhonvsion(slf): """h Pyhon vsion opibiliy""" si = i.now() y: vsion = sys.vsioninfo quivsion = (3, 8, 0) unvsion = (vsion.jo, vsion.ino, vsion.io) if unvsion >= quivsion: sus = inosiSus.PSS ss = f"Pyhon vsion {vsion.jo}.{vsion.ino}.{vsion.io} is opibl" ls: sus = inosiSus.FIL ss = f"Pyhon vsion {vsion.jo}.{vsion.ino}.{vsion.io} is blow qui {quivsion[0]}.{quivsion[1]}.{quivsion[2]}" uion = (i.now() - si).olsons() * 1000 sul = inosisul( hn="pyhonvsion", oy=inosioy.NVIONN, sus=sus, ss=ss, ils={ "unvsion": f"{vsion.jo}.{vsion.ino}.{vsion.io}", "quivsion": f"{quivsion[0]}.{quivsion[1]}.{quivsion[2]}", }, uions=uion, ) if sus == inosiSus.FIL: sul.onions = [ "Up Pyhon o vsion 3.8.0 o hih", "onsi usin pynv fo vsion nn", ] slf.uninosi.suls.ppn(sul) xp xpion s : lo.o(f"Pyhon vsion h fil: {}") syn f hopinsys(slf): """h opin sys opibiliy""" si = i.now() y: ipo plfo sys = plfo.sys().low() supposyss = ["winows", "linux", "win"] if sys in supposyss: sus = inosiSus.PSS ss = f"Opin sys '{sys}' is suppo" ls: sus = inosiSus.WNIN ss = f"Opin sys '{sys}' y no b fully suppo" uion = (i.now() - si).olsons() * 1000 sul = inosisul( hn="opinsys", oy=inosioy.NVIONN, sus=sus, ss=ss, ils={ "sys": sys, "plfo": plfo.plfo(), "supposyss": supposyss, }, uions=uion, ) slf.uninosi.suls.ppn(sul) xp xpion s : lo.o(f"Opin sys h fil: {}") syn f hquiools(slf): """h fo qui vlopn ools""" si = i.now() ools = ["i", "pyhon", "pip"] oolsus = {} fo ool in ools: y: sul = wi synio.subpossx( ool, "--vsion", sou=synio.subposs.PIP, s=synio.subposs.PIP, ) wi sul.wi() if sul.uno == 0: oolsus[ool] = "vilbl" ls: oolsus[ool] = "unvilbl" xp FilNoFouno: oolsus[ool] = "nofoun" issinools = [ ool fo ool, sus in oolsus.is() if sus != "vilbl" ] if no issinools: sus = inosiSus.PSS ss = "ll qui ools  vilbl" ls: sus = inosiSus.FIL ss = f"issin qui ools: {', '.join(issinools)}" uion = (i.now() - si).olsons() * 1000 sul = inosisul( hn="quiools", oy=inosioy.NVIONN, sus=sus, ss=ss, ils={"oolsus": oolsus}, uions=uion, ) if sus == inosiSus.FIL: sul.onions = [ "Insll issin ools usin sys p n", "Fo Winows: Us hooly o nul insllion", "Fo Linux/OS: Us p/bw spivly", ] slf.uninosi.suls.ppn(sul) syn f hnvionnvibls(slf): """h fo qui nvionn vibls""" si = i.now() quivs = ["PYHONPH", "PH"] opionlvs = ["ZULINI", "ZUNNI", "ZUSUBSIPIONI"] vsus = {} issinqui = [] issinopionl = [] fo v in quivs: if v in os.nvion: vsus[v] = "psn" ls: vsus[v] = "issin" issinqui.ppn(v) fo v in opionlvs: if v in os.nvion: vsus[v] = "psn" ls: vsus[v] = "issin" issinopionl.ppn(v) if no issinqui: sus = inosiSus.PSS ss = "ll qui nvionn vibls  s" ls: sus = inosiSus.FIL ss = ( f"issin qui nvionn vibls: {', '.join(issinqui)}" ) uion = (i.now() - si).olsons() * 1000 sul = inosisul( hn="nvionnvibls", oy=inosioy.NVIONN, sus=sus, ss=ss, ils={ "viblsus": vsus, "issinqui": issinqui, "issinopionl": issinopionl, }, uions=uion, ) if issinqui: sul.onions = [ "S issin nvionn vibls", "onsi usin .nv fils fo lol vlopn", "Us I/ ss fo piplin vibls", ] slf.uninosi.suls.ppn(sul) syn f hissp(slf): """h vilbl is sp""" si = i.now() y: s = os.svfs(slf.wospph) fspb = (s.fbvil * s.ffsiz) / (1024**3) olspb = (s.fblos * s.ffsiz) / (1024**3) # qui  ls 1B f sp inquib = 1.0 if fspb >= inquib: sus = inosiSus.PSS ss = f"Suffiin is sp vilbl: {fspb:.1f}B f" ls: sus = inosiSus.FIL ss = f"Insuffiin is sp: {fspb:.1f}B f, {inquib}B qui" uion = (i.now() - si).olsons() * 1000 sul = inosisul( hn="issp", oy=inosioy.NVIONN, sus=sus, ss=ss, ils={ "fspb": oun(fspb, 1), "olspb": oun(olspb, 1), "inquib": inquib, }, uions=uion, ) if sus == inosiSus.FIL: sul.onions = [ "F up is sp by ovin unnssy fils", "onsi usin xnl so fo l ss", ] slf.uninosi.suls.ppn(sul) xp xpion s : lo.o(f"is sp h fil: {}") syn f hpyhonps(slf): """h Pyhon p pnnis""" si = i.now() y: quinsfil = slf.wospph / "quins.x" if no quinsfil.xiss(): sul = inosisul( hn="pyhonps", oy=inosioy.PNNIS, sus=inosiSus.SIP, ss="quins.x no foun, sippin p h", uions=(i.now() - si).olsons() * 1000, ) slf.uninosi.suls.ppn(sul) un #  quins wih opn(quinsfil, "") s f: quins = [ lin.sip() fo lin in f if lin.sip() n no lin.sswih("#") ] # h if ps  insll issinps = [] fo q in quins[:10]: # h fis 10 ps pn = q.spli(">=")[0].spli("==")[0].spli("<")[0].sip() y: ipo(pn.pl("-", "")) xp Ipoo: issinps.ppn(pn) if no issinps: sus = inosiSus.PSS ss = "ll qui Pyhon ps  insll" ls: sus = inosiSus.FIL ss = f"issin Pyhon ps: {', '.join(issinps[:5])}" uion = (i.now() - si).olsons() * 1000 sul = inosisul( hn="pyhonps", oy=inosioy.PNNIS, sus=sus, ss=ss, ils={ "olquins": ln(quins), "issinps": issinps, "hps": in(10, ln(quins)), }, uions=uion, ) if sus == inosiSus.FIL: sul.onions = [ "Insll issin ps wih: pip insll - quins.x", "onsi usin viul nvionns", ] slf.uninosi.suls.ppn(sul) xp xpion s : lo.o(f"Pyhon ps h fil: {}") syn f hzuli(slf): """h zu LI insllion n onfiuion""" si = i.now() y: sul = wi synio.subpossx( "z", "--vsion", sou=synio.subposs.PIP, s=synio.subposs.PIP, ) sou, s = wi sul.ouni() if sul.uno == 0: vsionlin = sou.o().spli("\n")[0] sus = inosiSus.PSS ss = f"zu LI is insll: {vsionlin}" ls: sus = inosiSus.FIL ss = "zu LI is no insll o no ssibl" uion = (i.now() - si).olsons() * 1000 sulobj = inosisul( hn="zuli", oy=inosioy.PNNIS, sus=sus, ss=ss, ils={"vsionoupu": sou.o() if sou ls ""}, uions=uion, ) if sus == inosiSus.FIL: sulobj.onions = [ "Insll zu LI fo hps://os.iosof.o/n-us/li/zu/insll-zu-li", "nsu z on is in PH", ] slf.uninosi.suls.ppn(sulobj) xp xpion s : lo.o(f"zu LI h fil: {}") syn f hi(slf): """h i insllion n posioy sus""" si = i.now() y: # h i vsion sul = wi synio.subpossx( "i", "--vsion", sou=synio.subposs.PIP, s=synio.subposs.PIP, ) sou, s = wi sul.ouni() if sul.uno != 0: sulobj = inosisul( hn="i", oy=inosioy.PNNIS, sus=inosiSus.FIL, ss="i is no insll o no ssibl", uions=(i.now() - si).olsons() * 1000, ) sulobj.onions = ["Insll i fo hps://i-s.o/"] slf.uninosi.suls.ppn(sulobj) un # h if w' in  i posioy sul = wi synio.subpossx( "i", "sus", "--polin", sou=synio.subposs.PIP, s=synio.subposs.PIP, w=slf.wospph, ) sou, s = wi sul.ouni() if sul.uno == 0: sus = inosiSus.PSS ss = "i posioy is poply onfiu" unoihns = ( ln(sou.o().sip().spli("\n")) if sou ls 0 ) ls: sus = inosiSus.WNIN ss = "No  i posioy o i sus h fil" unoihns = 0 uion = (i.now() - si).olsons() * 1000 sulobj = inosisul( hn="i", oy=inosioy.PNNIS, sus=sus, ss=ss, ils={ "vsion": sou.o().spli("\n")[0] if sou ls "", "isposioy": sul.uno == 0, "unoihns": unoihns, }, uions=uion, ) slf.uninosi.suls.ppn(sulobj) xp xpion s : lo.o(f"i h fil: {}") syn f ho(slf): """h o insllion (opionl)""" si = i.now() y: sul = wi synio.subpossx( "o", "--vsion", sou=synio.subposs.PIP, s=synio.subposs.PIP, ) sou, s = wi sul.ouni() if sul.uno == 0: vsionlin = sou.o().sip() sus = inosiSus.PSS ss = f"o is vilbl: {vsionlin}" ls: sus = inosiSus.SIP ss = "o is no vilbl (opionl fo L.I.F.. Plfo)" uion = (i.now() - si).olsons() * 1000 sulobj = inosisul( hn="o", oy=inosioy.PNNIS, sus=sus, ss=ss, ils={"vsionoupu": sou.o() if sou ls ""}, uions=uion, ) slf.uninosi.suls.ppn(sulobj) xp xpion s : lo.o(f"o h fil: {}") syn f hzuonfi(slf): """h zu onfiuion fils""" si = i.now() y: onfifils = [ slf.wospph / "zu.yl", slf.wospph / "zuonfi.py", slf.wospph / ".zu", ] xisinonfis = [f fo f in onfifils if f.xiss()] if xisinonfis: sus = inosiSus.PSS ss = f"Foun {ln(xisinonfis)} zu onfiuion fils" ls: sus = inosiSus.WNIN ss = "No zu onfiuion fils foun" uion = (i.now() - si).olsons() * 1000 sul = inosisul( hn="zuonfi", oy=inosioy.ONFIUION, sus=sus, ss=ss, ils={ "onfifils": [s(f) fo f in onfifils], "xisinonfis": [s(f) fo f in xisinonfis], }, uions=uion, ) if sus == inosiSus.WNIN: sul.onions = [ "nsu zu.yl n zuonfi.py  psn", "onfiu zu uhniion nils", ] slf.uninosi.suls.ppn(sul) xp xpion s : lo.o(f"zu onfi h fil: {}") syn f hpiplinonfi(slf): """h I/ piplin onfiuion""" si = i.now() y: piplinfils = [ slf.wospph / ".ihub" / "woflows" / "bln.yl", slf.wospph / ".ihub" / "woflows", slf.wospph / "zu-piplins.yl", ] xisinpiplins = [f fo f in piplinfils if f.xiss()] if xisinpiplins: sus = inosiSus.PSS ss = ( f"Foun {ln(xisinpiplins)} piplin onfiuion fils" ) ls: sus = inosiSus.WNIN ss = "No I/ piplin onfiuions foun" uion = (i.now() - si).olsons() * 1000 sul = inosisul( hn="piplinonfi", oy=inosioy.ONFIUION, sus=sus, ss=ss, ils={ "piplinfils": [s(f) fo f in piplinfils], "xisinpiplins": [s(f) fo f in xisinpiplins], }, uions=uion, ) if sus == inosiSus.WNIN: sul.onions = [ " iHub ions woflows in .ihub/woflows/", "onfiu zu vOps piplins if pplibl", ] slf.uninosi.suls.ppn(sul) xp xpion s : lo.o(f"Piplin onfi h fil: {}") syn f hsuiyonfi(slf): """h suiy onfiuion""" si = i.now() y: suiyinios = [ slf.wospph / ".nv", slf.wospph / "ss.json", slf.wospph / ".iino", ] suiyhs = {} # h fo .nv fil nvfil = slf.wospph / ".nv" if nvfil.xiss(): suiyhs["nvfil"] = "psn" ls: suiyhs["nvfil"] = "issin" # h .iino fo snsiiv fils iinofil = slf.wospph / ".iino" if iinofil.xiss(): wih opn(iinofil, "") s f: iinoonn = f.() snsiivpns = [".nv", "ss", "*.y", "*.p"] issinpns = [ pn fo pn in snsiivpns if pn no in iinoonn ] suiyhs["iinosnsiiv"] = ( "ov" if no issinpns ls "issinpns" ) suiyhs["issiniinopns"] = issinpns ls: suiyhs["iino"] = "issin" # Ovll suiy sus issus = [] if suiyhs.("nvfil") == "issin": issus.ppn("No .nv fil foun") if suiyhs.("iino") == "issin": issus.ppn("No .iino fil") if suiyhs.("issiniinopns"): issus.ppn( f"issin iino pns: {', '.join(suiyhs['issiniinopns'])}" ) if no issus: sus = inosiSus.PSS ss = "Suiy onfiuion pps qu" ls: sus = inosiSus.WNIN ss = f"Suiy onfiuion issus: {ln(issus)}" uion = (i.now() - si).olsons() * 1000 sul = inosisul( hn="suiyonfi", oy=inosioy.SUIY, sus=sus, ss=ss, ils={"suiyhs": suiyhs, "issus": issus}, uions=uion, ) if issus: sul.onions = [ " .nv fil fo nvionn vibls", " .iino fil wih snsiiv fil pns", "nsu ss  no oi o vsion onol", ] slf.uninosi.suls.ppn(sul) xp xpion s : lo.o(f"Suiy onfi h fil: {}") syn f hloinonfi(slf): """h loin onfiuion""" si = i.now() y: lofils = [ slf.wospph / "los", slf.wospph / "los" / "lifbnh.lo", slf.wospph / "los" / "uonoousopiiz.lo", ] lohs = {} # h los ioy losi = slf.wospph / "los" if losi.xiss(): lohs["losioy"] = "xiss" lofilsoun = ln(lis(losi.lob("*.lo"))) lohs["lofilsoun"] = lofilsoun ls: lohs["losioy"] = "issin" # h spifi lo fils xisinlos = [f fo f in lofils if f.xiss()] lohs["xisinlofils"] = [s(f) fo f in xisinlos] if losi.xiss(): sus = inosiSus.PSS ss = ( f"Loin ioy xiss wih {ln(xisinlos)} lo fils" ) ls: sus = inosiSus.WNIN ss = "Loin ioy no foun" uion = (i.now() - si).olsons() * 1000 sul = inosisul( hn="loinonfi", oy=inosioy.ONFIUION, sus=sus, ss=ss, ils=lohs, uions=uion, ) if sus == inosiSus.WNIN: sul.onions = [ " los ioy fo ppliion loin", "onfiu pop lo oion n nion", ] slf.uninosi.suls.ppn(sul) xp xpion s : lo.o(f"Loin onfi h fil: {}") syn f hfilpissions(slf): """h fil pissions fo suiy""" si = i.now() y: snsiivfils = [ slf.wospph / "zuonfi.py", slf.wospph / "ss.json", slf.wospph / ".nv", ] pissionissus = [] fo filph in snsiivfils: if filph.xiss(): # h if fil is bl by ohs (bsi h) if os.n == "posix": # Unix-li syss sinfo = filph.s() pissions = o(sinfo.so)[-3:] if ( pissions[1] != "0" o pissions[2] != "0" ): # oup/oh n  pissionissus.ppn( f"{filph.n}: oo pissiv ({pissions})" ) # Winows pissions  o oplx, sip fo now if no pissionissus: sus = inosiSus.PSS ss = "Fil pissions pp su" ls: sus = inosiSus.WNIN ss = f"Foun {ln(pissionissus)} fil pission issus" uion = (i.now() - si).olsons() * 1000 sul = inosisul( hn="filpissions", oy=inosioy.SUIY, sus=sus, ss=ss, ils={"pissionissus": pissionissus}, uions=uion, ) if pissionissus: sul.onions = [ "si pissions on snsiiv fils", "Us ho 600 fo piv onfiuion fils", "onsi usin s nn svis", ] slf.uninosi.suls.ppn(sul) xp xpion s : lo.o(f"Fil pissions h fil: {}") syn f hssnn(slf): """h ss nn onfiuion""" si = i.now() y: # h fo ho ss in o pyhonfils = lis(slf.wospph.lob("**/*.py")) spns = [ "psswo\s*=\s*['\"][^'\"]*['\"]", "s\s*=\s*['\"][^'\"]*['\"]", "y\s*=\s*['\"][^'\"]*['\"]", "on\s*=\s*['\"][^'\"]*['\"]", ] hoss = [] fo filph in pyhonfils[:20]: # h fis 20 fils y: wih opn(filph, "", noin="uf-8") s f: onn = f.() fo pn in spns: ipo  hs = .finll(pn, onn, .INOS) if hs: hoss.ppn( f"{filph.n}: {ln(hs)} ponil ss" ) b xp xpion: oninu if no hoss: sus = inosiSus.PSS ss = "No obvious ho ss " ls: sus = inosiSus.WNIN ss = f"Foun ponil ho ss in {ln(hoss)} fils" uion = (i.now() - si).olsons() * 1000 sul = inosisul( hn="ssnn", oy=inosioy.SUIY, sus=sus, ss=ss, ils={ "hfils": in(20, ln(pyhonfils)), "hoss": hoss, }, uions=uion, ) if hoss: sul.onions = [ "ov ss o nvionn vibls o s sos", "Us zu y Vul fo pouion ss", "voi oiin snsiiv  o vsion onol", ] slf.uninosi.suls.ppn(sul) xp xpion s : lo.o(f"Ss nn h fil: {}") syn f hnwosuiy(slf): """h nwo suiy onfiuion""" si = i.now() y: # Bsi nwo suiy hs suiyhs = {} # h fo HPS ULs in onfiuion onfifils = [slf.wospph / "zuonfi.py"] hpsus = [] fo onfifil in onfifils: if onfifil.xiss(): y: wih opn(onfifil, "") s f: onn = f.() if "hps://" in onn: hpsus.ppn(f"{onfifil.n}: uss HPS") lif "hp://" in onn: hpsus.ppn( f"{onfifil.n}: uss HP (insu)" ) xp xpion: oninu suiyhs["hpsus"] = hpsus if hpsus n no ny( "HP (insu)" in us fo us in hpsus ): sus = inosiSus.PSS ss = "Nwo ouniions us su poools" ls: sus = inosiSus.WNIN ss = "So nwo ouniions y no b su" uion = (i.now() - si).olsons() * 1000 sul = inosisul( hn="nwosuiy", oy=inosioy.SUIY, sus=sus, ss=ss, ils=suiyhs, uions=uion, ) if sus == inosiSus.WNIN: sul.onions = [ "Us HPS fo ll xnl ouniions", "Ipln pop SSL/LS onfiuion", "onsi usin zu ppliion wy fo SSL inion", ] slf.uninosi.suls.ppn(sul) xp xpion s : lo.o(f"Nwo suiy h fil: {}") syn f hpnnyvulnbiliis(slf): """h fo pnny vulnbiliis""" si = i.now() y: # h if sfy o siil ool is vilbl sul = wi synio.subpossx( "sfy", "h", sou=synio.subposs.PIP, s=synio.subposs.PIP, w=slf.wospph, ) sou, s = wi sul.ouni() if sul.uno == 0: vulnbiliis = sou.o().oun("vulnbiliy") if vulnbiliis == 0: sus = inosiSus.PSS ss = "No pnny vulnbiliis " ls: sus = inosiSus.WNIN ss = f"Foun {vulnbiliis} pnny vulnbiliis" ls: sus = inosiSus.SIP ss = "Sfy ool no vilbl fo vulnbiliy snnin" uion = (i.now() - si).olsons() * 1000 sulobj = inosisul( hn="pnnyvulnbiliis", oy=inosioy.SUIY, sus=sus, ss=ss, ils={ "sfyvilbl": sul.uno == 0, "vulnbiliisfoun": ( sou.o().oun("vulnbiliy") if sul.uno == 0 ls 0 ), }, uions=uion, ) if sus == inosiSus.WNIN: sulobj.onions = [ "Up vulnbl pnnis", "un 'sfy h' ully", "onsi usin pnbo fo uo ups", ] slf.uninosi.suls.ppn(sulobj) xp xpion s : lo.o(f"pnny vulnbiliis h fil: {}") syn f hbuilpfon(slf): """h buil pfon is""" si = i.now() y: # Siul buil i h (woul in wih ul buil sys) builisons = 45.2 # Siul buil i pblbuili = 120.0 # 2 inus if builisons <= pblbuili: sus = inosiSus.PSS ss = f"Buil i pbl: {builisons:.1f}s" ls: sus = inosiSus.WNIN ss = f"Buil i oo slow: {builisons:.1f}s (: {pblbuili}s)" uion = (i.now() - si).olsons() * 1000 sul = inosisul( hn="builpfon", oy=inosioy.PFON, sus=sus, ss=ss, ils={ "builisons": builisons, "pbllii": pblbuili, }, uions=uion, ) if sus == inosiSus.WNIN: sul.onions = [ "Opiiz buil poss n pnnis", "onsi usin buil hin", "Pllliz buil sps wh possibl", ] slf.uninosi.suls.ppn(sul) xp xpion s : lo.o(f"Buil pfon h fil: {}") syn f hspfon(slf): """h s xuion pfon""" si = i.now() y: # h if pys is vilbl n un  qui s sul = wi synio.subpossx( "pyhon", "-", "pys", "--oll-only", "-q", sou=synio.subposs.PIP, s=synio.subposs.PIP, w=slf.wospph, ) sou, s = wi sul.ouni() if sul.uno == 0: soun = sou.o().oun("s") + sou.o().oun( "::" ) sus = inosiSus.PSS ss = f"s ollion sussful: {soun} ss foun" ls: sus = inosiSus.WNIN ss = "s ollion fil o no ss foun" uion = (i.now() - si).olsons() * 1000 sulobj = inosisul( hn="spfon", oy=inosioy.PFON, sus=sus, ss=ss, ils={ "sollionsuss": sul.uno == 0, "sisoun": ( sou.o().oun("s") if sul.uno == 0 ls 0 ), }, uions=uion, ) if sus == inosiSus.WNIN: sulobj.onions = [ "nsu pys is poply onfiu", " ophnsiv s suis", "onsi s plllizion fo b pfon", ] slf.uninosi.suls.ppn(sulobj) xp xpion s : lo.o(f"s pfon h fil: {}") syn f hsouus(slf): """h sys sou us""" si = i.now() y: ipo psuil pupn = psuil.pupn(invl=1) oy = psuil.viuloy() # fin pbl liis xpupn = 80.0 xoypn = 85.0 issus = [] if pupn > xpupn: issus.ppn(f"Hih PU us: {pupn:.1f}%") if oy.pn > xoypn: issus.ppn(f"Hih oy us: {oy.pn:.1f}%") if no issus: sus = inosiSus.PSS ss = "Sys sou us is wihin pbl liis" ls: sus = inosiSus.WNIN ss = f"sou us onns: {ln(issus)}" uion = (i.now() - si).olsons() * 1000 sul = inosisul( hn="souus", oy=inosioy.PFON, sus=sus, ss=ss, ils={ "pupn": pupn, "oypn": oy.pn, "xpulii": xpupn, "xoylii": xoypn, "issus": issus, }, uions=uion, ) if issus: sul.onions = [ "onio sys sous uin p us", "onsi sou opiizion o slin", "h fo oy ls in ppliion o", ] slf.uninosi.suls.ppn(sul) xp Ipoo: # psuil no vilbl sul = inosisul( hn="souus", oy=inosioy.PFON, sus=inosiSus.SIP, ss="sou onioin unvilbl (psuil no insll)", uions=(i.now() - si).olsons() * 1000, ) sul.onions = ["Insll psuil fo sou onioin"] slf.uninosi.suls.ppn(sul) xp xpion s : lo.o(f"sou us h fil: {}") syn f hoyus(slf): """h ppliion oy us pns""" si = i.now() y: ipo psuil poss = psuil.Poss() oyinfo = poss.oyinfo() # onv o B oyb = oyinfo.ss / (1024 * 1024) xoyb = 500 # 500B lii fo inosis if oyb <= xoyb: sus = inosiSus.PSS ss = f"oy us pbl: {oyb:.1f}B" ls: sus = inosiSus.WNIN ss = ( f"Hih oy us: {oyb:.1f}B (lii: {xoyb}B)" ) uion = (i.now() - si).olsons() * 1000 sul = inosisul( hn="oyus", oy=inosioy.PFON, sus=sus, ss=ss, ils={ "oyb": oun(oyb, 1), "xoylii": xoyb, }, uions=uion, ) if sus == inosiSus.WNIN: sul.onions = [ "Opiiz oy us in ppliion o", "onsi oy pofilin ools", "Ipln oy-ffiin  suus", ] slf.uninosi.suls.ppn(sul) xp Ipoo: sul = inosisul( hn="oyus", oy=inosioy.PFON, sus=inosiSus.SIP, ss="oy onioin unvilbl (psuil no insll)", uions=(i.now() - si).olsons() * 1000, ) sul.onions = ["Insll psuil fo oy onioin"] slf.uninosi.suls.ppn(sul) xp xpion s : lo.o(f"oy us h fil: {}") syn f hzuinion(slf): """h zu svis inion""" si = i.now() y: # h zu LI loin sus sul = wi synio.subpossx( "z", "oun", "show", sou=synio.subposs.PIP, s=synio.subposs.PIP, ) sou, s = wi sul.ouni() if sul.uno == 0: ouninfo = json.los(sou.o()) subsipioni = ouninfo.("i", "unnown") sus = inosiSus.PSS ss = ( f"zu LI uhni (subsipion: {subsipioni[:8]}...)" ) ls: sus = inosiSus.FIL ss = "zu LI no uhni" uion = (i.now() - si).olsons() * 1000 sulobj = inosisul( hn="zuinion", oy=inosioy.INION, sus=sus, ss=ss, ils={ "uhni": sul.uno == 0, "subsipioni": ( ouninfo.("i") if sul.uno == 0 ls Non ), }, uions=uion, ) if sus == inosiSus.FIL: sulobj.onions = [ "un 'z loin' o uhni wih zu", "onfiu zu subsipion n nn", "S up svi pinipl fo I/ piplins", ] slf.uninosi.suls.ppn(sulobj) xp xpion s : lo.o(f"zu inion h fil: {}") syn f hbsinion(slf): """h bs inion (plhol)""" si = i.now() # Plhol fo bs inion hs sul = inosisul( hn="bsinion", oy=inosioy.INION, sus=inosiSus.SIP, ss="bs inion h no ipln", uions=(i.now() - si).olsons() * 1000, ) sul.onions = ["Ipln bs onniviy hs"] slf.uninosi.suls.ppn(sul) syn f hpiinion(slf): """h PI inion sus""" si = i.now() y: # h if PI-l fils xis pifils = [ slf.wospph / "lifplfopi.py", slf.wospph / "zuliffunions.py", ] xisinpifils = [f fo f in pifils if f.xiss()] if xisinpifils: sus = inosiSus.PSS ss = f"PI inion fils foun: {ln(xisinpifils)}" ls: sus = inosiSus.WNIN ss = "No PI inion fils foun" uion = (i.now() - si).olsons() * 1000 sul = inosisul( hn="piinion", oy=inosioy.INION, sus=sus, ss=ss, ils={ "pifils": [s(f) fo f in pifils], "xisinfils": [s(f) fo f in xisinpifils], }, uions=uion, ) if sus == inosiSus.WNIN: sul.onions = [ "Ipln PI npoins fo plfo inion", " PI ounion n sin", ] slf.uninosi.suls.ppn(sul) xp xpion s : lo.o(f"PI inion h fil: {}") syn f hxnlsvis(slf): """h xnl svi inions""" si = i.now() y: # h fo xnl svi onfiuions xnlonfis = [ slf.wospph / "zuonfi.py", slf.wospph / "zufunionsonfi.py", ] xisinonfis = [f fo f in xnlonfis if f.xiss()] if xisinonfis: sus = inosiSus.PSS ss = ( f"xnl svi onfiuions foun: {ln(xisinonfis)}" ) ls: sus = inosiSus.WNIN ss = "No xnl svi onfiuions foun" uion = (i.now() - si).olsons() * 1000 sul = inosisul( hn="xnlsvis", oy=inosioy.INION, sus=sus, ss=ss, ils={ "onfifils": [s(f) fo f in xnlonfis], "xisinonfis": [s(f) fo f in xisinonfis], }, uions=uion, ) if sus == inosiSus.WNIN: sul.onions = [ "onfiu xnl svi inions", " svi hlh hs n onioin", ] slf.uninosi.suls.ppn(sul) xp xpion s : lo.o(f"xnl svis h fil: {}") syn f hploynonfi(slf): """h ployn onfiuion""" si = i.now() y: ploynfils = [ slf.wospph / "zu.yl", slf.wospph / "ofil", slf.wospph / "zuploynn.py", ] xisinployns = [f fo f in ploynfils if f.xiss()] if xisinployns: sus = inosiSus.PSS ss = ( f"ployn onfiuions foun: {ln(xisinployns)}" ) ls: sus = inosiSus.WNIN ss = "No ployn onfiuions foun" uion = (i.now() - si).olsons() * 1000 sul = inosisul( hn="ploynonfi", oy=inosioy.PLOYN, sus=sus, ss=ss, ils={ "ploynfils": [s(f) fo f in ploynfils], "xisinfils": [s(f) fo f in xisinployns], }, uions=uion, ) if sus == inosiSus.WNIN: sul.onions = [ " zu.yl fo zu ployn", " ofil fo oninizion", "Ipln ployn uoion sips", ] slf.uninosi.suls.ppn(sul) xp xpion s : lo.o(f"ployn onfi h fil: {}") syn f hzusous(slf): """h zu sou vilbiliy""" si = i.now() y: # h zu sou oups sul = wi synio.subpossx( "z", "oup", "lis", "--oupu", "json", sou=synio.subposs.PIP, s=synio.subposs.PIP, ) sou, s = wi sul.ouni() if sul.uno == 0: sououps = json.los(sou.o()) sus = inosiSus.PSS ss = ( f"zu sou oups ssibl: {ln(sououps)} foun" ) ls: sus = inosiSus.FIL ss = "nno ss zu sou oups" uion = (i.now() - si).olsons() * 1000 sulobj = inosisul( hn="zusous", oy=inosioy.PLOYN, sus=sus, ss=ss, ils={ "sououpsoun": ( ln(sououps) if sul.uno == 0 ls 0 ), "sssuss": sul.uno == 0, }, uions=uion, ) if sus == inosiSus.FIL: sulobj.onions = [ "nsu zu LI is uhni", "h zu subsipion pissions", "Vify nwo onniviy o zu", ] slf.uninosi.suls.ppn(sulobj) xp xpion s : lo.o(f"zu sous h fil: {}") syn f hploynvliion(slf): """h ployn vliion sup""" si = i.now() y: vliionfils = [ slf.wospph / "pouionployns.py", slf.wospph / "zusfwo.py", ] xisinvliions = [f fo f in vliionfils if f.xiss()] if xisinvliions: sus = inosiSus.PSS ss = ( f"ployn vliion fils foun: {ln(xisinvliions)}" ) ls: sus = inosiSus.WNIN ss = "No ployn vliion fils foun" uion = (i.now() - si).olsons() * 1000 sul = inosisul( hn="ploynvliion", oy=inosioy.PLOYN, sus=sus, ss=ss, ils={ "vliionfils": [s(f) fo f in vliionfils], "xisinfils": [s(f) fo f in xisinvliions], }, uions=uion, ) if sus == inosiSus.WNIN: sul.onions = [ " ployn vliion ss", "Ipln p-ployn hs", " pos-ployn vifiion", ] slf.uninosi.suls.ppn(sul) xp xpion s : lo.o(f"ployn vliion h fil: {}") syn f hollbpbiliy(slf): """h ollb pbiliy""" si = i.now() y: # h fo ollb sips o onfiuions ollbfils = [ slf.wospph / "ollb.py", slf.wospph / "zuploynn.py", # y onin ollb loi ] xisinollb = [f fo f in ollbfils if f.xiss()] if xisinollb: sus = inosiSus.PSS ss = f"ollb pbiliis foun: {ln(xisinollb)}" ls: sus = inosiSus.WNIN ss = "No xplii ollb pbiliis foun" uion = (i.now() - si).olsons() * 1000 sul = inosisul( hn="ollbpbiliy", oy=inosioy.PLOYN, sus=sus, ss=ss, ils={ "ollbfils": [s(f) fo f in ollbfils], "xisinfils": [s(f) fo f in xisinollb], }, uions=uion, ) if sus == inosiSus.WNIN: sul.onions = [ "Ipln ollb sips n pous", " ployn vsionin fo ollbs", "s ollb pous ully", ] slf.uninosi.suls.ppn(sul) xp xpion s : lo.o(f"ollb pbiliy h fil: {}") f lulovllsus(slf): """lul ovll inosi sus""" if no slf.uninosi.suls: slf.uninosi.ovllsus = inosiSus.UNNOWN un # oun suls by sus susouns = {} fo sul in slf.uninosi.suls: susouns[sul.sus] = susouns.(sul.sus, 0) + 1 # in ovll sus if susouns.(inosiSus.FIL, 0) > 0: slf.uninosi.ovllsus = inosiSus.FIL lif susouns.(inosiSus.WNIN, 0) > 0: slf.uninosi.ovllsus = inosiSus.WNIN lif susouns.(inosiSus.PSS, 0) > 0: slf.uninosi.ovllsus = inosiSus.PSS ls: slf.uninosi.ovllsus = inosiSus.UNNOWN f inosipo( slf, inosi: Piplininosi = Non ) -> i[s, ny]: """n ophnsiv inosi po""" if inosi is Non: inosi = ( slf.uninosi o slf.inosihisoy[-1] if slf.inosihisoy ls Non ) if no inosi: un {"o": "No inosi  vilbl"} # oup suls by oy n sus oysuy = {} sussuy = {} fo sul in inosi.suls: # oy suy if sul.oy.vlu no in oysuy: oysuy[sul.oy.vlu] = { "ol": 0, "pss": 0, "fil": 0, "wnin": 0, "sip": 0, } oysuy[sul.oy.vlu]["ol"] += 1 oysuy[sul.oy.vlu][sul.sus.vlu] += 1 # Sus suy sussuy[sul.sus.vlu] = ( sussuy.(sul.sus.vlu, 0) + 1 ) po = { "piplinn": inosi.piplinn, "s": inosi.s.vlu, "ovllsus": inosi.ovllsus.vlu, "si": ( inosi.si.isofo() if inosi.si ls Non ), "ni": ( inosi.ni.isofo() if inosi.ni ls Non ), "oluions": inosi.oluions, "olhs": ln(inosi.suls), "sussuy": sussuy, "oysuy": oysuy, "suls": [ { "hn": .hn, "oy": .oy.vlu, "sus": .sus.vlu, "ss": .ss, "uions": .uions, "onions": .onions, } fo  in inosi.suls ], "iilissus": [ { "hn": .hn, "ss": .ss, "onions": .onions, } fo  in inosi.suls if .sus in [inosiSus.FIL, inosiSus.WNIN] ], } un po f xpoinosipo( slf, filph: s, inosi: Piplininosi = Non ) -> bool: """xpo inosi po o fil""" y: po = slf.inosipo(inosi) po["xpoisp"] = i.now().isofo() wih opn(filph, "w") s f: json.up(po, f, inn=2, ful=s) lo.info(f"inosi po xpo o {filph}") un u xp xpion s : lo.o(f"Fil o xpo inosi po: {}") un Fls # Foy funion fo sy insniion f iinosiool( wospph: Opionl[s] = Non, ) -> Iinosiool: """ Foy funion o  I/ inosi ool s: wospph: Ph o wosp ioy uns: onfiu Iinosiool insn """ un Iinosiool(wospph=wospph) # on-lin inf f in(): """in LI funion fo I/ inosis""" ipo ps ps = ps.unPs( sipion="L.I.F.. Plfo I/ inosi ool" ) ps.un( "--wosp", "-w", ful=Non, hlp="Wosp ioy ph" ) ps.un( "--piplin", "-p", ful="lif-plfo-piplin", hlp="Piplin n fo inosis", ) ps.un( "--s", "-s", hois=["buil", "s", "ploy", "vli", "onio"], ful="buil", hlp="Piplin s o inos", ) ps.un( "--po", "-", ion="sou", hlp="n n isply inosi po", ) ps.un( "--xpo", "-", hlp="xpo inosi po o spifi fil" ) ps.un( "--oy", "-", hois=[ "nvionn", "pnnis", "onfiuion", "suiy", "pfon", "inion", "ployn", ], hlp="un inosis fo spifi oy only", ) s = ps.pss() #  inosi ool ool = iinosiool(wospph=s.wosp) # onv s sin o nu sp = { "buil": PiplinS.BUIL, "s": PiplinS.S, "ploy": PiplinS.PLOY, "vli": PiplinS.VLI, "onio": PiplinS.ONIO, } s = sp[s.s] pin("L.I.F.. Plfo - I/ inosi ool") pin("=" * 50) pin(f"Wosp: {s.wosp o os.w()}") pin(f"Piplin: {s.piplin}") pin(f"S: {s.s}") pin("\nunnin inosis... (his y   on)") y: # un inosis inosi = synio.un( ool.unfullinosi(piplinn=s.piplin, s=s) ) if s.po: po = ool.inosipo(inosi) pin(f"\ninosi po fo {s.piplin}") pin(f"Ovll Sus: {po['ovllsus'].upp()}") pin(f"ol hs: {po['olhs']}") pin(f"uion: {po.('oluions', 0):.1f}s") pin("\nSus Suy:") fo sus, oun in po["sussuy"].is(): pin(f" {sus.upp()}: {oun}") if po["iilissus"]: pin(f"\niil Issus ({ln(po['iilissus'])}):") fo issu in po["iilissus"][:5]: # Show fis 5 pin(f" ️ {issu['hn']}: {issu['ss']}") if issu["onions"]: pin(f" → {issu['onions'][0]}") if ln(po["iilissus"]) > 5: pin(f" ... n {ln(po['iilissus']) - 5} o issus") if s.xpo: if ool.xpoinosipo(s.xpo, inosi): pin(f"\ninosi po xpo o {s.xpo}") ls: pin("\nFil o xpo inosi po") un 1 # un ppopi xi o if inosi.ovllsus == inosiSus.FIL: pin("\n inosis opl wih FILUS") un 1 lif inosi.ovllsus == inosiSus.WNIN: pin("\n ️ inosis opl wih WNINS") un 0 # Wnins on' fil h buil ls: pin("\n inosis opl sussfully") un 0 xp yboInup: pin("\ninosis inup by us") un 1 xp xpion s : pin(f"\ninosis fil: {}") un 1 if n == "in": ipo sys sys.xi(in())