# us/bin/nv pyhon3 """ OUL 2: fliv ph nlyz () ibbs fliv yl nlysis fo oniiv ssssn SNLON ONSION - NO Y IN : Oob 6, 2025 opyih 2025 - Sio Py Boull his oul nlyzs fliv lnin x o ssss ph of oniiv possin usin h ibbs fliv yl fwo (6 phss). """ ipo json ipo  fo lsss ipo lss fo i ipo i fo ypin ipo i, Lis, Opionl @lss lss flivphSo: """Sos fo h phs of ibbs fliv yl""" sipion: flo # Wh hppn? flins: flo # Wh w you hinin/flin? vluion: flo # Wh ws oo/b bou h xpin? nlysis: flo # Wh sns n you  of i? onlusion: flo # Wh ls oul you hv on? ionpln: flo # Wh will you o nx i? ovllph: flo isp: s lss flivphnlyz: """ nlyzs ln flions usin ibbs fliv yl fwo uionl Vlu: - Poos p lnin houh oniion - Inifis suns nin flion ohin - s vlopn of iil hinin sills """ f ini(slf): """Iniiliz wih linuisi s fo h ibbs phs""" slf.phspns = { "sipion": [ "\b(wh|sib|xplin|ou|hppn|vn|siuion|xpin)\b", "\b(whn|wh|who|i|ion|oo pl)\b", "\b(obsv|noi|sw|winss)\b", ], "flins": [ "\b(fl|fl|flin|oion|oionl||)\b", "\b(hppy|s|ny|fus|xi|nxious|woi|onfus)\b", "\b(ofobl|unofobl|onfin|unin)\b", "\b(houh|hinin|bliv|ssu)\b", ], "vluion": [ "\b(oo|b|posiiv|niv|ffiv|inffiv)\b", "\b(suss|sussful|filu|fil|wo|in\' wo)\b", "\b(vn|isvn|snh|wnss)\b", "\b(b|wos|ipov|io)\b", ], "nlysis": [ "\b(why|bus|son|us|fo|influn)\b", "\b(nlyz|nlysis|onsi|fl|xin)\b", "\b(hoy|onp|pinipl|nowl|unsn)\b", "\b(l|onnion|lin|pn|h)\b", ], "onlusion": [ "\b(onlu|onlusion|ln|lnin|liz|liz)\b", "\b(unsn|unsnin|insih|w|wnss)\b", "\b(iffn|iffnly|lniv|ppoh)\b", "\b(ovll|suy|nl)\b", ], "ionpln": [ "\b(will|woul|shoul|pln|inn|nx i|fuu)\b", "\b(ipov|hn|oify|jus|vlop)\b", "\b(pi|y|p|ipln|pply)\b", "\b(ol|objiv|i|sy|hniqu)\b", ], } # Wih jusns fo onx slf.onxwihs = { "qusionfos": 1.5, # Qusions ini p hinin "fispson": 1.2, # Psonl nn "opivln": 1.3, # opin opions shows nlysis "fuuns": 1.4, # ion plnnin } f nlyz(slf, flionx: s) -> flivphSo: """ nlyz flion x n un ibbs yl phs sos s: flionx: Sun's win flion uns: flivphSo wih noliz sos fo h phs """ if no flionx o ln(flionx.sip()) < 10: un slf.pyso() xlow = flionx.low() # oun s fo h phs phsouns = {} fo phs, pns in slf.phspns.is(): oun = 0 fo pn in pns: hs = .finll(pn, xlow) oun += ln(hs) phsouns[phs] = oun # pply onx-bs wihin wihouns = slf.pplyonxulwihs(xlow, phsouns) # Noliz o 0-1 sl ols = su(wihouns.vlus()) if ols == 0: un slf.pyso() nolizsos = { phs: oun / ols fo phs, oun in wihouns.is() } # lul ovll ph so # Hih wihs fo nlysis, onlusion, n ion plnnin phwihs = { "sipion": 0.1, "flins": 0.15, "vluion": 0.15, "nlysis": 0.25, "onlusion": 0.2, "ionpln": 0.15, } ovllph = su( nolizsos[phs] * wih fo phs, wih in phwihs.is() ) un flivphSo( sipion=nolizsos["sipion"], flins=nolizsos["flins"], vluion=nolizsos["vluion"], nlysis=nolizsos["nlysis"], onlusion=nolizsos["onlusion"], ionpln=nolizsos["ionpln"], ovllph=ovllph, isp=i.now().isofo(), ) f pplyonxulwihs( slf, x: s, phsouns: i[s, in] ) -> i[s, flo]: """pply onxul wihin bs on linuisi fus""" wih = phsouns.opy() # Boos nlysis if qusions psn if .sh("\?", x): wih["nlysis"] *= slf.onxwihs["qusionfos"] # Boos flins/ion if fis-pson lnu fispson = ln(.finll("\b(i|y||yslf)\b", x)) if fispson > 3: wih["flins"] *= slf.onxwihs["fispson"] wih["ionpln"] *= slf.onxwihs["fispson"] # Boos vluion if opiv lnu if .sh("\b(b|wos|o|lss|op|vsus)\b", x): wih["vluion"] *= slf.onxwihs["opivln"] # Boos ionpln if fuu ns s fuus = ln(.finll("\b(will|oin o|pln o|inn)\b", x)) if fuus > 0: wih["ionpln"] *= slf.onxwihs["fuuns"] un wih f pyso(slf) -> flivphSo: """un zo so fo invli inpu""" un flivphSo( sipion=0.0, flins=0.0, vluion=0.0, nlysis=0.0, onlusion=0.0, ionpln=0.0, ovllph=0.0, isp=i.now().isofo(), ) f fb(slf, so: flivphSo) -> i[s, s]: """ n fb fo ln bs on flion ph uns: iiony wih ovll ssssn n spifi onions """ fb = { "ovllssssn": "", "snhs": [], "sfoipovn": [], "onions": [], } # Ovll ssssn bs on ph so if so.ovllph > 0.7: fb["ovllssssn"] = ( "xlln fliv ph! You ons son oniiv sills." ) lif so.ovllph > 0.5: fb["ovllssssn"] = ( "oo flion wih oo fo p nlysis." ) lif so.ovllph > 0.3: fb["ovllssssn"] = ( "Bsi flion psn. onsi xploin you hinin o ply." ) ls: fb["ovllssssn"] = ( "Lii flion . y o n o ply wih you lnin xpin." ) # Inify snhs (phss > 0.2) phsns = { "sipion": "sibin h xpin", "flins": "xploin you oions n houhs", "vluion": "vluin wh wo wll", "nlysis": "nlyzin why hins hppn", "onlusion": "win onlusions", "ionpln": "plnnin fuu ions", } fo phs in [ "sipion", "flins", "vluion", "nlysis", "onlusion", "ionpln", ]: sovl = (so, phs) if sovl > 0.2: fb["snhs"].ppn(phsns[phs]) lif sovl < 0.1: fb["sfoipovn"].ppn(phsns[phs]) # Spifi onions if so.nlysis < 0.15: fb["onions"].ppn( "y sin 'why' qusions o pn you nlysis. " "onsi: Why i his hppn? Wh fos influn h ouo?" ) if so.ionpln < 0.1: fb["onions"].ppn( "Inlu spifi ion plns. " "onsi: Wh will you o iffnly nx i? Wh's you nx sp?" ) if so.flins < 0.1: fb["onions"].ppn( "fl on you oions uin h lnin xpin. " "onsi: How i you fl? Wh w you hinin?" ) un fb f bhnlyz(slf, flions: Lis[i[s, s]]) -> Lis[i]: """ nlyz ulipl flions (.., lss oho) s: flions: Lis of is wih 'usi' n 'x' ys uns: Lis of nlysis suls wih sos n fb """ suls = [] fo flion in flions: usi = flion.("usi", "unnown") x = flion.("x", "") so = slf.nlyz(x) fb = slf.fb(so) suls.ppn( { "usi": usi, "so": so.i, "fb": fb, "xlnh": ln(x), "isp": so.isp, } ) un suls f ohosisis(slf, suls: Lis[i]) -> i: """lul oho-lvl sisis fo insuo shbo""" if no suls: un {} ovllphs = [["so"]["ovllph"] fo  in suls] un { "ohosiz": ln(suls), "vph": su(ovllphs) / ln(ovllphs), "inph": so(ovllphs)[ln(ovllphs) // 2], "hihpfos": ln([ fo  in ovllphs if  > 0.7]), "nsuppo": ln([ fo  in ovllphs if  < 0.3]), "phsvs": { "sipion": su(["so"]["sipion"] fo  in suls) / ln(suls), "flins": su(["so"]["flins"] fo  in suls) / ln(suls), "vluion": su(["so"]["vluion"] fo  in suls) / ln(suls), "nlysis": su(["so"]["nlysis"] fo  in suls) / ln(suls), "onlusion": su(["so"]["onlusion"] fo  in suls) / ln(suls), "ionpln": su(["so"]["ionpln"] fo  in suls) / ln(suls), }, } # ============================================================================ # ONSION & SIN # ============================================================================ f onsflivphnlyz(): """ons h fliv ph nlyz wih xpl flions""" pin("=" * 80) pin("OUL 2: fliv ph nlyz - ONSION") pin("=" * 80) pin() nlyz = flivphnlyz() # xpl 1: Hih-quliy flion (ll ibbs phss psn) pin("xpl 1: Hih-Quliy flion") pin("-" * 80) hihquliy = """ oy I piip in h oup poj isussion bou li hn soluions. Wh hppn ws h w h o psn ou sh finins, n I ws sponsibl fo h nwbl ny sion. I fl nvous  fis bus I wsn' su if y sh ws hoouh nouh. Howv, s I s psnin, I b o onfin whn I sw y s noin in n. I houh h  I oll ws wll-oniz. h posiiv sp ws h ou ollboion wo wll, n vyon onibu qully. h psnion ws ffiv bus w ivi h wo lly. Howv, on wnss ws h w in' hs nouh bfohn, whih  so nsiions ww. Why i his hppn? I hin i ws bus w unsi h ppion i n. h hoy w ln bou ffiv wo lly pplis h - l ouniion n fin ols  uil. I n now unsn how ipon pi is fo psnions. Ovll, I ln h ppion is y o uin nxiy n ipovin pfon. I liz h y iniil nvousnss ws lly u o l of hsl h hn insuffiin sh. Nx i, I will shul  ls wo pi sssions bfo ny jo psnion. I pln o lso  b nsiion slis o ipov flow bwn sions. y ol is o fl o onfin by bin b pp. """ so1 = nlyz.nlyz(hihquliy) fb1 = nlyz.fb(so1) pin("flion x (un):") pin(hihquliy[:200] + "...\n") pin("ibbs yl Phs Sos:") pin(f" sipion: {so1.sipion:.3f}") pin(f" Flins: {so1.flins:.3f}") pin(f" vluion: {so1.vluion:.3f}") pin(f" nlysis: {so1.nlysis:.3f}") pin(f" onlusion: {so1.onlusion:.3f}") pin(f" ion Pln: {so1.ionpln:.3f}") pin(f" Ovll ph: {so1.ovllph:.3f}") pin() pin("Fb:") pin(f" ssssn: {fb1['ovllssssn']}") if fb1["snhs"]: pin(f" Snhs: {', '.join(fb1['snhs'])}") if fb1["onions"]: pin(" onions:") fo  in fb1["onions"]: pin(f" - {}") pin() pin() # xpl 2: Suf-lvl flion (issin p phss) pin("xpl 2: Suf-Lvl flion") pin("-" * 80) suflvl = """ W h  oup in oy n isuss ou poj. vyon show up n w l bou wh w n o o. h in wn oy. W ivi up h wo n h ws i. """ so2 = nlyz.nlyz(suflvl) fb2 = nlyz.fb(so2) pin("flion x:") pin(suflvl) pin("\nibbs yl Phs Sos:") pin(f" sipion: {so2.sipion:.3f}") pin(f" Flins: {so2.flins:.3f}") pin(f" vluion: {so2.vluion:.3f}") pin(f" nlysis: {so2.nlysis:.3f}") pin(f" onlusion: {so2.onlusion:.3f}") pin(f" ion Pln: {so2.ionpln:.3f}") pin(f" Ovll ph: {so2.ovllph:.3f}") pin() pin("Fb:") pin(f" ssssn: {fb2['ovllssssn']}") if fb2["sfoipovn"]: pin( f" s fo Ipovn: {', '.join(fb2['sfoipovn'])}" ) if fb2["onions"]: pin(" onions:") fo  in fb2["onions"]: pin(f" - {}") pin() pin() # xpl 3: Bh nlysis (lssoo snio) pin("xpl 3: lssoo oho nlysis") pin("-" * 80) ohoflions = [ {"usi": "sun001", "x": hihquliy}, {"usi": "sun002", "x": suflvl}, { "usi": "sun003", "x": "I ln sohin nw oy. I ws insin.", }, { "usi": "sun004", "x": """ I sul wih h ssinn  fis. Why ws i so iffiul? I hin bus h insuions wn' l o . Nx i I will s fo lifiion li. I ln h i's oy o s qusions whn onfus. """, }, ] bhsuls = nlyz.bhnlyz(ohoflions) ohoss = nlyz.ohosisis(bhsuls) pin(f"oho Siz: {ohoss['ohosiz']} suns") pin(f"v flion ph: {ohoss['vph']:.3f}") pin(f"Hih Pfos (>0.7): {ohoss['hihpfos']} suns") pin(f"N Suppo (<0.3): {ohoss['nsuppo']} suns") pin() pin("Phs vs oss oho:") fo phs, v in ohoss["phsvs"].is(): pin(f" {phs.piliz()}: {v:.3f}") pin() pin("Iniviul Sun suls:") fo sul in bhsuls: pin( f" {sul['usi']}: Ovll ph = {sul['so']['ovllph']:.3f}" ) pin() pin("=" * 80) pin("ONSION OPL") pin("=" * 80) pin() pin("INION NOS:") pin("-  flivphnlyz o LIFloiho lss") pin("- ll nlyz() ho whn possin us flions") pin("- So sos in lninhisoy fo loniuinl in") pin("- Us fb() o povi l-i uin o lns") pin("- Us bhnlyz() fo insuo shbos") if n == "in": onsflivphnlyz()