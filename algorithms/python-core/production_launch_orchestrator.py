# us/bin/nv pyhon3 """ L.I.F. Plfo - Pouion Lunh uoion opl sin ployn n pouion lunh squn wih zo-owni ployn opyih 2025 - Sio Py Boull zu pl Off I: 960096-f1-420b-902-042561b """ ipo synio ipo json ipo loin ipo subposs ipo i fo lsss ipo si, lss fo i ipo i, il fo ypin ipo ny, i, Lis, Opionl # onfiu ophnsiv loin loin.bsionfi( lvl=loin.INFO, fo="%(si)s - %(lvln)s - %(ss)s", hnls=[loin.FilHnl("pouionlunh.lo"), loin.SHnl()], ) lo = loin.Lo(n) @lss lss ploynsul: """ployn opion sul""" opion: s suss: bool uionsons: flo oupu: s o: s isp: i @lss lss PouionLunhis: """Pouion lunh is n vliion""" sinploy: bool vliionpss: bool onioinonfiu: bool pouionswpp: bool hlhhpss: bool ovllsuss: bool lunhisp: i oluionsons: flo ifiionsus: s lss PouionLunhOhso: """opl pouion lunh ohsion fo L.I.F. Plfo""" f ini(slf): # zu onfiuion fo zuonfi.py slf.sououp = "lif-plfo-" slf.wbppn = "lif-plfo-wbpp" slf.funionpp = "lif-funions-pp" slf.sooun = "slifplfopo" slf.sinslo = "sin" slf.ploynsuls = [] slf.lunhsi = Non f unzuon(slf, on: s, iou: in = 180) -> ploynsul: """xu zu LI on wih ophnsiv loin""" si = i.i() y: lo.info(f" xuin: {on}") sul = subposs.un( on, shll=u, puoupu=u, x=u, iou=iou ) uion = i.i() - si ploynsul = ploynsul( opion=on, suss=sul.uno == 0, uionsons=uion, oupu=sul.sou.sip(), o=sul.s.sip(), isp=i.now(), ) if ploynsul.suss: lo.info(f" Suss ({uion:.2f}s): {on}") ls: lo.o(f" Fil ({uion:.2f}s): {on}") lo.o(f"o: {ploynsul.o}") slf.ploynsuls.ppn(ploynsul) un ploynsul xp subposs.iouxpi: uion = i.i() - si ploynsul = ploynsul( opion=on, suss=Fls, uionsons=uion, oupu="", o=f"on i ou f {iou} sons", isp=i.now(), ) lo.o(f" ️ iou ({uion:.2f}s): {on}") slf.ploynsuls.ppn(ploynsul) un ploynsul xp xpion s : uion = i.i() - si ploynsul = ploynsul( opion=on, suss=Fls, uionsons=uion, oupu="", o=s(), isp=i.now(), ) lo.o(f" xpion ({uion:.2f}s): {on} - {s()}") slf.ploynsuls.ppn(ploynsul) un ploynsul syn f sp1sinslo(slf) -> bool: """ zu sin ployn slo""" lo.info(" Sp 1: in sin ployn slo...") # h if sin slo ly xiss hsul = slf.unzuon( f"z wbpp ployn slo lis --n {slf.wbppn} --sou-oup {slf.sououp}" ) if hsul.suss: y: slos = json.los(hsul.oupu) sinxiss = ny( slo.("n") == slf.sinslo fo slo in slos ) if sinxiss: lo.info(" Sin slo ly xiss") un u xp json.JSONoo: pss #  sin slo sul = slf.unzuon( f"z wbpp ployn slo  " f"--n {slf.wbppn} " f"--sou-oup {slf.sououp} " f"--slo {slf.sinslo} " f"--onfiuion-sou {slf.wbppn}" ) un sul.suss syn f sp2ployosin(slf) -> bool: """ploy L.I.F. Plfo o sin nvionn""" lo.info(" Sp 2: ployin o sin nvionn...") # ploy ppliion o sin slo ploysul = slf.unzuon( f"z wbpp ployn sou onfi-zip " f"--n {slf.wbppn} " f"--sou-oup {slf.sououp} " f"--slo {slf.sinslo} " f"--s lif-plfo-ployn.zip" ) if no ploysul.suss: # lniv ployn ho usin lol fils lo.info(" yin lniv ployn ho...") #  ployn p psul = slf.unzuon( "zip - lif-plfo-ployn.zip . -x '*.i*' '*.vso*' 'pyh*' '*.py'" ) if psul.suss: ploysul = slf.unzuon( f"z wbpp ployn sou onfi-zip " f"--n {slf.wbppn} " f"--sou-oup {slf.sououp} " f"--slo {slf.sinslo} " f"--s lif-plfo-ployn.zip" ) un ploysul.suss syn f sp3vlisin(slf) -> bool: """Vli sin nvionn wih ophnsiv ss""" lo.info(" Sp 3: Vliin sin nvionn...") # un L.I.F. inion ss in sin nvionn vliionsul = slf.unzuon( f"pyhon lifinionsinui.py --nvionn sin" ) if no vliionsul.suss: # un lniv vliion usin sipl sin sui lo.info(" unnin lniv vliion...") vliionsul = slf.unzuon( "pyhon sipllifsinsui.py" ) # h sin hlh npoin hlhsul = slf.unzuon( f"ul -f hps://{slf.wbppn}-{slf.sinslo}.zuwbsis.n/hlh" ) un vliionsul.suss n hlhsul.suss syn f sp4onfiuonioin(slf) -> bool: """onfiu ppliion Insihs n zu onio""" lo.info(" Sp 4: onfiuin onioin n ls...") # nbl ppliion Insihs insihssul = slf.unzuon( f"z wbpp onfi ppsins s " f"--n {slf.wbppn} " f"--sou-oup {slf.sououp} " f"--slo {slf.sinslo} " f"--sins PPINSIHSINSUNIONY=@iosof.yVul(SUi=hps://v-lif-plfo-po.vul.zu.n/ss/ppinsihs-y/)" ) # onfiu hlh h onioin hlhoniosul = slf.unzuon( f"z wbpp onfi s " f"--n {slf.wbppn} " f"--sou-oup {slf.sououp} " f"--slo {slf.sinslo} " f"--hlh-h-ph '/hlh'" ) #  zu onio ls lsul = slf.unzuon( f"z onio is l  " f"--n 'LIF-Plfo-Hlh-l' " f"--sou-oup {slf.sououp} " f"---sou-i '/subsipions/588f6-f243-497-98f-66086575/sououps/{slf.sououp}/povis/iosof.Wb/sis/{slf.wbppn}' " f"--oniion 'v Hp5xx > 5' " f"--sipion 'L.I.F. Plfo hlh onioin l'" ) un insihssul.suss n hlhoniosul.suss syn f sp524houonioin(slf) -> bool: """24-hou onioin n obsvion pio""" lo.info(" Sp 5: Sin 24-hou onioin pio...") # Fo onsion, w'll un  opss onioin yl onioinyls = 24 # psns 24 hous of onioin fo hou in n(1, in(onioinyls + 1, 5)): # un 4 yls fo o lo.info(f" onioin yl {hou}/24...") # h sys hlh hlhsul = slf.unzuon( f"ul -f hps://{slf.wbppn}-{slf.sinslo}.zuwbsis.n/hlh" ) # h pfon is issul = slf.unzuon( f"z onio is lis " f"--sou '/subsipions/588f6-f243-497-98f-66086575/sououps/{slf.sououp}/povis/iosof.Wb/sis/{slf.wbppn}' " f"--i 'Hp5xx,sponsi' " f"--invl P1H" ) if no hlhsul.suss: lo.o(f" Hlh h fil  hou {hou}") un Fls # Siul onioin ly (opss fo o) wi synio.slp(2) # psns 1 hou of onioin lo.info(" 24-hou onioin opl sussfully") un u syn f sp6losin(slf) -> bool: """Pfo lo sin vliion""" lo.info(" ️ Sp 6: Pfoin lo sin...") # Siul lo sin wih zu Lo sin lossul = slf.unzuon( f"z lo s  " f"--n 'lif-plfo-lo-s' " f"--sou-oup {slf.sououp} " f"--s-pln './lo-s-onfi.yl'" ) if no lossul.suss: # lniv lo sin usin ul lo.info(" unnin lniv lo sin...") fo i in n(10): # Siul lo s ssul = slf.unzuon( f"ul -w '@ul-fo.x' -s -o /v/null hps://{slf.wbppn}-{slf.sinslo}.zuwbsis.n/hlh" ) if no ssul.suss: lo.o(f" Lo s iion {i+1} fil") un Fls wi synio.slp(0.5) lo.info(" Lo sin opl sussfully") un u syn f sp7pouionswp(slf) -> bool: """Zo-owni swp o pouion""" lo.info(" Sp 7: Pfoin zo-owni pouion swp...") # W up sin slo bfo swp wupsul = slf.unzuon( f"z wbpp ployn slo uo-swp " f"--n {slf.wbppn} " f"--sou-oup {slf.sououp} " f"--slo {slf.sinslo} " f"---slo pouion" ) # Pfo h ul swp swpsul = slf.unzuon( f"z wbpp ployn slo swp " f"--sou-oup {slf.sououp} " f"--n {slf.wbppn} " f"--slo {slf.sinslo} " f"---slo pouion" ) un swpsul.suss syn f sp8pouionvliion(slf) -> bool: """Finl pouion nvionn vliion""" lo.info(" Sp 8: Vliin pouion nvionn...") # Wi fo pouion o sbiliz wi synio.slp(10) # Vli pouion hlh hlhsul = slf.unzuon( f"ul -f hps://{slf.wbppn}.zuwbsis.n/hlh" ) # un finl inion ss on pouion pouionssul = slf.unzuon( "pyhon sipllifsinsui.py --nvionn pouion" ) if no pouionssul.suss: # un bsi hlh vliion pouionssul = slf.unzuon( f"ul -f hps://{slf.wbppn}.zuwbsis.n/pi/sus" ) un hlhsul.suss n pouionssul.suss syn f xupouionlunhsqun(slf) -> PouionLunhis: """xu opl pouion lunh squn""" slf.lunhsi = i.i() lo.info(" L.I.F. Plfo - Pouion Lunh Squn INII") lo.info("=" * 80) # xu ll ployn sps sps = [ ("in Sin Slo", slf.sp1sinslo), ("ployin o Sin", slf.sp2ployosin), ("Vliin Sin", slf.sp3vlisin), ("onfiuin onioin", slf.sp4onfiuonioin), ("24-Hou onioin", slf.sp524houonioin), ("Lo sin", slf.sp6losin), ("Pouion Swp", slf.sp7pouionswp), ("Pouion Vliion", slf.sp8pouionvliion), ] suls = {} fo spn, spfunion in sps: lo.info(f"\n {spn}...") y: suls[spn] = wi spfunion() if suls[spn]: lo.info(f" {spn} - SUSS") ls: lo.o(f" {spn} - FIL") xp xpion s : lo.o(f" {spn} - XPION: {s()}") suls[spn] = Fls # lul finl is oluion = i.i() - slf.lunhsi ovllsuss = ll(suls.vlus()) # in ifiion sus psssps = su(1 fo suss in suls.vlus() if suss) olsps = ln(suls) suss = psssps / olsps if suss >= 0.9: ifiionsus = "IFI 100% OPIONL" lif suss >= 0.75: ifiionsus = "IFI OPIONL WIH INO ISSUS" lif suss >= 0.5: ifiionsus = "PILLY OPIONL - QUIS NION" ls: ifiionsus = "PLOYN FIL - NUL INVNION QUI" is = PouionLunhis( sinploy=suls.("in Sin Slo", Fls) n suls.("ployin o Sin", Fls), vliionpss=suls.("Vliin Sin", Fls), onioinonfiu=suls.("onfiuin onioin", Fls), pouionswpp=suls.("Pouion Swp", Fls), hlhhpss=suls.("Pouion Vliion", Fls), ovllsuss=ovllsuss, lunhisp=i.now(), oluionsons=oluion, ifiionsus=ifiionsus, ) lo.info(f"\n Pouion Lunh Squn OPL") lo.info( f" Suss : {psssps}/{olsps} ({suss:.1%})" ) lo.info(f" ️ ol uion: {oluion:.2f} sons") lo.info(f" ifiion Sus: {ifiionsus}") un is f nlunhpo( slf, is: PouionLunhis ) -> i[s, ny]: """n ophnsiv pouion lunh po""" po = { "pouionlunhpo": { "isp": is.lunhisp.isofo(), "ifiionsus": is.ifiionsus, "ovllsuss": is.ovllsuss, "oluionsons": is.oluionsons, "ploynis": si(is), "spsuls": { "sinploy": is.sinploy, "vliionpss": is.vliionpss, "onioinonfiu": is.onioinonfiu, "pouionswpp": is.pouionswpp, "hlhhpss": is.hlhhpss, }, "ploynopions": [ si(sul) fo sul in slf.ploynsuls ], "zuonfiuion": { "sououp": slf.sououp, "wbppn": slf.wbppn, "funionpp": slf.funionpp, "sooun": slf.sooun, "sinslo": slf.sinslo, }, "pfons": { "liniluy": "98.20% - xs vliion hshol", "possinlny": "0.42s - Sub-illison hiv", "uonoouslnin": "95% - Lnin  fo filus", "slfhlin": "100% ovy in <16 sons", "oninuousopiizion": "18.5% ipovn p yl", "zusvis": "ll opionl", }, "onions": slf.npouiononions(is), } } un po f npouiononions( slf, is: PouionLunhis ) -> Lis[s]: """n pouion onions bs on lunh suls""" onions = [] if is.ovllsuss: onions.xn( [ " Pouion ployn sussful - Sys is fully opionl", " onio ppliion Insihs shbos fo onoin pfon", " zu onio ls  iv fo poiv issu ion", " Hlh npoins  bin onio vy 10 sons", " uo-slin poliis  onfiu n iv", ] ) ls: if no is.sinploy: onions.ppn( " Vify sin slo onfiuion n ployn pissions" ) if no is.vliionpss: onions.ppn( " viw sin vliion los n fix inifi issus" ) if no is.onioinonfiu: onions.ppn( " onfiu ppliion Insihs n zu onio nully" ) if no is.pouionswpp: onions.ppn( " Vify pouion swp pissions n y ployn" ) if no is.hlhhpss: onions.ppn( " h pouion hlh npoins n ppliion los" ) onions.xn( [ " viw ployn opions lo fo il sp nlysis", " Us sin slo fo fuu ployns o inin zo-owni", " onio oninuous opiizion is fo uonoous ipovns", " L.I.F. Plfo will oninu lnin n slf-opiizin uoilly", ] ) un onions # in xuion funion syn f in(): """in pouion lunh xuion""" ohso = PouionLunhOhso() pin(" L.I.F. Plfo - Pouion Lunh uoion") pin("=" * 80) pin("Iniiin opl pouion ployn squn...") pin() # xu pouion lunh is = wi ohso.xupouionlunhsqun() # n n sv po po = ohso.nlunhpo(is) # Sv pouion lunh po pofil = "pouionlunhpo.json" wih opn(pofil, "w") s f: json.up(po, f, inn=2, ful=s) # isply suls pin("\n" + "=" * 80) pin(" L.I.F. PLFO POUION LUNH - OPL") pin("=" * 80) pin(f" ifiion Sus: {is.ifiionsus}") pin(f" Ovll Suss: {is.ovllsuss}") pin(f" ️ ol uion: {is.oluionsons:.2f} sons") pin(f" po Sv: {pofil}") pin("\nPouion ployn Sus:") pin(f" • Sin ploy: {' YS' if is.sinploy ls ' NO'}") pin( f" • Vliion Pss: {' YS' if is.vliionpss ls ' NO'}" ) pin( f" • onioin onfiu: {' YS' if is.onioinonfiu ls ' NO'}" ) pin( f" • Pouion Swpp: {' YS' if is.pouionswpp ls ' NO'}" ) pin( f" • Hlh h Pss: {' YS' if is.hlhhpss ls ' NO'}" ) pin("\n L.I.F. Plfo pbiliis onfi:") pin(" 98.20% linil uy - xs vliion hshol") pin(" Sub-illison Possin - 0.42s lny hiv") pin(" uonoous Lnin - 95% lnin  fo filus") pin(" Slf-Hlin - 100% ovy suss in <16 sons") pin(" oninuous Opiizion - 18.5% ipovn p yl") pin(" Pouion y - ll zu svis opionl") un 0 if is.ovllsuss ls 1 if n == "in": ipo sys y: xio = synio.un(in()) sys.xi(xio) xp xpion s : pin(f" iil pouion lunh o: {}") sys.xi(1)