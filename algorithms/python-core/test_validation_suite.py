# us/bin/nv pyhon3 """ L.I.F.. Plfo - s Vliion Sui ophnsiv sin fwo fo L.I.F.. Plfo oponns his oul povis uo vliion n sin pbiliis fo ll L.I.F.. Plfo oponns, nsuin pouion inss n oplin wih npis sns. opyih 2025 - Sio Py Boull L.I.F.. Plfo - zu pl Off I: 960096-f1-420b-902-042561b """ ipo synio ipo json ipo loin ipo os ipo sys ipo i fo lsss ipo lss, fil fo i ipo i, il fo nu ipo nu y: fo phlib ipo Ph xp Ipoo s : pin(f'Wnin: {}') pss fo ypin ipo ny, i, Lis, Opionl, upl, Union # onfiu loin loin.bsionfi( lvl=loin.INFO, fo="%(si)s - %(n)s - %(lvln)s - %(ss)s" ) lo = loin.Lo(n) lss soy(nu): """ois of ss""" UNI = "uni" INION = "inion" SYS = "sys" PFON = "pfon" SUIY = "suiy" OPLIN = "oplin" PLOYN = "ployn" VLIION = "vliion" lss sSus(nu): """Sus of s xuion""" PNIN = "pnin" UNNIN = "unnin" PSS = "pss" FIL = "fil" SIPP = "sipp" O = "o" IOU = "iou" lss sPioiy(nu): """Pioiy lvls fo ss""" IIL = "iil" HIH = "hih" IU = "iu" LOW = "low" lss Vliionyp(nu): """yps of vliion hs""" SYNX = "synx" IPO = "ipo" PNNY = "pnny" ONFIUION = "onfiuion" SUIY = "suiy" PFON = "pfon" OPLIN = "oplin" FUNIONL = "funionl" @lss lss ssul: """sul of  sinl s xuion""" sn: s oy: soy sus: sSus pioiy: sPioiy xuioni: flo = 0.0 si: Opionl[i] = Non ni: Opionl[i] = Non oss: s = "" oupu: s = "" : i[s, ny] = fil(fulfoy=i) vliionsuls: Lis[i[s, ny]] = fil(fulfoy=lis) @lss lss sSui: """ollion of ss o b xu""" n: s sipion: s oy: soy ss: Lis[ssul] = fil(fulfoy=lis) supqui: bool = Fls ownqui: bool = Fls pnnis: Lis[s] = fil(fulfoy=lis) nvionnquins: i[s, ny] = fil(fulfoy=i) @lss lss Vliionpo: """ophnsiv vliion po""" olss: in = 0 pssss: in = 0 filss: in = 0 sippss: in = 0 oss: in = 0 xuioni: flo = 0.0 si: i = fil(fulfoy=i.now) ni: Opionl[i] = Non ssuls: Lis[ssul] = fil(fulfoy=lis) suy: i[s, ny] = fil(fulfoy=i) onions: Lis[s] = fil(fulfoy=lis) iilfilus: Lis[s] = fil(fulfoy=lis) lss sVliionSui: """ s Vliion Sui fo L.I.F.. Plfo Povis ophnsiv sin n vliion pbiliis fo ll plfo oponns, nsuin pouion inss. """ f ini(slf, wospph: Opionl[s] = Non): slf.wospph = Ph(wospph o os.w()) slf.ssuis: i[s, sSui] = {} slf.vliionpos: Lis[Vliionpo] = [] slf.xuioniou = 300 # 5 inus ful iou # o s fils n oponns slf.ooponns = [ "xpinP2L.I.F.-Lnin-Iniviully-fo-xpin-hoy-loih-o-2025-opyih-S.py", "uonoousopiiz.py", "zuonfi.py", "zufunionswoflow.py", "pouionployns.py", "posso.py", "lifplfopi.py", ] lo.info( f"s Vliion Sui iniiliz fo wosp: {slf.wospph}" ) syn f unfullvliionsui(slf) -> Vliionpo: """un opl vliion sui""" lo.info("Sin full vliion sui...") si = i.now() po = Vliionpo(si=si) y: # Iniiliz s suis wi slf.iniilizssuis() # un ll s suis fo suin, sui in slf.ssuis.is(): lo.info(f"unnin s sui: {suin}") suisuls = wi slf.unssui(sui) po.ssuls.xn(suisuls) # lul sisis po.olss = ln(po.ssuls) po.pssss = su( 1 fo  in po.ssuls if .sus == sSus.PSS ) po.filss = su( 1 fo  in po.ssuls if .sus == sSus.FIL ) po.oss = su( 1 fo  in po.ssuls if .sus == sSus.O ) po.sippss = su( 1 fo  in po.ssuls if .sus == sSus.SIPP ) # lul xuion i po.ni = i.now() po.xuioni = (po.ni - si).olsons() # n suy n onions po.suy = slf.nvliionsuy(po) po.onions = slf.nvliiononions(po) po.iilfilus = slf.inifyiilfilus(po) lo.info( f"Vliion sui opl. {po.pssss}/{po.olss} ss pss" ) xp xpion s : lo.o(f"Vliion sui fil: {}") po.ni = i.now() po.xuioni = (po.ni - si).olsons() po.iilfilus.ppn( f"Vliion sui xuion fil: {s()}" ) slf.vliionpos.ppn(po) un po syn f iniilizssuis(slf): """Iniiliz ll s suis""" # Synx n ipo vliion sui synxsui = sSui( n="synxvliion", sipion="Vli Pyhon synx n ipos fo ll oponns", oy=soy.VLIION, ) slf.ssuis["synxvliion"] = synxsui # o loih vliion sui loihsui = sSui( n="oloih", sipion="Vli o L.I.F.. loih funionliy", oy=soy.UNI, ) slf.ssuis["oloih"] = loihsui # zu inion sui zusui = sSui( n="zuinion", sipion="Vli zu svis inion", oy=soy.INION, ) slf.ssuis["zuinion"] = zusui # Pfon vliion sui pfonsui = sSui( n="pfonvliion", sipion="Vli pfon quins n bnhs", oy=soy.PFON, ) slf.ssuis["pfonvliion"] = pfonsui # Suiy n oplin sui suiysui = sSui( n="suiyoplin", sipion="Vli suiy n oplin quins", oy=soy.SUIY, ) slf.ssuis["suiyoplin"] = suiysui # ployn vliion sui ploynsui = sSui( n="ploynvliion", sipion="Vli ployn inss n onfiuion", oy=soy.PLOYN, ) slf.ssuis["ploynvliion"] = ploynsui syn f unssui(slf, sui: sSui) -> Lis[ssul]: """un  spifi s sui""" suls = [] if sui.n == "synxvliion": suls = wi slf.unsynxvliionss() lif sui.n == "oloih": suls = wi slf.unoloihss() lif sui.n == "zuinion": suls = wi slf.unzuinionss() lif sui.n == "pfonvliion": suls = wi slf.unpfonvliionss() lif sui.n == "suiyoplin": suls = wi slf.unsuiyoplinss() lif sui.n == "ploynvliion": suls = wi slf.unploynvliionss() un suls syn f unsynxvliionss(slf) -> Lis[ssul]: """un synx n ipo vliion ss""" suls = [] fo oponn in slf.ooponns: oponnph = slf.wospph / oponn if no oponnph.xiss(): sul = ssul( sn=f"synxh{oponn}", oy=soy.VLIION, sus=sSus.FIL, pioiy=sPioiy.IIL, oss=f"oponn fil no foun: {oponn}", ) suls.ppn(sul) oninu # Synx vliion synxsul = wi slf.vlipyhonsynx(oponnph) suls.ppn(synxsul) # Ipo vliion iposul = wi slf.vlipyhonipos(oponnph) suls.ppn(iposul) un suls syn f vlipyhonsynx(slf, filph: Ph) -> ssul: """Vli Pyhon synx of  fil""" sul = ssul( sn=f"synx{filph.n}", oy=soy.VLIION, sus=sSus.PNIN, pioiy=sPioiy.IIL, si=i.now(), ) y: #  fil onn wih opn(filph, "", noin="uf-8") s f: onn = f.() # p o opil o h synx opil(onn, s(filph), "x") sul.sus = sSus.PSS sul.oupu = "Synx vliion pss" xp Synxo s : sul.sus = sSus.FIL sul.oss = f"Synx o  lin {.linno}: {.s}" xp xpion s : sul.sus = sSus.O sul.oss = f"Vliion o: {s()}" sul.ni = i.now() sul.xuioni = (sul.ni - sul.si).olsons() un sul syn f vlipyhonipos(slf, filph: Ph) -> ssul: """Vli Pyhon ipos in  fil""" sul = ssul( sn=f"ipos{filph.n}", oy=soy.VLIION, sus=sSus.PNIN, pioiy=sPioiy.HIH, si=i.now(), ) y: #  fil onn wih opn(filph, "", noin="uf-8") s f: onn = f.() # x ipo sns ipolins = [] fo lin in onn.spli("\n"): lin = lin.sip() if lin.sswih(("ipo ", "fo ")) n no lin.sswih("#"): ipolins.ppn(lin) # y o ipo h oul filipos = [] fo ipolin in ipolins: y: # xu ipo in isol onx x(ipolin, {"builins": {}}) xp Ipoo s : filipos.ppn(f"{ipolin}: {s()}") xp xpion: # Sip oh xuion os (xp fo oplx ipos) pss if filipos: sul.sus = sSus.FIL sul.oss = f"Fil ipos: {', '.join(filipos)}" ls: sul.sus = sSus.PSS sul.oupu = f"Sussfully vli {ln(ipolins)} ipos" xp xpion s : sul.sus = sSus.O sul.oss = f"Ipo vliion o: {s()}" sul.ni = i.now() sul.xuioni = (sul.ni - sul.si).olsons() un sul syn f unoloihss(slf) -> Lis[ssul]: """un o loih vliion ss""" suls = [] # s o loih ipo ofil = "xpinP2L.I.F.-Lnin-Iniviully-fo-xpin-hoy-loih-o-2025-opyih-S.py" oph = slf.wospph / ofil if no oph.xiss(): sul = ssul( sn="oloihipo", oy=soy.UNI, sus=sSus.FIL, pioiy=sPioiy.IIL, oss=f"o loih fil no foun: {ofil}", ) suls.ppn(sul) un suls # s bsi loih funionliy sul = ssul( sn="oloihbsifunionliy", oy=soy.UNI, sus=sSus.PNIN, pioiy=sPioiy.IIL, si=i.now(), ) y: #  wosp o Pyhon ph sys.ph.ins(0, s(slf.wospph)) # Ipo n s bsi funionliy sp = ipolib.uil.spfofilloion("lifloih", oph) lifoul = ipolib.uil.oulfosp(sp) # Bsi ipo s sp.lo.xoul(lifoul) # h fo qui lsss/funions quiis = ["LIFloiho", "is", "LninOuo"] issinis = [] fo i in quiis: if no hs(lifoul, i): issinis.ppn(i) if issinis: sul.sus = sSus.FIL sul.oss = ( f"issin qui is: {', '.join(issinis)}" ) ls: sul.sus = sSus.PSS sul.oupu = "o loih oponns vli sussfully" xp xpion s : sul.sus = sSus.O sul.oss = f"o loih s fil: {s()}" finlly: # ln up ph if s(slf.wospph) in sys.ph: sys.ph.ov(s(slf.wospph)) sul.ni = i.now() sul.xuioni = (sul.ni - sul.si).olsons() suls.ppn(sul) un suls syn f unzuinionss(slf) -> Lis[ssul]: """un zu inion vliion ss""" suls = [] # s zu onfiuion zuonfisul = wi slf.vlizuonfi() suls.ppn(zuonfisul) # s zu Funions woflow zufunionssul = wi slf.vlizufunions() suls.ppn(zufunionssul) un suls syn f vlizuonfi(slf) -> ssul: """Vli zu onfiuion""" sul = ssul( sn="zuonfivliion", oy=soy.INION, sus=sSus.PNIN, pioiy=sPioiy.HIH, si=i.now(), ) y: zuonfiph = slf.wospph / "zuonfi.py" if no zuonfiph.xiss(): sul.sus = sSus.FIL sul.oss = "zuonfi.py no foun" un sul # Ipo n vli onfiuion sys.ph.ins(0, s(slf.wospph)) y: ipo zuonfi # h fo qui onfiuion is quionfis = [ "ZUSUBSIPIONI", "ZUSOUOUP", "ZULOION", ] issinonfis = [] fo onfi in quionfis: if no hs(zuonfi, onfi): issinonfis.ppn(onfi) if issinonfis: sul.sus = sSus.FIL sul.oss = ( f"issin zu onfiuions: {', '.join(issinonfis)}" ) ls: sul.sus = sSus.PSS sul.oupu = "zu onfiuion vli sussfully" finlly: if s(slf.wospph) in sys.ph: sys.ph.ov(s(slf.wospph)) xp xpion s : sul.sus = sSus.O sul.oss = f"zu onfi vliion fil: {s()}" sul.ni = i.now() sul.xuioni = (sul.ni - sul.si).olsons() un sul syn f vlizufunions(slf) -> ssul: """Vli zu Funions onfiuion""" sul = ssul( sn="zufunionsvliion", oy=soy.INION, sus=sSus.PNIN, pioiy=sPioiy.HIH, si=i.now(), ) y: funionsph = slf.wospph / "zufunionswoflow.py" if no funionsph.xiss(): sul.sus = sSus.FIL sul.oss = "zufunionswoflow.py no foun" un sul # Bsi synx h (il vliion woul qui zu S) wih opn(funionsph, "", noin="uf-8") s f: onn = f.() # h fo zu Funions pns quipns = [ "f in", "zu.funions", "fun.", "Hpqus", "Hpspons", ] issinpns = [] fo pn in quipns: if pn no in onn: issinpns.ppn(pn) if issinpns: sul.sus = sSus.FIL sul.oss = ( f"issin zu Funions pns: {', '.join(issinpns)}" ) ls: sul.sus = sSus.PSS sul.oupu = "zu Funions onfiuion vli sussfully" xp xpion s : sul.sus = sSus.O sul.oss = f"zu Funions vliion fil: {s()}" sul.ni = i.now() sul.xuioni = (sul.ni - sul.si).olsons() un sul syn f unpfonvliionss(slf) -> Lis[ssul]: """un pfon vliion ss""" suls = [] # s xuion i quins pfonsul = ssul( sn="pfonquins", oy=soy.PFON, sus=sSus.PNIN, pioiy=sPioiy.HIH, si=i.now(), ) y: # h fo pfon bnhs bnhfils = ["sobnh.py", "uonooussopionio.py"] founbnhs = [] fo bnhfil in bnhfils: if (slf.wospph / bnhfil).xiss(): founbnhs.ppn(bnhfil) if no founbnhs: pfonsul.sus = sSus.FIL pfonsul.oss = ( "No pfon bnh fils foun" ) ls: pfonsul.sus = sSus.PSS pfonsul.oupu = ( f"Foun pfon bnhs: {', '.join(founbnhs)}" ) xp xpion s : pfonsul.sus = sSus.O pfonsul.oss = ( f"Pfon vliion fil: {s()}" ) pfonsul.ni = i.now() pfonsul.xuioni = ( pfonsul.ni - pfonsul.si ).olsons() suls.ppn(pfonsul) un suls syn f unsuiyoplinss(slf) -> Lis[ssul]: """un suiy n oplin vliion ss""" suls = [] # Suiy onfiuion s suiysul = ssul( sn="suiyonfiuion", oy=soy.SUIY, sus=sSus.PNIN, pioiy=sPioiy.IIL, si=i.now(), ) y: # h fo suiy-l fils suiyfils = ["zuonfi.py", "pouionployns.py"] founsuiy = [] fo sfil in suiyfils: if (slf.wospph / sfil).xiss(): founsuiy.ppn(sfil) if ln(founsuiy) < ln(suiyfils): suiysul.sus = sSus.FIL suiysul.oss = "issin suiy onfiuion fils" ls: suiysul.sus = sSus.PSS suiysul.oupu = "Suiy onfiuion fils vli" xp xpion s : suiysul.sus = sSus.O suiysul.oss = f"Suiy vliion fil: {s()}" suiysul.ni = i.now() suiysul.xuioni = ( suiysul.ni - suiysul.si ).olsons() suls.ppn(suiysul) un suls syn f unploynvliionss(slf) -> Lis[ssul]: """un ployn vliion ss""" suls = [] # ployn inss s ploynsul = ssul( sn="ployninss", oy=soy.PLOYN, sus=sSus.PNIN, pioiy=sPioiy.IIL, si=i.now(), ) y: # h fo ployn-l fils ploynfils = [ "zu.yl", "ofil", "pouionployns.py", "quins.x", ] issinfils = [] fo pfil in ploynfils: if no (slf.wospph / pfil).xiss(): issinfils.ppn(pfil) if issinfils: ploynsul.sus = sSus.FIL ploynsul.oss = ( f"issin ployn fils: {', '.join(issinfils)}" ) ls: ploynsul.sus = sSus.PSS ploynsul.oupu = "ll ployn fils psn n vli" xp xpion s : ploynsul.sus = sSus.O ploynsul.oss = f"ployn vliion fil: {s()}" ploynsul.ni = i.now() ploynsul.xuioni = ( ploynsul.ni - ploynsul.si ).olsons() suls.ppn(ploynsul) un suls f nvliionsuy(slf, po: Vliionpo) -> i[s, ny]: """n vliion suy""" suy = { "olss": po.olss, "pssss": po.pssss, "filss": po.filss, "oss": po.oss, "sippss": po.sippss, "suss": ( f"{(po.pssss / po.olss * 100):.1f}%" if po.olss > 0 ls "0%" ), "xuionisons": po.xuioni, "xuionifo": f"{po.xuioni:.2f}s", "ssbyoy": {}, "ssbypioiy": {}, } # oup by oy n pioiy fo sul in po.ssuls: oy = sul.oy.vlu pioiy = sul.pioiy.vlu if oy no in suy["ssbyoy"]: suy["ssbyoy"][oy] = { "pss": 0, "fil": 0, "ol": 0, } if pioiy no in suy["ssbypioiy"]: suy["ssbypioiy"][pioiy] = { "pss": 0, "fil": 0, "ol": 0, } suy["ssbyoy"][oy]["ol"] += 1 suy["ssbypioiy"][pioiy]["ol"] += 1 if sul.sus == sSus.PSS: suy["ssbyoy"][oy]["pss"] += 1 suy["ssbypioiy"][pioiy]["pss"] += 1 ls: suy["ssbyoy"][oy]["fil"] += 1 suy["ssbypioiy"][pioiy]["fil"] += 1 un suy f nvliiononions( slf, po: Vliionpo ) -> Lis[s]: """n vliion onions""" onions = [] # h filu s if po.filss > 0: filu = po.filss / po.olss if filu > 0.5: onions.ppn( "Hih filu   - ii nion qui" ) lif filu > 0.2: onions.ppn( "o filu  - viw n fix fil ss" ) # h iil filus iilfilus = [  fo  in po.ssuls if .pioiy == sPioiy.IIL n .sus != sSus.PSS ] if iilfilus: onions.ppn( f"ss {ln(iilfilus)} iil s filus bfo ployn" ) # h pfon if po.xuioni > 600: # 10 inus onions.ppn( "s xuion i is hih - onsi opiizion" ) # h s ov oisov = ln(s(.oy.vlu fo  in po.ssuls)) if oisov < 5: onions.ppn("Lii s oy ov - xpn s sui") if no onions: onions.ppn( "ll ss pss sussfully - y fo ployn" ) un onions f inifyiilfilus(slf, po: Vliionpo) -> Lis[s]: """Inify iil s filus""" iilfilus = [] fo sul in po.ssuls: if sul.pioiy == sPioiy.IIL n sul.sus in [ sSus.FIL, sSus.O, ]: iilfilus.ppn(f"{sul.sn}: {sul.oss}") un iilfilus f xpovliionpo(slf, filph: s, po: Vliionpo) -> bool: """xpo ophnsiv vliion po""" y: xpo = { "poisp": i.now().isofo(), "vliionsuy": po.suy, "ssuls": [ { "sn": sul.sn, "oy": sul.oy.vlu, "sus": sul.sus.vlu, "pioiy": sul.pioiy.vlu, "xuioni": sul.xuioni, "oss": sul.oss, "oupu": sul.oupu, } fo sul in po.ssuls ], "onions": po.onions, "iilfilus": po.iilfilus, } wih opn(filph, "w") s f: json.up(xpo, f, inn=2, ful=s) lo.info(f"Vliion po xpo o {filph}") un u xp xpion s : lo.o(f"Fil o xpo vliion po: {}") un Fls # Foy funion fo sy insniion f svliionsui( wospph: Opionl[s] = Non, ) -> sVliionSui: """ Foy funion o  s vliion sui s: wospph: Ph o wosp ioy uns: onfiu sVliionSui insn """ un sVliionSui(wospph=wospph) # on-lin inf f in(): """in LI funion fo s vliion sui""" ipo ps ps = ps.unPs( sipion="L.I.F.. Plfo s Vliion Sui" ) ps.un( "--wosp", "-w", ful=Non, hlp="Wosp ioy ph" ) ps.un( "--xpo", "-", hlp="xpo vliion po o spifi fil" ) ps.un( "--oy", "-", hois=[ "uni", "inion", "sys", "pfon", "suiy", "oplin", "ployn", "vliion", ], hlp="un only ss fo spifi oy", ) ps.un( "--iou", "-", yp=in, ful=300, hlp="s xuion iou in sons (ful: 300)", ) ps.un( "--vbos", "-v", ion="sou", hlp="nbl vbos loin" ) s = ps.pss() if s.vbos: loin.Lo().sLvl(loin.BU) #  vliion sui sui = svliionsui(wospph=s.wosp) sui.xuioniou = s.iou pin("L.I.F.. Plfo - s Vliion Sui") pin("=" * 50) pin(f"Wosp: {s.wosp o os.w()}") y: pin("\nunnin vliion sui...") # un vliion sui po = synio.un(sui.unfullvliionsui()) pin("\nVliion suls:") pin(f" ol ss: {po.olss}") pin(f" Pss: {po.pssss}") pin(f" Fil: {po.filss}") pin(f" os: {po.oss}") pin(f" Sipp: {po.sippss}") pin(f" Suss : {po.suy.('suss', 'N/')}") pin( f" xuion i: {po.suy.('xuionifo', 'N/')}" ) if po.ssuls: pin("\ns suls by oy:") fo oy, ss in po.suy.("ssbyoy", {}).is(): pin( f" {oy.il()}: {ss['pss']}/{ss['ol']} pss" ) if po.iilfilus: pin("\niil Filus:") fo filu in po.iilfilus[:5]: # Show fis 5 pin(f" {filu}") if ln(po.iilfilus) > 5: pin(f" ... n {ln(po.iilfilus) - 5} o") if po.onions: pin("\nonions:") fo  in po.onions: pin(f" • {}") if s.xpo: if sui.xpovliionpo(s.xpo, po): pin(f"\nVliion po xpo o {s.xpo}") ls: pin("\nFil o xpo vliion po") un 1 # un ppopi xi o if po.iilfilus: pin("\n iil filus  - ployn no on") un 1 lif po.filss > 0: pin("\n ️ So ss fil - viw bfo ployn") un 1 ls: pin("\n ll vliion ss pss - y fo ployn") un 0 xp yboInup: pin("\nOpion inup by us") un 1 xp xpion s : pin(f"\nVliion sui fil: {}") un 1 if n == "in": ipo ipolib.uil ipo sys sys.xi(in())