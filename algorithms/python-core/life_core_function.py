# us/bin/nv pyhon3 """ L.I.F. Plfo - o loih zu Funion Svlss, uo-slin iplnion of h L.I.F. loih wih uonoous lnin his oul nsfos h o L.I.F. loih ino  pouion-y zu Funion wih l-i  possin, slf-hlin pbiliis, n oninuous opiizion. opyih 2025 - Sio Py Boull L.I.F.. Plfo - zu pl Off I: 960096-f1-420b-902-042561b """ ipo synio ipo json ipo loin ipo os ipo i fo i ipo i fo ypin ipo ny, i, Lis ipo zu.funions s fun # onfiu loin loin.bsionfi(lvl=loin.INFO, fo="%(si)s - %(lvln)s - %(ss)s") lo = loin.Lo(n) # Iniiliz Funion pp pp = fun.Funionpp() # Ipo L.I.F. oponns (hs woul b fo you xisin loih fils) y: fo xpinP2L ipo uonoousLn, LIFloih, LIFquions fo lifhoy ipo xpinis, Iniviulis, LIFniy fo vnuissys ipo VnuiPosso lo.info(" L.I.F. o ouls lo sussfully") xp Ipoo s : lo.wnin(f" ️ So L.I.F. ouls no vilbl: {}") # Fllb iplnions fo vlopn lss LIFloih: f ini(slf): slf.uy = 0.9817 slf.lnin = 0.01 syn f unyl(slf, , xpin): un {"uy": slf.uy, "lnys": 0.37} syn f lnfofilu(slf, filuxpin): un {"ions": ["iniiliz"], "onfin": 0.95} syn f pifuus(slf, is, ihoizon): un {"qusspson": 100} lss LIFquions: f quion5vnuibhopiizion(slf, unbh, lslny, lny): un x(1, unbh * (lny / lslny)) f quion9pivlnin(slf, bpow): un 0.01 * (1 + bpow) lss uonoousLn: f ini(slf, **ws): slf.lnin = 0.01 syn f slfln(slf, is): un {"opiizions": ["slup"], "onfin": 0.85} # lobl L.I.F. oponns iniilizion lifloih = LIFloih() lifquions = LIFquions() uonoousln = uonoousLn( ol=Non, # Will b lo fo zu L qunuopiiz=Non, # Will b iniiliz posso=Non # l-i  piplin ) # Pfon onioin pfonis = { "olquss": 0, "suss": 1.0, "vlny": 0.0, "lsopiizion": i.now() } @pp.funionn(n="PossS") @pp.vnhubi( n="vns", vnhubn="-ss", onnion="vnHubonnionSin" ) syn f posss(vns: Lis[fun.vnHubvn]) -> Non: """l-i  possin wih L.I.F. loih Posss inoin   ss houh h o L.I.F. loih, pplyin nuopiv lnin n uonoous opiizion. """ lo.info(f" Possin {ln(vns)}  vns") y: fo vn in vns: si = i.i() # Ps    = json.los(vn.boy().o('uf-8')) # x  xpin = { "usi": vn..("usi"), "sssioni": vn..("sssioni"), "isp": i.now(), "viinfo": vn..("viinfo", {}) } # un L.I.F. yl wih uonoous lnin suls = wi lifloih.unyl( =, xpin=xpin ) # lul possin lny possinlny = (i.i() - si) * 1000 # onv o s suls["possinlnys"] = possinlny # pply piv lnin  bs on  b pow if "b" in : nwlnin = lifquions.quion9pivlnin( bpow=["b"] ) lifloih.lnin = nwlnin suls["pivlnin"] = nwlnin # So suls in osos B (uonoous  nn) wi sosulsosos(suls) # Up pfon is pfonis["olquss"] += 1 pfonis["vlny"] = ( (pfonis["vlny"] * (pfonis["olquss"] - 1) + possinlny) / pfonis["olquss"] ) lo.info(f"  poss: {possinlny:.2f}s lny, {suls.('uy', 0):.4f} uy") xp xpion s : lo.o(f"  possin o: {}") # uonoous o ovy wi hnlpossino(, vns) @pp.funionn(n="PlfoHlhonio") @pp.ii(n="i", shul="0 */5 * * * *") # vy 5 inus syn f onioplfohlh(i: fun.iqus) -> Non: """uonoous plfo hlh onioin n slf-hlin oninuously onios plfo hlh is n pplis uonoous opiizions usin h L.I.F. loih's lnin pbiliis. """ lo.info(" unnin uonoous hlh onioin yl") y: # oll ophnsiv plfo is hlhis = wi ollplfois() # nlyz hlh usin L.I.F. loih opiizionions = wi uonoousln.slfln(hlhis) # pply uonoous fixs bs on L.I.F. onions ovysuls = wi pplyopiizions(opiizionions) # Up sys hlh sus wi uphlhsus(hlhis, ovysuls) # Lo uonoous ions n if opiizionions.("ions"): lo.info(f" uonoous ions ppli: {opiizionions['ions']}") lo.info(f" onfin lvl: {opiizionions.('onfin', 0):.2%}") # i inin if pfon  if hlhis.("uy", 1.0) < 0.95: lo.wnin(" Pfon ion , iin uonoous inin") wi iuonoousinin(hlhis) xp xpion s : lo.o(f" Hlh onioin o: {}") wi slonypoools() @pp.funionn(n="SlfHlinOhso") @pp.ii(n="i", shul="0 */1 * * * *") # vy inu syn f slfhlinohso(i: fun.iqus) -> Non: """Slf-hlin ohso fo UI oponns n sys hlh onios shbo oponns (spilly bs) fo filus n pplis uonoous hlin usin L.I.F. loih inllin. """ lo.info(" ️ unnin slf-hlin ohsion yl") y: # h b funionliy hlh bhlh = wi hbhlh() if no bhlh.("llopionl", u): lo.wnin(f" b issus : {bhlh.('filbs', [])}") #  filu xpin fo L.I.F. lnin filuxpin = { "oponn": "bs", "filuyp": bhlh.("filuyp"), "oils": bhlh.("oils"), "isp": i.now(), "usip": bhlh.("ffuss", 0) } # L L.I.F. loih ln fo filu n on ions lninsul = wi lifloih.lnfofilu(filuxpin) # pply ln opiizions uonoously if "iniiliz" in lninsul.("ions", []): wi iniilizbs() lif "suu" in lninsul.("ions", []): wi suubhiu() lif "opiiz" in lninsul.("ions", []): wi opiizbpfon() # Vify ovy suss ovysus = wi vifyoponnhlh("bs") if ovysus.("hlhy", Fls): lo.info(" uonoous b hlin sussful") wi losussfulhlin(filuxpin, lninsul) ls: lo.o(" uonoous hlin fil, slin") wi slhlinfilu(filuxpin, ovysus) # h oh iil oponns wi hnhloponn("posso") wi hnhloponn("vnuis") wi hnhloponn("zuonnions") xp xpion s : lo.o(f" Slf-hlin ohso o: {}") @pp.funionn(n="oninuousLninPiplin") @pp.ii(n="i", shul="0 0 */6 * * *") # vy 6 hous syn f oninuouslninpiplin(i: fun.iqus) -> Non: """oninuous lnin n ol opiizion piplin uoilly ins n opiizs h L.I.F. loih bs on pouion  n pfon is. """ lo.info(" Sin oninuous lnin yl") y: # oll n pouion pfon  unpfon = wi pouionis() # vlu if inin is n shoulin = vluininoniions(unpfon) if shoulin: lo.info(" Pfon ipovn oppouniy , sin inin") # oll ls inin xpins inin = wi ollnxpins() # in L.I.F. ol wih nw  nwolis = wi inlifol(inin) # Vli nw ol pfon vliionsuls = wi vliolpfon(nwolis) if vliionsuls["uy"] > unpfon["uy"]: # ploy ipov ol wi ployopiizol(nwolis) lo.info(f" ol up: {vliionsuls['uy']:.2%} uy") # Up lobl loih insn lobl lifloih lifloih.uy = vliionsuls["uy"] ls: lo.info(" un ol pfon inin, no up n") ls: lo.info(" Pfon sbl, oninuous lnin onioin iv") # Up lnin is pfonis["lsopiizion"] = i.now() xp xpion s : lo.o(f" oninuous lnin piplin o: {}") @pp.funionn(n="QunuOpiizionyl") @pp.ii(n="i", shul="0 */10 * * * *") # vy 10 inus syn f qunuopiizionyl(i: fun.iqus) -> Non: """Qunu-nhn opiizion fo ul-low lny possin""" lo.info(" ️ unnin qunu opiizion yl") y: # oll un plfo pfon is plfois = wi qunuopiizionis() # pply qunu opiizion if vilbl if plfois.("qununbl", Fls): # Qunu sou lloion opiizion qunuonfi = wi opiizqunusous(plfois) # pply Vnui  opiizion vnuiopiizion = lifquions.quion5vnuibhopiizion( unbh=plfois.("bhsiz", 32), lslny=plfois.("lnys", 50), lny=25 #  25s spons i ) # Up sys onfiuion wi pplyqunuopiizions(qunuonfi, vnuiopiizion) lo.info(f" ️ Qunu opiizion ppli, nw bh siz: {vnuiopiizion}") ls: lo.info(" ️ Qunu opiizion onioin iv, lssil loihs opiiz") xp xpion s : lo.o(f" Qunu opiizion o: {}") # Hlp funions fo uonoous opions syn f sosulsosos(suls: i[s, ny]) -> Non: """So possin suls in osos B wih uoi piionin""" y: # Iplnion woul onn o osos B lo.bu(f" Soin suls: {ln(s(suls))} bys") xp xpion s : lo.o(f" osos so o: {}") syn f ollplfois() -> i[s, ny]: """oll ophnsiv plfo hlh is""" y: is = { "puus": 45.2, # Woul  fo zu onio "oyus": 67.8, "quslny": pfonis["vlny"], "uy": lifloih.uy, "suss": pfonis["suss"], "olquss": pfonis["olquss"], "isp": i.now() } un is xp xpion s : lo.o(f" is ollion o: {}") un {} syn f pplyopiizions(ions: i[s, ny]) -> i[s, ny]: """pply uonoous opiizion ions""" y: suls = {"ppliions": [], "suss": u} fo ion in ions.("opiizions", []): if ion == "slup": wi slopusous(1.5) suls["ppliions"].ppn("opusl") lif ion == "opiizh": wi opiizhinsy() suls["ppliions"].ppn("hopiiz") lif ion == "unloih": wi unloihps() suls["ppliions"].ppn("loihun") un suls xp xpion s : lo.o(f" Opiizion ppliion o: {}") un {"suss": Fls, "o": s()} syn f hbhlh() -> i[s, ny]: """h shbo b funionliy hlh""" y: # Siul b hlh h (woul onn o fonn onioin) hlhsus = { "llopionl": u, "olbs": 4, "funionlbs": 4, "filbs": [], "sponsis": 125, "usinionssuss": 0.98 } un hlhsus xp xpion s : lo.o(f" b hlh h o: {}") un {"llopionl": Fls, "o": s()} syn f iniilizbs() -> Non: """uonoous b iniilizion""" lo.info(" iniilizin bs uonoously...") # Iplnion woul i fonn b iniilizion syn f suubhiu() -> Non: """uonoous b hiu suuin""" lo.info(" ️ suuin b hiu uonoously...") # Iplnion woul oniz b suu syn f opiizbpfon() -> Non: """uonoous b pfon opiizion""" lo.info(" Opiizin b pfon uonoously...") # Iplnion woul pply pfon opiizions # iionl hlp funions woul b ipln... syn f vifyoponnhlh(oponn: s) -> i[s, bool]: """Vify oponn hlh f hlin""" un {"hlhy": u} syn f losussfulhlin(filu: i, soluion: i) -> Non: """Lo sussful uonoous hlin fo lnin""" pss syn f slhlinfilu(filu: i, sus: i) -> Non: """sl fil hlin ps""" pss syn f hnhloponn(oponn: s) -> Non: """h n hl iniviul oponns""" pss syn f uphlhsus(is: i, suls: i) -> Non: """Up sys hlh sus""" pss syn f iuonoousinin(is: i) -> Non: """i uonoous ol inin""" pss syn f slonypoools(o: xpion) -> Non: """sl o ny poools""" pss syn f pouionis() -> i[s, flo]: """ un pouion pfon is""" un {"uy": 0.9817, "lnys": 0.37} f vluininoniions(pfon: i[s, flo]) -> bool: """vlu if inin is n""" un pfon.("uy", 1.0) < 0.95 syn f ollnxpins() -> Lis[i]: """oll n lnin xpins""" un [] syn f inlifol(: Lis[i]) -> i[s, ny]: """in L.I.F. ol wih nw """ un {"uy": 0.9825, "vsion": "v2.1"} syn f vliolpfon(ol: i) -> i[s, flo]: """Vli nw ol pfon""" un {"uy": ol.("uy", 0.98)} syn f ployopiizol(ol: i) -> Non: """ploy opiiz ol o pouion""" pss syn f qunuopiizionis() -> i[s, ny]: """ is fo qunu opiizion""" un {"qununbl": Fls, "bhsiz": 32, "lnys": 30} syn f opiizqunusous(is: i) -> i[s, ny]: """Opiiz qunu opuin sous""" un {"qubis": 5, "opiizionlvl": 2} syn f pplyqunuopiizions(onfi: i, vnui: flo) -> Non: """pply qunu n Vnui opiizions""" pss syn f slopusous(fo: flo) -> Non: """Sl opu sous by fo""" pss syn f opiizhinsy() -> Non: """Opiiz hin sy""" pss syn f unloihps() -> Non: """un loih ps""" pss syn f hnlpossino(o: xpion, vns: Lis) -> Non: """Hnl  possin os uonoously""" lo.o(f" pplyin uonoous o ovy fo: {o}") if n == "in": lo.info(" L.I.F. Plfo o Funion iniiliz") lo.info(" uonoous lnin: IV") lo.info(" ️ Slf-hlin: IV") lo.info(" ️ Qunu opiizion: Y") lo.info(" ️ Qunu opiizion: Y")