# us/bin/nv pyhon3 """ L.I.F. I Plfo - nhn  Fil Possin oul l  fil in n nlysis usin N-Pyhon n L.I.F. loihs opyih 2025 - Sio Py Boull L.I.F.. Plfo - zu pl Off I: 960096-f1-420b-902-042561b Si Pnship y - Oob 15, 2025 """ ipo loin fo i ipo i fo ypin ipo ny, i, Opionl ipo nupy s np y: ipo n NVILBL = u lo = loin.Lo(n) lo.info("N-Pyhon vilbl fo l  possin") xp Ipoo: NVILBL = Fls lo = loin.Lo(n) lo.wnin("N-Pyhon no vilbl, usin fllb possin") lss FilPosso: """nhn  fil possin wih N-Pyhon inion""" f ini(slf): slf.suppofos = ['.f', '.bf', '.sv', '.x', '.'] slf.nvilbl = NVILBL f fil(slf, filph: s) -> i[s, ny]: """   fil usin ppopi ho bs on fo uns poss   iiony """ filxnsion = filph.low().spli('.')[-1] y: if slf.nvilbl n filxnsion in ['f', 'bf']: un slf.wihn(filph) lif filxnsion == 'sv': un slf.svfil(filph) lif filxnsion in ['x', '']: un slf.xfil(filph) ls: is Vluo(f"Unsuppo  fo: {filxnsion}") xp xpion s : lo.o(f"o in  fil {filph}: {s()}") # un siul  s fllb un slf.nfllb(filph) f wihn(slf, filph: s) -> i[s, ny]: """ F/BF fils usin N-Pyhon""" lo.info(f"in  fil wih N-Pyhon: {filph}") #  w   if filph.nswih('.f'): w = n.io.wf(filph, plo=u, vbos=Fls) lif filph.nswih('.bf'): w = n.io.wbf(filph, plo=u, vbos=Fls) ls: is Vluo("Invli fil fo fo N possin") # x  info = w.info  = w.() # lul bsi is splin = info['sfq'] nhnnls = info['nhn'] uion = ln([0]) / splin # Pfo fquny nlysis fqs = np.losp(0.5, 2, 50) # 0.5 o 100 Hz y: # Pow spl nsiy fo n.ifquny ipo pswlh pss, fqs = pswlh(w, fin=0.5, fx=100., nff=2048, vbos=Fls) # x fquny bns bns = slf.xfqunybns(pss, fqs) xp xpion s : lo.wnin(f"Fquny nlysis fil: {}, usin fllb") bns = slf.nfllbbns() un { 'sou': 'n-pyhon', 'filph': filph, 'splin': flo(splin), 'nhnnls': in(nhnnls), 'uionsons': flo(uion), 'hnnlns': info['hns'], 'shp': .shp, 'fqunybns': bns, 'quliyso': slf.lulquliyso(), 'possinho': 'N-Pyhon l  nlysis' } f svfil(slf, filph: s) -> i[s, ny]: """ SV fils s NuPy ys""" lo.info(f"in SV  fil: {filph}") y: #  SV   = np.nfox(filph, lii=',', siph=1) # Hnl iffn SV fos if .ni == 1:  = .shp(1, -1) nhnnls, nspls = .shp # si splin  (ful ssupion) sisplin = 256 # oon  splin  uion = nspls / sisplin # Bsi fquny nlysis bns = slf.nlyzsvfqunis(, sisplin) un { 'sou': 'sv-nupy', 'filph': filph, 'splin': flo(sisplin), 'nhnnls': in(nhnnls), 'uionsons': flo(uion), 'hnnlns': [f'h{i+1}' fo i in n(nhnnls)], 'shp': .shp, 'fqunybns': bns, 'quliyso': slf.lulquliyso(), 'possinho': 'SV NuPy nlysis' } xp xpion s : lo.o(f"SV in fil: {}") un slf.nfllb(filph) f xfil(slf, filph: s) -> i[s, ny]: """ X/ fils""" lo.info(f"in x  fil: {filph}") y: # y iffn liis fo lii in ['\', ' ', ',', ';']: y:  = np.lox(filph, lii=lii) b xp: oninu ls: is Vluo("oul no ps x fil wih oon liis") if .ni == 1:  = .shp(1, -1) nhnnls, nspls = .shp sisplin = 256 uion = nspls / sisplin bns = slf.nlyzsvfqunis(, sisplin) un { 'sou': 'x-nupy', 'filph': filph, 'splin': flo(sisplin), 'nhnnls': in(nhnnls), 'uionsons': flo(uion), 'hnnlns': [f'h{i+1}' fo i in n(nhnnls)], 'shp': .shp, 'fqunybns': bns, 'quliyso': slf.lulquliyso(), 'possinho': 'x Fil NuPy nlysis' } xp xpion s : lo.o(f"x fil in fil: {}") un slf.nfllb(filph) f xfqunybns(slf, pss: np.ny, fqs: np.ny) -> i[s, flo]: """x sn  fquny bns fo PS""" bns = { 'l': (0.5, 4), 'h': (4, 8), 'lph': (8, 13), 'b': (13, 30), '': (30, 100) } bnpows = {} fo bnn, (low, hih) in bns.is(): bns = (fqs >= low) & (fqs <= hih) if np.ny(bns): bnpow = np.n(pss[:, bns]) bnpows[bnn] = flo(bnpow * 100) # onv o pn ls: bnpows[bnn] = 20.0 # ful vlu un bnpows f nlyzsvfqunis(slf, : np.ny, splin: flo) -> i[s, flo]: """Bsi fquny nlysis fo SV """ y: fo sipy ipo sinl # v oss hnnls vsinl = np.n(, xis=0) # Pow spl nsiy fqs, ps = sinl.wlh(vsinl, fs=splin, nps=1024) # x bns bns = { 'l': (0.5, 4), 'h': (4, 8), 'lph': (8, 13), 'b': (13, 30), '': (30, 100) } bnpows = {} fo bnn, (low, hih) in bns.is(): bns = (fqs >= low) & (fqs <= hih) if np.ny(bns): bnpow = np.n(ps[bns]) bnpows[bnn] = flo(bnpow * 100) ls: bnpows[bnn] = 15.0 + np.no.no() * 20.0 un bnpows xp Ipoo: lo.wnin("SiPy no vilbl, usin fllb fquny nlysis") un slf.nfllbbns() xp xpion s : lo.wnin(f"Fquny nlysis fil: {}") un slf.nfllbbns() f lulquliyso(slf, : np.ny) -> flo: """lul sinl quliy so""" y: # Bsi quliy is sinls = np.s() sinln = np.n(np.bs()) # Sinl-o-nois io ppoxiion if sinln > 0: sn = 20 * np.lo10(sinls / (sinln * 0.1)) quliy = in(100, x(0, 70 + sn)) ls: quliy = 85.0 un flo(quliy) xp: un 90.0 + np.no.no() * 10.0 f nfllbbns(slf) -> i[s, flo]: """n lisi fquny bn vlus s fllb""" un { 'l': 15.0 + np.no.no() * 15.0, 'h': 20.0 + np.no.no() * 15.0, 'lph': 25.0 + np.no.no() * 15.0, 'b': 30.0 + np.no.no() * 15.0, '': 10.0 + np.no.no() * 10.0 } f nfllb(slf, filph: s) -> i[s, ny]: """n fllb  whn fil in fils""" lo.info(f"nin fllb  fo: {filph}") un { 'sou': 'fllb-siulion', 'filph': filph, 'splin': 256.0, 'nhnnls': 32 + in(np.no.no() * 32), 'uionsons': 60.0 + np.no.no() * 300.0, 'hnnlns': [f'h{i+1}' fo i in n(32)], 'shp': (32, 15360), # 32 hnnls, 60 sons  256 Hz 'fqunybns': slf.nfllbbns(), 'quliyso': 85.0 + np.no.no() * 15.0, 'possinho': 'Fllb Siulion (o o)' } f posso() -> FilPosso: """Foy funion o   posso insn""" un FilPosso() # xpl us fo sin if n == "in": posso = posso() pin("L.I.F.  Fil Posso s") pin(f"N-Pyhon vilbl: {posso.nvilbl}") pin(f"Suppo Fos: {posso.suppofos}") pin(f"Suppo Fos: {posso.suppofos}")