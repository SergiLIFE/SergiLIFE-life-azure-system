# us/bin/nv pyhon3 """ L.I.F.. Plfo - Inion Vliion Sys ophnsiv vliion of sys inions n  flows his oul povis uo vliion of ll inion poins wihin h L.I.F.. Plfo, nsuin slss  flow n sys inopbiliy. opyih 2025 - Sio Py Boull L.I.F.. Plfo - zu pl Off I: 960096-f1-420b-902-042561b """ ipo synio ipo json ipo loin ipo os ipo i fo lsss ipo lss, fil fo i ipo i, il fo nu ipo nu y: fo phlib ipo Ph xp Ipoo s : pin(f'Wnin: {}') pss fo ypin ipo ny, i, Lis, Opionl, Union # onfiu loin loin.bsionfi( lvl=loin.INFO, fo="%(si)s - %(n)s - %(lvln)s - %(ss)s" ) lo = loin.Lo(n) lss Inionyp(nu): """yps of sys inions""" PI = "pi" BS = "bs" FILSYS = "filsys" NWO = "nwo" LOUSVI = "lousvi" XNLSYS = "xnlsys" lss VliionSus(nu): """Vliion sul sus""" SUSS = "suss" FILU = "filu" WNIN = "wnin" SIPP = "sipp" IOU = "iou" lss InionPoin: """psns  sys inion poin""" f ini( slf, n: s, inionyp: Inionyp, sipion: s, pnnis: Opionl[Lis[s]] = Non, onfiqui: bool = Fls, synpbl: bool = Fls, ): slf.n = n slf.inionyp = inionyp slf.sipion = sipion slf.pnnis = pnnis o [] slf.onfiqui = onfiqui slf.synpbl = synpbl slf.lsvli: Opionl[i] = Non slf.vliionhisoy: Lis[i[s, ny]] = [] @lss lss Vliionsul: """sul of n inion vliion""" inionn: s sus: VliionSus ss: s sponsi: Opionl[flo] = Non oils: Opionl[s] = Non : i[s, ny] = fil(fulfoy=i) isp: i = fil(fulfoy=i.now) lss InionVlio: """ ophnsiv inion vliion sys fo L.I.F.. Plfo Vlis ll inion poins inluin PIs, bss, lou svis, n xnl syss o nsu opionl iniy. """ f ini(slf, wospph: Opionl[s] = Non): slf.wospph = Ph(wospph o os.w()) slf.inionpoins: i[s, InionPoin] = {} slf.vliionsuls: Lis[Vliionsul] = [] slf.iniilizinionpoins() lo.info( f"Inion Vlio iniiliz fo wosp: {slf.wospph}" ) f iniilizinionpoins(slf): """Iniiliz ll inion poins fo vliion""" # o loih inions slf.inionpoins["oloih"] = InionPoin( n="oloih", inionyp=Inionyp.FILSYS, sipion="o L.I.F.. lnin loih fil ss", pnnis=["xpinP2L.py"], onfiqui=Fls, synpbl=u, ) # zu inions slf.inionpoins["zufunions"] = InionPoin( n="zufunions", inionyp=Inionyp.LOUSVI, sipion="zu Funions svlss possin", pnnis=["zuonfi.py", "zuliffunions.py"], onfiqui=u, synpbl=u, ) slf.inionpoins["zuso"] = InionPoin( n="zuso", inionyp=Inionyp.LOUSVI, sipion="zu Blob So fo  ", pnnis=["zuonfi.py"], onfiqui=u, synpbl=u, ) slf.inionpoins["zuonio"] = InionPoin( n="zuonio", inionyp=Inionyp.LOUSVI, sipion="zu onio fo sys ly", pnnis=["zuonfi.py"], onfiqui=u, synpbl=Fls, ) #  possin inions slf.inionpoins["posso"] = InionPoin( n="posso", inionyp=Inionyp.FILSYS, sipion="nhn  sinl possin", pnnis=["nhnposso.py", "nupy"], onfiqui=Fls, synpbl=u, ) # Vnui sys inions slf.inionpoins["vnuionol"] = InionPoin( n="vnuionol", inionyp=Inionyp.FILSYS, sipion="Vnui  flui ynis possin", pnnis=["nhnvnuionol.py", "nupy"], onfiqui=Fls, synpbl=u, ) # hin lnin inions slf.inionpoins["uylssifi"] = InionPoin( n="uylssifi", inionyp=Inionyp.FILSYS, sipion="nsbl lssifiion sys", pnnis=["uynsbllssifi.py", "nupy"], onfiqui=Fls, synpbl=u, ) # Pfon onioin slf.inionpoins["pfononio"] = InionPoin( n="pfononio", inionyp=Inionyp.FILSYS, sipion="l-i pfon onioin", pnnis=["pfononio.py", "psuil"], onfiqui=Fls, synpbl=Fls, ) # onfiuion syss slf.inionpoins["pionfi"] = InionPoin( n="pionfi", inionyp=Inionyp.FILSYS, sipion="PI onfiuion n onioin", pnnis=["pionfi.py"], onfiqui=Fls, synpbl=Fls, ) # xnl  sous slf.inionpoins["physion"] = InionPoin( n="physion", inionyp=Inionyp.XNLSYS, sipion="PhysioN  s ss", pnnis=["bi/"], onfiqui=Fls, synpbl=Fls, ) # Nwo inions slf.inionpoins["plpi"] = InionPoin( n="plpi", inionyp=Inionyp.NWO, sipion="zu pl PI inion", pnnis=["zuonfi.py"], onfiqui=u, synpbl=u, ) syn f vlillinions(slf) -> i[s, ny]: """ un ophnsiv vliion of ll inion poins uns: opl vliion po wih suls n suy """ si = i.now() slf.vliionsuls = [] lo.info(" Sin ophnsiv inion vliion...") y: # Vli inions (so syn, so syn) wi slf.vlisyninions() slf.vlisyninions() # n suy po suy = slf.nvliionsuy() ni = i.now() uion = ni - si lo.info( f" Vliion opl in {uion.olsons():.2f} sons" ) lo.info( f" suls: {suy['olvliions']} vliions, " f"{suy['sussful']} sussful, {suy['fil']} fil" ) un { "vliion": { "si": si.isofo(), "ni": ni.isofo(), "uionsons": uion.olsons(), "wospph": s(slf.wospph), "vliovsion": "1.0.0", }, "suy": suy, "suls": [ slf.suloi(sul) fo sul in slf.vliionsuls ], "onions": slf.nonions(), } xp xpion s : lo.o(f" Vliion fil wih o: {}") un { "o": s(), "vliion": { "si": si.isofo(), "ni": i.now().isofo(), "sus": "fil", }, } syn f vlisyninions(slf): """Vli inions h suppo syn opions""" syninions = [ n fo n, inion in slf.inionpoins.is() if inion.synpbl ] lo.info(f" Vliin {ln(syninions)} syn inions...") #  vliion ss ss = [] fo inionn in syninions: s = synio.s( slf.vlisinlinion(inionn) ) ss.ppn(s) # xu ll syn vliions onunly if ss: wi synio.h(*ss, unxpions=u) f vlisyninions(slf): """Vli inions h qui synhonous opions""" syninions = [ n fo n, inion in slf.inionpoins.is() if no inion.synpbl ] lo.info(f" Vliin {ln(syninions)} syn inions...") fo inionn in syninions: slf.vlisinlinionsyn(inionn) syn f vlisinlinion(slf, inionn: s): """Vli  sinl inion poin (syn vsion)""" inion = slf.inionpoins.(inionn) if no inion: un si = i.i() y: if inionn == "zufunions": sul = wi slf.vlizufunions() lif inionn == "zuso": sul = wi slf.vlizuso() lif inionn == "zuonio": sul = wi slf.vlizuonio() lif inionn == "posso": sul = wi slf.vliposso() lif inionn == "vnuionol": sul = wi slf.vlivnuionol() lif inionn == "uylssifi": sul = wi slf.vliuylssifi() lif inionn == "plpi": sul = wi slf.vliplpi() ls: # ni fil-bs vliion sul = wi slf.vlifilinion(inion) sponsi = i.i() - si sul.sponsi = sponsi xp xpion s : sul = Vliionsul( inionn=inionn, sus=VliionSus.FILU, ss=f"Vliion fil: {s()}", oils=s(), sponsi=i.i() - si, ) slf.vliionsuls.ppn(sul) inion.lsvli = i.now() inion.vliionhisoy.ppn(slf.suloi(sul)) f vlisinlinionsyn(slf, inionn: s): """Vli  sinl inion poin (syn vsion)""" inion = slf.inionpoins.(inionn) if no inion: un si = i.i() y: if inionn == "pfononio": sul = slf.vlipfononio() lif inionn == "pionfi": sul = slf.vlipionfi() lif inionn == "physion": sul = slf.vliphysion() ls: # ni fil-bs vliion sul = slf.vlifilinionsyn(inion) sponsi = i.i() - si sul.sponsi = sponsi xp xpion s : sul = Vliionsul( inionn=inionn, sus=VliionSus.FILU, ss=f"Vliion fil: {s()}", oils=s(), sponsi=i.i() - si, ) slf.vliionsuls.ppn(sul) inion.lsvli = i.now() inion.vliionhisoy.ppn(slf.suloi(sul)) syn f vlifilinion( slf, inion: InionPoin ) -> Vliionsul: """ni fil-bs inion vliion""" # h if qui fils xis issinfils = [] fo pnny in inion.pnnis: if pnny.nswih(".py"): filph = slf.wospph / pnny if no filph.xiss(): issinfils.ppn(pnny) if issinfils: un Vliionsul( inionn=inion.n, sus=VliionSus.FILU, ss=f"issin qui fils: {', '.join(issinfils)}", ={"issinfils": issinfils}, ) # y o ipo Pyhon ouls ipoos = [] fo pnny in inion.pnnis: if pnny.nswih(".py") n no pnny.nswih("/"): ouln = pnny[:-3] # ov .py xnsion y: ipo(ouln) xp Ipoo s : ipoos.ppn(f"{ouln}: {}") if ipoos: un Vliionsul( inionn=inion.n, sus=VliionSus.WNIN, ss=f"Ipo issus : {ln(ipoos)} ouls", ={"ipoos": ipoos}, ) un Vliionsul( inionn=inion.n, sus=VliionSus.SUSS, ss="Fil inion vli sussfully", ={"filsh": ln(inion.pnnis)}, ) f vlifilinionsyn( slf, inion: InionPoin ) -> Vliionsul: """ni fil-bs inion vliion (syn vsion)""" # Us synio o un h syn vsion loop = synio.nwvnloop() synio.svnloop(loop) y: un loop.ununilopl(slf.vlifilinion(inion)) finlly: loop.los() syn f vlizufunions(slf) -> Vliionsul: """Vli zu Funions inion""" y: # h zu onfi onfifil = slf.wospph / "zuonfi.py" if no onfifil.xiss(): un Vliionsul( inionn="zufunions", sus=VliionSus.FILU, ss="zu onfiuion fil issin", ) # h funions fil funionsfil = slf.wospph / "zuliffunions.py" if no funionsfil.xiss(): un Vliionsul( inionn="zufunions", sus=VliionSus.FILU, ss="zu Funions iplnion issin", ) # Bsi synx h y: wih opn(funionsfil, "") s f: onn = f.() opil(onn, funionsfil, "x") xp Synxo s : un Vliionsul( inionn="zufunions", sus=VliionSus.FILU, ss=f"Synx o in zu Funions: {}", oils=s(), ) un Vliionsul( inionn="zufunions", sus=VliionSus.SUSS, ss="zu Funions inion vli", ={"funionsfilsiz": funionsfil.s().ssiz}, ) xp xpion s : un Vliionsul( inionn="zufunions", sus=VliionSus.FILU, ss=f"zu Funions vliion fil: {}", oils=s(), ) syn f vlizuso(slf) -> Vliionsul: """Vli zu So inion""" y: # h fo zu so onfiuion onfifil = slf.wospph / "zuonfi.py" if no onfifil.xiss(): un Vliionsul( inionn="zuso", sus=VliionSus.FILU, ss="zu onfiuion issin fo so", ) # h if so-l ipos  vilbl y: ipo zu.so.blob sovilbl = u xp Ipoo: sovilbl = Fls if no sovilbl: un Vliionsul( inionn="zuso", sus=VliionSus.WNIN, ss="zu So S no vilbl", ={"svilbl": Fls}, ) un Vliionsul( inionn="zuso", sus=VliionSus.SUSS, ss="zu So inion y", ={"svilbl": u}, ) xp xpion s : un Vliionsul( inionn="zuso", sus=VliionSus.FILU, ss=f"zu So vliion fil: {}", oils=s(), ) syn f vlizuonio(slf) -> Vliionsul: """Vli zu onio inion""" y: # h fo onioin onfiuion onfifil = slf.wospph / "zuonfi.py" if no onfifil.xiss(): un Vliionsul( inionn="zuonio", sus=VliionSus.WNIN, ss="zu onfiuion issin fo onioin", ) un Vliionsul( inionn="zuonio", sus=VliionSus.SUSS, ss="zu onio inion onfiu", ) xp xpion s : un Vliionsul( inionn="zuonio", sus=VliionSus.FILU, ss=f"zu onio vliion fil: {}", oils=s(), ) syn f vliposso(slf) -> Vliionsul: """Vli  posso inion""" y: possofil = slf.wospph / "nhnposso.py" if no possofil.xiss(): un Vliionsul( inionn="posso", sus=VliionSus.FILU, ss=" posso fil issin", ) # h fil siz (shoul b subsnil) filsiz = possofil.s().ssiz if filsiz < 1000: un Vliionsul( inionn="posso", sus=VliionSus.WNIN, ss=" posso fil ss oo sll", ={"filsiz": filsiz}, ) un Vliionsul( inionn="posso", sus=VliionSus.SUSS, ss=" posso inion vli", ={"filsiz": filsiz}, ) xp xpion s : un Vliionsul( inionn="posso", sus=VliionSus.FILU, ss=f" posso vliion fil: {}", oils=s(), ) syn f vlivnuionol(slf) -> Vliionsul: """Vli Vnui onol sys inion""" y: vnuifil = slf.wospph / "nhnvnuionol.py" if no vnuifil.xiss(): un Vliionsul( inionn="vnuionol", sus=VliionSus.FILU, ss="Vnui onol fil issin", ) filsiz = vnuifil.s().ssiz if filsiz < 1000: un Vliionsul( inionn="vnuionol", sus=VliionSus.WNIN, ss="Vnui onol fil ss inopl", ={"filsiz": filsiz}, ) un Vliionsul( inionn="vnuionol", sus=VliionSus.SUSS, ss="Vnui onol inion vli", ={"filsiz": filsiz}, ) xp xpion s : un Vliionsul( inionn="vnuionol", sus=VliionSus.FILU, ss=f"Vnui onol vliion fil: {}", oils=s(), ) syn f vliuylssifi(slf) -> Vliionsul: """Vli uy lssifi inion""" y: lssififil = slf.wospph / "uynsbllssifi.py" if no lssififil.xiss(): un Vliionsul( inionn="uylssifi", sus=VliionSus.FILU, ss="uy lssifi fil issin", ) filsiz = lssififil.s().ssiz if filsiz < 1000: un Vliionsul( inionn="uylssifi", sus=VliionSus.WNIN, ss="uy lssifi ss inopl", ={"filsiz": filsiz}, ) un Vliionsul( inionn="uylssifi", sus=VliionSus.SUSS, ss="uy lssifi inion vli", ={"filsiz": filsiz}, ) xp xpion s : un Vliionsul( inionn="uylssifi", sus=VliionSus.FILU, ss=f"uy lssifi vliion fil: {}", oils=s(), ) syn f vliplpi(slf) -> Vliionsul: """Vli zu pl PI inion""" y: # h fo pl-l onfiuion onfifil = slf.wospph / "zuonfi.py" if no onfifil.xiss(): un Vliionsul( inionn="plpi", sus=VliionSus.WNIN, ss="pl onfiuion no foun", ) un Vliionsul( inionn="plpi", sus=VliionSus.SUSS, ss="pl PI inion onfiu", ) xp xpion s : un Vliionsul( inionn="plpi", sus=VliionSus.FILU, ss=f"pl PI vliion fil: {}", oils=s(), ) f vlipfononio(slf) -> Vliionsul: """Vli pfon onio inion""" y: oniofil = slf.wospph / "pfononio.py" if no oniofil.xiss(): un Vliionsul( inionn="pfononio", sus=VliionSus.FILU, ss="Pfon onio fil issin", ) un Vliionsul( inionn="pfononio", sus=VliionSus.SUSS, ss="Pfon onio inion vli", ) xp xpion s : un Vliionsul( inionn="pfononio", sus=VliionSus.FILU, ss=f"Pfon onio vliion fil: {}", oils=s(), ) f vlipionfi(slf) -> Vliionsul: """Vli PI onfiuion inion""" y: pifil = slf.wospph / "pionfi.py" if no pifil.xiss(): un Vliionsul( inionn="pionfi", sus=VliionSus.FILU, ss="PI onfiuion fil issin", ) un Vliionsul( inionn="pionfi", sus=VliionSus.SUSS, ss="PI onfiuion inion vli", ) xp xpion s : un Vliionsul( inionn="pionfi", sus=VliionSus.FILU, ss=f"PI onfi vliion fil: {}", oils=s(), ) f vliphysion(slf) -> Vliionsul: """Vli PhysioN  ss""" y: i = slf.wospph / "bi" if no i.xiss(): un Vliionsul( inionn="physion", sus=VliionSus.WNIN, ss="BI  ioy no foun", ={"ioyxiss": Fls}, ) # h fo  fils fils = lis(i.lob("*")) if no fils: un Vliionsul( inionn="physion", sus=VliionSus.WNIN, ss="No  fils foun in BI ioy", ={"filsoun": 0}, ) un Vliionsul( inionn="physion", sus=VliionSus.SUSS, ss="PhysioN  ss vli", ={"filsoun": ln(fils)}, ) xp xpion s : un Vliionsul( inionn="physion", sus=VliionSus.FILU, ss=f"PhysioN  vliion fil: {}", oils=s(), ) f nvliionsuy(slf) -> i[s, ny]: """n vliion suy sisis""" olvliions = ln(slf.vliionsuls) sussful = su( 1 fo  in slf.vliionsuls if .sus == VliionSus.SUSS ) fil = su( 1 fo  in slf.vliionsuls if .sus == VliionSus.FILU ) wnins = su( 1 fo  in slf.vliionsuls if .sus == VliionSus.WNIN ) sipp = su( 1 fo  in slf.vliionsuls if .sus == VliionSus.SIPP ) # lul v spons i sponsis = [ .sponsi fo  in slf.vliionsuls if .sponsi is no Non ] vsponsi = ( su(sponsis) / ln(sponsis) if sponsis ls 0 ) # Ovll hlh so (0-100) hlhso = 0 if olvliions > 0: suss = sussful / olvliions hlhso = suss * 100 # Pnly fo filus filupnly = (fil / olvliions) * 20 hlhso = x(0, hlhso - filupnly) un { "olvliions": olvliions, "sussful": sussful, "fil": fil, "wnins": wnins, "sipp": sipp, "suss": ( oun(sussful / olvliions * 100, 1) if olvliions > 0 ls 0 ), "vsponsi": oun(vsponsi, 3), "hlhso": oun(hlhso, 1), "ovllsus": ( "hlhy" if hlhso >= 80 ls "" if hlhso >= 60 ls "iil" ), } f nonions(slf) -> Lis[s]: """n pioiiz onions bs on vliion suls""" onions = [] filvliions = [  fo  in slf.vliionsuls if .sus == VliionSus.FILU ] wninvliions = [  fo  in slf.vliionsuls if .sus == VliionSus.WNIN ] if filvliions: onions.ppn(" IIL INION ISSUS:") fo filu in filvliions[:5]: onions.ppn( f" • {filu.inionn}: {filu.ss}" ) if filu.oils: onions.ppn(f" → {filu.oils}") if wninvliions: onions.ppn("\n ️ INION WNINS:") fo wnin in wninvliions[:5]: onions.ppn( f" • {wnin.inionn}: {wnin.ss}" ) onions.xn( [ "\n NL ONIONS:", " • nsu ll zu nils  poply onfiu", " • Vify nwo onniviy fo lou svis", " • h fil pissions fo  ss", " • Up pnnis o ls sbl vsions", " • onio inion hlh in pouion", " • Ipln y loi fo nsin filus", ] ) un onions f suloi(slf, sul: Vliionsul) -> i[s, ny]: """onv vliion sul o iiony""" un { "inionn": sul.inionn, "sus": sul.sus.vlu, "ss": sul.ss, "sponsi": sul.sponsi, "oils": sul.oils, "": sul., "isp": sul.isp.isofo(), } f xpovliionpo(slf, filph: s) -> bool: """xpo vliion suls o JSON fil""" y: if no slf.vliionsuls: lo.wnin("No vliion suls o xpo") un Fls po = synio.un(slf.vlillinions()) wih opn(filph, "w") s f: json.up(po, f, inn=2, ful=s) lo.info(f" Vliion po xpo o {filph}") un u xp xpion s : lo.o(f" Fil o xpo vliion po: {}") un Fls # Foy funion fo sy insniion f inionvlio(wospph: Opionl[s] = Non): """ Foy funion o  n inion vlio s: wospph: Ph o wosp ioy uns: onfiu InionVlio insn """ un InionVlio(wospph) # on-lin inf f in(): """in LI funion fo inion vliion""" ipo ps ps = ps.unPs( sipion="L.I.F.. Plfo Inion Vlio" ) ps.un( "--wosp", "-w", ful=Non, hlp="Wosp ioy ph (ful: un ioy)", ) ps.un( "--oupu", "-o", ful="inionvliionpo.json", hlp="Oupu fil fo vliion po", ) ps.un( "--vbos", "-v", ion="sou", hlp="nbl vbos loin" ) s = ps.pss() if s.vbos: loin.Lo().sLvl(loin.BU) pin(" L.I.F.. Plfo - Inion Vlio") pin("=" * 60) #  vlio vlio = inionvlio(s.wosp) # un vliion pin(" unnin ophnsiv inion vliion...") po = synio.un(vlio.vlillinions()) if "o" in po: pin(f" Vliion fil: {po['o']}") un 1 # isply suy suy = po["suy"] pin("\nVLIION SUY:") pin(f" ol Vliions: {suy['olvliions']}") pin(f" Sussful: {suy['sussful']}") pin(f" Fil: {suy['fil']}") pin(f" Wnins: {suy['wnins']}") pin(f" Suss : {suy['suss']}%") pin(f" Hlh So: {suy['hlhso']}/100") pin(f" Ovll Sus: {suy['ovllsus'].upp()}") # xpo po if vlio.xpovliionpo(s.oupu): pin(f"\n po xpo o: {s.oupu}") ls: pin("\n Fil o xpo po") # xi wih ppopi o un 0 if suy["ovllsus"] == "hlhy" ls 1 if n == "in": ipo sys sys.xi(in())