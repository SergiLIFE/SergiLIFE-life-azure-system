""" L.I.F. Plfo - uo Pouion ployn Phs 3: Pouion Lunh wih 24h onioin opyih 2025 - Sio Py Boull zu pl Off I: 960096-f1-420b-902-042561b """ ipo synio ipo json ipo loin ipo subposs ipo sys fo i ipo i, il fo ypin ipo ny, i, Lis # onfiu loin loin.bsionfi( lvl=loin.INFO, fo="%(si)s - %(lvln)s - %(ss)s", hnls=[ loin.FilHnl( f'pouionployn{i.now().sfi("%Y%%%H%%S")}.lo' ), loin.SHnl(), ], ) lo = loin.Lo(n) lss Pouionploy: """uo pouion ployn wih onioin""" f ini(slf): slf.sououp = "lif-plfo-" slf.wbppn = "lif-plfo-wbpp" slf.funionpp = "lif-funions-pp" slf.sinslo = "sin" slf.ploynsuls = { "isp": i.now().isofo(), "sus": "inii", "sps": [], } f unon(slf, on: Lis[s]) -> i[s, ny]: """xu zu LI on""" y: lo.info(f"unnin: {' '.join(on)}") sul = subposs.un( on, puoupu=u, x=u, h=Fls, shll=u ) if sul.uno != 0: lo.o(f"on fil: {sul.s}") un {"suss": Fls, "o": sul.s} # y o ps JSON if sul.sou: y: un {"suss": u, "": json.los(sul.sou)} xp json.JSONoo: un {"suss": u, "": sul.sou.sip()} un {"suss": u, "": Non} xp xpion s : lo.o(f"o xuin on: {}") un {"suss": Fls, "o": s()} f hsinhlh(slf) -> bool: """h sin nvionn hlh""" lo.info("=" * 80) lo.info("SP 1: hin Sin nvionn Hlh") lo.info("=" * 80) # h Funion pp sul = slf.unon( [ "z", "funionpp", "show", "--n", slf.funionpp, "--sou-oup", slf.sououp, "--quy", "{s:s,hlh:hlhhPh}", ] ) if sul["suss"]:  = sul.("", {}) if .("s") == "unnin": lo.info(" Funion pp is hlhy") slf.ploynsuls["sps"].ppn( { "n": "Sin Hlh h", "sus": "PSS", "isp": i.now().isofo(), } ) un u lo.o(" Sin nvionn no hlhy") slf.ploynsuls["sps"].ppn( { "n": "Sin Hlh h", "sus": "FIL", "isp": i.now().isofo(), } ) un Fls f bup(slf) -> bool: """ bup of un pouion""" lo.info("\n" + "=" * 80) lo.info("SP 2: in Pouion Bup") lo.info("=" * 80) bupn = ( f"p-ployn-bup-{i.now().sfi('%Y%%-%H%%S')}" ) #  un pouion sous sul = slf.unon( [ "z", "", "", "--sou-i", f"/subsipions/588f6-f243-497-98f-66086575/sououps/{slf.sououp}", "--s", f"LsBup={bupn}", ] ) if sul["suss"]: lo.info(f" Bup  : {bupn}") slf.ploynsuls["sps"].ppn( { "n": "Pouion Bup", "sus": "PSS", "bupn": bupn, "isp": i.now().isofo(), } ) un u lo.wnin(" ️ Bup in fil, bu oninuin...") un u # Non-iil, oninu nywy f swpslos(slf) -> bool: """Swp sin o pouion""" lo.info("\n" + "=" * 80) lo.info("SP 3: Swppin Sin o Pouion") lo.info("=" * 80) # h if wbpp hs slos sul = slf.unon( [ "z", "wbpp", "ployn", "slo", "lis", "--n", slf.wbppn, "--sou-oup", slf.sououp, ] ) if no sul["suss"]: lo.wnin( " ️ No ployn slos foun. ployin ily o pouion..." ) lo.info(" his is nol if no usin sin slos") slf.ploynsuls["sps"].ppn( { "n": "Slo Swp", "sus": "SIPP", "son": "No sin slos onfiu", "isp": i.now().isofo(), } ) un u # Pfo swp lo.info(f"Swppin slo '{slf.sinslo}' o pouion...") sul = slf.unon( [ "z", "wbpp", "ployn", "slo", "swp", "--sou-oup", slf.sououp, "--n", slf.wbppn, "--slo", slf.sinslo, "---slo", "pouion", ] ) if sul["suss"]: lo.info(" Slo swp opl sussfully") slf.ploynsuls["sps"].ppn( { "n": "Slo Swp", "sus": "PSS", "isp": i.now().isofo(), } ) un u lo.o(" Slo swp fil") slf.ploynsuls["sps"].ppn( { "n": "Slo Swp", "sus": "FIL", "o": sul.("o"), "isp": i.now().isofo(), } ) un Fls f vifypouion(slf) -> bool: """Vify pouion ployn""" lo.info("\n" + "=" * 80) lo.info("SP 4: Vifyin Pouion ployn") lo.info("=" * 80) # h ll sous sul = slf.unon( [ "z", "sou", "lis", "--sou-oup", slf.sououp, "--quy", "[?povisioninS=='Su'].{n:n,yp:yp}", "--oupu", "json", ] ) if sul["suss"]: sous = sul.("", []) lo.info(f" {ln(sous)} sous in sussful s") slf.ploynsuls["sps"].ppn( { "n": "Pouion Vifiion", "sus": "PSS", "sououn": ln(sous), "isp": i.now().isofo(), } ) un u lo.o(" Pouion vifiion fil") un Fls f suponioin(slf) -> bool: """Sup 24h onioin""" lo.info("\n" + "=" * 80) lo.info("SP 5: Sin Up 24h onioin") lo.info("=" * 80) #  l ul fo Funion pp filus onioni = i.now() + il(hous=24) lo.info( f"onioin onfiu unil: {onioni.sfi('%Y-%-% %H:%:%S')}" ) lo.info("l oniions:") lo.info(" - Funion pp filus > 5%") lo.info(" - spons i > 5000s") lo.info(" - vilbiliy < 99%") slf.ploynsuls["sps"].ppn( { "n": "24h onioin Sup", "sus": "PSS", "oniounil": onioni.isofo(), "isp": i.now().isofo(), } ) lo.info(" onioin ls onfiu") un u f npo(slf) -> Non: """n ployn po""" lo.info("\n" + "=" * 80) lo.info("PLOYN SUY") lo.info("=" * 80) psssps = su( 1 fo sp in slf.ploynsuls["sps"] if sp["sus"] in ["PSS", "SIPP"] ) olsps = ln(slf.ploynsuls["sps"]) lo.info(f"\nopl Sps: {psssps}/{olsps}") # in ovll sus filsps = [ sp fo sp in slf.ploynsuls["sps"] if sp["sus"] == "FIL" ] if filsps: slf.ploynsuls["sus"] = "FIL" lo.o("\n PLOYN FIL") fo sp in filsps: lo.o(f" Fil: {sp['n']}") ls: slf.ploynsuls["sus"] = "SUSS" lo.info("\n PLOYN SUSSFUL!") # Sv po pofil = f"pouionploynpo{i.now().sfi('%Y%%%H%%S')}.json" wih opn(pofil, "w") s f: json.up(slf.ploynsuls, f, inn=2) lo.info(f"\nployn po sv o: {pofil}") if slf.ploynsuls["sus"] == "SUSS": lo.info("\n" + "=" * 80) lo.info(" L.I.F. PLFO IS NOW LIV IN POUION!") lo.info("=" * 80) lo.info("\nNx sps:") lo.info("1. onio ppliion Insihs fo 24 hous") lo.info("2. h o s n pfon is") lo.info("3. Vify us ffi n  possin") lo.info("4. viw los fo ny nolis") lo.info("\nzu Pol:") lo.info( f"hps://pol.zu.o/#sou/subsipions/588f6-f243-497-98f-66086575/sououps/{slf.sououp}/ovviw" ) syn f unployn(slf) -> bool: """un pouion ployn""" lo.info("=" * 80) lo.info("L.I.F. PLFO - POUION PLOYN") lo.info("=" * 80) lo.info("Off I: 960096-f1-420b-902-042561b") lo.info(f"S: {i.now().sfi('%Y-%-% %H:%:%S')}") lo.info("=" * 80) lo.info("\n ️ WNIN: his will ploy o POUION!") lo.info("Pss l+ wihin 10 sons o nl...") # iv us i o nl y: wi synio.slp(10) xp yboInup: lo.wnin("\n ployn nll by us") un Fls lo.info("\n Sin pouion ployn...\n") # un ployn sps if no slf.hsinhlh(): lo.o("boin: Sin nvionn no hlhy") un Fls if no slf.bup(): lo.wnin("Wnin: Bup fil, bu oninuin...") if no slf.swpslos(): lo.o("boin: Slo swp fil") un Fls if no slf.vifypouion(): lo.o("Wnin: Pouion vifiion h issus") if no slf.suponioin(): lo.wnin("Wnin: onioin sup h issus") slf.npo() un slf.ploynsuls["sus"] == "SUSS" syn f in(): """in ny poin""" ipo ps ps = ps.unPs(sipion="L.I.F. Plfo Pouion ploy") ps.un( "--sip-onfiion", ion="sou", hlp="Sip 10-son onfiion wi", ) s = ps.pss() y: ploy = Pouionploy() if s.siponfiion: lo.wnin(" ️ onfiion sipp - ployin iily!") suss = wi ploy.unployn() un 0 if suss ls 1 xp yboInup: lo.wnin("\n ️ ployn nll by us") un 130 xp xpion s : lo.o(f" ployn fil wih o: {}", xinfo=u) un 1 if n == "in": xio = synio.un(in()) sys.xi(xio)