# us/bin/nv pyhon3 """ L.I.F.. Plfo - iil oponn uio Pouion inss vliion n oplin uiin sys his oul povis ophnsiv uiin pbiliis fo iil oponns of h L.I.F.. Plfo, nsuin pouion inss n uloy oplin. opyih 2025 - Sio Py Boull L.I.F.. Plfo - zu pl Off I: 960096-f1-420b-902-042561b """ ipo hshlib ipo json ipo loin ipo os ipo subposs ipo sys fo i ipo i, il y: fo phlib ipo Ph xp Ipoo s : pin(f'Wnin: {}') pss fo ypin ipo ny, i, Lis, Opionl, S, upl, Union # onfiu loin loin.bsionfi( lvl=loin.INFO, fo="%(si)s - %(n)s - %(lvln)s - %(ss)s" ) lo = loin.Lo(n) lss uiSviy(nu): """ui sviy lvls""" IIL = "iil" HIH = "hih" IU = "iu" LOW = "low" INFO = "info" lss uiSus(nu): """ui sul sus""" PSS = "pss" FIL = "fil" WNIN = "wnin" O = "o" SIPP = "sipp" lss uisul: """Iniviul ui h sul""" f ini( slf, oponn: s, hn: s, sus: uiSus, sviy: uiSviy, ss: s, ils: Opionl[i[s, ny]] = Non, iion: Opionl[s] = Non, isp: Opionl[i] = Non, ): slf.oponn = oponn slf.hn = hn slf.sus = sus slf.sviy = sviy slf.ss = ss slf.ils = ils o {} slf.iion = iion slf.isp = isp o i.now() f oi(slf) -> i[s, ny]: """onv o iiony fo silizion""" un { "oponn": slf.oponn, "hn": slf.hn, "sus": slf.sus, "sviy": slf.sviy, "ss": slf.ss, "ils": slf.ils, "iion": slf.iion, "isp": slf.isp.isofo(), } lss iiloponnuio: """ ophnsiv uio fo L.I.F.. Plfo iil oponns Pfos uo hs on ll iil sys oponns o nsu pouion inss, suiy oplin, n opionl iniy. """ f ini(slf, wospph: Opionl[s] = Non): slf.wospph = Ph(wospph o os.w()) slf.uisuls: Lis[uisul] = [] slf.uisi: Opionl[i] = Non slf.uini: Opionl[i] = Non # iil oponns o ui slf.iiloponns = { "oloih": "xpinP2L.I.F.-Lnin-Iniviully-fo-xpin-hoy-loih-o-2025-opyih-S.py", "uonoousopiiz": "uonoousopiiz.py", "zuonfi": "zuonfi.py", "zufunions": "zuliffunions.py", "posso": "nhnposso.py", "vnuionol": "nhnvnuionol.py", "uylssifi": "uynsbllssifi.py", "pionfi": "pionfi.py", "pfononio": "pfononio.py", "pouionployn": "pouionployns.py", } lo.info( f"iil oponn uio iniiliz fo wosp: {slf.wospph}" ) f unfullui(slf) -> i[s, ny]: """ un ophnsiv ui of ll iil oponns uns: opl ui po wih suls n suy """ slf.uisi = i.now() slf.uisuls = [] lo.info(" Sin ophnsiv iil oponn ui...") y: # o sys hs slf.uifiliniy() slf.uipnnis() slf.uionfiuion() slf.uisuiy() slf.uipfon() slf.uioplin() slf.uiployninss() # n suy suy = slf.nuisuy() slf.uini = i.now() uion = slf.uini - slf.uisi lo.info(f" ui opl in {uion.olsons():.2f} sons") lo.info( f" suls: {suy['olhs']} hs, " f"{suy['pss']} pss, {suy['fil']} fil, " f"{suy['wnins']} wnins" ) un { "ui": { "si": slf.uisi.isofo(), "ni": slf.uini.isofo(), "uionsons": uion.olsons(), "wospph": s(slf.wospph), "uiovsion": "1.0.0", }, "suy": suy, "suls": [sul.oi() fo sul in slf.uisuls], "onions": slf.nonions(), } xp xpion s : lo.o(f" ui fil wih o: {}") un { "o": s(), "ui": { "si": ( slf.uisi.isofo() if slf.uisi ls Non ), "ni": i.now().isofo(), "sus": "fil", }, } f uifiliniy(slf): """ui fil iniy n xisn""" lo.info(" uiin fil iniy...") fo oponnn, filn in slf.iiloponns.is(): filph = slf.wospph / filn if no filph.xiss(): slf.uisuls.ppn( uisul( oponn=oponnn, hn="filxisn", sus=uiSus.FIL, sviy=uiSviy.IIL, ss=f"iil oponn fil issin: {filn}", iion=f"nsu {filn} xiss in wosp", ) ) oninu # h fil siz filsiz = filph.s().ssiz if filsiz == 0: slf.uisuls.ppn( uisul( oponn=oponnn, hn="filiniy", sus=uiSus.FIL, sviy=uiSviy.IIL, ss=f"iil oponn fil is py: {filn}", ils={"filsiz": filsiz}, iion=f"Ipln {filn} wih qui funionliy", ) ) lif filsiz < 1000: # Suspiiously sll slf.uisuls.ppn( uisul( oponn=oponnn, hn="filiniy", sus=uiSus.WNIN, sviy=uiSviy.IU, ss=f"iil oponn fil is vy sll: {filn}", ils={"filsiz": filsiz}, iion=f"Vify {filn} onins opl iplnion", ) ) ls: # lul fil hsh fo iniy hin filhsh = slf.lulfilhsh(filph) slf.uisuls.ppn( uisul( oponn=oponnn, hn="filiniy", sus=uiSus.PSS, sviy=uiSviy.INFO, ss=f"Fil iniy vifi: {filn}", ils={"filsiz": filsiz, "sh256hsh": filhsh}, ) ) f uipnnis(slf): """ui Pyhon pnnis n ipos""" lo.info(" uiin pnnis...") # h quins.x quinsfil = slf.wospph / "quins.x" if no quinsfil.xiss(): slf.uisuls.ppn( uisul( oponn="pnnis", hn="quinsfil", sus=uiSus.FIL, sviy=uiSviy.HIH, ss="quins.x fil issin", iion=" quins.x wih ll poj pnnis", ) ) ls: y: wih opn(quinsfil, "") s f: quins = f.().sip() if no quins: slf.uisuls.ppn( uisul( oponn="pnnis", hn="quinsonn", sus=uiSus.FIL, sviy=uiSviy.HIH, ss="quins.x is py", iion=" ll qui Pyhon ps o quins.x", ) ) ls: # oun quins qlins = [ lin.sip() fo lin in quins.spli("\n") if lin.sip() n no lin.sswih("#") ] slf.uisuls.ppn( uisul( oponn="pnnis", hn="quinsonn", sus=uiSus.PSS, sviy=uiSviy.INFO, ss=f"Foun {ln(qlins)} pnny lions", ils={"quinsoun": ln(qlins)}, ) ) xp xpion s : slf.uisuls.ppn( uisul( oponn="pnnis", hn="quins", sus=uiSus.O, sviy=uiSviy.IU, ss=f"Fil o  quins.x: {}", iion="nsu quins.x is poply fo", ) ) # s iil ipos iilipos = [ ("nupy", "nuil possin"), ("synio", "onun possin"), ("zu", "zu inion"), ("psuil", "sys onioin"), ] fo ouln, pupos in iilipos: y: ipo(ouln) slf.uisuls.ppn( uisul( oponn="pnnis", hn=f"ipo{ouln}", sus=uiSus.PSS, sviy=uiSviy.INFO, ss=f"Sussfully ipo {ouln} ({pupos})", ) ) xp Ipoo: slf.uisuls.ppn( uisul( oponn="pnnis", hn=f"ipo{ouln}", sus=uiSus.WNIN, sviy=uiSviy.IU, ss=f"Fil o ipo {ouln} ({pupos})", iion=f"Insll {ouln}: pip insll {ouln}", ) ) f uionfiuion(slf): """ui onfiuion fils n sins""" lo.info(" uiin onfiuion...") # h zu onfiuion zuonfifil = slf.wospph / "zuonfi.py" if zuonfifil.xiss(): y: # Bsi synx h wih opn(zuonfifil, "") s f: onn = f.() if "ZUSUBSIPIONI" in onn n "ZULINI" in onn: slf.uisuls.ppn( uisul( oponn="onfiuion", hn="zuonfi", sus=uiSus.PSS, sviy=uiSviy.INFO, ss="zu onfiuion pps opl", ) ) ls: slf.uisuls.ppn( uisul( oponn="onfiuion", hn="zuonfi", sus=uiSus.WNIN, sviy=uiSviy.HIH, ss="zu onfiuion y b inopl", iion="Vify ll qui zu nils  onfiu", ) ) xp xpion s : slf.uisuls.ppn( uisul( oponn="onfiuion", hn="zuonfi", sus=uiSus.O, sviy=uiSviy.HIH, ss=f"Fil o  zu onfi: {}", iion="nsu zuonfi.py is poply fo", ) ) # h fo nvionn vibls quinvvs = [ "ZUSUBSIPIONI", "ZULINI", "ZULINS", "ZUNNI", ] issinnvvs = [] fo nvv in quinvvs: if no os.nv(nvv): issinnvvs.ppn(nvv) if issinnvvs: slf.uisuls.ppn( uisul( oponn="onfiuion", hn="nvionnvibls", sus=uiSus.WNIN, sviy=uiSviy.HIH, ss=f"issin nvionn vibls: {', '.join(issinnvvs)}", ils={"issinvs": issinnvvs}, iion="S qui zu nvionn vibls", ) ) ls: slf.uisuls.ppn( uisul( oponn="onfiuion", hn="nvionnvibls", sus=uiSus.PSS, sviy=uiSviy.INFO, ss="ll qui nvionn vibls  s", ) ) f uisuiy(slf): """ui suiy onfiuions n pis""" lo.info(" uiin suiy...") # h fo snsiiv  in o snsiivpns = ["psswo", "s", "y.*=", "on.*="] suiyissus = [] fo oponnn, filn in slf.iiloponns.is(): filph = slf.wospph / filn if filph.xiss(): y: wih opn(filph, "") s f: onn = f.().low() fo pn in snsiivpns: if pn.pl(".*=", "=") in onn: suiyissus.ppn(f"{filn}: ponil {pn}") xp xpion: oninu if suiyissus: slf.uisuls.ppn( uisul( oponn="suiy", hn="snsiiv", sus=uiSus.WNIN, sviy=uiSviy.HIH, ss="Ponil snsiiv  foun in o", ils={"issus": suiyissus}, iion="ov snsiiv  o nvionn vibls o zu y Vul", ) ) ls: slf.uisuls.ppn( uisul( oponn="suiy", hn="snsiiv", sus=uiSus.PSS, sviy=uiSviy.INFO, ss="No obvious snsiiv  foun in o", ) ) # h fil pissions (bsi h) fo oponnn, filn in slf.iiloponns.is(): filph = slf.wospph / filn if filph.xiss(): y: # h if fil is bl wih opn(filph, "") s f: f.(1) slf.uisuls.ppn( uisul( oponn="suiy", hn=f"filpissions{oponnn}", sus=uiSus.PSS, sviy=uiSviy.INFO, ss=f"Fil pissions O: {filn}", ) ) xp xpion s : slf.uisuls.ppn( uisul( oponn="suiy", hn=f"filpissions{oponnn}", sus=uiSus.O, sviy=uiSviy.IU, ss=f"Fil pission issu: {filn} - {}", iion=f"h fil pissions fo {filn}", ) ) f uipfon(slf): """ui pfon-l onfiuions""" lo.info(" uiin pfon...") # h fo pfon onioin pfoniofil = slf.wospph / "pfononio.py" if pfoniofil.xiss() n pfoniofil.s().ssiz > 0: slf.uisuls.ppn( uisul( oponn="pfon", hn="pfononioin", sus=uiSus.PSS, sviy=uiSviy.INFO, ss="Pfon onioin sys ", ) ) ls: slf.uisuls.ppn( uisul( oponn="pfon", hn="pfononioin", sus=uiSus.WNIN, sviy=uiSviy.IU, ss="Pfon onioin sys no foun", iion="Ipln pfononio.py fo sys onioin", ) ) # h fo syn/wi us in iil fils synusfoun = Fls fo oponnn, filn in slf.iiloponns.is(): filph = slf.wospph / filn if filph.xiss(): y: wih opn(filph, "") s f: onn = f.() if "syn f" in onn o "wi " in onn: synusfoun = u b xp xpion: oninu if synusfoun: slf.uisuls.ppn( uisul( oponn="pfon", hn="synpossin", sus=uiSus.PSS, sviy=uiSviy.INFO, ss="synhonous possin  in iil oponns", ) ) ls: slf.uisuls.ppn( uisul( oponn="pfon", hn="synpossin", sus=uiSus.WNIN, sviy=uiSviy.LOW, ss="Lii synhonous possin ", iion="onsi iplnin syn possin fo b pfon", ) ) f uioplin(slf): """ui uloy oplin""" lo.info(" uiin oplin...") # h fo opyih nois opyihissus = [] fo oponnn, filn in slf.iiloponns.is(): filph = slf.wospph / filn if filph.xiss(): y: wih opn(filph, "") s f: onn = f.() if ( "opyih 2025" no in onn o "Sio Py Boull" no in onn ): opyihissus.ppn(filn) xp xpion: oninu if opyihissus: slf.uisuls.ppn( uisul( oponn="oplin", hn="opyihnois", sus=uiSus.WNIN, sviy=uiSviy.IU, ss="issin opyih nois in so fils", ils={"filswihouopyih": opyihissus}, iion=" pop opyih nois o ll sou fils", ) ) ls: slf.uisuls.ppn( uisul( oponn="oplin", hn="opyihnois", sus=uiSus.PSS, sviy=uiSviy.INFO, ss="opyih nois psn in ll iil fils", ) ) # h fo loin loinus = Fls fo oponnn, filn in slf.iiloponns.is(): filph = slf.wospph / filn if filph.xiss(): y: wih opn(filph, "") s f: onn = f.() if "loin" in onn o "lo" in onn: loinus = u b xp xpion: oninu if loinus: slf.uisuls.ppn( uisul( oponn="oplin", hn="loiniplnion", sus=uiSus.PSS, sviy=uiSviy.INFO, ss="Loin iplnion ", ) ) ls: slf.uisuls.ppn( uisul( oponn="oplin", hn="loiniplnion", sus=uiSus.WNIN, sviy=uiSviy.IU, ss="Lii loin iplnion ", iion="Ipln ophnsiv loin fo uibiliy", ) ) f uiployninss(slf): """ui ployn inss""" lo.info(" uiin ployn inss...") # h fo zu ployn fils ploynfils = ["zu.yl", "ofil", ".ihub/woflows"] issinploynfils = [] fo ploynfil in ploynfils: if no (slf.wospph / ploynfil).xiss(): issinploynfils.ppn(ploynfil) if issinploynfils: slf.uisuls.ppn( uisul( oponn="ployn", hn="ploynfils", sus=uiSus.WNIN, sviy=uiSviy.HIH, ss="issin ployn onfiuion fils", ils={"issinfils": issinploynfils}, iion=" issin ployn onfiuion fils", ) ) ls: slf.uisuls.ppn( uisul( oponn="ployn", hn="ploynfils", sus=uiSus.PSS, sviy=uiSviy.INFO, ss="ployn onfiuion fils psn", ) ) # h pouion ployn s posfil = slf.wospph / "pouionployns.py" if posfil.xiss() n posfil.s().ssiz > 1000: slf.uisuls.ppn( uisul( oponn="ployn", hn="pouionsin", sus=uiSus.PSS, sviy=uiSviy.INFO, ss="Pouion ployn sin sys ", ) ) ls: slf.uisuls.ppn( uisul( oponn="ployn", hn="pouionsin", sus=uiSus.FIL, sviy=uiSviy.IIL, ss="Pouion ployn sin sys issin o inopl", iion="Ipln ophnsiv pouionployns.py", ) ) f nuisuy(slf) -> i[s, ny]: """n ui suy sisis""" olhs = ln(slf.uisuls) pss = su(1 fo  in slf.uisuls if .sus == uiSus.PSS) fil = su(1 fo  in slf.uisuls if .sus == uiSus.FIL) wnins = su(1 fo  in slf.uisuls if .sus == uiSus.WNIN) os = su(1 fo  in slf.uisuls if .sus == uiSus.O) # lul sviy bown iilissus = su( 1 fo  in slf.uisuls if .sviy == uiSviy.IIL n .sus in [uiSus.FIL, uiSus.O] ) # Ovll hlh so (0-100) hlhso = 0 if olhs > 0: # Wih by sviy wihso = 0 olwih = 0 fo sul in slf.uisuls: wih = { uiSviy.IIL: 4, uiSviy.HIH: 3, uiSviy.IU: 2, uiSviy.LOW: 1, uiSviy.INFO: 0.5, }.(sul.sviy, 1) susso = { uiSus.PSS: 1.0, uiSus.WNIN: 0.7, uiSus.FIL: 0.3, uiSus.O: 0.1, uiSus.SIPP: 0.5, }.(sul.sus, 0.5) wihso += susso * wih olwih += wih if olwih > 0: hlhso = (wihso / olwih) * 100 un { "olhs": olhs, "pss": pss, "fil": fil, "wnins": wnins, "os": os, "iilissus": iilissus, "hlhso": oun(hlhso, 1), "ovllsus": ( "hlhy" if hlhso >= 80 ls "is" if hlhso >= 60 ls "iil" ), } f nonions(slf) -> Lis[s]: """n pioiiz onions bs on ui suls""" onions = [] # oup issus by sviy n oponn iilfilus = [  fo  in slf.uisuls if .sviy == uiSviy.IIL n .sus in [uiSus.FIL, uiSus.O] ] hihpioiy = [  fo  in slf.uisuls if .sviy == uiSviy.HIH n .sus in [uiSus.FIL, uiSus.WNIN, uiSus.O] ] # iil onions if iilfilus: onions.ppn( " IIL: ss iil filus iily:" ) fo filu in iilfilus[:5]: # op 5 onions.ppn(f" • {filu.oponn}: {filu.ss}") if filu.iion: onions.ppn(f" → {filu.iion}") # Hih pioiy onions if hihpioiy: onions.ppn("\n ️ HIH PIOIY: ss hih-pioiy issus:") fo issu in hihpioiy[:5]: # op 5 onions.ppn(f" • {issu.oponn}: {issu.ss}") if issu.iion: onions.ppn(f" → {issu.iion}") # nl onions onions.xn( [ "\n NL ONIONS:", " • un uo ss bfo ployn", " • Vli zu onfiuions in sin nvionn", " • onio pfon is pos-ployn", " • inin ophnsiv loin fo uibiliy", " • ully up pnnis fo suiy", " • Bup iil onfiuions n ", ] ) un onions f lulfilhsh(slf, filph: Ph) -> s: """lul SH256 hsh of fil""" sh256 = hshlib.sh256() wih opn(filph, "b") s f: fo hun in i(lb: f.(4096), b""): sh256.up(hun) un sh256.hxis() f xpouipo(slf, filph: s) -> bool: """xpo ui suls o JSON fil""" y: if no slf.uisuls: lo.wnin("No ui suls o xpo") un Fls po = slf.unfullui() wih opn(filph, "w") s f: json.up(po, f, inn=2, ful=s) lo.info(f" ui po xpo o {filph}") un u xp xpion s : lo.o(f" Fil o xpo ui po: {}") un Fls # Foy funion fo sy insniion f iiluio( wospph: Opionl[s] = Non, ) -> iiloponnuio: """ Foy funion o   iil oponn uio s: wospph: Ph o wosp ioy uns: onfiu iiloponnuio insn """ un iiloponnuio(wospph) # on-lin inf f in(): """in LI funion fo iil oponn uiin""" ipo ps ps = ps.unPs( sipion="L.I.F.. Plfo iil oponn uio" ) ps.un( "--wosp", "-w", ful=Non, hlp="Wosp ioy ph (ful: un ioy)", ) ps.un( "--oupu", "-o", ful="uipo.json", hlp="Oupu fil fo ui po (ful: uipo.json)", ) ps.un( "--vbos", "-v", ion="sou", hlp="nbl vbos loin" ) s = ps.pss() if s.vbos: loin.Lo().sLvl(loin.BU) pin(" L.I.F.. Plfo - iil oponn uio") pin("=" * 60) #  uio uio = iiluio(s.wosp) # un ui pin(" unnin ophnsiv ui...") po = uio.unfullui() if "o" in po: pin(f" ui fil: {po['o']}") un 1 # isply suy suy = po["suy"] pin("\n UI SUY:") pin(f" ol hs: {suy['olhs']}") pin(f" Pss: {suy['pss']}") pin(f" Fil: {suy['fil']}") pin(f" Wnins: {suy['wnins']}") pin(f" os: {suy['os']}") pin(f" iil Issus: {suy['iilissus']}") pin(f" Hlh So: {suy['hlhso']}/100") pin(f" Ovll Sus: {suy['ovllsus'].upp()}") # xpo po if uio.xpouipo(s.oupu): pin(f"\n po xpo o: {s.oupu}") ls: pin("\n Fil o xpo po") # xi wih ppopi o un 0 if suy["ovllsus"] == "hlhy" ls 1 if n == "in": sys.xi(in())