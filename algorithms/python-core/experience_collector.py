# us/bin/nv pyhon3 """ L.I.F. Plfo - xpin ollion Piplin onvs plfo vns ino L.I.F. xpins fo oninuous lnin his oul iplns Phs 2 of h L.I.F. inion, in  piplin h pus plfo inions n onvs h ino lnin xpins fo uonoous opiizion n slf-ipovn. opyih 2025 - Sio Py Boull L.I.F.. Plfo - zu pl Off I: 960096-f1-420b-902-042561b """ ipo synio ipo json ipo loin fo lsss ipo si, lss fo i ipo i, il fo ypin ipo ny, i, Lis fo uui ipo uui4 # onfiu loin loin.bsionfi( lvl=loin.INFO, fo="%(si)s - %(lvln)s - %(ss)s" ) lo = loin.Lo(n) @lss lss xpinis: """is h fin h hisis of n xpin""" novly: flo # 0.0 o 1.0 - How nw/uniqu his xpin is oionlslin: flo # 0.0 o 1.0 - oionl ip/ipon oplxiy: flo # 0.0 o 1.0 - oniiv oplxiy qui lvn: flo # 0.0 o 1.0 - lvn o un ols ouovlu: flo = 0.5 # Suss/filu vlu of h xpin f lullninponil(slf) -> flo: """lul h lnin ponil of his xpin""" # Hih novly, oplxiy, n lvn ins lnin ponil # oionl slin s s  ulipli bsponil = ( slf.novly * 0.4 + slf.oplxiy * 0.3 + slf.lvn * 0.3 ) oionlulipli = 1.0 + (slf.oionlslin * 0.5) un in(bsponil * oionlulipli, 1.0) @lss lss Iniviulis: """Iniviul hisis h ff lnin""" oniivsyl: s # "iv", "fliv", "pi", "hois" uiosiy: flo # 0.0 o 1.0 - iv o xplo n ln silin: flo # 0.0 o 1.0 - biliy o ov fo filus opnnss: flo # 0.0 o 1.0 - Willinnss o y nw ppohs lninpfn: s = "xpinil" # Lnin syl pfn @lss lss LninOuo: """sul of possin n xpin houh L.I.F. loih""" xpini: s lninin: flo # oun ln fo his xpin onfin: flo # onfin in h lnin ppliopiizions: Lis[s] pfonipovn: flo isp: i nxions: Lis[s] lss LIFniy: """L.I.F. lnin niy wih uonoous opiizion pbiliis""" f ini(slf, is: Iniviulis): slf.is = is slf.xpinbuff: Lis[i[s, ny]] = [] slf.shbuff: Lis[i[s, ny]] = [] slf.nowlbs: i[s, ny] = {} slf.pfonhisoy: Lis[flo] = [] slf.isiv = Fls syn f possxpin(slf, xpin: xpinis) -> LninOuo: """Poss n xpin n n lnin ouos""" xpini = s(uui4()) y: # lul bs lnin in bs on xpin is n iniviul is lninponil = xpin.lullninponil() # Iniviul is oify lnin ffivnss iulipli = slf.luliulipli(xpin) # Finl lnin in lninin = lninponil * iulipli # in opiizions o pply bs on xpin yp opiizions = slf.inopiizions(xpin) # lul xp pfon ipovn pfonipovn = ( lninin * 0.15 ) # onsviv ipovn si # n nx ions bs on lnin nxions = slf.nnxions(xpin, lninin) #  lnin ouo ouo = LninOuo( xpini=xpini, lninin=lninin, onfin=in(lninin * slf.is.uiosiy, 1.0), ppliopiizions=opiizions, pfonipovn=pfonipovn, isp=i.now(), nxions=nxions, ) # So in nowl bs slf.nowlbs[xpini] = { "xpin": si(xpin), "ouo": si(ouo), "onx": {"possini": i.now()}, } lo.info( f" xpin poss: {lninin:.4f} lnin in, " f"{ln(opiizions)} opiizions inifi" ) un ouo xp xpion s : lo.o(f" xpin possin o: {}") un LninOuo( xpini=xpini, lninin=0.0, onfin=0.0, ppliopiizions=[], pfonipovn=0.0, isp=i.now(), nxions=["ypossin"], ) f luliulipli(slf, xpin: xpinis) -> flo: """lul how iniviul is ff lnin fo his xpin""" # uiosiy nhns lnin fo novl xpins uiosiybonus = slf.is.uiosiy * xpin.novly * 0.3 # silin hlps ln fo filus (low ouovlu) silinbonus = 0.0 if xpin.ouovlu < 0.5: silinbonus = ( slf.is.silin * (1.0 - xpin.ouovlu) * 0.2 ) # Opnnss nhns lnin fo oplx xpins opnnssbonus = slf.is.opnnss * xpin.oplxiy * 0.2 bsulipli = 0.7 # Bs lnin ffivnss un bsulipli + uiosiybonus + silinbonus + opnnssbonus f inopiizions(slf, xpin: xpinis) -> Lis[s]: """in wh opiizions o pply bs on xpin""" opiizions = [] # Hih novly suss n fo xploion if xpin.novly > 0.7: opiizions.xn(["xplolnivs", "xpnnowlbs"]) # Hih oplxiy suss n fo siplifiion if xpin.oplxiy > 0.8: opiizions.xn(["siplifyposs", "binosps"]) # Low ouo vlu (filu) suss n fo ipovn if xpin.ouovlu < 0.4: opiizions.xn(["nlyzfilupns", "jussy"]) # Hih lvn suss pioiy opiizion if xpin.lvn > 0.8: opiizions.xn(["pioiizlnin", "iippliion"]) un opiizions f nnxions( slf, xpin: xpinis, lninin: flo ) -> Lis[s]: """n nx ions bs on lnin ouo""" ions = [] # Hih lnin in suss onfin o  if lninin > 0.7: ions.xn(["pplyiily", "shlnin"]) # iu lnin in suss n fo vliion lif lninin > 0.4: ions.xn(["vlilnin", "ulppliion"]) # Low lnin in suss n fo o xpin ls: ions.xn(["ho", "slnivppoh"]) # lwys inlu flion fo hih-slin xpins if xpin.oionlslin > 0.6: ions.ppn("flonxpin") un ions syn f opiizlnin(slf) -> i[s, ny]: """Opiiz lnin sy bs on uul xpins""" lo.info(" Opiizin lnin sy...") y: if ln(slf.shbuff) < 10: lo.info( " Insuffiin  fo opiizion, oninuin ollion" ) un { "sus": "ollin", "buffsiz": ln(slf.shbuff), } # nlyz pns in sh buff pns = slf.nlyzxpinpns() # Opiiz lnin ps bs on pns opiizions = slf.opiizps(pns) # l poss xpins fo buff possoun = ln(slf.shbuff) slf.shbuff.l() lo.info( f" Lnin opiizion opl: {possoun} xpins poss" ) un { "sus": "opiiz", "possxpins": possoun, "pnsfoun": ln(pns), "opiizionsppli": ln(opiizions), "opiizionils": opiizions, } xp xpion s : lo.o(f" Lnin opiizion o: {}") un {"sus": "o", "o": s()} f nlyzxpinpns(slf) -> i[s, ny]: """nlyz pns in uul xpins""" pns = { "hihlninonxs": [], "lowlninonxs": [], "sussfulopiizions": [], "filopiizions": [], } fo ny in slf.shbuff: in = ny.("in", 0) xp = ny.("xp", {}) # Inify hih-lnin onxs if in > 0.7: pns["hihlninonxs"].ppn( { "novly": xp.("novly", 0), "oplxiy": xp.("oplxiy", 0), "lvn": xp.("lvn", 0), } ) # Inify low-lnin onxs lif in < 0.3: pns["lowlninonxs"].ppn( { "novly": xp.("novly", 0), "oplxiy": xp.("oplxiy", 0), "lvn": xp.("lvn", 0), } ) un pns f opiizps(slf, pns: i[s, ny]) -> Lis[s]: """Opiiz lnin ps bs on inifi pns""" opiizions = [] # If hih-lnin onxs show onsisn pns, nhn h if pns["hihlninonxs"]: vnovly = su( x["novly"] fo x in pns["hihlninonxs"] ) / ln(pns["hihlninonxs"]) if vnovly > 0.7: opiizions.ppn("insnovlysin") # If low-lnin onxs show pobls, ss h if pns["lowlninonxs"]: voplxiy = su( x["oplxiy"] fo x in pns["lowlninonxs"] ) / ln(pns["lowlninonxs"]) if voplxiy > 0.8: opiizions.ppn("uoplxiyhshol") un opiizions f s(slf) -> Non: """S h L.I.F. niy boun posss""" slf.isiv = u lo.info(" L.I.F. niy iv fo oninuous lnin") f sop(slf) -> Non: """Sop h L.I.F. niy boun posss""" slf.isiv = Fls lo.info(" L.I.F. niy iv") lss Plfoxpinollo: """olls plfo inions n onvs h o L.I.F. xpins""" f ini(slf, ososlin=Non): slf.ososlin = ososlin slf.lifniy = LIFniy( is=Iniviulis( oniivsyl="iv", uiosiy=0.8, silin=0.7, opnnss=0.9, lninpfn="xpinil", ) ) slf.xpinquu: Lis[i[s, ny]] = [] slf.possinss = { "olxpins": 0, "sussfulpossin": 0, "lnininol": 0.0, "opiizionsppli": 0, } syn f sollion(slf) -> Non: """S h xpin ollion n possin piplin""" slf.lifniy.s() lo.info(" Plfo xpin ollo s") # S boun possin possinss = [ synio.s(slf.possxpinquu()), synio.s(slf.pioiopiizion()), synio.s(slf.ispoin()), ] y: wi synio.h(*possinss) xp xpion s : lo.o(f" xpin ollion o: {}") finlly: slf.lifniy.sop() syn f ollplfoinion(slf, vn: i[s, ny]) -> Non: """onv plfo vns ino L.I.F. xpins n poss h""" y: # lul xpin hisis bs on vn  xpin = xpinis( novly=slf.lulnovly(vn), oionlslin=slf.lulslin(vn), oplxiy=slf.luloplxiy(vn), lvn=1.0 if vn.("iil", Fls) ls 0.5, ouovlu=vn.("suss", 0.5), ) # Poss houh L.I.F. niy lninouo = wi slf.lifniy.possxpin(xpin) # So in sh buff fo bh opiizion slf.lifniy.shbuff.ppn( { "xp": si(xpin), "in": lninouo.lninin, "isp": i.now(), "onx": vn, "ouo": si(lninouo), } ) # Up possin sisis slf.possinss["olxpins"] += 1 slf.possinss["sussfulpossin"] += 1 slf.possinss[ "lnininol" ] += lninouo.lninin slf.possinss["opiizionsppli"] += ln( lninouo.ppliopiizions ) # i ii opiizion if buff is full if ln(slf.lifniy.shbuff) >= 100: opiizionsul = wi slf.lifniy.opiizlnin() lo.info( f" Bh opiizion i: {opiizionsul.('sus')}" ) # pply ii opiizions if onfin is hih if lninouo.onfin > 0.8: wi slf.pplyiiopiizions(lninouo) lo.bu( f" xpin oll: {lninouo.lninin:.4f} in, " f"{lninouo.onfin:.2%} onfin" ) xp xpion s : lo.o(f" Plfo inion ollion o: {}") syn f ollbinion(slf, b: i[s, ny]) -> Non: """Spiliz ollion fo b inions""" y: # nhn b vn  wih UI-spifi onx nhn = { **b, "inionyp": "uib", "iil": b.("isofunionliy", Fls), "suss": b.("sponsis", 200) < 150, # Suss if < 150s "oplxiyinios": { "jvsipos": b.("jsos", 0), "sslofilus": b.("ssfilus", 0), "usis": b.("youn", 0), }, } wi slf.ollplfoinion(nhn) xp xpion s : lo.o(f" b inion ollion o: {}") syn f ollpossinvn(slf, : i[s, ny]) -> Non: """Spiliz ollion fo  possin vns""" y: # nhn  vn  wih nul possin onx nhn = { **, "inionyp": "nulpossin", "iil": u, #  possin is lwys iil "suss": .("uy", 0.95), "oplxiyinios": { "lnys": .("possinlnys", 1.0), "sinlquliy": .("sinlquliy", 0.9), "hnnloun": .("hnnls", 64), }, } wi slf.ollplfoinion(nhn) xp xpion s : lo.o(f"  possin vn ollion o: {}") f lulnovly(slf, vn: i[s, ny]) -> flo: """lul novly so fo n vn""" y: # Bs novly on vn yp fquny n hisis inionyp = vn.("inionyp", "unnown") # Nw inion yps hv hih novly nownyps = [ "uib", "nulpossin", "usinpu", "sysspons", ] if inionyp no in nownyps: un 0.9 # o oniions ins novly if vn.("oou", Fls): un 0.7 # Unusul pfon is ins novly sponsi = vn.("sponsis", 100) if sponsi > 500: # Unusully slow un 0.6 un 0.3 # ful low novly fo ouin inions xp xpion s : lo.o(f" Novly lulion o: {}") un 0.2 # onsviv ful f lulslin(slf, vn: i[s, ny]) -> flo: """lul oionl slin (ipon) of n vn""" y: slin = 0.3 # Bs slin # iil vns hv hih slin if vn.("iil", Fls): slin += 0.4 # Filus ins slin if vn.("suss", 1.0) < 0.5: slin += 0.3 # Us ip inss slin ffuss = vn.("ffuss", 0) if ffuss > 0: slin += in(ffuss / 100.0, 0.3) # x 0.3 bonus un in(slin, 1.0) xp xpion s : lo.o(f" Slin lulion o: {}") un 0.3 # onsviv ful f luloplxiy(slf, vn: i[s, ny]) -> flo: """lul oniiv oplxiy of n vn""" y: oplxiy = 0.2 # Bs oplxiy # ulipl siulnous filus ins oplxiy oplxiyinios = vn.("oplxiyinios", {}) if isinsn(oplxiyinios, i): ooun = su( v fo , v in oplxiyinios.is() if "o" in .low() n isinsn(v, (in, flo)) ) oplxiy += in(ooun / 10.0, 0.4) # x 0.4 fo os # Hih lny inss oplxiy lny = oplxiyinios.("lnys", 0) if lny > 100: oplxiy += in( (lny - 100) / 1000.0, 0.3 ) # x 0.3 fo lny # uli-oponn vns ins oplxiy if vn.("oponnsff", 1) > 1: oplxiy += 0.2 un in(oplxiy, 1.0) xp xpion s : lo.o(f" oplxiy lulion o: {}") un 0.4 # onsviv ful syn f possxpinquu(slf) -> Non: """Boun possin of xpin quu""" lo.info(" xpin quu posso s") whil u: y: if slf.xpinquu: # Poss quu xpins whil slf.xpinquu: vn = slf.xpinquu.pop(0) wi slf.ollplfoinion(vn) # Bif pus bfo nx possin yl wi synio.slp(1.0) xp xpion s : lo.o(f" xpin quu possin o: {}") wi synio.slp(5.0) syn f pioiopiizion(slf) -> Non: """Pioi opiizion i""" lo.info(" Pioi opiizion shul s") whil u: y: # i opiizion vy 10 inus wi synio.slp(600) if ln(slf.lifniy.shbuff) >= 10: opiizionsul = wi slf.lifniy.opiizlnin() lo.info( f" Pioi opiizion: {opiizionsul.('sus')}" ) xp xpion s : lo.o(f" Pioi opiizion o: {}") wi synio.slp(60) syn f ispoin(slf) -> Non: """Pioi is poin""" lo.info(" is poin shul s") whil u: y: # po is vy 5 inus wi synio.slp(300) vlninin = slf.possinss["lnininol"] / x( slf.possinss["sussfulpossin"], 1 ) lo.info( f" xpin ollion is: " f"{slf.possinss['olxpins']} ol, " f"{vlninin:.4f} v in, " f"{slf.possinss['opiizionsppli']} opiizions" ) xp xpion s : lo.o(f" is poin o: {}") wi synio.slp(60) syn f pplyiiopiizions(slf, ouo: LninOuo) -> Non: """pply ii opiizions fo hih-onfin lnin""" y: fo opiizion in ouo.ppliopiizions: if opiizion == "pplyiily": # Ii ppliion of ln opiizion lo.info(f" Ii opiizion ppli: {opiizion}") lif opiizion == "pioiizlnin": # Ins pioiy of siil fuu xpins lo.info(f" Lnin pioiizion up: {opiizion}") xp xpion s : lo.o(f" Ii opiizion o: {}") syn f in(): """in funion o ons xpin ollion""" lo.info(" L.I.F. Plfo xpin ollo o") # Iniiliz xpin ollo ollo = Plfoxpinollo() # Siul plfo vns fo onsion syn f siulplfovns(): """Siul vious plfo vns""" vns = [ { "inionyp": "uib", "bn": "shbo", "sponsis": 125, "suss": 0.98, "ussisfion": 0.92, }, { "inionyp": "nulpossin", "uy": 0.9825, "possinlnys": 0.37, "sinlquliy": 0.94, "iil": u, }, { "inionyp": "uib", "bn": "nlyis", "sponsis": 850, # Slow spons "jsos": 2, "youn": 1, "suss": 0.65, }, ] fo vn in vns: wi ollo.ollplfoinion(vn) wi synio.slp(1) y: # S ollion in boun ollions = synio.s(ollo.sollion()) # Siul vns wi siulplfovns() # L i un fo  bi wi synio.slp(10) xp yboInup: lo.info(" onsion sopp by us") finlly: lo.info(" xpin ollion onsion opl") if n == "in": synio.un(in())