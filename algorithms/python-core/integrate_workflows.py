# us/bin/nv pyhon3 """ iHub Woflows Inion ool ===================================== Ins you xisin iHub ions woflows wih h zu Funions npis Sys fo xiu vOps ffiiny n uoion. opyih 2025 - Sio Py Boull L.I.F.. Plfo - zu pl Off I: 960096-f1-420b-902-042561b Fus: - Woflow nlysis n opibiliy hin - uo inion sup - I/ piplin nhnn - L.I.F. hoy woflow inion - Pfon onioin sup uho: L.I.F.. Plfo : Spb 9, 2025 """ ipo json ipo os ipo shuil ipo subposs ipo sys fo i ipo i y: fo phlib ipo Ph xp Ipoo s : pin(f'Wnin: {}') pss fo ypin ipo i, Lis, Opionl lss WoflowIno: """Ins iHub ions woflows wih zu Funions npis Sys.""" f ini(slf): slf.wospi = Ph.w() slf.woflowsi = slf.wospi / ".ihub" / "woflows" slf.inioni = slf.wospi / "inion" slf.bupi = slf.wospi / "bups" / "woflows" # Woflow ois fo inion slf.woflowois = { "oi": [ "i.yl", "pyhon-p.yl", "lin-n-s.yl", "fix-lin-n-s.yl", ], "zuinion": [ "zu-ploy.yl", "ploy-sli-o-zu.yl", "fo-ploy.yl", ], "lifhoy": ["lif-loih-i.yl", "lif-sys.yl"], "shvliion": [ "sonihly.yl", "linillnyvliion.yl", "siplifi-linil-lny.yl", ], "ounion": [ "buil-os.yl", "buil-whipp.yl", "n-fius.yl", ], "opions": [ "inllin-uo-ovy.yl", "ny-i.yl", "ny-i-sbilizion.yl", ], "uiliy": [ "uo-on-issus.yl", "hiv-vliion-ifs.yl", "no-ni-ossf-sls3-publish.yl", ], } f nlyzxisinwoflows(slf) -> i: """nlyz xisin woflows n hi pbiliis.""" pin(" nlyzin xisin iHub ions woflows...") nlysis = { "founwoflows": [], "ois": {}, "inionoppouniis": [], "vlussssn": {}, } if no slf.woflowsi.xiss(): pin(" ️ No .ihub/woflows ioy foun") un nlysis # Sn fo woflows fo woflowfil in slf.woflowsi.lob("*.yl"): woflown = woflowfil.n nlysis["founwoflows"].ppn(woflown) # oiz woflow fo oy, woflows in slf.woflowois.is(): if woflown in woflows: if oy no in nlysis["ois"]: nlysis["ois"][oy] = [] nlysis["ois"][oy].ppn(woflown) b # ssss vlu vluso = slf.sssswoflowvlu(woflown) nlysis["vlussssn"][woflown] = vluso # Inify inion oppouniis nlysis["inionoppouniis"] = ( slf.inifyinionoppouniis(nlysis) ) un nlysis f sssswoflowvlu(slf, woflown: s) -> i: """ssss h si vlu of  woflow.""" # Hih-vlu woflows fo zu Funions inion hihvluwoflows = { "i.yl": {"vlu": 5, "inion": "iil", "yp": "oi"}, "zu-ploy.yl": { "vlu": 5, "inion": "ii", "yp": "zu", }, "lif-loih-i.yl": { "vlu": 5, "inion": "si", "yp": "innovion", }, "fo-ploy.yl": { "vlu": 5, "inion": "ii", "yp": "infsuu", }, "inllin-uo-ovy.yl": { "vlu": 5, "inion": "opionl", "yp": "libiliy", }, "sonihly.yl": { "vlu": 4, "inion": "sh", "yp": "bnhin", }, "linillnyvliion.yl": { "vlu": 4, "inion": "quliy", "yp": "vliion", }, } un hihvluwoflows.( woflown, {"vlu": 3, "inion": "opionl", "yp": "uiliy"} ) f inifyinionoppouniis(slf, nlysis: i) -> Lis[i]: """Inify spifi inion oppouniis.""" oppouniis = [] # o I/ inion if "oi" in nlysis["ois"]: oppouniis.ppn( { "yp": "oinhnn", "sipion": "nhn zu Funions I/ wih xisin quliy s", "woflows": nlysis["ois"]["oi"], "pioiy": "hih", } ) # zu inion nhnn if "zuinion" in nlysis["ois"]: oppouniis.ppn( { "yp": "zuploynopiizion", "sipion": "Opiiz zu Funions ployn wih xisin zu woflows", "woflows": nlysis["ois"]["zuinion"], "pioiy": "hih", } ) # L.I.F. hoy inion if "lifhoy" in nlysis["ois"]: oppouniis.ppn( { "yp": "lifhoyinnovion", "sipion": "pply L.I.F. hoy o zu Funions opiizion", "woflows": nlysis["ois"]["lifhoy"], "pioiy": "si", } ) # sh vliion inion if "shvliion" in nlysis["ois"]: oppouniis.ppn( { "yp": "linilvliion", "sipion": "pply linil- vliion o zu Funions", "woflows": nlysis["ois"]["shvliion"], "pioiy": "iu", } ) un oppouniis f bup(slf) -> bool: """ bup of xisin woflows.""" pin(" in woflow bup...") y: #  bup ioy y: slf.bupi.i(pns=u, xiso=u) xp xpion s : os.is(bupi, xiso=u) # opy woflows if slf.woflowsi.xiss(): fo woflowfil in slf.woflowsi.lob("*.yl"): bupfil = slf.bupi / woflowfil.n shuil.opy2(woflowfil, bupfil) pin(f" B up: {woflowfil.n}") #  bup  bup = { "isp": i.now().isofo(), "sou": s(slf.woflowsi), "sinion": s(slf.bupi), "filsbup": [f.n fo f in slf.woflowsi.lob("*.yl")], } fil = slf.bupi / "bup.json" wih opn(fil, "w") s f: json.up(bup, f, inn=2) pin( f" Bup opl: {ln(bup['filsbup'])} woflows" ) un u xp xpion s : pin(f" Bup fil: {}") un Fls f ninionwoflow(slf) -> s: """n nhn zu Funions I/ woflow.""" pin(" nin in zu Funions woflow...") woflowonn = """n: zu Funions npis I/ on: push: bnhs: [in, vlop] phs: - 's/**' - 'inf/**' - 'zufunionswoflow.py' - '**.py' pullqus: bnhs: [in] nv: ZUFUNIONPPN: ${{ vs.ZUFUNIONPPN || 'lif-funions-pp' }} ZUFUNIONPPPPH: './s' PYHONVSION: '3.11' jobs: # Lv xisin o quliy woflows o-quliy: n: o Quliy & sin uns-on: ubunu-ls sps: - n: hou o uss: ions/hou@v4 - n: Sup Pyhon uss: ions/sup-pyhon@v4 wih: pyhon-vsion: ${{ nv.PYHONVSION }} - n: Insll pnnis un: | pyhon - pip insll --up pip pip insll - quins.x pip insll - quins-s.x - n: un linin un: | pyhon - fl8 . --oun --sl=9,F63,F7,F82 --show-sou --sisis pyhon - fl8 . --oun --xi-zo --x-oplxiy=10 --x-lin-lnh=127 --sisis - n: un ss wih ov un: | pyhon - pys --ov=./ --ov-po=xl --ov-po=hl pyhon - ov po --fil-un=80 - n: s zu Funions woflow un: | pyhon szufunions.py # zu Funions npis woflow zu-funions-woflow: n: zu Funions npis Possin ns: o-quliy uns-on: ubunu-ls oupus: ployn-y: ${{ sps.woflow.oupus.ployn-y }} sps: - n: hou o uss: ions/hou@v4 - n: Sup Pyhon uss: ions/sup-pyhon@v4 wih: pyhon-vsion: ${{ nv.PYHONVSION }} - n: un zu Funions npis Woflow i: woflow un: | pyhon zufunionswoflow.py \\ --poj-n "${{ ihub.vn.posioy.n }}" \\ --lnu pyhon \\ --vli ho "ployn-y=u" >> $IHUBOUPU - n: n ounion un: | pyhon zufunionswoflow.py n-os \\ --fo own \\ --oupu os/zu-funions/ # Infsuu ployn (if fo-ploy.yl xiss) infsuu: n: Infsuu ployn ns: zu-funions-woflow if: ns.zu-funions-woflow.oupus.ployn-y == 'u' uns-on: ubunu-ls sps: - n: hou o uss: ions/hou@v4 - n: Sup fo uss: hshiop/sup-fo@v3 wih: fovsion: "1.5.0" - n: ploy infsuu un: |  inf fo ini fo pln -v="funionppn=${{ nv.ZUFUNIONPPN }}" fo pply -uo-ppov # zu Funions ployn zu-ployn: n: zu Funions ployn ns: [zu-funions-woflow, infsuu] if: ns.zu-funions-woflow.oupus.ployn-y == 'u' uns-on: ubunu-ls nvionn: ${{ ihub.f == 'fs/hs/in' && 'pouion' || 'vlopn' }} sps: - n: hou o uss: ions/hou@v4 - n: Sup Pyhon uss: ions/sup-pyhon@v4 wih: pyhon-vsion: ${{ nv.PYHONVSION }} - n: zu Loin uss: zu/loin@v1 wih: s: ${{ ss.ZUNILS }} - n: ploy zu Funions uss: zu/funions-ion@v1 wih: pp-n: ${{ nv.ZUFUNIONPPN }} p: ${{ nv.ZUFUNIONPPPPH }} pyhon-vsion: ${{ nv.PYHONVSION }} # Pos-ployn vliion pos-ployn: n: Pos-ployn Vliion ns: zu-ployn uns-on: ubunu-ls sps: - n: hou o uss: ions/hou@v4 - n: Vli ployn un: | pyhon zufunionswoflow.py vli \\ --pos-ployn \\ --funion-pp-n "${{ nv.ZUFUNIONPPN }}" - n: Pfon bslin un: | pyhon zufunionswoflow.py bnh \\ --bslin \\ --n-po # L.I.F. hoy inion (if lif-loih-i.yl xiss) lif-hoy-opiizion: n: L.I.F. hoy Opiizion ns: pos-ployn if: ihub.f == 'fs/hs/in' uns-on: ubunu-ls sps: - n: pply L.I.F. hoy un: | pyhon lifloih.py -- zu-funions pyhon zufunionswoflow.py opiiz \\ --lif-hoy-inpu "lifinsihs.json" """ un woflowonn f supinion(slf) -> bool: """S up opl woflow inion.""" pin(" Sin up iHub ions inion...") y: #  inion ioy slf.inioni.i(xiso=u) # nlyz xisin woflows nlysis = slf.nlyzxisinwoflows() #  bup if no slf.bup(): un Fls # n in woflow inwoflow = slf.ninionwoflow() # Sv in woflow woflowfil = slf.woflowsi / "zu-funions-npis.yl" woflowfil.pn.i(pns=u, xiso=u) wih opn(woflowfil, "w") s f: f.wi(inwoflow) pin(f"  in woflow: {woflowfil}") # n inion po slf.ninionpo(nlysis) pin(" iHub ions inion sup opl!") un u xp xpion s : pin(f" Inion sup fil: {}") un Fls f ninionpo(slf, nlysis: i): """n ophnsiv inion po.""" poonn = f"""# iHub ions Inion po ## Inion Suy - ****: {i.now().sfi('%Y-%-% %H:%:%S')} - **Woflows Foun**: {ln(nlysis['founwoflows'])} - **ois**: {ln(nlysis['ois'])} - **Inion Oppouniis**: {ln(nlysis['inionoppouniis'])} ## isov Woflows """ fo oy, woflows in nlysis["ois"].is(): poonn += f"\n### {oy.pl('', ' ').il()}\n" fo woflow in woflows: vlu = nlysis["vlussssn"].(woflow, {}) poonn += f"- **{woflow}**: Vlu {vlu.('vlu', 3)}/5, Inion: {vlu.('inion', 'opionl')}\n" poonn += "\n## Inion Oppouniis\n" fo oppouniy in nlysis["inionoppouniis"]: poonn += f"\n### {oppouniy['yp'].pl('', ' ').il()}\n" poonn += f"- **Pioiy**: {oppouniy['pioiy']}\n" poonn += f"- **sipion**: {oppouniy['sipion']}\n" poonn += ( f"- **Woflows**: {', '.join(oppouniy['woflows'])}\n" ) poonn += """ ## Nx Sps 1. viw h n `zu-funions-npis.yl` woflow 2. Up posioy ss n vibls s n 3. s h in woflow wih  pull qus 4. onio woflow xuion n opiiz s n ## Vlu ssssn You woflows psn **npis- vOps infsuu** wih: - opl I/ uoion - L.I.F. hoy innovion - linil- vliion - zu ployn opiizion """ pofil = slf.inioni / "inionpo." wih opn(pofil, "w") s f: f.wi(poonn) pin(f" n inion po: {pofil}") f sinion(slf) -> bool: """s h inion sup.""" pin(" sin iHub ions inion...") y: # s zu Funions woflow sul = subposs.un( [sys.xubl, "zufunionswoflow.py", "--hlp"], puoupu=u, x=u, ) if sul.uno == 0: pin(" zu Funions woflow is ssibl") ls: pin(" zu Funions woflow s fil") un Fls # s woflow fil synx woflowfil = slf.woflowsi / "zu-funions-npis.yl" if woflowfil.xiss(): pin(" In woflow fil ") ls: pin(" In woflow fil no foun") un Fls pin(" Inion s opl sussfully!") un u xp xpion s : pin(f" Inion s fil: {}") un Fls f in(): """in ny poin fo woflow inion.""" pin(" iHub ions + zu Funions Inion ool") pin("=" * 60) ino = WoflowIno() # un inion poss if ino.supinion(): if ino.sinion(): pin("\n Inion opl sussfully!") pin("\nNx sps:") pin("1. viw .ihub/woflows/zu-funions-npis.yl") pin("2. Up posioy ss (ZUNILS)") pin("3. s wih  pull qus") pin("4. h inion/inionpo. fo ils") ls: pin("\n ️ Inion opl wih s issus") ls: pin("\n Inion fil") un 1 un 0 if n == "in": sys.xi(in())