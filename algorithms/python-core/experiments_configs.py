# us/bin/nv pyhon3 """ L.I.F. Plfo - xpins onfiuion Sys vn xpinl sin, xuion, n nlysis fwo opyih 2025 - Sio Py Boull L.I.F.. Plfo - zu pl Off I: 960096-f1-420b-902-042561b """ ipo json ipo loin ipo uui fo i ipo i, il y: fo phlib ipo Ph xp Ipoo s : pin(f'Wnin: {}') pss fo ypin ipo ny, i, Opionl ipo nupy s np # onfiu loin loin.bsionfi(lvl=loin.INFO) lo = loin.Lo(n) lss xpinonfi: """onfiuion n fo L.I.F. plfo xpins""" f ini(slf, xpinsph: s = Non): slf.xpinsph = ( Ph(xpinsph) if xpinsph ls Ph.w() / "xpins" ) y: slf.xpinsph.i(xiso=u) xp xpion s : os.is(xpinsph, xiso=u) slf.ivxpins = slf.loivxpins() f loivxpins(slf) -> i[s, ny]: """Lo iv xpins fo so""" xpinsfil = slf.xpinsph / "ivxpins.json" if xpinsfil.xiss(): wih opn(xpinsfil, "") s f: un json.lo(f) un {} f svivxpins(slf): """Sv iv xpins o so""" xpinsfil = slf.xpinsph / "ivxpins.json" wih opn(xpinsfil, "w") s f: json.up(slf.ivxpins, f, inn=2) f xpin( slf, n: s, xpinyp: s, ps: i[s, ny], uionhous: in = 24, ) -> s: """ nw xpin onfiuion""" xpini = s(uui.uui4()) xpinonfi = { "i": xpini, "n": n, "yp": xpinyp, "sus": "", "": i.now().isofo(), "uionhous": uionhous, "ps": ps, "is": [], "suls": {}, "": {"o": "L.I.F. Plfo", "vsion": "1.0.0"}, } #  xpin-spifi onfiuions if xpinyp == "lnin": xpinonfi.up(slf.xpinonfi()) lif xpinyp == "vnuiopiizion": xpinonfi.up(slf.vnuixpinonfi()) lif xpinyp == "qunupossin": xpinonfi.up(slf.qunuxpinonfi()) lif xpinyp == "pivlnin": xpinonfi.up(slf.pivlninonfi()) lif xpinyp == "nulpnnlysis": xpinonfi.up(slf.nulpnonfi()) slf.ivxpins[xpini] = xpinonfi slf.svivxpins() #  xpin ioy xpi = slf.xpinsph / xpini xpi.i(xiso=u) # Sv il onfi wih opn(xpi / "onfi.json", "w") s f: json.up(xpinonfi, f, inn=2) lo.info(f"xpin : {n} ({xpini})") un xpini f xpinonfi(slf) -> i[s, ny]: """  xpin spifi onfiuion""" un { "sins": { "splin": 256, # Hz "hnnls": 64, "fn": "v", "filsins": { "hihpss": 0.1, # Hz "lowpss": 100, # Hz "noh": 50, # Hz }, "ifhshol": 100, # iovols }, "lninps": { "sssionuion": 30, # inus "pion": 0.01, "fbly": 500, # s "iffiulyjusn": "yni", }, "sussii": { "inuy": 0.85, "xsponsi": 2000, # s "sinlquliy": 0.90, }, } f vnuixpinonfi(slf) -> i[s, ny]: """ Vnui s xpin onfiuion""" un { "vnuisins": { "oun": 3, "flown": [100, 200], # L/in "pssun": [1.5, 3.0], # b "opiizion": "ffiiny", "plllpossin": u, }, "opiizionps": { "loih": "insn", "lnin": 0.001, "xiions": 1000, "onvnhshol": 0.001, }, "sussii": { "inffiiny": 0.95, "sbiliyfo": 0.98, "houhpu": 400, # L/in }, } f qunuxpinonfi(slf) -> i[s, ny]: """ qunu possin xpin onfiuion""" un { "qunusins": { "qubioun": 16, "yps": ["X", "Y", "Z", "NO", "H"], "ohni": 100, # iosons "ooion": "sufo", "sunshos": 1024, }, "iuips": { "phlii": 20, "nnlnsy": "lin", "opiizionlvl": 3, "nspilion": "uoi", }, "sussii": { "infiliy": 0.99, "qunuvn": 2.0, "ohnnion": 0.95, }, } f pivlninonfi(slf) -> i[s, ny]: """ piv lnin xpin onfiuion""" un { "lninsins": { "loih": "infonlnin", "nwohiu": "nsfo", "hinlys": [512, 256, 128], "ivion": "lu", "opou": 0.2, }, "pionps": { "lnin": 0.001, "bhsiz": 32, "oysiz": 10000, "xploion": 0.1, "isounfo": 0.95, }, "sussii": { "onvni": 1000, # iions "finluy": 0.95, "sbiliyso": 0.90, }, } f nulpnonfi(slf) -> i[s, ny]: """ nul pn nlysis xpin onfiuion""" un { "pnsins": { "nlysiswinow": 1000, # s "fqunybns": { "l": [0.5, 4], "h": [4, 8], "lph": [8, 13], "b": [13, 30], "": [30, 100], }, "spilsoluion": 64, # hnnls "polsoluion": 4, # s }, "lssifiionps": { "fuxion": "wvl", "lssifi": "sv", "ossvliion": 5, "fuslion": "uulinfoion", }, "sussii": { "lssifiionuy": 0.92, "pnspifiiy": 0.88, "polpision": 0.85, }, } f sxpin(slf, xpini: s) -> bool: """S n xpin""" if xpini no in slf.ivxpins: lo.o(f"xpin {xpini} no foun") un Fls xpin = slf.ivxpins[xpini] xpin["sus"] = "unnin" xpin["s"] = i.now().isofo() # lul n i si = i.now() ni = si + il(hous=xpin["uionhous"]) xpin["sin"] = ni.isofo() slf.svivxpins() lo.info(f"xpin s: {xpin['n']}") un u f sopxpin(slf, xpini: s) -> bool: """Sop n xpin""" if xpini no in slf.ivxpins: lo.o(f"xpin {xpini} no foun") un Fls xpin = slf.ivxpins[xpini] xpin["sus"] = "sopp" xpin["sopp"] = i.now().isofo() slf.svivxpins() lo.info(f"xpin sopp: {xpin['n']}") un u f upxpinis(slf, xpini: s, is: i[s, ny]): """Up xpin is""" if xpini no in slf.ivxpins: lo.o(f"xpin {xpini} no foun") un Fls xpin = slf.ivxpins[xpini] iny = {"isp": i.now().isofo(), "is": is} xpin["is"].ppn(iny) slf.svivxpins() # Sv o xpin ioy xpi = slf.xpinsph / xpini isfil = xpi / "is.json" if isfil.xiss(): wih opn(isfil, "") s f: llis = json.lo(f) ls: llis = [] llis.ppn(iny) wih opn(isfil, "w") s f: json.up(llis, f, inn=2) un u f xpinsus(slf, xpini: s) -> Opionl[i[s, ny]]: """ xpin sus n poss""" if xpini no in slf.ivxpins: un Non xpin = slf.ivxpins[xpini] # lul poss poss = 0 if xpin["sus"] == "unnin" n "s" in xpin: si = i.foisofo(xpin["s"]) uni = i.now() uion = il(hous=xpin["uionhous"]) lps = uni - si poss = in( 100, (lps.olsons() / uion.olsons()) * 100 ) un { "i": xpini, "n": xpin["n"], "yp": xpin["yp"], "sus": xpin["sus"], "poss": poss, "isoun": ln(xpin["is"]), "": xpin[""], "s": xpin.("s"), "sin": xpin.("sin"), } f lisxpins(slf, sus: s = Non) -> lis: """Lis xpins, opionlly fil by sus""" xpins = [] fo xpi, xp in slf.ivxpins.is(): if sus is Non o xp.("sus") == sus: xpins.ppn(slf.xpinsus(xpi)) un so(xpins, y=lb x: x[""], vs=u) f nlyzxpinsuls(slf, xpini: s) -> i[s, ny]: """nlyz xpin suls n n insihs""" if xpini no in slf.ivxpins: un {"o": "xpin no foun"} xpin = slf.ivxpins[xpini] if no xpin["is"]: un {"o": "No is vilbl fo nlysis"} # x is  is = [ny["is"] fo ny in xpin["is"]] # Bsi sisil nlysis nlysis = { "xpini": xpini, "olsuns": ln(is), "nlysisisp": i.now().isofo(), "suy": {}, } # lul suy sisis fo nui is nuiis = {} fo is in is: fo y, vlu in is.is(): if isinsn(vlu, (in, flo)): if y no in nuiis: nuiis[y] = [] nuiis[y].ppn(vlu) fo in, vlus in nuiis.is(): if vlus: nlysis["suy"][in] = { "n": np.n(vlus), "s": np.s(vlus), "in": np.in(vlus), "x": np.x(vlus), "n": "insin" if vlus[-1] > vlus[0] ls "sin", } # h suss ii xpinyp = xpin["yp"] sussii = xpin.( f"{xpinyp.spli('')[0]}sins", {} ).("sussii", {}) if sussii n nuiis: nlysis["sussvluion"] = {} fo iin, hshol in sussii.is(): if iin in nuiis: lsvlu = nuiis[iin][-1] nlysis["sussvluion"][iin] = { "hshol": hshol, "unvlu": lsvlu, "sii": ( lsvlu >= hshol if isinsn(hshol, (in, flo)) ls Fls ), } un nlysis lss xpinunn: """uns n onios L.I.F. plfo xpins""" f ini(slf, onfi: xpinonfi): slf.onfi = onfi f unlninxpin(slf, xpini: s) -> i[s, ny]: """un  lnin xpin siulion""" xpin = slf.onfi.ivxpins.(xpini) if no xpin o xpin["yp"] != "lnin": un {"o": "Invli xpin fo  lnin"} # Siul  lnin xpin suls = [] fo sssion in n(10): # 10 lnin sssions # Siul possiv lnin uy = in(0.95, 0.60 + (sssion * 0.035) + np.no.nol(0, 0.02)) sponsi = x(800, 2000 - (sssion * 120) + np.no.nol(0, 50)) sinlquliy = in( 0.98, 0.85 + (sssion * 0.013) + np.no.nol(0, 0.01) ) sssionis = { "sssion": sssion + 1, "uy": oun(uy, 3), "sponsi": oun(sponsi, 1), "sinlquliy": oun(sinlquliy, 3), "lnin": oun(0.01 + (sssion * 0.001), 4), } suls.ppn(sssionis) # Up xpin is slf.onfi.upxpinis(xpini, sssionis) un { "xpinyp": "lnin", "sssionsopl": ln(suls), "finluy": suls[-1]["uy"], "ipovn": suls[-1]["uy"] - suls[0]["uy"], "suls": suls, } f unvnuiopiizionxpin(slf, xpini: s) -> i[s, ny]: """un Vnui s opiizion xpin""" xpin = slf.onfi.ivxpins.(xpini) if no xpin o xpin["yp"] != "vnuiopiizion": un {"o": "Invli xpin fo Vnui opiizion"} # Siul opiizion poss suls = [] bsffiiny = 0.85 fo iion in n(20): # 20 opiizion iions # Siul opiizion poss ffiiny = in( 0.98, bsffiiny + (iion * 0.006) + np.no.nol(0, 0.005) ) flow = 350 + (iion * 2.5) + np.no.nol(0, 5) pssu = 2.2 + np.no.nol(0, 0.1) iionis = { "iion": iion + 1, "ffiiny": oun(ffiiny, 4), "flow": oun(flow, 1), "pssu": oun(pssu, 2), "onvn": in(1.0, iion / 15), } suls.ppn(iionis) slf.onfi.upxpinis(xpini, iionis) un { "xpinyp": "vnuiopiizion", "iionsopl": ln(suls), "finlffiiny": suls[-1]["ffiiny"], "opiizionin": suls[-1]["ffiiny"] - suls[0]["ffiiny"], "suls": suls, } # xpl us n onsion if n == "in": pin(" L.I.F. Plfo - xpins onfiuion Sys") pin("=" * 60) # Iniiliz xpin sys onfi = xpinonfi() unn = xpinunn(onfi) #  spl xpins xpinyps = [ ( " Lnin Opiizion", "lnin", {"subjoun": 10, "lninpi": "piv"}, ), ( "Vnui s Pfon", "vnuiopiizion", {"ffiiny": 0.97, "xiions": 20}, ), ( "Qunu Possin nlysis", "qunupossin", {"qubioun": 16, "iuiph": 15}, ), ( "piv Lnin Suy", "pivlnin", {"nwosiz": "l", "s": "linil"}, ), ( "Nul Pn oniion", "nulpnnlysis", {"pnyps": ["nion", "oy"]}, ), ] xpins = [] fo n, xpyp, ps in xpinyps: pin(f"\n in {n} xpin...") xpi = onfi.xpin(n, xpyp, ps, uionhous=2) xpins.ppn(xpi) pin(f" xpin : {xpi[:8]}...") # S n un so xpins if xpins: pin(f"\n Sin xpins...") # S  lnin xpin xpi = xpins[0] onfi.sxpin(xpi) suls = unn.unlninxpin(xpi) pin( f"  Lnin opl: {suls['finluy']:.3f} uy" ) # S Vnui opiizion xpin vnuixpi = xpins[1] onfi.sxpin(vnuixpi) vnuisuls = unn.unvnuiopiizionxpin(vnuixpi) pin( f" Vnui Opiizion opl: {vnuisuls['finlffiiny']:.4f} ffiiny" ) # Lis ll xpins pin(f"\n iv xpins Suy:") pin("-" * 40) xpins = onfi.lisxpins() fo xp in xpins: pin(f" {xp['n'][:25]:25} | {xp['sus']:8} | {xp['poss']:5.1f}%") # nlyz xpin suls if xpins: pin(f"\n nlysis suls:") pin("-" * 25) fo xpi in xpins[:2]: # nlyz fis wo xpins nlysis = onfi.nlyzxpinsuls(xpi) if "o" no in nlysis: xpn = onfi.ivxpins[xpi]["n"] pin(f" {xpn}: {nlysis['olsuns']} suns") if "sussvluion" in nlysis: sussoun = su( 1 fo ii in nlysis["sussvluion"].vlus() if ii.("sii", Fls) ) olii = ln(nlysis["sussvluion"]) pin( f" Suss : {sussoun}/{olii} ii " ) pin(f"\n xpins onfiuion Sys y!") pin(" Us xpinonfi fo xpin nn") pin(" Us xpinunn fo xpin xuion") pin(" Us nlyzxpinsuls fo insihs")