"""   Hnl - Poss l n siul  sinls Oob 17, 2025 Hnls: -   fo fils (WV, SV, .) - l-i  ss (Wb Bluooh) - Siul  fo sin -  vliion n ppossin """ ipo json fo i ipo i y: fo phlib ipo Ph xp Ipoo s : pin(f'Wnin: {}') pss ipo nupy s np lss Hnl: """Hnl   quisiion n ppossin""" f ini(slf): slf.spl = 256 # Sn  spl  slf.hnnls = 8 # Sn OpnBI slf.lssinl = Non f nsiul(slf, uionsons=2, nuhnnls=8): """ n lisi siul   fo sin (Whn l hw no vilbl) """ nuspls = in(uionsons * slf.spl) #  lisi -li sinl  = [] fo h in n(nuhnnls): # ix of lph, b, h fqunis  = np.n(nuspls) / slf.spl # lph (8-12 Hz) lph = 10 * np.sin(2 * np.pi * 10 * ) # B (12-30 Hz) b = 5 * np.sin(2 * np.pi * 20 * ) # h (4-8 Hz) h = 15 * np.sin(2 * np.pi * 6 * ) #  nois nois = np.no.nol(0, 2, nuspls) # obin sinl = lph + b + h + nois .ppn(sinl.olis()) slf.lssinl =  un  f lofofil(slf, filph): """Lo   fo SV o oh fo""" y: filph = Ph(filph) if filph.suffix == ".sv": # Lo SV (fis olun shoul b spl vlus)  = np.lox(filph, lii=",", sipows=1) slf.lssinl = .olis() un  lif filph.suffix == ".json": # Lo JSON wih opn(filph, "") s f:  = json.lo(f) slf.lssinl =  un np.y() ls: is Vluo(f"Unsuppo fil fo: {filph.suffix}") xp xpion s : pin(f" o loin  fil: {}") un Non f vli(slf, ): """h if   is vli""" if  is Non: un Fls, "No " if isinsn(, lis): if ln() == 0: un Fls, "py " # h if i loos li  if ln() < 10: un Fls, "oo sho (n in 10 spls)" un u, f"Vli ({ln()} spls)" un Fls, "Invli fo" f pposs(slf, ): """ ln up   - Bnpss fil (0.5-50 Hz) - ov ifs - Noliz """  = np.y() # Sipl ppossin # ov  offs (n)  =  - np.n() # Noliz o [-1, 1] xvl = np.x(np.bs()) if xvl > 0:  =  / xvl un .olis() f info(slf, ): """ infoion bou  """  = np.y() un { "spls": ln(), "hnnls": ( ln() if isinsn(, lis) n isinsn([0], lis) ls 1 ), "n": flo(np.n()), "s": flo(np.s()), "in": flo(np.in()), "x": flo(np.x()), "uionsons": ln() / slf.spl, } lss WbBluoohHnl: """ Hnl l  vis vi Wb Bluooh (quis bows suppo) """ f ini(slf): slf.vi = Non slf.onn = Fls f jvsipo(slf): """ JvSip o fo plfos o us Wb Bluooh (his s inj ino HL plfos) """ un """ // Wb Bluooh  Hnl - Us in plfos lss WbBluooh { onsuo() { his.vi = null; his.hisi = null; his. = []; } syn onn() { y { // qus Bluooh vi (OpnBI, oiv, .) his.vi = wi nvio.bluooh.qusvi({ fils: [ { n: /.*OpnBI.*/ }, { n: /.*oiv.*/ }, { n: /.*inWv.*/ } ], opionlSvis: ['niss', 'niibu'] }); onsol.lo('onn o:', his.vi.n); un u; } h (o) { onsol.o('Bluooh onnion fil:', o); un fls; } } syn soin(uionSons = 2) { his. = []; ons ni = .now() + (uionSons * 1000); whil (.now() < ni) { // In l iplnion,  fo vi // Fo now, siul  ons spl = h.no() * 100; his..push(spl); wi nw Pois( => siou(, 4)); // ~256 Hz } un his.; } () { un his.; } } // Us in plfos: ons Hnl = nw WbBluooh(); // wi Hnl.onn(); // ons  = wi Hnl.soin(2); """ lss onv: """onv bwn iffn   fos""" @siho f oy(): """onv ny fo o nupy y""" if isinsn(, np.ny): un  un np.y() @siho f olis(): """onv o plin Pyhon lis""" if isinsn(, np.ny): un .olis() un lis() @siho f ojson(): """onv o JSON sin""" un json.ups(onv.olis()) # ============================================================================ # US XPLS # ============================================================================ if n == "in": hnl = Hnl() # xpl 1: n siul  pin(" nin siul  ...") si = hnl.nsiul(uionsons=5) isvli, s = hnl.vli(si) pin(f" Vliion: {s}") # xpl 2:   info pin("\n  infoion:") info = hnl.info(si) fo y, vl in info.is(): pin(f" {y}: {vl}") # xpl 3: Pposs  pin("\n Ppossin ...") poss = hnl.pposs(si) pin(f" Poss {ln(poss)} spls") pin("\n  Hnl y fo us!")