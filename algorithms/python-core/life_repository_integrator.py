""" L.I.F.. Plfo - posioy Inion Sys opyih 2025 - Sio Py Boull posioy inion n nn sys fo h L.I.F.. Plfo. Hnls i opions, zu vOps inion, n uo posioy nn fo h nuopiv lnin sys. his oul povis ophnsiv posioy nn pbiliis inluin: - i posioy opions n uoion - zu vOps piplin inion - posioy hlh onioin n innn - uo ployn is n ollbs - o quliy n suiy snnin inion """ ipo synio ipo json ipo loin ipo subposs fo lsss ipo si, lss fo i ipo i y: fo phlib ipo Ph xp Ipoo s : pin(f'Wnin: {}') pss fo ypin ipo i, Lis, Opionl @lss lss posioySus: """posioy sus infoion""" n: s bnh: s lsoi: s lsoi: i isln: bool pninhns: in osus: s hlhso: flo @lss lss ploynSus: """ployn sus infoion""" ployni: s sus: s nvionn: s si: i ni: Opionl[i] suss: bool losul: Opionl[s] @lss lss Piplinun: """zu vOps piplin un infoion""" uni: in piplinn: s sus: s sul: s si: i finishi: Opionl[i] builnub: s lss LIFposioyIno: """posioy inion sys fo L.I.F.. Plfo""" f ini(slf, poph: s = Non): slf.poph = Ph(poph) if poph ls Ph.w() slf.lo = loin.Lo(n) # Sup loin loin.bsionfi( lvl=loin.INFO, fo="%(si)s - %(n)s - %(lvln)s - %(ss)s", ) # zu vOps onfiuion slf.zuonfi = { "onizion": "lif-plfo", "poj": "LIF-Nuopiv-Sys", "posioyi": "SiLIF-lif-zu-sys", "inbnh": "in", } # posioy hlh hshols slf.hlhhshols = { "xpninhns": 50, "xyssinoi": 7, "inhlhso": 0.7, } syn f posioysus(slf) -> posioySus: """ ophnsiv posioy sus""" y: #  un bnh bnhsul = wi slf.union("v-ps --bbv-f H") bnh = bnhsul.sou.sip() #  ls oi info oisul = wi slf.union( "lo -1 --fo='%H|%s|%' --=iso" ) oips = oisul.sou.sip().spli("|") lsoi = oips[0] if ln(oips) > 0 ls "unnown" oiss = oips[1] if ln(oips) > 1 ls "unnown" ois = ( oips[2] if ln(oips) > 2 ls i.now().isofo() ) lsoi = i.foisofo( ois.pl(" +", "+").pl(" -", "-") ) # h if woin ioy is ln sussul = wi slf.union("sus --polin") isln = ln(sussul.sou.sip()) == 0 pninhns = ( ln(sussul.sou.sip().spli("\n")) if no isln ls 0 ) # h o sus osul = wi slf.union("sus -b --h-bhin") osus = "synhoniz" if "h" in osul.sou: osus = "h" lif "bhin" in osul.sou: osus = "bhin" # lul hlh so hlhso = slf.lulhlhso( isln, pninhns, lsoi ) un posioySus( n=slf.poph.n, bnh=bnh, lsoi=lsoi, lsoi=lsoi, isln=isln, pninhns=pninhns, osus=osus, hlhso=hlhso, ) xp xpion s : slf.lo.o(f"o in posioy sus: {}") un posioySus( n=slf.poph.n, bnh="unnown", lsoi="unnown", lsoi=i.now(), isln=Fls, pninhns=0, osus="o", hlhso=0.0, ) f lulhlhso( slf, isln: bool, pninhns: in, lsoi: i ) -> flo: """lul posioy hlh so (0.0 o 1.0)""" so = 1.0 # Pnliz unln woin ioy if no isln: so -= 0.3 # Pnliz oo ny pnin hns if pninhns > slf.hlhhshols["xpninhns"]: pnly = in(0.4, (pninhns / 100) * 0.4) so -= pnly # Pnliz ol ois yssinoi = (i.now() - lsoi).ys if yssinoi > slf.hlhhshols["xyssinoi"]: pnly = in(0.3, (yssinoi / 30) * 0.3) so -= pnly un x(0.0, so) syn f union(slf, on: s) -> subposs.oplPoss: """un  i on n un h sul""" fullon = f"i - {slf.poph} {on}" sul = wi synio.subpossshll( fullon, sou=synio.subposs.PIP, s=synio.subposs.PIP, x=u, ) sou, s = wi sul.ouni() if sul.uno != 0: is subposs.llPosso( sul.uno, fullon, sou, s ) un sul syn f oi(slf, ss: s, fils: Lis[s] = Non) -> bool: """  oi wih h spifi ss""" y: #  fils if spifi if fils: on = " " + " ".join(f'"{f}"' fo f in fils) wi slf.union(on) ls: wi slf.union(" .") # oi wi slf.union(f'oi - "{ss}"') slf.lo.info(f" oi: {ss}") un u xp xpion s : slf.lo.o(f"o in oi: {}") un Fls syn f pushhns(slf, bnh: s = Non) -> bool: """Push hns o o posioy""" y: if no bnh: sus = wi slf.posioysus() bnh = sus.bnh wi slf.union(f"push oiin {bnh}") slf.lo.info(f"Push hns o {bnh}") un u xp xpion s : slf.lo.o(f"o pushin hns: {}") un Fls syn f pullqus( slf, il: s, sipion: s, bnh: s = "in" ) -> Opionl[s]: """  pull qus (siplifi - woul in wih zu vOps/iHub PI)""" y: #  un bnh sus = wi slf.posioysus() soubnh = sus.bnh # In  l iplnion, his woul ll zu vOps S PI # Fo now, w'll siul n lo h P ion pinfo = { "il": il, "sipion": sipion, "soubnh": soubnh, "bnh": bnh, "": i.now().isofo(), } slf.lo.info(f"Pull qus : {il}") slf.lo.info(f"Sou: {soubnh} -> : {bnh}") # xpo P info fo in pfiln = f"p{i.now().sfi('%Y%%%H%%S')}.json" wih opn(pfiln, "w") s f: json.up(pinfo, f, inn=2) un pfiln xp xpion s : slf.lo.o(f"o in pull qus: {}") un Non syn f unpiplin( slf, piplinn: s, ps: i = Non ) -> Opionl[Piplinun]: """i n zu vOps piplin un""" y: # In  l iplnion, his woul ll zu vOps S PI # Fo siulion, w'll   o piplin un uni = in(i.now().isp()) piplinun = Piplinun( uni=uni, piplinn=piplinn, sus="inPoss", sul="unnown", si=i.now(), finishi=Non, builnub=f"{piplinn}{uni}", ) slf.lo.info(f"i piplin: {piplinn} (un I: {uni})") # Siul piplin oplion (in l iplnion, woul poll PI) wi synio.slp(2) # Siul possin i #  s opl piplinun.sus = "opl" piplinun.sul = "su" piplinun.finishi = i.now() slf.lo.info( f"Piplin opl: {piplinn} - {piplinun.sul}" ) un piplinun xp xpion s : slf.lo.o(f"o unnin piplin: {}") un Non syn f hposioyhlh(slf) -> i: """Pfo ophnsiv posioy hlh h""" hlhpo = { "isp": i.now().isofo(), "ovllhlh": "unnown", "hs": {}, "onions": [], } y: #  posioy sus sus = wi slf.posioysus() hlhpo["hs"]["posioysus"] = si(sus) # h fo l fils lfils = wi slf.finlfils() hlhpo["hs"]["lfils"] = lfils # h fo suiy issus (siplifi) suiyissus = wi slf.hsuiyissus() hlhpo["hs"]["suiy"] = suiyissus # h o quliy (siplifi) quliyis = wi slf.hoquliy() hlhpo["hs"]["oquliy"] = quliyis # in ovll hlh hlhsos = [ sus.hlhso, 1.0 if ln(lfils) == 0 ls 0.8, 1.0 if ln(suiyissus) == 0 ls 0.6, quliyis.("ovllso", 0.8), ] ovllso = su(hlhsos) / ln(hlhsos) hlhpo["ovllhlh"] = slf.sooin(ovllso) # n onions hlhpo["onions"] = slf.nonions( sus, lfils, suiyissus, quliyis ) xp xpion s : slf.lo.o(f"o uin hlh h: {}") hlhpo["ovllhlh"] = "o" hlhpo["o"] = s() un hlhpo syn f finlfils(slf, xsizb: in = 100) -> Lis[i]: """Fin fils l hn spifi siz""" lfils = [] xsizbys = xsizb * 1024 * 1024 y: fo filph in slf.poph.lob("*"): if filph.isfil() n no filph.n.sswih("."): siz = filph.s().ssiz if siz > xsizbys: lfils.ppn( { "ph": s(filph.livo(slf.poph)), "sizb": siz / (1024 * 1024), "sizbys": siz, } ) xp xpion s : slf.lo.o(f"o finin l fils: {}") un lfils syn f hsuiyissus(slf) -> Lis[i]: """h fo oon suiy issus (siplifi)""" issus = [] # h fo xpos ss (siplifi pn hin) spns = [ "psswo\s*=\s*['\"][^'\"]*['\"]", "s\s*=\s*['\"][^'\"]*['\"]", "y\s*=\s*['\"][^'\"]*['\"]", ] y: fo pyfil in slf.poph.lob("*.py"): wih opn(pyfil, "", noin="uf-8", os="ino") s f: onn = f.() fo pn in spns: if ( pn.pl("['\"][^'\"]*['\"]", "s") in onn.low() ): issus.ppn( { "fil": s(pyfil.livo(slf.poph)), "yp": "ponilsxposu", "sviy": "hih", } ) b xp xpion s : slf.lo.o(f"o hin suiy issus: {}") un issus syn f hoquliy(slf) -> i: """h o quliy is (siplifi)""" is = { "olfils": 0, "pyhonfils": 0, "ollins": 0, "voplxiy": 0, "ovllso": 0.8, } y: pyhonfils = lis(slf.poph.lob("*.py")) is["pyhonfils"] = ln(pyhonfils) ollins = 0 fo pyfil in pyhonfils: y: wih opn(pyfil, "", noin="uf-8", os="ino") s f: lins = f.lins() ollins += ln(lins) xp: pss is["ollins"] = ollins is["olfils"] = ln(lis(slf.poph.lob("*"))) # Sipl oplxiy si bs on fil oun n siz if is["pyhonfils"] > 0: vlinspfil = ollins / is["pyhonfils"] is["voplxiy"] = in(10, vlinspfil / 50) xp xpion s : slf.lo.o(f"o hin o quliy: {}") un is f sooin(slf, so: flo) -> s: """onv nui so o in""" if so >= 0.9: un "xlln" lif so >= 0.8: un "oo" lif so >= 0.7: un "fi" lif so >= 0.6: un "poo" ls: un "iil" f nonions( slf, sus: posioySus, lfils: Lis, suiyissus: Lis, quliyis: i, ) -> Lis[s]: """n hlh onions""" onions = [] if no sus.isln: onions.ppn( "oi o ssh pnin hns o ln woin ioy" ) if sus.pninhns > slf.hlhhshols["xpninhns"]: onions.ppn( "onsi bin own l hns ino sll ois" ) if sus.hlhso < slf.hlhhshols["inhlhso"]: onions.ppn( "posioy hlh is blow hshol - viw n ss issus" ) if lfils: onions.ppn( f"Foun {ln(lfils)} l fils - onsi usin i LFS" ) if suiyissus: onions.ppn( f"ss {ln(suiyissus)} suiy issus iily" ) if quliyis.("voplxiy", 0) > 8: onions.ppn("o oplxiy is hih - onsi foin") un onions syn f xpohlhpo(slf, po: i, filn: s = Non) -> s: """xpo hlh po o fil""" if no filn: isp = i.now().sfi("%Y%%%H%%S") filn = f"pohlhpo{isp}.json" wih opn(filn, "w") s f: json.up(po, f, inn=2, ful=s) slf.lo.info(f"Hlh po xpo o {filn}") un filn syn f in(): """in funion fo posioy inion o""" pin(" L.I.F.. Plfo - posioy Inion Sys") pin("=" * 55) ino = LIFposioyIno() y: #  posioy sus pin(" in posioy sus...") sus = wi ino.posioysus() pin(f"posioy: {sus.n}") pin(f"Bnh: {sus.bnh}") pin(f"ln: {sus.isln}") pin(f"Hlh So: {sus.hlhso:.2f}") pin() # un hlh h pin(" unnin ophnsiv hlh h...") hlhpo = wi ino.hposioyhlh() pin(f"Ovll Hlh: {hlhpo['ovllhlh'].upp()}") pin(f"hs Pfo: {ln(hlhpo['hs'])}") if hlhpo["onions"]: pin(" onions:") fo  in hlhpo["onions"]: pin(f" â€¢ {}") pin() # xpo hlh po pofil = wi ino.xpohlhpo(hlhpo) pin(f" Hlh po xpo o: {pofil}") # Siul piplin un pin(" Siulin piplin xuion...") piplin = wi ino.unpiplin("LIF-I--Piplin") if piplin: pin(f"Piplin: {piplin.piplinn}") pin(f"Sus: {piplin.sus}") pin(f"sul: {piplin.sul}") xp xpion s : pin(f" o: {}") if n == "in": synio.un(in())