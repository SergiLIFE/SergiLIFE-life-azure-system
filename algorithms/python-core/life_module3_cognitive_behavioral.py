""" L.I.F. hoy oul 3: oniiv Bhviol olin vn oniiv olin n bhviol pn nlysis opyih 2025 - Sio Py Boull """ ipo json ipo loin fo ollions ipo fuli, qu fo lsss ipo lss, fil fo i ipo i, il fo nu ipo nu fo ypin ipo ny, i, Lis, Opionl, upl ipo plolib.pyplo s pl ipo nupy s np fo sipy ipo ss fo sipy.spil ipo sofx # Ipo L.I.F. hoy o fo lifhoy ipo pionPs, oLIFloih # onfiu loin loin.bsionfi(lvl=loin.INFO) lo = loin.Lo(n) lss oniivS(nu): """oniiv ss fo olin""" NION = "nions" LNIN = "lnins" OY = "oys" ISION = "isions" XUION = "xuions" FLION = "flions" S = "ss" lss Bhvioyp(nu): """yps of bhvios o ol""" OO = "oobhvio" ONIIV = "oniivbhvio" OIONL = "oionlbhvio" SOIL = "soilbhvio" PIV = "pivbhvio" HBIUL = "hbiulbhvio" lss LninPhs(nu): """Lnin phs ss""" QUISIION = "quisiionphs" ONSOLIION = "onsoliionphs" NION = "nionphs" IVL = "ivlphs" NLIZION = "nlizionphs" @lss lss oniivPofil: """oniiv pofil psnion""" nionspn: flo = 0.5 woinoypiy: in = 7 possinsp: flo = 1.0 oniivflxibiliy: flo = 0.5 xuivonol: flo = 0.5 oniion: flo = 0.5 lninffiiny: flo = 0.5 pion: flo = 0.1 @lss lss BhvioPn: """Bhvio pn suu""" bhvioyp: Bhvioyp = Bhvioyp.ONIIV fquny: flo = 0.0 innsiy: flo = 0.0 uion: flo = 0.0 onxis: Lis[s] = fil(fulfoy=lis) suss: flo = 0.0 pionlvl: flo = 0.0 onfin: flo = 0.0 @lss lss oniivvn: """oniiv vn psnion""" isp: i = fil(fulfoy=i.now) oniivs: oniivS = oniivS.NION vnyp: s = "" siulusfus: i[s, flo] = fil(fulfoy=i) sponsfus: i[s, flo] = fil(fulfoy=i) pfonis: i[s, flo] = fil(fulfoy=i) onx: i[s, ny] = fil(fulfoy=i) lss LIFoniivBhviolol: """vn oniiv bhviol olin wih L.I.F. hoy""" f ini(slf, oniivpofil: Opionl[oniivPofil] = Non): slf.oniivpofil = oniivpofil o oniivPofil() # Iniiliz L.I.F. loih fo oniiv pion slf.lifloih = oLIFloih( lnin=0.03, xxpins=15000, pionps=pionPs( lnin=0.03, yfo=0.85, hshol=0.2 ), ) # oniiv s nn slf.unoniivs = oniivS.NION slf.oniivshisoy = qu(xln=1000) slf.snsiionpobbiliis = slf.iniilizsnsiions() # Bhvio olin slf.bhviopns = {} slf.bhviohisoy = qu(xln=5000) slf.onxbhvioppin = fuli(lis) # Lnin n oy ols slf.woinoy = qu( xln=slf.oniivpofil.woinoypiy ) slf.lonoy = {} slf.pisoioy = qu(xln=10000) slf.snioy = {} # Pfon in slf.pfonis = { "oniivlo": [], "lninposs": [], "bhviolonsisny": [], "pionffiiny": [], "isionuy": [], "sponsi": [], } # oniiv posss slf.nionol = slf.iniiliznionol() slf.isionol = slf.iniilizisionol() slf.lninol = slf.iniilizlninol() lo.info("L.I.F. oniiv Bhviol ol iniiliz") f possoniivvn(slf, vn: oniivvn) -> i[s, ny]: """Poss  oniiv vn houh h ol""" y: si = i.now() # Up oniiv s slf.uponiivs(vn) # Poss houh nion ol nionsul = slf.possnion(vn) # Up woin oy slf.upwoinoy(vn, nionsul) # Poss houh ision ol if pplibl isionsul = {} if vn.oniivs in [ oniivS.ISION, oniivS.XUION, ]: isionsul = slf.possision(vn, nionsul) # Up lnin ol lninsul = slf.uplnin( vn, nionsul, isionsul ) # x bhviol pns bhviosul = slf.nlyzbhviopns(vn) # p usin L.I.F. loih piononx = { "oniivs": vn.oniivs.vlu, "nionfous": nionsul.("fouslvl", 0.5), "lninposs": lninsul.("lnin", 0.5), "bhviolsuss": bhviosul.("suss", 0.5), } lifpion = slf.lifloih.poss( slf.nooniivfus(vn), piononx ) # Up oniiv pofil bs on pion slf.poniivpofil(lifpion) # So in pisoi oy slf.pisoioy.ppn(vn) possini = (i.now() - si).olsons() sul = { "vni": s(vn.isp), "oniivs": vn.oniivs.vlu, "nionsul": nionsul, "isionsul": isionsul, "lninsul": lninsul, "bhviosul": bhviosul, "lifpion": lifpion, "possini": possini, "oniivlo": slf.luloniivlo(), "uppofil": slf.oniivpofil, "suss": u, } # Up pfon is slf.uppfonis(sul) un sul xp xpion s : lo.o(f"o possin oniiv vn: {s()}") un {"vni": s(vn.isp), "suss": Fls, "o": s()} f olbhviolsqun( slf, bhviosqun: Lis[BhvioPn], onx: i[s, ny] ) -> i[s, ny]: """ol  squn of bhvios""" y: squns = i.now() squnsuls = [] bhviolohn = [] pionjoy = [] # Iniiliz squn s squns = { "onu": 0.0, "onsisny": 1.0, "fiu": 0.0, "lninuulion": 0.0, } fo i, bhvio in nu(bhviosqun): #  oniiv vn fo bhvio vn = oniivvn( isp=i.now(), oniivs=slf.pbhvioooniivs(bhvio), vnyp=f"bhvioxuion{i}", siulusfus={"bhvioinnsiy": bhvio.innsiy}, sponsfus={"bhviofquny": bhvio.fquny}, onx=onx, ) # Poss h vn vnsul = slf.possoniivvn(vn) # Up squn s squns = slf.upsquns( squns, bhvio, vnsul ) # lul bhviol ohn if i > 0: ohn = slf.lulbhviolohn( bhviosqun[i - 1], bhvio, squns ) bhviolohn.ppn(ohn) #  pion joy pionso = vnsul.("lifpion", {}).( "pionso", 0.5 ) pionjoy.ppn(pionso) squnsuls.ppn( { "bhvioinx": i, "bhvioyp": bhvio.bhvioyp.vlu, "vnsul": vnsul, "squns": squns.opy(), "ohn": ( bhviolohn[-1] if bhviolohn ls 1.0 ), } ) # nlyz squn-lvl pns squnnlysis = slf.nlyzsqunpns( bhviosqun, squnsuls, bhviolohn ) possini = (i.now() - squns).olsons() sul = { "squnlnh": ln(bhviosqun), "squnsuls": squnsuls, "bhviolohn": bhviolohn, "pionjoy": pionjoy, "squnnlysis": squnnlysis, "finlsquns": squns, "possini": possini, "ovllsuss": np.n( [b.suss fo b in bhviosqun] ), "squnffiiny": squnnlysis.("ffiinyso", 0.5), } # Up bhviol pns bs slf.upbhviolpns(bhviosqun, sul) un sul xp xpion s : lo.o(f"o olin bhviol squn: {s()}") un {"o": s(), "squnlnh": ln(bhviosqun)} f pibhviolspons( slf, siulus: i[s, ny], onx: i[s, ny] ) -> i[s, ny]: """Pi bhviol spons o siulus""" y: # no siulus fus siulusvo = slf.nosiulusfus(siulus) #  un oniiv onx oniivonx = { "uns": slf.unoniivs.vlu, "oniivlo": slf.luloniivlo(), "nionpiy": slf.oniivpofil.nionspn, "woinoylo": ln(slf.woinoy) / slf.oniivpofil.woinoypiy, } # obin wih xnl onx fullonx = {**oniivonx, **onx} # Pi houh iffn ols piions = {} # nion piion nionpiion = slf.pinionspons( siulusvo, fullonx ) piions["nion"] = nionpiion # oniiv s piion spiion = slf.pioniivsnsiion( siulusvo, fullonx ) piions["oniivs"] = spiion # Bhviol pn piion bhviopiion = slf.pibhviopn( siulusvo, fullonx ) piions["bhvio"] = bhviopiion # Lnin ouo piion lninpiion = slf.pilninouo( siulusvo, fullonx ) piions["lnin"] = lninpiion # In piions usin L.I.F. loih inpiion = slf.inpiions( piions, siulusvo ) # lul onfin sos onfinsos = slf.lulpiiononfin( piions, inpiion ) sul = { "siulusnoin": siulusvo.olis(), "iniviulpiions": piions, "inpiion": inpiion, "onfinsos": onfinsos, "oniivonx": oniivonx, "pioniivlo": slf.pioniivlohn( siulusvo ), "pioninss": slf.sssspioninss(), "onion": slf.nbhviolonion( inpiion ), } un sul xp xpion s : lo.o(f"o piin bhviol spons: {s()}") un {"o": s(), "siulus": siulus} f siullninsssion( slf, lninss: Lis[i[s, ny]], sssionuion: flo = 30.0 ) -> i[s, ny]: """Siul  lnin sssion wih oniiv olin""" y: sssions = i.now() # Iniiliz sssion s sssions = { "oniivfiu": 0.0, "oivion": 1.0, "nionsbiliy": 1.0, "lninffiiny": slf.oniivpofil.lninffiiny, "nowluulion": 0.0, } ssuls = [] lninuv = [] oniivlouv = [] nionuv = [] ips = sssionuion / ln(lninss) fo i, s in nu(lninss): ssi = sssions + il(sons=i * ips) #  lnin vn lninvn = oniivvn( isp=ssi, oniivs=oniivS.LNIN, vnyp=f"lnins{i}", siulusfus=s.("siulusfus", {}), onx={"siffiuly": s.("iffiuly", 0.5)}, ) # Poss lnin vn vnsul = slf.possoniivvn(lninvn) # Up sssion s sssions = slf.uplninsssions( sssions, s, vnsul, i / ln(lninss) ) # lul lnin is lninposs = slf.lullninposs( s, vnsul, sssions ) lninuv.ppn(lninposs) oniivlouv.ppn(sssions["oniivfiu"]) nionuv.ppn(sssions["nionsbiliy"]) ssuls.ppn( { "sinx": i, "syp": s.("yp", "unnown"), "iffiuly": s.("iffiuly", 0.5), "lninposs": lninposs, "sssions": sssions.opy(), "vnsul": vnsul, } ) # nlyz lnin sssion sssionnlysis = slf.nlyzlninsssion( ssuls, lninuv, oniivlouv, nionuv ) # Up lon- lnin ols slf.uplonlnin(sssionnlysis) sssionuionul = (i.now() - sssions).olsons() sul = { "sssionuion": sssionuionul, "nuss": ln(lninss), "ssuls": ssuls, "lninuv": lninuv, "oniivlouv": oniivlouv, "nionuv": nionuv, "sssionnlysis": sssionnlysis, "finlsssions": sssions, "nowlin": sssions["nowluulion"], "sssionffiiny": sssionnlysis.("ovllffiiny", 0.5), "onions": slf.nlninonions( sssionnlysis ), } un sul xp xpion s : lo.o(f"o siulin lnin sssion: {s()}") un {"o": s(), "nuss": ln(lninss)} f nlyzoniivpns( slf, iwinow: Opionl[il] = Non ) -> i[s, ny]: """nlyz oniiv pns ov i""" y: if iwinow is Non: iwinow = il(hous=24) uoffi = i.now() - iwinow # Fil vns wihin i winow nvns = [ vn fo vn in slf.pisoioy if vn.isp >= uoffi ] if no nvns: un {"o": "No vns in spifi i winow"} # nlyz oniiv s pns snlysis = slf.nlyzoniivspns(nvns) # nlyz nion pns nionnlysis = slf.nlyznionpns(nvns) # nlyz lnin pns lninnlysis = slf.nlyzlninpns(nvns) # nlyz bhviol pns bhviolnlysis = slf.nlyzbhviolpnspol( nvns ) # lul oniiv hyh oniivhyh = slf.luloniivhyh(nvns) # ssss oniiv ffiiny ffiinyis = slf.ssssoniivffiiny(nvns) # n insihs insihs = slf.noniivinsihs( snlysis, nionnlysis, lninnlysis, bhviolnlysis, oniivhyh, ffiinyis, ) sul = { "nlysiswinow": s(iwinow), "nuvns": ln(nvns), "snlysis": snlysis, "nionnlysis": nionnlysis, "lninnlysis": lninnlysis, "bhviolnlysis": bhviolnlysis, "oniivhyh": oniivhyh, "ffiinyis": ffiinyis, "insihs": insihs, "unoniivpofil": slf.oniivpofil, "lifloihsus": slf.lifloih.pfonis(), } un sul xp xpion s : lo.o(f"o nlyzin oniiv pns: {s()}") un {"o": s()} # Hlp hos fo oniiv possin f iniilizsnsiions(slf) -> i[s, i[s, flo]]: """Iniiliz oniiv s nsiion pobbiliis""" un { oniivS.NION.vlu: { oniivS.LNIN.vlu: 0.3, oniivS.ISION.vlu: 0.2, oniivS.OY.vlu: 0.2, oniivS.S.vlu: 0.3, }, oniivS.LNIN.vlu: { oniivS.OY.vlu: 0.4, oniivS.FLION.vlu: 0.3, oniivS.NION.vlu: 0.2, oniivS.S.vlu: 0.1, }, oniivS.OY.vlu: { oniivS.ISION.vlu: 0.3, oniivS.FLION.vlu: 0.3, oniivS.NION.vlu: 0.2, oniivS.LNIN.vlu: 0.2, }, oniivS.ISION.vlu: { oniivS.XUION.vlu: 0.5, oniivS.FLION.vlu: 0.2, oniivS.NION.vlu: 0.2, oniivS.OY.vlu: 0.1, }, oniivS.XUION.vlu: { oniivS.FLION.vlu: 0.4, oniivS.NION.vlu: 0.3, oniivS.S.vlu: 0.2, oniivS.LNIN.vlu: 0.1, }, oniivS.FLION.vlu: { oniivS.LNIN.vlu: 0.3, oniivS.OY.vlu: 0.3, oniivS.NION.vlu: 0.2, oniivS.S.vlu: 0.2, }, oniivS.S.vlu: { oniivS.NION.vlu: 0.6, oniivS.OY.vlu: 0.2, oniivS.LNIN.vlu: 0.1, oniivS.FLION.vlu: 0.1, }, } f iniiliznionol(slf) -> i[s, ny]: """Iniiliz nion ol ps""" un { "foushshol": 0.3, "isiony": 0.9, "nionpiy": slf.oniivpofil.nionspn, "slivnionwih": 0.7, "ivinionwih": 0.3, } f iniilizisionol(slf) -> i[s, ny]: """Iniiliz ision ol ps""" un { "isionhshol": 0.6, "uninyoln": 0.4, "ispfn": 0.5, "ipssusnsiiviy": 0.3, "onfinhshol": 0.7, } f iniilizlninol(slf) -> i[s, ny]: """Iniiliz lnin ol ps""" un { "lninbs": slf.oniivpofil.lninffiiny, "foin": 0.1, "onsoliionsnh": 0.8, "infnsisn": 0.6, "nlizionbiliy": 0.5, } f uponiivs(slf, vn: oniivvn): """Up un oniiv s bs on vn""" # So pvious s slf.oniivshisoy.ppn(slf.unoniivs) # Sipl s nsiion bs on vn yp n pobbiliis if vn.oniivs != slf.unoniivs: nsiionpob = slf.snsiionpobbiliis.( slf.unoniivs.vlu, {} ).(vn.oniivs.vlu, 0.1) #  so nonss n onx influn onxinflun = 0.1 * ln(vn.onx) finlpob = in(0.9, nsiionpob + onxinflun) if np.no.no() < finlpob: slf.unoniivs = vn.oniivs f possnion(slf, vn: oniivvn) -> i[s, ny]: """Poss nion hniss""" y: # lul nion fous siulusslin = ( np.n(lis(vn.siulusfus.vlus())) if vn.siulusfus ls 0.5 ) onxlvn = ln(vn.onx) / 10.0 # Noliz onx influn fouslvl = in( 1.0, siulusslin * slf.nionol["slivnionwih"] + onxlvn * slf.nionol["ivinionwih"], ) # pply oniiv lo ffs oniivlo = slf.luloniivlo() nionpiy = x( 0.1, slf.nionol["nionpiy"] - oniivlo * 0.3 ) ffivfous = fouslvl * nionpiy # Up nion s nionsul = { "fouslvl": flo(ffivfous), "nionpiy": flo(nionpiy), "siulusslin": flo(siulusslin), "oniivloip": flo(oniivlo * 0.3), "nionffiiny": flo(ffivfous / x(0.1, fouslvl)), } un nionsul xp xpion s : lo.o(f"o possin nion: {s()}") un {"fouslvl": 0.5, "nionpiy": 0.5} f upwoinoy( slf, vn: oniivvn, nionsul: i[s, ny] ): """Up woin oy wih nw infoion""" y: # Only  o woin oy if nion is suffiin if ( nionsul.("fouslvl", 0) > slf.nionol["foushshol"] ): #  oy i oyi = { "isp": vn.isp, "onn": { "siulus": vn.siulusfus, "spons": vn.sponsfus, "onx": vn.onx, }, "nionwih": nionsul["fouslvl"], "oniivs": vn.oniivs.vlu, } #  o woin oy (qu uoilly hnls piy) slf.woinoy.ppn(oyi) # Ponilly onsoli o lon- oy if nionsul["fouslvl"] > 0.8: slf.onsoliolonoy(oyi) xp xpion s : lo.o(f"o upin woin oy: {s()}") f onsoliolonoy(slf, oyi: i[s, ny]): """onsoli woin oy o lon- oy""" y: # Sipl onsoliion bs on nion wih n piion onny = s(oyi["onn"]) if onny in slf.lonoy: # Snhn xisin oy slf.lonoy[onny]["snh"] += 0.1 slf.lonoy[onny]["ssoun"] += 1 ls: #  nw lon- oy slf.lonoy[onny] = { "onn": oyi["onn"], "snh": oyi["nionwih"], "": oyi["isp"], "ssoun": 1, "oniivs": oyi["oniivs"], } xp xpion s : lo.o(f"o onsoliin oy: {s()}") f nooniivfus(slf, vn: oniivvn) -> np.ny: """no oniiv vn fus fo L.I.F. possin""" y: fus = [] # oniiv s noin (on-ho) snoin = [0.0] * ln(oniivS) snoin[lis(oniivS).inx(vn.oniivs)] = 1.0 fus.xn(snoin) # Siulus fus siulusvlus = lis(vn.siulusfus.vlus())[ :5 ] # Lii o 5 fus whil ln(siulusvlus) < 5: siulusvlus.ppn(0.0) fus.xn(siulusvlus) # spons fus sponsvlus = lis(vn.sponsfus.vlus())[ :5 ] # Lii o 5 fus whil ln(sponsvlus) < 5: sponsvlus.ppn(0.0) fus.xn(sponsvlus) # onx fus (siplifi) onxinnsiy = ln(vn.onx) / 10.0 # Noliz fus.ppn(onxinnsiy) # oniiv pofil fus fus.xn( [ slf.oniivpofil.nionspn, slf.oniivpofil.possinsp, slf.oniivpofil.oniivflxibiliy, slf.oniivpofil.lninffiiny, ] ) un np.y(fus[:50]) # Lii ol fus xp xpion s : lo.o(f"o noin oniiv fus: {s()}") un np.zos(20) # ful noin f luloniivlo(slf) -> flo: """lul un oniiv lo""" y: # Woin oy lo wlo = ln(slf.woinoy) / x( 1, slf.oniivpofil.woinoypiy ) # n s oplxiy noplxiy = 0.5 if ln(slf.oniivshisoy) > 0: shns = ln(s(lis(slf.oniivshisoy)[-10:])) noplxiy = in(1.0, shns / 5.0) # Possin n possinn = 1.0 - slf.oniivpofil.possinsp # obin oniiv lo ollo = ( wlo * 0.4 + noplxiy * 0.3 + possinn * 0.3 ) un in(1.0, ollo) xp xpion s : lo.o(f"o lulin oniiv lo: {s()}") un 0.5 f uppfonis(slf, sul: i[s, ny]): """Up pfon in is""" y: slf.pfonis["oniivlo"].ppn( sul.("oniivlo", 0.5) ) # x oh is fo sul if "lninsul" in sul: lnin = sul["lninsul"].("lnin", 0.5) slf.pfonis["lninposs"].ppn(lnin) if "bhviosul" in sul: onsisny = sul["bhviosul"].("onsisny", 0.5) slf.pfonis["bhviolonsisny"].ppn(onsisny) if "lifpion" in sul: pionso = sul["lifpion"].( "pionso", 0.5 ) slf.pfonis["pionffiiny"].ppn( pionso ) # i hisoy o pvn oy owh fo ilis in slf.pfonis.vlus(): if ln(ilis) > 1000: l ilis[:500] # p ls 500 vlus xp xpion s : lo.o(f"o upin pfon is: {s()}") # Plhol hos fo oplx oniiv posss f possision( slf, vn: oniivvn, nionsul: i[s, ny] ) -> i[s, ny]: """Poss ision in""" isiononfin = ( nionsul.("fouslvl", 0.5) * slf.oniivpofil.xuivonol ) un { "isiononfin": flo(isiononfin), "isioni": flo( 1.0 / x(0.1, slf.oniivpofil.possinsp) ), "isionquliy": flo(isiononfin * 0.8 + 0.2), } f uplnin( slf, vn: oniivvn, nionsul: i[s, ny], isionsul: i[s, ny], ) -> i[s, ny]: """Up lnin ol""" lninffiiny = ( nionsul.("fouslvl", 0.5) * 0.6 + slf.oniivpofil.lninffiiny * 0.4 ) un { "lnin": flo(lninffiiny), "nionpobbiliy": flo(lninffiiny * 0.9), "nlizionsnh": flo( lninffiiny * slf.oniivpofil.oniivflxibiliy ), } f nlyzbhviopns(slf, vn: oniivvn) -> i[s, ny]: """nlyz un bhvio pns""" un { "onsisny": 0.7, "suss": 0.75, "pionlvl": 0.6, "pnsnh": 0.5, } f poniivpofil(slf, lifpion: i[s, ny]): """p oniiv pofil bs on L.I.F. fb""" y: pionsnh = lifpion.("pionso", 0.5) lnin = 0.01 * pionsnh # ul pion of oniiv ps if pionsnh > 0.7: slf.oniivpofil.lninffiiny += lnin slf.oniivpofil.oniivflxibiliy += lnin * 0.5 # p vlus in vli n slf.oniivpofil.lninffiiny = np.lip( slf.oniivpofil.lninffiiny, 0.1, 1.0 ) slf.oniivpofil.oniivflxibiliy = np.lip( slf.oniivpofil.oniivflxibiliy, 0.1, 1.0 ) xp xpion s : lo.o(f"o pin oniiv pofil: {s()}") # iionl plhol hos (siplifi iplnions) f pbhvioooniivs( slf, bhvio: BhvioPn ) -> oniivS: """p bhvio yp o oniiv s""" ppin = { Bhvioyp.ONIIV: oniivS.LNIN, Bhvioyp.OO: oniivS.XUION, Bhvioyp.OIONL: oniivS.FLION, Bhvioyp.PIV: oniivS.LNIN, Bhvioyp.HBIUL: oniivS.XUION, Bhvioyp.SOIL: oniivS.ISION, } un ppin.(bhvio.bhvioyp, oniivS.NION) f upsquns( slf, s: i[s, ny], bhvio: BhvioPn, vnsul: i[s, ny], ) -> i[s, ny]: """Up squn s""" s["onu"] = 0.9 * s["onu"] + 0.1 * bhvio.suss s["fiu"] += 0.05 s["lninuulion"] += vnsul.("lninsul", {}).( "lnin", 0.1 ) un s f lulbhviolohn( slf, pvbhvio: BhvioPn, ubhvio: BhvioPn, s: i[s, ny], ) -> flo: """lul bhviol ohn bwn onsuiv bhvios""" ypsiiliy = ( 1.0 if pvbhvio.bhvioyp == ubhvio.bhvioyp ls 0.5 ) innsiysiiliy = 1.0 - bs( pvbhvio.innsiy - ubhvio.innsiy ) un (ypsiiliy + innsiysiiliy) / 2.0 f nlyzsqunpns( slf, squn: Lis[BhvioPn], suls: Lis[i[s, ny]], ohn: Lis[flo], ) -> i[s, ny]: """nlyz pns in bhviol squn""" un { "ffiinyso": np.n([.("ohn", 0.5) fo  in suls]), "onsisnyso": 1.0 - np.s([b.innsiy fo b in squn]), "pionso": np.n( [ ["vnsul"] .("lifpion", {}) .("pionso", 0.5) fo  in suls ] ), } f upbhviolpns( slf, squn: Lis[BhvioPn], sul: i[s, ny] ): """Up bhviol pns bs""" # So squn pn fo fuu fn pny = "".join([b.bhvioyp.vlu fo b in squn]) if pny no in slf.bhviopns: slf.bhviopns[pny] = [] slf.bhviopns[pny].ppn(sul) # iionl siplifi iplnions fo inin hos f nosiulusfus(slf, siulus: i[s, ny]) -> np.ny: """no siulus fus""" fus = lis(siulus.vlus())[:10] whil ln(fus) < 10: fus.ppn(0.0) un np.y(fus) f pinionspons( slf, siulus: np.ny, onx: i[s, ny] ) -> i[s, ny]: """Pi nion spons""" un {"pifous": 0.7, "onfin": 0.8} f pioniivsnsiion( slf, siulus: np.ny, onx: i[s, ny] ) -> i[s, ny]: """Pi oniiv s nsiion""" un { "nxs": oniivS.LNIN.vlu, "nsiionpobbiliy": 0.7, } f pibhviopn( slf, siulus: np.ny, onx: i[s, ny] ) -> i[s, ny]: """Pi bhvio pn""" un {"bhvioyp": Bhvioyp.PIV.vlu, "innsiy": 0.6} f pilninouo( slf, siulus: np.ny, onx: i[s, ny] ) -> i[s, ny]: """Pi lnin ouo""" un {"lninin": 0.3, "nionpobbiliy": 0.8} f inpiions( slf, piions: i[s, ny], siulus: np.ny ) -> i[s, ny]: """In ulipl piions""" un {"inspons": 0.7, "ovllonfin": 0.75} f lulpiiononfin( slf, piions: i[s, ny], in: i[s, ny] ) -> i[s, flo]: """lul piion onfin sos""" un {"nion": 0.8, "bhvio": 0.7, "lnin": 0.75, "ovll": 0.75} f pioniivlohn(slf, siulus: np.ny) -> flo: """Pi hn in oniiv lo""" un 0.1 f sssspioninss(slf) -> flo: """ssss inss fo pion""" un slf.oniivpofil.oniivflxibiliy f nbhviolonion(slf, piion: i[s, ny]) -> s: """n bhviol onion""" un "inin un oniiv sy wih o pion" f uplninsssions( slf, s: i[s, ny], s: i[s, ny], sul: i[s, ny], poss: flo, ) -> i[s, ny]: """Up lnin sssion s""" s["oniivfiu"] += 0.05 * s.("iffiuly", 0.5) s["nowluulion"] += 0.1 * sul.("lninsul", {}).( "lnin", 0.1 ) un s f lullninposs( slf, s: i[s, ny], sul: i[s, ny], s: i[s, ny] ) -> flo: """lul lnin poss fo s""" un sul.("lninsul", {}).("lnin", 0.5) * ( 1.0 - s["oniivfiu"] ) f nlyzlninsssion( slf, ssuls: Lis[i[s, ny]], lninuv: Lis[flo], oniivlo: Lis[flo], nion: Lis[flo], ) -> i[s, ny]: """nlyz opl lnin sssion""" un { "ovllffiiny": np.n(lninuv), "nionsbiliy": 1.0 - np.s(nion), "oniivlonn": 1.0 - np.n(oniivlo), } f uplonlnin(slf, nlysis: i[s, ny]): """Up lon- lnin ols""" pss # Siplifi iplnion f nlninonions(slf, nlysis: i[s, ny]) -> Lis[s]: """n lnin onions""" un [ " ul bs", "jus s iffiuly", "onio oniiv lo", ] # oniiv pn nlysis hos (siplifi) f nlyzoniivspns( slf, vns: Lis[oniivvn] ) -> i[s, ny]: """nlyz oniiv s pns""" ss = [.oniivs.vlu fo  in vns] un { "osoons": x(s(ss), y=ss.oun), "snsiions": ln(s(ss)), } f nlyznionpns( slf, vns: Lis[oniivvn] ) -> i[s, ny]: """nlyz nion pns""" un {"vfous": 0.7, "nionsbiliy": 0.8} f nlyzlninpns( slf, vns: Lis[oniivvn] ) -> i[s, ny]: """nlyz lnin pns""" un {"lninffiiny": 0.75, "nowlnion": 0.8} f nlyzbhviolpnspol( slf, vns: Lis[oniivvn] ) -> i[s, ny]: """nlyz bhviol pns ov i""" un {"bhvioonsisny": 0.7, "pionfquny": 0.3} f luloniivhyh( slf, vns: Lis[oniivvn] ) -> i[s, ny]: """lul oniiv hyh pns""" un {"yllnh": 30.0, "ppfoni": "onin"} f ssssoniivffiiny( slf, vns: Lis[oniivvn] ) -> i[s, ny]: """ssss oniiv ffiiny""" un {"possinffiiny": 0.8, "souuilizion": 0.75} f noniivinsihs( slf, snlysis: i[s, ny], nionnlysis: i[s, ny], lninnlysis: i[s, ny], bhviolnlysis: i[s, ny], oniivhyh: i[s, ny], ffiinyis: i[s, ny], ) -> Lis[s]: """n oniiv insihs""" un [ "oniiv pfon is sbl", "Lnin ffiiny shows posiiv n", "nion pns ini oo fous", "Bhviol onsisny is inin", ] f olsus(slf) -> i[s, ny]: """ ophnsiv ol sus""" un { "unoniivs": slf.unoniivs.vlu, "oniivpofil": slf.oniivpofil, "woinoyus": f"{ln(slf.woinoy)}/{slf.oniivpofil.woinoypiy}", "lonoyis": ln(slf.lonoy), "pisoioyis": ln(slf.pisoioy), "bhviopnsln": ln(slf.bhviopns), "noniivlo": ( np.n(slf.pfonis["oniivlo"][-10:]) if slf.pfonis["oniivlo"] ls 0.5 ), "nlninposs": ( np.n(slf.pfonis["lninposs"][-10:]) if slf.pfonis["lninposs"] ls 0.5 ), "lifloihpfon": slf.lifloih.pfonis(), } f lifoniivol( oniivpofil: Opionl[oniivPofil] = Non, ) -> LIFoniivBhviolol: """Foy funion o  L.I.F. oniiv ol""" un LIFoniivBhviolol(oniivpofil) # xpl us n sin f slifoniivol(): """s L.I.F. oniiv bhviol ol""" pin("sin L.I.F. oniiv Bhviol ol...") #  oniiv pofil pofil = oniivPofil( nionspn=0.8, woinoypiy=8, possinsp=1.2, oniivflxibiliy=0.7, lninffiiny=0.8, ) #  ol ol = lifoniivol(pofil) pin( f" oniiv ol wih pofil: W piy={pofil.woinoypiy}" ) # s oniiv vn possin vn = oniivvn( oniivs=oniivS.LNIN, vnyp="lnins", siulusfus={"iffiuly": 0.6, "novly": 0.8}, sponsfus={"uy": 0.85, "sponsi": 1.2}, onx={"syp": "oy", "nvionn": "qui"}, ) sul = ol.possoniivvn(vn) pin(f"Poss oniiv vn - Suss: {sul['suss']}") pin(f"oniiv lo: {sul['oniivlo']:.3f}") pin(f"nion fous: {sul['nionsul']['fouslvl']:.3f}") # s bhviol squn olin bhvios = [ BhvioPn( Bhvioyp.ONIIV, fquny=0.8, innsiy=0.7, suss=0.85 ), BhvioPn( Bhvioyp.PIV, fquny=0.6, innsiy=0.8, suss=0.75 ), BhvioPn( Bhvioyp.OO, fquny=0.9, innsiy=0.6, suss=0.90 ), ] squnsul = ol.olbhviolsqun( bhvios, {"sssionyp": "inin"} ) pin(f"ol bhviol squn - Lnh: {squnsul['squnlnh']}") pin(f"Squn ffiiny: {squnsul['squnffiiny']:.3f}") # s bhviol piion siulus = {"innsiy": 0.7, "oplxiy": 0.6, "novly": 0.4} onx = {"iofy": "onin", "oivion": 0.8} piion = ol.pibhviolspons(siulus, onx) pin( f"Bhviol piion onfin: {piion['onfinsos']['ovll']:.3f}" ) pin(f"onion: {piion['onion']}") # s lnin sssion siulion lninss = [ {"yp": "oy", "iffiuly": 0.5}, {"yp": "nion", "iffiuly": 0.6}, {"yp": "sonin", "iffiuly": 0.7}, ] sssionsul = ol.siullninsssion( lninss, sssionuion=20.0 ) pin(f"Lnin sssion - ss: {sssionsul['nuss']}") pin(f"Sssion ffiiny: {sssionsul['sssionffiiny']:.3f}") pin(f"nowl in: {sssionsul['nowlin']:.3f}") # s oniiv pn nlysis pnnlysis = ol.nlyzoniivpns() if "o" no in pnnlysis: pin(f"oniiv pn nlysis - vns: {pnnlysis['nuvns']}") pin(f"Insihs: {ln(pnnlysis['insihs'])}") #  ol sus sus = ol.olsus() pin(f"\nol Sus:") pin(f" un s: {sus['unoniivs']}") pin(f" Woin oy: {sus['woinoyus']}") pin(f" n oniiv lo: {sus['noniivlo']:.3f}") pin( f" L.I.F. pfon: {sus['lifloihpfon']['ovllpfon']:.3f}" ) un ol, sssionsul if n == "in": # un ss ol, suls = slifoniivol() pin("\nL.I.F. oniiv Bhviol ol sin opl sussfully!")