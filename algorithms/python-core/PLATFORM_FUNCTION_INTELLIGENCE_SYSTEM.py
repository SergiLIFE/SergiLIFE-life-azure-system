# us/bin/nv pyhon3 """ PLFO FUNION INLLIN SYS ====================================== onios n lns fo LL plfo funions oss LL L.I.F. plfos: Plfos onio: 1. LIFNPISPLFOL.hl 2. LIFUIONPLFOL.hl 3. LIFLINILPLFOBI.hl 4. LIFIPLFOL.hl 5. LIFSHPLFOL.hl 6. iionl o plfos Funion ois onio: * Nviion (bs, swihin) *  Opions (vi onnion, libion, nlysis) * nlyis (poin, visulizion, is) * Us Inions (buons, fos, inpus) *  Possin (nlysis, lulions, fosin) * Inion (PI lls, zu onnions) h loih lns fo: - Funion xuion filus - Pfon ion -  inonsisnis - Us inion issus - Sys sou onsins - oss-plfo pnnis opyih 2025 - Sio Py Boull L.I.F. Plfo - zu pl """ ipo synio ipo loin fo lsss ipo lss, fil fo i ipo i fo nu ipo nu fo ypin ipo ny, i, Lis, Opionl loin.bsionfi(lvl=loin.INFO) lo = loin.Lo(n) lss Funionoy(nu): """ois of plfo funions""" NVIION = "nviion" OPIONS = "opions" NLYIS = "nlyis" POIN = "poin" USINION = "usinion" POSSIN = "possin" SYSINION = "sysinion" VISULIZION = "visulizion" lss FunionSus(nu): """Funion xuion sus""" SUSS = "suss" FILU = "filu" IOU = "iou" PIL = "pil"  = "" @lss lss Funioni: """s pfon of  plfo funion""" plfon: s funionn: s oy: Funionoy isp: i sus: FunionSus xuionis: flo unvlu: Opionl[s] = Non oss: Opionl[s] = Non lloun: in = 0 sussoun: in = 0 filuoun: in = 0 suss: flo = 100.0 ussff: in = 0 f suss(slf) -> flo: if slf.lloun == 0: un 100.0 un (slf.sussoun / slf.lloun) * 100 @lss lss PlfoFunionLiby: """opl funion liby fo h plfo""" plfon: s funions: i[s, Funionoy] = fil(fulfoy=i) is: Lis[Funioni] = fil(fulfoy=lis) lshlhh: Opionl[i] = Non hlhso: flo = 100.0 # ============================================================================ # PLFO FUNION INVNOY # ============================================================================ PLFOFUNIONS = { "LIFNPISPLFOL": { # Nviion Funions "showb": Funionoy.NVIION, #  Opions "onnopo": Funionoy.OPIONS, "onnploy": Funionoy.OPIONS, "snFovis": Funionoy.OPIONS, "libNwo": Funionoy.OPIONS, "snpisnlysis": Funionoy.OPIONS, "nnpis": Funionoy.OPIONS, # nlyis & is "nlyzopnyPfon": Funionoy.NLYIS, "nlyzinin": Funionoy.NLYIS, "nlyzNulPns": Funionoy.NLYIS, "viwPiivnlyis": Funionoy.NLYIS, # OI & poin "lulOI": Funionoy.POIN, "nOIpo": Funionoy.POIN, "nOIFos": Funionoy.POIN, "nxuivpo": Funionoy.POIN, "nQulypo": Funionoy.POIN, # Us Inions "viwployils": Funionoy.USINION, "opiizLnin": Funionoy.USINION, "opiizPouiviy": Funionoy.USINION, "nhnFous": Funionoy.USINION, # inin "lunhNwinin": Funionoy.POSSIN, #  Ups "upnpisis": Funionoy.POSSIN, }, "LIFUIONPLFOL": { "showb": Funionoy.NVIION, "onnSun": Funionoy.OPIONS, "snlssoovis": Funionoy.OPIONS, "lunhLninSssion": Funionoy.POSSIN, "nlyzSunPfon": Funionoy.NLYIS, "nPosspo": Funionoy.POIN, "nionLvls": Funionoy.VISULIZION, "piviffiulyjus": Funionoy.USINION, }, "LIFLINILPLFOBI": { "showb": Funionoy.NVIION, "onnPin": Funionoy.OPIONS, "sblishBslin": Funionoy.OPIONS, "nolis": Funionoy.NLYIS, "lulnSo": Funionoy.NLYIS, "piovy": Funionoy.NLYIS, "nlinilpo": Funionoy.POIN, "opohos": Funionoy.NLYIS, }, "LIFIPLFOL": { "showb": Funionoy.NVIION, "slol": Funionoy.POSSIN, "unHypps": Funionoy.POSSIN, "unuoL": Funionoy.POSSIN, "llosous": Funionoy.SYSINION, "visulizis": Funionoy.VISULIZION, "bnhPfon": Funionoy.NLYIS, }, "LIFSHPLFOL": { "showb": Funionoy.NVIION, "uplos": Funionoy.SYSINION, "xFus": Funionoy.POSSIN, "unSisils": Funionoy.NLYIS, "fusuliplSuis": Funionoy.POSSIN, "nPubliionpo": Funionoy.POIN, "SuyPoss": Funionoy.VISULIZION, }, } # ============================================================================ # PLFO FUNION INLLIN SYS # ============================================================================ lss PlfoFunionInllin: """ onios n lns fo LL plfo funions oss ll L.I.F. plfos """ f ini(slf): slf.plfos: i[s, PlfoFunionLiby] = {} slf.funionfilus: i[s, Lis[Funioni]] = {} slf.lninpns: i[s, i[s, ny]] = {} slf.ossplfoinsihs: Lis[s] = [] slf.iniilizplfos() lo.info("SUSS: Plfo Funion Inllin Sys iniiliz") f iniilizplfos(slf): """Iniiliz funion in fo ll plfos""" fo plfon, funions in PLFOFUNIONS.is(): liby = PlfoFunionLiby( plfon=plfon, funions=funions ) slf.plfos[plfon] = liby slf.funionfilus[plfon] = [] slf.lninpns[plfon] = {} syn f oniofunionxuion( slf, plfon: s, funionn: s, xuionis: flo, sus: FunionSus, oss: Opionl[s] = Non, unvlu: Opionl[s] = Non, ussff: in = 0, ) -> i[s, ny]: """ onio  sinl funion xuion n ln fo i """ if plfon no in slf.plfos: un {"suss": Fls, "o": f"Plfo no foun: {plfon}"} plfo = slf.plfos[plfon] if funionn no in plfo.funions: un {"suss": Fls, "o": f"Funion no foun: {funionn}"} oy = plfo.funions[funionn] #  i i = Funioni( plfon=plfon, funionn=funionn, oy=oy, isp=i.now(), sus=sus, xuionis=xuionis, oss=oss, unvlu=unvlu, ussff=ussff, ) #  h i plfo.is.ppn(i) # If filu, o i if sus in [FunionSus.FILU, FunionSus.IOU]: slf.funionfilus[plfon].ppn(i) lo.wnin( f"L: {plfon}.{funionn}() fil: {oss}" ) # Ln fo his xuion wi slf.lnfoxuion(plfon, funionn, i) un { "plfo": plfon, "funion": funionn, "sus": sus.vlu, "xuionis": xuionis, "lnino": u, } syn f lnfoxuion( slf, plfon: s, funionn: s, i: Funioni ): """ loih lns pns fo funion xuion """ lniny = f"{plfon}:{funionn}" if lniny no in slf.lninpns[plfon]: slf.lninpns[plfon][lniny] = { "ollls": 0, "sussfullls": 0, "fillls": 0, "vxuioni": 0.0, "filuos": [], "onions": [], } pn = slf.lninpns[plfon][lniny] pn["ollls"] += 1 if i.sus == FunionSus.SUSS: pn["sussfullls"] += 1 ls: pn["fillls"] += 1 if i.oss: pn["filuos"].ppn(i.oss) # Up v xuion i pn["vxuioni"] = ( pn["vxuioni"] * (pn["ollls"] - 1) + i.xuionis ) / pn["ollls"] # n onions bs on pns wi slf.nfuniononions( plfon, funionn, pn ) syn f nfuniononions( slf, plfon: s, funionn: s, pn: i[s, ny] ): """ loih ns opiizion onions fo funions """ onions = [] # Pfon onions if pn["vxuioni"] > 1000: # > 1 son onions.ppn( f"OPIIZION: {funionn}() is slow ({pn['vxuioni']:.0f}s). " "onsi syn xuion o hin." ) # libiliy onions if pn["ollls"] > 0: filu = (pn["fillls"] / pn["ollls"]) * 100 if filu > 10: # > 10% filu  onions.ppn( f"LIBILIY: {funionn}() hs {filu:.1f}% filu . " "Invsi: " + s(s(pn["filuos"][:3])) ) pn["onions"] = onions syn f nlyzllfunions(slf) -> i[s, ny]: """ ophnsiv nlysis of ll plfo funions """ nlysis = { "isp": i.now().isofo(), "olplfos": ln(slf.plfos), "olfunions": 0, "plfosuis": {}, "funionfilusbyoy": {}, "ossplfoinsihs": [], "loihlninsuy": {}, } fo plfon, plfo in slf.plfos.is(): nlysis["olfunions"] += ln(plfo.funions) # Plfo suy ollls = ln(plfo.is) fillls = ln(slf.funionfilus[plfon]) hlhso = ( ((ollls - fillls) / ollls * 100) if ollls > 0 ls 100.0 ) plfo.hlhso = hlhso nlysis["plfosuis"][plfon] = { "olfunions": ln(plfo.funions), "olxuions": ollls, "filxuions": fillls, "hlhso": hlhso, "sus": ( "O" if hlhso >= 95 ls "NSNION" if hlhso >= 80 ls "IIL" ), } # oiz filus fo i in slf.funionfilus[plfon]: n = i.oy.vlu if n no in nlysis["funionfilusbyoy"]: nlysis["funionfilusbyoy"][n] = [] nlysis["funionfilusbyoy"][n].ppn( f"{i.plfon}.{i.funionn}()" ) # oss-plfo insihs nlysis["ossplfoinsihs"] = ( wi slf.nossplfoinsihs() ) # loih lnin suy fo plfon, pns in slf.lninpns.is(): nlysis["loihlninsuy"][plfon] = { "funionsln": ln(pns), "pnso": su( 1 fo p in pns.vlus() if p["ollls"] > 0 ), "opiizionoppouniis": su( 1 fo p in pns.vlus() if ln(p["onions"]) > 0 ), } un nlysis syn f nossplfoinsihs(slf) -> Lis[s]: """ loih inifis pns oss ulipl plfos """ insihs = [] # Fin oon filu os filuosbyfunion = {} fo plfon, pns in slf.lninpns.is(): fo funpn,  in pns.is(): funn = funpn.spli(":")[1] if funn no in filuosbyfunion: filuosbyfunion[funn] = [] filuosbyfunion[funn].xn(["filuos"]) # po oss-plfo issus fo funn, filus in filuosbyfunion.is(): if ln(filus) > 3: # S filu oss ulipl plfos insihs.ppn( f"OSS-PLFO: {funn}() fils onsisnly. " f"Filus: {lis(s(filus))[:3]}" ) un insihs syn f npfunionpo(slf, plfon: s) -> i[s, ny]: """ il po on vy funion in  plfo """ if plfon no in slf.plfos: un {"o": "Plfo no foun"} plfo = slf.plfos[plfon] po = { "plfo": plfon, "n": i.now().isofo(), "olhlhso": plfo.hlhso, "funions": {}, } fo funn, oy in plfo.funions.is(): is = [ fo  in plfo.is if .funionn == funn] if no is: sus = "NOXU" ss = {"sus": sus} ls: sussful = ln( [ fo  in is if .sus == FunionSus.SUSS] ) suss = (sussful / ln(is)) * 100 vi = su(.xuionis fo  in is) / ln(is) sus = ( "O" if suss >= 95 ls "" if suss >= 80 ls "FIL" ) ss = { "sus": sus, "ollls": ln(is), "sussful": sussful, "fil": ln(is) - sussful, "suss": suss, "vxuionis": vi, "oy": oy.vlu, } #  lnin onions lniny = f"{plfon}:{funn}" if lniny in slf.lninpns[plfon]: pn = slf.lninpns[plfon][lniny] ss["onions"] = pn.("onions", []) po["funions"][funn] = ss un po syn f niopiizionpln(slf, plfon: s) -> i[s, ny]: """ loih ns ophnsiv opiizion pln fo ni plfo """ po = wi slf.npfunionpo(plfon) opiizionpln = { "plfo": plfon, "n": i.now().isofo(), "pioiyfixs": [], "pfonipovns": [], "libiliynhnns": [], "ossfunionopiizions": [], } fo funn, ss in po.("funions", {}).is(): if ss.("sus") == "FIL": opiizionpln["pioiyfixs"].ppn( f"FIX: {funn}() - Suss  {ss.('suss', 0):.1f}%" ) if ss.("vxuionis", 0) > 500: opiizionpln["pfonipovns"].ppn( f"OPIIZ: {funn}() - xuion i {ss.('vxuionis', 0):.0f}s" ) if ss.("onions"): fo  in ss["onions"]: if "LIBILIY" in : opiizionpln["libiliynhnns"].ppn() lif "OPIIZION" in : opiizionpln["pfonipovns"].ppn() un opiizionpln # ============================================================================ # ONSION # ============================================================================ syn f onsfunioninllin(): """ ons plfo funion inllin oss ll plfos """ pin("\n" + "=" * 80) pin("PLFO FUNION INLLIN SYS - OPHNSIV ONIOIN") pin("=" * 80 + "\n") sys = PlfoFunionInllin() # Siul funion xuions oss plfos pin("PHS 1: onioin funion xuions oss ll plfos...\n") # npis Plfo - so filus wi sys.oniofunionxuion( "LIFNPISPLFOL", "showb", xuionis=45, sus=FunionSus.SUSS, ) wi sys.oniofunionxuion( "LIFNPISPLFOL", "showb", xuionis=2500, sus=FunionSus.FILU, oss="b ln no iniv", ) wi sys.oniofunionxuion( "LIFNPISPLFOL", "onnopo", xuionis=1200, sus=FunionSus.SUSS, ) wi sys.oniofunionxuion( "LIFNPISPLFOL", "nlyzopnyPfon", xuionis=3500, sus=FunionSus., oss="Slow nlysis xuion", ) # uion Plfo wi sys.oniofunionxuion( "LIFUIONPLFOL", "showb", xuionis=40, sus=FunionSus.SUSS, ) wi sys.oniofunionxuion( "LIFUIONPLFOL", "onnSun", xuionis=1100, sus=FunionSus.SUSS, ) # linil Plfo wi sys.oniofunionxuion( "LIFLINILPLFOBI", "sblishBslin", xuionis=2000, sus=FunionSus.SUSS, ) wi sys.oniofunionxuion( "LIFLINILPLFOBI", "nolis", xuionis=800, sus=FunionSus.SUSS, ) pin("SUSS: onio funion xuions o\n") # nlyz ll funions pin("PHS 2: nlyzin ll plfo funions...\n") nlysis = wi sys.nlyzllfunions() pin(f"ol Plfos onio: {nlysis['olplfos']}") pin(f"ol Funions : {nlysis['olfunions']}\n") pin("PLFO HLH SOS:") fo plfo, suy in nlysis["plfosuis"].is(): pin(f" {plfo}: {suy['hlhso']:.1f}% - {suy['sus']}") # P-plfo il po pin("\n" + "-" * 80) pin("PHS 3: il funion po fo npis Plfo...\n") npispo = wi sys.npfunionpo( "LIFNPISPLFOL" ) fo funn, ss in npispo.("funions", {}).is(): if ss.("sus") != "NOXU": pin(f" {funn}():") pin(f" Sus: {ss.('sus')}") pin( f" lls: {ss.('ollls')} | Suss: {ss.('suss', 0):.1f}%" ) pin(f" v i: {ss.('vxuionis', 0):.0f}s") if ss.("onions"): fo  in ss["onions"][:1]: pin(f" ONION: {}") # Opiizion pln pin("\n" + "-" * 80) pin("PHS 4: I-n opiizion pln...\n") oppln = wi sys.niopiizionpln( "LIFNPISPLFOL" ) if oppln["pioiyfixs"]: pin("PIOIY FIXS:") fo fix in oppln["pioiyfixs"][:3]: pin(f" - {fix}") if oppln["pfonipovns"]: pin("\nPFON IPOVNS:") fo ip in oppln["pfonipovns"][:3]: pin(f" - {ip}") pin("\n" + "=" * 80) pin("SUSS: Funion Inllin Sys fully opionl") pin("loih is now onioin n lnin fo LL plfo funions") pin("=" * 80 + "\n") un sys if n == "in": sys = synio.un(onsfunioninllin()) pin("PBILIIS:") pin(" * onios 50+ plfo funions") pin(" * s suss/filu s") pin(" * sus xuion pfon") pin(" * Inifis filu pns") pin(" * ns opiizion onions") pin(" * oss-plfo insih nion") pin(" * uo fix nion") pin(" * oninuous lnin") pin("\nh loih now lns fo VY funion oss LL plfos!")