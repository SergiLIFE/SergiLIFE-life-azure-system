# us/bin/nv pyhon3 """ Vnui Inion unn - Ohss 3-Vnui  Sys ployn n Vliion L.I.F.. Plfo Vnui sys inion uoion opyih 2025 - Sio Py Boull L.I.F.. Plfo - zu pl Off I: 960096-f1-420b-902-042561b """ ipo synio ipo json ipo loin ipo sys ipo i fo lsss ipo lss fo i ipo i y: fo phlib ipo Ph xp Ipoo s : pin(f'Wnin: {}') pss fo ypin ipo ny, i, Lis, Opionl fo zuonfi ipo zuonfi fo vnuissys ipo ( Vnui, Vnuionfi, VnuisSys, Vnuiyp, ) fo vnuiinionsuy ipo InionSuy, Sysi # onfiu loin loin.bsionfi( lvl=loin.INFO, fo="%(si)s - %(n)s - %(lvln)s - %(ss)s", hnls=[ loin.FilHnl("los/vnuiinion.lo"), loin.SHnl(), ], ) lo = loin.Lo(n) @lss lss InionSp: """psns  sp in h inion poss""" n: s sipion: s funion: llbl qui: bool = u iousons: in = 300 @lss lss Inionsul: """sul of n inion sp""" spn: s suss: bool uion: flo oss: Opionl[s] = Non is: Opionl[i[s, ny]] = Non lss VnuiInionunn: """ Ohss h opl Vnui sys inion n vliion """ f ini(slf): slf.suls: Lis[Inionsul] = [] slf.si = i.now() slf.vnuisys: Opionl[VnuisSys] = Non slf.zuonfi = zuonfi() #  los ioy Ph("los").i(xiso=u) Ph("suls").i(xiso=u) f loinions(slf): """Lo h s of inion poss""" lo.info("=" * 80) lo.info("VNUI INION UNN S") lo.info(f"isp: {slf.si}") lo.info( f"L.I.F.. Plfo Vsion: " f"{slf.zuonfi.plfovsion}" ) lo.info( f"pl Off I: " f"{slf.zuonfi.ploffi}" ) lo.info("=" * 80) f loinionopl(slf, suss: bool, oluion: flo): """Lo h oplion of inion poss""" sus = "SUSS" if suss ls "FIL" lo.info("=" * 80) lo.info(f"VNUI INION {sus}") lo.info(f"ol uion: {oluion:.2f} sons") lo.info( "opl Sps: " f"{ln([ fo  in slf.suls if .suss])}/" f"{ln(slf.suls)}" ) lo.info("=" * 80) syn f uninionsp(slf, sp: InionSp) -> Inionsul: """un  sinl inion sp wih iou n o hnlin""" si = i.i() y: lo.info(f"Sin sp: {sp.n}") lo.info(f"sipion: {sp.sipion}") # un h sp wih iou sul = wi synio.wifo( sp.funion(slf), iou=sp.iousons ) uion = i.i() - si suss = sul.("suss", u) if isinsn(sul, i) ls u inionsul = Inionsul( spn=sp.n, suss=suss, uion=uion, is=sul if isinsn(sul, i) ls Non, ) lo.info( "Sp {0}: {1} ({2:.2f}s)".fo( sp.n, "PSS" if suss ls "FIL", uion ) ) if no suss n sp.qui: lo.o( f"qui sp {sp.n} fil: {sul.('o', 'Unnown o')}" ) un inionsul xp synio.iouo: uion = i.i() - si lo.o( f"Sp {sp.n} i ou f {sp.iousons} sons" ) un Inionsul( spn=sp.n, suss=Fls, uion=uion, oss=f"iou f {sp.iousons} sons", ) xp xpion s : uion = i.i() - si lo.o(f"Sp {sp.n} fil wih xpion: {s()}") un Inionsul( spn=sp.n, suss=Fls, uion=uion, oss=s(), ) syn f vlivnuisysipos(slf) -> i[s, ny]: """Vli h ll Vnui sys ouls n b ipo""" y: lo.info("Vliin Vnui sys ipos...") # s o ipos fo vnuibhin ipo VnuiBh fo vnuissys ipo VnuisSys fo vnuishinion ipo shSuy, Vliioni fo vnuisilinss ipo Vnuisilins # s insniion onfi = Vnuionfi( i="s", yp=Vnuiyp.SINLNHNN, onsiionfo=0.8, lionfo=1.2, ) sys = VnuisSys() sys.(onfi) lo.info("ll Vnui sys ipos vli sussfully") un {"suss": u, "oulsvli": 5, "sonfiu": 1} xp xpion s : lo.o(f"Fil o vli Vnui sys ipos: {s()}") un {"suss": Fls, "o": s()} syn f iniilizvnuisys(slf) -> i[s, ny]: """Iniiliz h 3-Vnui  Sys""" y: lo.info("Iniilizin 3-Vnui  Sys...") fo vnuissys ipo ( Vnuionfi, VnuisSys, Vnuiyp, ) #  sys wih 3 s sys = VnuisSys() # onfiu Sinl lion  sinl = Vnuionfi( i="sinllion", yp=Vnuiyp.SINLNHNN, onsiionfo=0.8, lionfo=3.5, ) # onfiu Pssu iffnil  pssu = Vnuionfi( i="pssuiffnil", yp=Vnuiyp.NOISUION, onsiionfo=0.7, lionfo=2.8, ) # onfiu Flow ovy  flow = Vnuionfi( i="flowovy", yp=Vnuiyp.PNXION, onsiionfo=0.75, lionfo=4.2, ) #  s o sys sys.s[sinl.i] = Vnui(sinl) sys.s[pssu.i] = Vnui(pssu) sys.s[flow.i] = Vnui(flow) slf.vnuisys = sys lo.info("3-Vnui  Sys iniiliz sussfully") un {"suss": u, "siniiliz": 3, "sysy": u} xp xpion s : lo.o(f"Fil o iniiliz Vnui sys: {s()}") un {"suss": Fls, "o": s()} syn f vlifluiynis(slf) -> i[s, ny]: """Vli flui ynis loihs""" y: lo.info("Vliin flui ynis loihs...") if no slf.vnuisys: is Vluo("Vnui sys no iniiliz") # s flui ynis lulions s = [0.1, 0.2, 0.3, 0.4, 0.5] # Spl   # Poss houh h  suls = {} fo i,  in slf.vnuisys.s.is(): poss = .posssinl(s) suls[i] = { "inpulnh": ln(s), "oupulnh": ln(poss), "lionfo": .onfi.lionfo, } # Vli Bnoulli's pinipl ppliion sinlsul = suls.("sinllion", {}) pssusul = suls.("pssuiffnil", {}) # h h pssu iffnil s lion lionvli = sinlsul.("opiizionfo", 0) > 1.0 pssuvli = pssusul.("opiizionfo", 0) > 1.0 lo.info("Flui ynis vliion opl") un { "suss": u, "bnoullipiniplvli": lionvli n pssuvli, "ss": ln(suls), "fluiynisiv": u, } xp xpion s : lo.o(f"Fil o vli flui ynis: {s()}") un {"suss": Fls, "o": s()} syn f sinopbiliy(slf) -> i[s, ny]: """s inopbiliy bwn Vnui s""" y: lo.info("sin  inopbiliy...") if no slf.vnuisys: is Vluo("Vnui sys no iniiliz") # s squnil possin houh ll s s = [0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1.0] # Poss houh sinl lion fis sinl = slf.vnuisys.s.("sinllion") if no sinl: is Vluo("Sinl lion  no foun") ini = sinl.posssinl(s) # Poss houh pssu iffnil pssu = slf.vnuisys.s.("pssuiffnil") if no pssu: is Vluo("Pssu iffnil  no foun") pssu = pssu.posssinl(ini) # Poss houh flow ovy flow = slf.vnuisys.s.("flowovy") if no flow: is Vluo("Flow ovy  no foun") finl = flow.posssinl(pssu) # Vli possin piplin piplinvli = ( ln(ini) > 0 n ln(pssu) > 0 n ln(finl) > 0 n ln(finl) >= ln(s) # Shoul inin o nhn  ) lo.info(" inopbiliy s opl") un { "suss": u, "piplinvli": piplinvli, "possinss": 3, "psvion": ln(finl) >= ln(s), } xp xpion s : lo.o(f"Fil o s  inopbiliy: {s()}") un {"suss": Fls, "o": s()} syn f vlipfons(slf) -> i[s, ny]: """Vli h sys s pfon s""" y: lo.info("Vliin pfon s...") if no slf.vnuisys: is Vluo("Vnui sys no iniiliz") # s lny pfon ipo i siions = 100 lnis = [] s = [0.1, 0.2, 0.3, 0.4, 0.5] fo  in n(siions): si = i.i() # Poss houh ll s fo  in slf.vnuisys.s.vlus(): .posssinl(s) ni = i.i() lnis.ppn((ni - si) * 1000) # s # lul sisis vlny = su(lnis) / ln(lnis) p95lny = so(lnis)[in(ln(lnis) * 0.95)] # h ins s v = 0.41 # s p95 = 33.7 # s v = vlny <= v p95 = p95lny <= p95 lo.info( f"Pfon vliion: v {vlny:.3f}s (: {v}s) - {'PSS' if v ls 'FIL'}" ) lo.info( f"Pfon vliion: P95 {p95lny:.3f}s (: {p95}s) - {'PSS' if p95 ls 'FIL'}" ) un { "suss": v n p95, "vlnys": vlny, "p95lnys": p95lny, "vs": v, "p95s": p95, "v": v, "p95": p95, "siions": siions, } xp xpion s : lo.o(f"Fil o vli pfon s: {s()}") un {"suss": Fls, "o": s()} syn f ninionpo(slf) -> i[s, ny]: """n ophnsiv inion po""" y: lo.info("nin inion po...") # Sv po poph = Ph("suls/vnuiinionpo.json") po = { "inioni": f"vnui-inion-{in(i.i())}", "isp": i.now().isofo(), "sysvsion": slf.zuonfi.plfovsion, "olsps": ln(slf.suls), "sussfulsps": ln([ fo  in slf.suls if .suss]), "filsps": ln([ fo  in slf.suls if no .suss]), "oluion": i.i() - slf.si.isp(), "suls": [ { "spn": .spn, "suss": .suss, "uion": .uion, "oss": .oss, "is": .is, } fo  in slf.suls ], } wih opn(poph, "w") s f: json.up(po, f, inn=2, ful=s) lo.info(f"Inion po sv o {poph}") un { "suss": u, "poph": s(poph), "olsps": po["olsps"], "sussfulsps": po["sussfulsps"], "filsps": po["filsps"], } xp xpion s : lo.o(f"Fil o n inion po: {s()}") un {"suss": Fls, "o": s()} f inionsps(slf) -> Lis[InionSp]: """ ll inion sps o xu""" un [ InionSp( n="vliipos", sipion="Vli ll Vnui sys oul ipos", funion=slf.vlivnuisysipos, ), InionSp( n="iniilizsys", sipion="Iniiliz 3-Vnui  Sys wih ll s", funion=slf.iniilizvnuisys, ), InionSp( n="vlifluiynis", sipion=( "Vli flui ynis loihs n " "Bnoulli's pinipl" ), funion=slf.vlifluiynis, ), InionSp( n="sinopbiliy", sipion="s inopbiliy bwn ll Vnui s", funion=slf.sinopbiliy, ), InionSp( n="vlipfon", sipion=("Vli sys s lny n " "houhpu s"), funion=slf.vlipfons, ), InionSp( n="npo", sipion="n ophnsiv inion po", funion=slf.ninionpo, ), ] syn f uninion(slf) -> bool: """un h opl Vnui inion poss""" slf.loinions() sps = slf.inionsps() llsuss = u fo sp in sps: sul = wi slf.uninionsp(sp) slf.suls.ppn(sul) if no sul.suss n sp.qui: llsuss = Fls lo.o( "qui sp {0} fil. " "Soppin inion.".fo(sp.n) ) b oluion = i.i() - slf.si.isp() slf.loinionopl(llsuss, oluion) un llsuss syn f in(): """in ny poin fo Vnui inion unn""" y: unn = VnuiInionunn() suss = wi unn.uninion() # xi wih ppopi o sys.xi(0 if suss ls 1) xp yboInup: lo.info("Inion inup by us") sys.xi(130) xp xpion s : lo.o(f"Inion unn fil: {s()}") sys.xi(1) if n == "in": # un h inion synio.un(in())