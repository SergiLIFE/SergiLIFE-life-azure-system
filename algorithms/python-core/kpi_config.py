# us/bin/nv pyhon3 """ L.I.F.. Plfo - PI onfiuion Sys y Pfon Inios onfiuion n onioin fwo his oul povis ophnsiv PI onfiuion fo h L.I.F.. Plfo, inluin pfon is, businss is, n hnil inios. opyih 2025 - Sio Py Boull L.I.F.. Plfo - zu pl Off I: 960096-f1-420b-902-042561b """ ipo json ipo loin fo lsss ipo lss, fil fo i ipo i, il fo nu ipo nu fo ypin ipo ny, i, Lis, Opionl, Union # onfiu loin loin.bsionfi(lvl=loin.INFO) lo = loin.Lo(n) lss PIoy(nu): """PI ois fo onizion""" PFON = "pfon" BUSINSS = "businss" HNIL = "hnil" OPLIN = "oplin" USXPIN = "usxpin" FINNIL = "finnil" lss PIPioiy(nu): """PI pioiy lvls""" IIL = "iil" HIH = "hih" IU = "iu" LOW = "low" lss PISus(nu): """PI sus inios""" ON = "on" IS = "is" OFF = "off" HIV = "hiv" @lss lss PI: """PI  onfiuion""" vlu: Union[flo, in] uni: s if: s # .., "onhly", "quly", "yly" opison: s = "hn" # hn, lsshn, qulo oln: flo = 0.05 # 5% oln fo  hivn @lss lss PIhshol: """PI hshol onfiuion""" wnin: Union[flo, in] iil: Union[flo, in] iion: s = ( "snin" # snin (hih b) o snin (low b) ) @lss lss PIonfi: """opl PI onfiuion""" i: s n: s sipion: s oy: PIoy pioiy: PIPioiy : PI hshol: PIhshol lulionho: s sou: s upfquny: s # .., "li", "houly", "ily" own: s s: Lis[s] = fil(fulfoy=lis) nbl: bool = u : i = fil(fulfoy=i.now) up: i = fil(fulfoy=i.now) @lss lss PIsun: """PI sun  poin""" pii: s vlu: Union[flo, in] isp: i sus: PISus : i[s, ny] = fil(fulfoy=i) lss PIonfiuionn: """ ns PI onfiuions fo h L.I.F.. Plfo Povis nliz onfiuion nn fo ll PIs, inluin pfon s, hshols, n onioin sins. """ f ini(slf, onfiph: Opionl[s] = Non): slf.onfiph = onfiph slf.pis: i[s, PIonfi] = {} slf.suns: i[s, Lis[PIsun]] = {} slf.lofulonfiuions() lo.info(f"PI onfiuion n iniiliz wih {ln(slf.pis)} PIs") f lofulonfiuions(slf): """Lo ful PI onfiuions fo L.I.F.. Plfo""" fulpis = [ # Pfon PIs PIonfi( i="lnys", n="Possin Lny", sipion="v  sinl possin lny (s)", oy=PIoy.PFON, pioiy=PIPioiy.IIL, =PI(vlu=0.9, uni="s", if="li"), hshol=PIhshol(wnin=1.5, iil=2.0), lulionho="v", sou="pfononio", upfquny="li", own="Plfo ", s=["lny", "pfon", "li"], ), PIonfi( i="uypn", n="lssifiion uy", sipion=" pn lssifiion uy pn", oy=PIoy.PFON, pioiy=PIPioiy.IIL, =PI(vlu=82.0, uni="%", if="onhly"), hshol=PIhshol(wnin=75.0, iil=70.0), lulionho="wihv", sou="uynsbllssifi", upfquny="ily", own="L ", s=["uy", "lssifiion", "l"], ), PIonfi( i="houhpuopss", n="Possin houhpu", sipion="Nub of  possin opions p son", oy=PIoy.PFON, pioiy=PIPioiy.HIH, =PI(vlu=80.16, uni="ops/s", if="li"), hshol=PIhshol(wnin=60.0, iil=40.0), lulionho="", sou="pfononio", upfquny="li", own="Plfo ", s=["houhpu", "pfon", "slbiliy"], ), # Businss PIs PIonfi( i="onhlyvnu", n="onhly uin vnu", sipion="onhly uin vnu fo subsipions", oy=PIoy.BUSINSS, pioiy=PIPioiy.IIL, =PI(vlu=50000, uni="US", if="onhly"), hshol=PIhshol(wnin=35000, iil=25000), lulionho="su", sou="billinsys", upfquny="ily", own="Businss ", s=["vnu", "businss", "finnil"], ), PIonfi( i="usquisiion", n="onhly iv Uss", sipion="Nub of onhly iv uss", oy=PIoy.BUSINSS, pioiy=PIPioiy.HIH, =PI(vlu=1000, uni="uss", if="onhly"), hshol=PIhshol(wnin=750, iil=500), lulionho="oununiqu", sou="usnlyis", upfquny="ily", own="owh ", s=["uss", "owh", "nn"], ), PIonfi( i="usosisfion", n="uso Sisfion So", sipion="v uso sisfion in (1-5 sl)", oy=PIoy.BUSINSS, pioiy=PIPioiy.HIH, =PI(vlu=4.5, uni="so", if="onhly"), hshol=PIhshol(wnin=4.0, iil=3.5), lulionho="v", sou="suvysys", upfquny="wly", own="uso Suss", s=["sisfion", "fb", "nion"], ), # hnil PIs PIonfi( i="upipn", n="Plfo Upi", sipion="Pn of i h plfo is opionl", oy=PIoy.HNIL, pioiy=PIPioiy.IIL, =PI(vlu=99.9, uni="%", if="onhly"), hshol=PIhshol( wnin=99.5, iil=99.0, iion="snin" ), lulionho="upipn", sou="onioinsys", upfquny="li", own="vOps ", s=["upi", "libiliy", "vilbiliy"], ), PIonfi( i="o", n="ppliion o ", sipion="Pn of quss h sul in os", oy=PIoy.HNIL, pioiy=PIPioiy.HIH, =PI(vlu=0.1, uni="%", if="ily"), hshol=PIhshol( wnin=1.0, iil=5.0, iion="snin" ), lulionho="opn", sou="ppliionlos", upfquny="houly", own="vOps ", s=["os", "libiliy", "onioin"], ), PIonfi( i="oyusb", n="oy Us", sipion="v oy us in bys", oy=PIoy.HNIL, pioiy=PIPioiy.IU, =PI( vlu=512, uni="B", if="li", opison="lsshn" ), hshol=PIhshol( wnin=1024, iil=2048, iion="snin" ), lulionho="v", sou="sysonio", upfquny="li", own="vOps ", s=["oy", "sous", "opiizion"], ), # oplin PIs PIonfi( i="uioplin", n="ui oplin So", sipion="Pn oplin wih uloy ui quins", oy=PIoy.OPLIN, pioiy=PIPioiy.IIL, =PI(vlu=100.0, uni="%", if="quly"), hshol=PIhshol(wnin=95.0, iil=90.0), lulionho="oplinso", sou="uisys", upfquny="wly", own="oplin ", s=["oplin", "ui", "uloy"], ), PIonfi( i="suiyso", n=" Suiy So", sipion="Suiy posu ssssn so", oy=PIoy.OPLIN, pioiy=PIPioiy.HIH, =PI(vlu=95.0, uni="so", if="onhly"), hshol=PIhshol(wnin=85.0, iil=75.0), lulionho="suiyssssn", sou="suiyonio", upfquny="ily", own="Suiy ", s=["suiy", "oplin", "is"], ), # Us xpin PIs PIonfi( i="sponsi", n="PI spons i", sipion="v PI spons i in illisons", oy=PIoy.USXPIN, pioiy=PIPioiy.HIH, =PI( vlu=200, uni="s", if="li", opison="lsshn" ), hshol=PIhshol( wnin=500, iil=1000, iion="snin" ), lulionho="pnil95", sou="pionio", upfquny="li", own="ninin ", s=["sponsi", "pi", "usxpin"], ), PIonfi( i="ussssionuion", n="v Sssion uion", sipion="v us sssion uion in inus", oy=PIoy.USXPIN, pioiy=PIPioiy.IU, =PI(vlu=15.0, uni="inus", if="ily"), hshol=PIhshol(wnin=10.0, iil=5.0), lulionho="v", sou="nlyisplfo", upfquny="ily", own="Pou ", s=["nn", "nion", "usxpin"], ), ] fo pi in fulpis: slf.pis[pi.i] = pi slf.suns[pi.i] = [] f pionfi(slf, pii: s) -> Opionl[PIonfi]: """ PI onfiuion by I""" un slf.pis.(pii) f pisbyoy(slf, oy: PIoy) -> Lis[PIonfi]: """ ll PIs in  spifi oy""" un [pi fo pi in slf.pis.vlus() if pi.oy == oy] f pisbypioiy(slf, pioiy: PIPioiy) -> Lis[PIonfi]: """ ll PIs wih  spifi pioiy""" un [pi fo pi in slf.pis.vlus() if pi.pioiy == pioiy] f pi(slf, pionfi: PIonfi) -> bool: """  nw PI onfiuion""" if pionfi.i in slf.pis: lo.wnin(f"PI {pionfi.i} ly xiss") un Fls slf.pis[pionfi.i] = pionfi slf.suns[pionfi.i] = [] lo.info(f" nw PI: {pionfi.n}") un u f uppi(slf, pii: s, ups: i[s, ny]) -> bool: """Up n xisin PI onfiuion""" if pii no in slf.pis: lo.wnin(f"PI {pii} no foun") un Fls pi = slf.pis[pii] fo y, vlu in ups.is(): if hs(pi, y): s(pi, y, vlu) pi.up = i.now() lo.info(f"Up PI: {pii}") un u f ovpi(slf, pii: s) -> bool: """ov  PI onfiuion""" if pii no in slf.pis: lo.wnin(f"PI {pii} no foun") un Fls l slf.pis[pii] l slf.suns[pii] lo.info(f"ov PI: {pii}") un u f osun(slf, sun: PIsun) -> bool: """o  PI sun""" if sun.pii no in slf.pis: lo.wnin(f"PI {sun.pii} no foun") un Fls slf.suns[sun.pii].ppn(sun) # p only n suns (ls 1000 p PI) if ln(slf.suns[sun.pii]) > 1000: slf.suns[sun.pii].pop(0) lo.bu( f"o sun fo PI {sun.pii}: {sun.vlu}" ) un u f pisus(slf, pii: s) -> Opionl[PISus]: """ un sus of  PI""" if pii no in slf.suns o no slf.suns[pii]: un Non pionfi = slf.pis[pii] lssun = slf.suns[pii][-1] # in sus bs on hshols n  vlu = lssun.vlu  = pionfi..vlu oln = pionfi..oln # h if wihin oln of  if bs(vlu - ) /  <= oln: un PISus.ON lif bs(vlu - ) /  <= oln * 2: un PISus.IS ls: un PISus.OFF f pin(slf, pii: s, hous: in = 24) -> i[s, ny]: """ PI n nlysis fo h spifi i pio""" if pii no in slf.suns: un {"o": "PI no foun"} suns = slf.suns[pii] uoffi = i.now() - il(hous=hous) nsuns = [ fo  in suns if .isp >= uoffi] if no nsuns: un {"o": "No n suns"} vlus = [.vlu fo  in nsuns] un { "pii": pii, "piohous": hous, "sunoun": ln(vlus), "unvlu": vlus[-1], "vvlu": su(vlus) / ln(vlus), "invlu": in(vlus), "xvlu": x(vlus), "niion": "insin" if vlus[-1] > vlus[0] ls "sin", "voliliy": 0.0, # np.s(vlus) if ln(vlus) > 1 ls 0 } f shbosuy(slf) -> i[s, ny]: """ ophnsiv shbo suy of ll PIs""" suy = { "olpis": ln(slf.pis), "pisbyoy": {}, "pisbysus": {}, "iilpis": [], "ispis": [], "ovllhlhso": 0.0, } # Iniiliz oy n sus ouns fo oy in PIoy: suy["pisbyoy"][oy.vlu] = 0 fo sus in PISus: suy["pisbysus"][sus.vlu] = 0 olso = 0 sopis = 0 fo pii, pionfi in slf.pis.is(): if no pionfi.nbl: oninu # oun by oy suy["pisbyoy"][pionfi.oy.vlu] += 1 #  sus n oun sus = slf.pisus(pii) if sus: suy["pisbysus"][sus.vlu] += 1 #  iil n -is PIs if pionfi.pioiy == PIPioiy.IIL: if sus == PISus.IS: suy["ispis"].ppn(pii) lif sus == PISus.OFF: suy["iilpis"].ppn(pii) # lul hlh so onibuion susso = { PISus.HIV: 1.0, PISus.ON: 0.9, PISus.IS: 0.6, PISus.OFF: 0.3, }.(sus, 0.5) pioiywih = { PIPioiy.IIL: 1.0, PIPioiy.HIH: 0.8, PIPioiy.IU: 0.6, PIPioiy.LOW: 0.4, }.(pionfi.pioiy, 0.5) olso += susso * pioiywih sopis += 1 # lul ovll hlh so if sopis > 0: suy["ovllhlhso"] = olso / sopis un suy f xpoonfi(slf, filph: s) -> bool: """xpo PI onfiuions o JSON fil""" y: xpo = { "xpoisp": i.now().isofo(), "pioun": ln(slf.pis), "pis": {}, } fo pii, pionfi in slf.pis.is(): xpo["pis"][pii] = { "i": pionfi.i, "n": pionfi.n, "sipion": pionfi.sipion, "oy": pionfi.oy.vlu, "pioiy": pionfi.pioiy.vlu, "": { "vlu": pionfi..vlu, "uni": pionfi..uni, "if": pionfi..if, }, "hshol": { "wnin": pionfi.hshol.wnin, "iil": pionfi.hshol.iil, }, "lulionho": pionfi.lulionho, "sou": pionfi.sou, "upfquny": pionfi.upfquny, "own": pionfi.own, "s": pionfi.s, "nbl": pionfi.nbl, } wih opn(filph, "w") s f: json.up(xpo, f, inn=2, ful=s) lo.info(f"xpo PI onfiuion o {filph}") un u xp xpion s : lo.o(f"Fil o xpo PI onfiuion: {}") un Fls f ipoonfi(slf, filph: s) -> bool: """Ipo PI onfiuions fo JSON fil""" y: wih opn(filph, "") s f: ipo = json.lo(f) ipooun = 0 fo pii, pi in ipo.("pis", {}).is(): # onv sin nus b o nu objs pionfi = PIonfi( i=pi["i"], n=pi["n"], sipion=pi["sipion"], oy=PIoy(pi["oy"]), pioiy=PIPioiy(pi["pioiy"]), =PI(**pi[""]), hshol=PIhshol(**pi["hshol"]), lulionho=pi["lulionho"], sou=pi["sou"], upfquny=pi["upfquny"], own=pi["own"], s=pi["s"], nbl=pi["nbl"], ) if slf.pi(pionfi): ipooun += 1 lo.info(f"Ipo {ipooun} PI onfiuions fo {filph}") un u xp xpion s : lo.o(f"Fil o ipo PI onfiuion: {}") un Fls # Foy funion fo sy insniion f pin(onfiph: Opionl[s] = Non) -> PIonfiuionn: """ Foy funion o   PI onfiuion n s: onfiph: Opionl ph o onfiuion fil uns: onfiu PIonfiuionn insn """ un PIonfiuionn(onfiph) # xpl us n onsion f onspionfi(): """ons h PI onfiuion sys""" pin(" PI onfiuion Sys onsion") pin("=" * 60) #  PI n pin = pin() pin(f" Lo {ln(pin.pis)} ful PIs") # isply PIs by oy pin("\n ️ PIs by oy:") fo oy in PIoy: pis = pin.pisbyoy(oy) pin(f" {oy.vlu.il()}: {ln(pis)} PIs") # isply iil PIs pin("\n iil Pioiy PIs:") iilpis = pin.pisbypioiy(PIPioiy.IIL) fo pi in iilpis[:5]: # Show fis 5 pin( f" • {pi.n} ({pi.i}) - : {pi..vlu}{pi..uni}" ) # Siul so suns pin("\n Siulin PI suns...") ipo no # Siul suns fo y PIs spis = ["lnys", "uypn", "houhpuopss"] fo pii in spis: pionfi = pin.pionfi(pii) if pionfi: # n lisi sun vlus vlu = 0.0 # ful vlu if pii == "lnys": vlu = no.unifo(0.5, 1.2) # oun  of 0.9s lif pii == "uypn": vlu = no.unifo(78, 85) # oun  of 82% lif pii == "houhpuopss": vlu = no.unifo(75, 85) # oun  of 80.16 sun = PIsun( pii=pii, vlu=vlu, isp=i.now(), sus=PISus.ON, ) pin.osun(sun) sus = pin.pisus(pii) suss = sus.vlu if sus ls "unnown" n = pionfi.n uni = pionfi..uni pin(f" {n}: {vlu:.2f}{uni} - Sus: {suss}") #  shbo suy pin("\n shbo Suy:") suy = pin.shbosuy() pin(f" ol PIs: {suy['olpis']}") pin(f" Ovll Hlh So: {suy['ovllhlhso']:.2f}") pin(f" iil Issus: {ln(suy['iilpis'])}") pin(f"  is PIs: {ln(suy['ispis'])}") # xpo onfiuion pin("\n xpoin PI onfiuion...") xposuss = pin.xpoonfi("pionfixpo.json") if xposuss: pin(" onfiuion xpo sussfully") ls: pin(" xpo fil") pin("\n PI onfiuion onsion opl sussfully!") if n == "in": # un onsion onspionfi()