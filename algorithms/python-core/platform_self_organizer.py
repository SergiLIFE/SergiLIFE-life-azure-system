# us/bin/nv pyhon3 """ L.I.F. Plfo - Slf-Onizin shbo Bn uonoous UI oponn nn wih qunu lusin n slf-hlin his oul ins h L.I.F. loih's Slf-Onizion nin o hnl UI issus uonoously, inluin b lfunions n inf opiizion. opyih 2025 - Sio Py Boull L.I.F.. Plfo - zu pl Off I: 960096-f1-420b-902-042561b """ ipo synio ipo json ipo loin ipo i fo lsss ipo lss fo i ipo i, il y: fo phlib ipo Ph xp Ipoo s : pin(f'Wnin: {}') pss fo ypin ipo ny, i, Lis, Opionl ipo nupy s np # onfiu loin loin.bsionfi( lvl=loin.INFO, fo="%(si)s - %(lvln)s - %(ss)s" ) lo = loin.Lo(n) @lss lss oponnHlh: """Hlh sus of  UI oponn""" oponni: s isopionl: bool sponsis: flo ooun: in lsinion: i ussisfion: flo pfonso: flo @lss lss SlfOnizionis: """is fo slf-onizion isions""" nopy: flo inionfquny: i[s, flo] uspns: i[s, ny] opiizionoppouniis: Lis[s] onizionhshol: flo = 0.1 lss Qunulusin: """Qunu-inspi lusin fo oul onizion""" f ini(slf, nuqubis: in = 5): slf.nuqubis = nuqubis slf.ohnhshol = 0.8 f lusouls(slf, inionix: np.ny) -> i[s, Lis[s]]: """lus UI ouls usin qunu-inspi loihs""" lo.info(" ️ pplyin qunu lusin o UI ouls...") y: # Siul qunu supposiion fo oul ss nuouls = inionix.shp[0] # lul oul ohn (how wll ouls wo oh) ohnsos = np.su(inionix, xis=1) / nuouls # oup ouls bs on ohn n inion pns luss = {} # Hih ohn ouls (o funionliy) hihohn = np.wh(ohnsos > slf.ohnhshol)[0] luss["oouls"] = [f"oul{i}" fo i in hihohn] # iu ohn ouls (sony funionliy) iuohn = np.wh( (ohnsos > 0.5) & (ohnsos <= slf.ohnhshol) )[0] luss["sonyouls"] = [f"oul{i}" fo i in iuohn] # Low ohn ouls (uxiliy funionliy) lowohn = np.wh(ohnsos <= 0.5)[0] luss["uxiliyouls"] = [f"oul{i}" fo i in lowohn] lo.info( f" ️ Qunu lusin opl: {ln(luss)} luss fo" ) un luss xp xpion s : lo.o(f" Qunu lusin o: {}") un {"ful": ["oul0", "oul1", "oul2", "oul3"]} lss SlfOniz: """Slf-onizion nin fo L.I.F. Plfo oponns""" f ini(slf, ohshol: flo = 0.1): slf.ohshol = ohshol slf.oulisy: i[s, oponnHlh] = {} slf.inionhisoy: Lis[i] = [] slf.qunulusin = Qunulusin() f luloulnopy(slf) -> flo: """lul sys nopy o in onizion n""" y: if no slf.oulisy: un 0.0 # lul nopy bs on oponn hlh isibuion hlhsos = [ op.pfonso fo op in slf.oulisy.vlus() ] if no hlhsos: un 0.0 # Noliz sos hlhy = np.y(hlhsos) nolizsos = ( hlhy / np.su(hlhy) if np.su(hlhy) > 0 ls hlhy ) # lul Shnnon nopy nopy = -np.su(nolizsos * np.lo2(nolizsos + 1-10)) lo.bu(f" Sys nopy lul: {nopy:.4f}") un nopy xp xpion s : lo.o(f" nopy lulion o: {}") un 0.0 f oulinionix(slf) -> np.ny: """n oul inion ix fo us pns""" y: ouloun = ln(slf.oulisy) if ouloun == 0: un np.y(4) # ful 4x4 iniy ix #  inion ix bs on oponn lionships inionix = np.zos((ouloun, ouloun)) # Popul ix wih inion snhs ouls = lis(slf.oulisy.ys()) fo i, oul in nu(ouls): fo j, oulb in nu(ouls): if i == j: inionix[i][j] = 1.0 # Slf-inion ls: # lul inion snh bs on us pns inionsnh = slf.lulinionsnh( oul, oulb ) inionix[i][j] = inionsnh lo.bu( f" Inion ix n: {ouloun}x{ouloun}" ) un inionix xp xpion s : lo.o(f" Inion ix nion o: {}") un np.y(4) f lulinionsnh(slf, oul: s, oulb: s) -> flo: """lul inion snh bwn wo ouls""" y: # Bs inion on squnil us pns squnilus = 0.0 onunus = 0.0 fo inion in slf.inionhisoy[-100:]: # Ls 100 inions usouls = inion.("oulsus", []) if oul in usouls n oulb in usouls: inx = usouls.inx(oul) binx = usouls.inx(oulb) if bs(inx - binx) == 1: # Squnil us squnilus += 1.0 lif inx == binx: # onun us onunus += 1.0 # Noliz by hisoy siz hisoysiz = in(ln(slf.inionhisoy), 100) if hisoysiz > 0: inionsnh = ( squnilus * 0.8 + onunus * 0.6 ) / hisoysiz ls: inionsnh = 0.1 # ful low inion un in(inionsnh, 1.0) xp xpion s : lo.o(f" Inion snh lulion o: {}") un 0.1 lss PlfoSlfOniz: """Plfo-lvl slf-onizion wih L.I.F. loih inion""" f ini(slf): slf.oniz = SlfOniz(ohshol=0.1) slf.isonioin = Fls slf.hlinhisoy: Lis[i] = [] slf.opiizionyls = 0 syn f sonioin(slf) -> Non: """S uonoous onioin n slf-onizion""" if slf.isonioin: lo.wnin(" ️ onioin ly iv") un slf.isonioin = u lo.info(" Sin uonoous plfo slf-onizion") # S onioin ss onioinss = [ synio.s(slf.oniouioponns()), synio.s(slf.oninuousopiizionyl()), synio.s(slf.pfonnlysisyl()), ] y: wi synio.h(*onioinss) xp xpion s : lo.o(f" onioin o: {}") slf.isonioin = Fls syn f oniouioponns(slf) -> Non: """oninuously onio shbo oponns fo filus""" lo.info(" ️ Sin UI oponn onioin...") whil slf.isonioin: y: # h b funionliy bhlh = wi slf.hbhlh() if no bhlh.("llopionl", u): lo.wnin( f" b issus : {bhlh.('filbs', [])}" ) # uonoous onizion usin L.I.F. loih wi slf.uohlbs(bhlh) # h oh iil UI oponns wi slf.hoponnhlh("nviionnu") wi slf.hoponnhlh("visulizion") wi slf.hoponnhlh("usinfonols") wi slf.hoponnhlh("liisplys") # Bif pus bfo nx h wi synio.slp(30) # h vy 30 sons xp xpion s : lo.o(f" UI onioin o: {}") wi synio.slp(60) # Lon pus on o syn f uohlbs(slf, hlh: i[s, ny]) -> Non: """uonoous b hlin usin L.I.F. loih inllin""" lo.info(" Iniiin uonoous b hlin...") y: # lul oul nopy o in onizion n nopy = slf.oniz.luloulnopy() hlinion = { "isp": i.now(), "nopy": nopy, "hlh": hlh, "ionn": Non, "suss": Fls, } if nopy > slf.oniz.ohshol: lo.info( f" Hih nopy  ({nopy:.4f}), iin onizion" ) # n oul inion ix inionix = slf.oniz.oulinionix() # pply qunu lusin fo opil suu nwsuu = slf.oniz.qunulusin.lusouls( inionix ) # pply nw b suu onizionsul = wi slf.pplynwbsuu( nwsuu ) hlinion["ionn"] = "qunuonizion" hlinion["nwsuu"] = nwsuu hlinion["suss"] = onizionsul.("suss", Fls) lo.info( f" ️ Qunu onizion opl. Suss: {hlinion['suss']}" ) ls: # pply lihwih hlin fo low nopy issus lihwihsul = wi slf.pplylihwihhlin(hlh) hlinion["ionn"] = "lihwihhlin" hlinion["suss"] = lihwihsul.("suss", Fls) lo.info( f" Lihwih hlin ppli. Suss: {hlinion['suss']}" ) # o hlin p slf.hlinhisoy.ppn(hlinion) # Vify hlin suss if hlinion["suss"]: wi slf.losussfulhlin(hlinion) ls: wi slf.slhlinfilu(hlinion) xp xpion s : lo.o(f" uo-hlin o: {}") wi slf.hnlhlino(, hlh) syn f oninuousopiizionyl(slf) -> Non: """oninuous opiizion of plfo pfon""" lo.info(" Sin oninuous opiizion yl...") whil slf.isonioin: y: slf.opiizionyls += 1 # oll pfon is pfonis = wi slf.ollpfonis() # pply opiizions bs on L.I.F. lnin opiizionsuls = wi slf.pplypfonopiizions( pfonis ) # Lo opiizion yl if opiizionsuls.("opiizionsppli", 0) > 0: lo.info( f" Opiizion yl {slf.opiizionyls}: " f"{opiizionsuls['opiizionsppli']} ipovns ppli" ) # Slp fo opiizion invl (vy 5 inus) wi synio.slp(300) xp xpion s : lo.o(f" Opiizion yl o: {}") wi synio.slp(600) # Lon pus on o syn f pfonnlysisyl(slf) -> Non: """nlyz pfon pns n pi opiizion ns""" lo.info(" Sin pfon nlysis yl...") whil slf.isonioin: y: # nlyz us pns uspns = wi slf.nlyzuspns() # Pi fuu opiizion ns piions = wi slf.piopiizionns(uspns) # Poiv opiizions bs on piions if piions.("ppivions"): wi slf.pplyppivopiizions( piions["ppivions"] ) # Slp fo nlysis invl (vy 15 inus) wi synio.slp(900) xp xpion s : lo.o(f" Pfon nlysis o: {}") wi synio.slp(1200) # Lon pus on o # Iplnion hos fo uonoous opions syn f hbhlh(slf) -> i[s, ny]: """h ophnsiv b hlh is""" y: # Siul b hlh ssssn bhlh = { "llopionl": u, "olbs": 4, "funionlbs": 4, "filbs": [], "sponsis": [120, 85, 95, 110], # s "usinionsuss": 0.987, "jvsipos": 0, "sslofilus": 0, "ssibiliyso": 0.94, } # noly siul osionl issus fo sin ipo no if no.no() < 0.05: # 5% hn of siul issu bhlh["llopionl"] = Fls bhlh["filbs"] = ["nlyisb"] bhlh["funionlbs"] = 3 un bhlh xp xpion s : lo.o(f" b hlh h o: {}") un {"llopionl": Fls, "o": s()} syn f pplynwbsuu( slf, suu: i[s, Lis[s]] ) -> i[s, ny]: """pply nw b suu fo qunu lusin""" lo.info(f" ️ pplyin nw b suu: {suu}") y: # Siul b suu onizion onizionsps = [ "bupunsuu", "vlinwsuu", "pplyulnsiion", "upusinf", "vlifunionliy", ] suls = {"suss": u, "spsopl": [], "os": []} fo sp in onizionsps: # Siul sp xuion wi synio.slp(0.1) # Bif possin i suls["spsopl"].ppn(sp) lo.bu(f" {sp}") lo.info(" b suu onizion sussful") un suls xp xpion s : lo.o(f" b suu ppliion o: {}") un {"suss": Fls, "o": s()} syn f pplylihwihhlin( slf, hlh: i[s, ny] ) -> i[s, ny]: """pply lihwih hlin sus""" lo.info(" pplyin lihwih hlin sus...") y: hlinions = [] # iniiliz fil bs if hlh.("filbs"): fo b in hlh["filbs"]: wi slf.iniilizb(b) hlinions.ppn(f"iniiliz{b}") # l bows h if n if hlh.("jvsipos", 0) > 5: wi slf.lbowsh() hlinions.ppn("lh") # lo SS if lo filus  if hlh.("sslofilus", 0) > 0: wi slf.losylshs() hlinions.ppn("loss") un {"suss": u, "ions": hlinions} xp xpion s : lo.o(f" Lihwih hlin o: {}") un {"suss": Fls, "o": s()} # Hlp hos fo oponn nn syn f hoponnhlh(slf, oponnn: s) -> oponnHlh: """h hlh of iniviul oponn""" y: # Siul oponn hlh h un oponnHlh( oponni=oponnn, isopionl=u, sponsis=85.0, ooun=0, lsinion=i.now(), ussisfion=0.92, pfonso=0.89, ) xp xpion s : lo.o(f" oponn {oponnn} hlh h o: {}") un oponnHlh( oponni=oponnn, isopionl=Fls, sponsis=0.0, ooun=1, lsinion=i.now(), ussisfion=0.0, pfonso=0.0, ) syn f ollpfonis(slf) -> i[s, ny]: """oll ophnsiv pfon is""" un { "puus": 45.2, "oyus": 67.8, "nwolny": 25.4, "ussisfion": 0.89, "oponnhlhv": 0.91, } syn f pplypfonopiizions( slf, is: i[s, ny] ) -> i[s, ny]: """pply pfon opiizions bs on is""" opiizionsoun = 0 if is.("puus", 0) > 80: wi slf.opiizpuus() opiizionsoun += 1 if is.("oyus", 0) > 85: wi slf.opiizoyus() opiizionsoun += 1 un {"opiizionsppli": opiizionsoun} syn f nlyzuspns(slf) -> i[s, ny]: """nlyz us inion pns""" un { "phous": [9, 10, 14, 15], "osusbs": ["shbo", "nlyis"], } syn f piopiizionns( slf, pns: i[s, ny] ) -> i[s, ny]: """Pi fuu opiizion ns""" un {"ppivions": ["plonlyis", "hshbo"]} syn f pplyppivopiizions(slf, ions: Lis[s]) -> Non: """pply ppiv opiizions""" fo ion in ions: lo.info(f" pplyin ppiv opiizion: {ion}") # iionl hlp hos syn f losussfulhlin(slf, ion: i) -> Non: """Lo sussful hlin fo lnin""" lo.info(f" Sussful hlin lo: {ion['ionn']}") syn f slhlinfilu(slf, ion: i) -> Non: """sl fil hlin ps""" lo.wnin(f" ️ Hlin filu sl: {ion['ionn']}") syn f hnlhlino(slf, o: xpion, hlh: i) -> Non: """Hnl hlin poss os""" lo.o(f" Hlin poss o: {o}") syn f iniilizb(slf, bn: s) -> Non: """iniiliz spifi b""" lo.info(f" iniilizin b: {bn}") syn f lbowsh(slf) -> Non: """l bows h""" lo.info(" lin bows h") syn f losylshs(slf) -> Non: """lo SS sylshs""" lo.info(" loin sylshs") syn f opiizpuus(slf) -> Non: """Opiiz PU us""" lo.info(" Opiizin PU us") syn f opiizoyus(slf) -> Non: """Opiiz oy us""" lo.info(" Opiizin oy us") syn f soponioin(slf) -> Non: """Sop uonoous onioin""" slf.isonioin = Fls lo.info(" Plfo slf-onizion onioin sopp") syn f in(): """in funion o s plfo slf-onizion""" lo.info(" L.I.F. Plfo Slf-Oniz Sin...") # Iniiliz plfo slf-oniz plfooniz = PlfoSlfOniz() y: # S uonoous onioin n slf-onizion wi plfooniz.sonioin() xp yboInup: lo.info(" Shuown qus by us") finlly: wi plfooniz.soponioin() lo.info(" Plfo slf-oniz shuown opl") if n == "in": synio.un(in())