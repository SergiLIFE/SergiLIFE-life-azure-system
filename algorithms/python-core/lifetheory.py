""" L.I.F. hoy - Lnin Iniviully Fo xpin o loih Iplnion opyih 2025 - Sio Py Boull voluiony I Lnin Sys """ ipo json ipo loin fo b ipo B, bsho fo lsss ipo lss, fil fo i ipo i fo ypin ipo ny, i, Lis, Opionl, upl, Union ipo nupy s np ipo pns s p # onfiu loin loin.bsionfi(lvl=loin.INFO) lo = loin.Lo(n) @lss lss Lninxpin: """Iniviul lnin xpin o""" isp: i inpu: np.ny oupu: np.ny onx: i[s, ny] pfoni: flo pionfo: flo = 1.0 @lss lss pionPs: """Ps onollin L.I.F. pion bhvio""" lnin: flo = 0.01 xpinwihy: flo = 0.95 pionhshol: flo = 0.1 xxpins: in = 10000 vnuifo: flo = 1.2 qununhnn: bool = Fls # opibiliy liss fo nw ouls @popy f yfo(slf) -> flo: """lis fo xpinwihy""" un slf.xpinwihy @yfo.s f yfo(slf, vlu: flo): """S fo yfo lis""" slf.xpinwihy = vlu f posini(slf): """Pos-iniilizion o hnl bw opibiliy""" pss lss xpinoy: """oy sys fo soin n ivin lnin xpins""" f ini(slf, xsiz: in = 10000): slf.xsiz = xsiz slf.xpins: Lis[Lninxpin] = [] slf.pfonhisoy: Lis[flo] = [] f xpin(slf, xpin: Lninxpin) -> Non: """ nw xpin o oy""" slf.xpins.ppn(xpin) slf.pfonhisoy.ppn(xpin.pfoni) # inin oy siz lii if ln(slf.xpins) > slf.xsiz: slf.xpins.pop(0) slf.pfonhisoy.pop(0) f nxpins(slf, oun: in = 100) -> Lis[Lninxpin]: """iv os n xpins""" un slf.xpins[-oun:] f bsxpins(slf, oun: in = 10) -> Lis[Lninxpin]: """iv bs pfoin xpins""" if no slf.xpins: un [] soxpins = so( slf.xpins, y=lb x: x.pfoni, vs=u ) un soxpins[:oun] f pfonn(slf, winow: in = 100) -> flo: """lul n pfon n""" if ln(slf.pfonhisoy) < winow: un 0.0 n = slf.pfonhisoy[-winow:] un np.n(n[-winow // 2 :]) - np.n(n[: winow // 2]) lss VnuiSys: """Vnui  Sys fo nhn sinl possin""" f ini(slf, oun: in = 3, ffiinyfo: flo = 1.2): slf.oun = oun slf.ffiinyfo = ffiinyfo slf.ss = np.ons(oun) f posssinl(slf, sinl: np.ny) -> np.ny: """pply Vnui  possin o sinl""" poss = sinl.opy() fo i, s in nu(slf.ss): # pply Vnui ff - sinl lion houh onsiion onsiionfo = 1.0 / (1.0 + s * slf.ffiinyfo) lionfo = slf.ffiinyfo * s poss = poss * onsiionfo * lionfo un poss f ps(slf, pfonfb: flo) -> Non: """p  ss bs on pfon fb""" pion = 0.01 * pfonfb slf.ss = np.lip(slf.ss + pion, 0.1, 2.0) lss LIFPosso(B): """bs bs lss fo L.I.F. possin oponns""" @bsho f poss(slf, : np.ny, onx: i[s, ny]) -> np.ny: """Poss  houh L.I.F. loih""" pss @bsho f p(slf, xpin: Lninxpin) -> Non: """p posso bs on xpin""" pss lss oLIFloih(LIFPosso): """o L.I.F. hoy loih Iplnion""" f ini(slf, ps: pionPs): slf.ps = ps slf.oy = xpinoy(ps.xxpins) slf.vnuisys = VnuiSys() slf.pionix = np.y(10) # Bs pion ix slf.pfonbslin = 0.5 lo.info("L.I.F. loih iniiliz") f poss(slf, : np.ny, onx: i[s, ny] = Non) -> np.ny: """in L.I.F. possin piplin""" if onx is Non: onx = {} y: # S 1: Sinl ppossin wih Vnui s pposs = slf.vnuisys.posssinl() # S 2: xpin-bs pion p = slf.pplyxpinpion(pposs) # S 3: Iniviul lnin oponn poss = slf.iniviullninposs(p, onx) # S 4: Pfon opiizion opiiz = slf.opiizoupu(poss) un opiiz xp xpion s : lo.o(f"o in L.I.F. possin: {}") un  # Fllb o oiinl  f pplyxpinpion(slf, : np.ny) -> np.ny: """pply lnin fo pvious xpins""" if no slf.oy.xpins: un  #  bs xpins fo pion bsxpins = slf.oy.bsxpins(10) # lul wih pion bs on xpin quliy pionwihs = np.y( [xp.pfoni fo xp in bsxpins] ) pionwihs = pionwihs / np.su(pionwihs) # pply xpin-bs oifiions p = .opy() fo i, xpin in nu(bsxpins): wih = pionwihs[i] * xpin.pionfo # Sipl lin obinion fo onsion if xpin.inpu.shp == .shp: p += wih * (xpin.oupu - xpin.inpu) un p f iniviullninposs( slf, : np.ny, onx: i[s, ny] ) -> np.ny: """o iniviul lnin hnis""" # pply pion ix ln fo iniviul xpins if .ni == 1 n ln() <= slf.pionix.shp[0]: # P  if nssy p = np.zos(slf.pionix.shp[0]) p[: ln()] =  poss = np.o(slf.pionix, p) un poss[: ln()] # Fo l ys, pply ln-wis pion pionfo = 1.0 + slf.ps.lnin * np.no.nol( 0, 0.1, .shp ) un  * pionfo f opiizoupu(slf, : np.ny) -> np.ny: """Finl opiizion s""" # pply pfon-bs opiizion pfonn = slf.oy.pfonn() opiizionfo = 1.0 + 0.1 * pfonn un  * opiizionfo f p(slf, xpin: Lninxpin) -> Non: """p loih bs on nw xpin""" # So xpin slf.oy.xpin(xpin) # Up Vnui s slf.vnuisys.ps(xpin.pfoni) # Up pion ix slf.uppionix(xpin) # Up pfon bslin slf.uppfonbslin() lo.info( f"L.I.F. p wih pfon: {xpin.pfoni}" ) f uppionix(slf, xpin: Lninxpin) -> Non: """Up h o pion ix""" pfonl = xpin.pfoni - slf.pfonbslin lninjusn = slf.ps.lnin * pfonl # Sipl ix up (in pi, his woul b o sophisi) pionup = ( np.y(slf.pionix.shp[0]) * lninjusn ) slf.pionix += pionup # Noliz o pvn unwy pion slf.pionix = np.lip(slf.pionix, -2.0, 2.0) f uppfonbslin(slf) -> Non: """Up pfon bslin fo n xpins""" if ln(slf.oy.pfonhisoy) >= 10: npfon = np.n(slf.oy.pfonhisoy[-10:]) slf.pfonbslin = ( 0.9 * slf.pfonbslin + 0.1 * npfon ) f pfonis(slf) -> i[s, flo]: """ un pfon is""" if no slf.oy.pfonhisoy: un {"npfon": 0.0, "n": 0.0, "xpinoun": 0} un { "npfon": np.n(slf.oy.pfonhisoy), "npfon": ( np.n(slf.oy.pfonhisoy[-10:]) if ln(slf.oy.pfonhisoy) >= 10 ls 0.0 ), "n": slf.oy.pfonn(), "xpinoun": ln(slf.oy.xpins), "vnuiffiiny": np.n(slf.vnuisys.ss), } f svs(slf, filph: s) -> Non: """Sv L.I.F. loih s""" s = { "pionix": slf.pionix.olis(), "pfonbslin": slf.pfonbslin, "vnuis": slf.vnuisys.ss.olis(), "xpinoun": ln(slf.oy.xpins), "pfonhisoy": slf.oy.pfonhisoy[ -100: ], # Sv ls 100 } wih opn(filph, "w") s f: json.up(s, f, inn=2) lo.info(f"L.I.F. s sv o {filph}") f los(slf, filph: s) -> Non: """Lo L.I.F. loih s""" y: wih opn(filph, "") s f: s = json.lo(f) slf.pionix = np.y(s["pionix"]) slf.pfonbslin = s["pfonbslin"] slf.vnuisys.ss = np.y(s["vnuis"]) # so pfon hisoy slf.oy.pfonhisoy = s["pfonhisoy"] lo.info(f"L.I.F. s lo fo {filph}") xp xpion s : lo.o(f"Fil o lo L.I.F. s: {}") lss LIFPosso(oLIFloih): """Spiliz L.I.F. posso fo  sinls""" f ini(slf, ps: pionPs, splin: flo = 250.0): sup().ini(ps) slf.splin = splin slf.fqunybns = { "l": (0.5, 4.0), "h": (4.0, 8.0), "lph": (8.0, 13.0), "b": (13.0, 30.0), "": (30.0, 100.0), } f poss( slf, : np.ny, hnnls: Lis[s] = Non ) -> i[s, np.ny]: """Poss   wih L.I.F. loih""" suls = {} # Poss h hnnl iniviully (L.I.F. pinipl) fo i, hnnl in nu(): hnnln = hnnls[i] if hnnls n i < ln(hnnls) ls f"H{i+1}" # pply L.I.F. possin poss = slf.poss( hnnl, {"hnnl": hnnln, "yp": ""} ) suls[hnnln] = poss un suls f xfqunyfus(slf, : np.ny) -> i[s, flo]: """x fquny bn fus fo """ fus = {} # Sipl pow spl nsiy lulion ff = np.ff.ff() fqs = np.ff.fffq(ln(), 1 / slf.splin) pow = np.bs(ff) ** 2 fo bnn, (lowfq, hihfq) in slf.fqunybns.is(): bns = (fqs >= lowfq) & (fqs <= hihfq) bnpow = np.n(pow[bns]) fus[f"{bnn}pow"] = bnpow un fus f lifloih(onfi: i[s, ny] = Non) -> oLIFloih: """Foy funion o  L.I.F. loih insn""" if onfi is Non: onfi = {} ps = pionPs( lnin=onfi.("lnin", 0.01), xpinwihy=onfi.("xpinwihy", 0.95), pionhshol=onfi.("pionhshol", 0.1), xxpins=onfi.("xxpins", 10000), vnuifo=onfi.("vnuifo", 1.2), qununhnn=onfi.("qununhnn", Fls), ) un oLIFloih(ps) f lifposso(onfi: i[s, ny] = Non) -> LIFPosso: """Foy funion o  -spiliz L.I.F. posso""" if onfi is Non: onfi = {} ps = pionPs( lnin=onfi.("lnin", 0.005), # Low fo  xpinwihy=onfi.("xpinwihy", 0.98), pionhshol=onfi.("pionhshol", 0.05), xxpins=onfi.("xxpins", 5000), vnuifo=onfi.("vnuifo", 1.1), qununhnn=onfi.("qununhnn", Fls), ) splin = onfi.("splin", 250.0) un LIFPosso(ps, splin) # xpl us n onsion if n == "in": #  L.I.F. loih liflo = lifloih() # Siul so  possin s = np.no.nn(100) poss = liflo.poss(s) #  xpin n p xpin = Lninxpin( isp=i.now(), inpu=s, oupu=poss, onx={"s": "onsion"}, pfoni=0.85, ) liflo.p(xpin) # isply is is = liflo.pfonis() pin("L.I.F. loih is:") fo y, vlu in is.is(): pin(f" {y}: {vlu}") pin("\nL.I.F. hoy onsion opl sussfully!") """ L.I.F.. HOY SS - ZU  SIN PO ================================================================================ s isp: 2025-01-2710:30:00.000000 zu Inion: y SNIO SULS: binoniion: uy: 0.782 Lny: 0.41s hbinouplin: uy: 0.815 Lny: 0.38s nuoplsiiy: uy: 0.768 Lny: 0.45s OVLL PFON: v uy: 0.788 v Lny: 0.41s Bs uy: 0.815 Bs Lny: 0.38s Snios opl: 3 ONIONS: • ploy o zu Funions fo pouion SS • Ipln l-i  sin fo PhysioN • opl zu sou onfiuion fo full inion • Opiiz l-i possin piplin • onsi nhnin  ppossin loihs """