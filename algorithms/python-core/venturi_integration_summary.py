# us/bin/nv pyhon3 """ Vnui Inion Suy - Pfon poin n Sys nlyis L.I.F.. Plfo ophnsiv inion suy n pfon nlyis opyih 2025 - Sio Py Boull L.I.F.. Plfo - zu pl Off I: 960096-f1-420b-902-042561b """ ipo json ipo loin ipo no ipo sisis fo ollions ipo fuli fo lsss ipo lss fo i ipo i, il y: fo phlib ipo Ph xp Ipoo s : pin(f'Wnin: {}') pss fo ypin ipo ny, i, Lis, Opionl # ipo nupy s np # poily on ou u o sp onsins lo = loin.Lo(n) @lss lss Sysi: """Iniviul sys pfon i""" oponn: s in: s vlu: flo isp: i uni: s sus: s # 'nol', 'wnin', 'iil' @lss lss InionSuy: """Suy of sys inion sus""" isp: i ovllsus: s oponnsus: i[s, s] pfonis: i[s, flo] ls: Lis[s] onions: Lis[s] lss VnuiInionSuiz: """ ophnsiv inion suy n pfon poin sys s  fo ll Vnui oponns fo sys-wi nlyis """ f ini( slf, isbph: s = "vnuiis.json", suybph: s = "inionsuis.json", ): slf.isbph = Ph(isbph) slf.suybph = Ph(suybph) slf.is: Lis[Sysi] = [] slf.suis: Lis[InionSuy] = [] slf.lo() f lo(slf) -> Non: """Lo is n suy  fo is""" # Lo is if slf.isbph.xiss(): y: wih opn(slf.isbph, "") s f:  = json.lo(f) fo i in .("is", []): # onv isp sin b o i i["isp"] = i.foisofo( i["isp"] ) i = Sysi(**i) slf.is.ppn(i) lo.info(f"Lo {ln(slf.is)} sys is") xp xpion s : lo.o(f"Fil o lo is bs: {}") # Lo suis if slf.suybph.xiss(): y: wih opn(slf.suybph, "") s f:  = json.lo(f) fo suy in .("suis", []): # onv isp sin b o i suy["isp"] = i.foisofo( suy["isp"] ) suy = InionSuy(**suy) slf.suis.ppn(suy) lo.info(f"Lo {ln(slf.suis)} inion suis") xp xpion s : lo.o(f"Fil o lo suis bs: {}") f sv(slf) -> Non: """Sv is n suy  o is""" # Sv is is = { "lsup": i.now().isofo(), "is": [ {**i.i, "isp": i.isp.isofo()} fo i in slf.is[-1000:] # p ls 1000 is ], } y: wih opn(slf.isbph, "w") s f: json.up(is, f, inn=2) xp xpion s : lo.o(f"Fil o sv is: {}") # Sv suis suis = { "lsup": i.now().isofo(), "suis": [ {**suy.i, "isp": suy.isp.isofo()} fo suy in slf.suis[-100:] # p ls 100 suis ], } y: wih opn(slf.suybph, "w") s f: json.up(suis, f, inn=2) xp xpion s : lo.o(f"Fil o sv suis: {}") f oi( slf, oponn: s, in: s, vlu: flo, uni: s = "", sus: s = "nol", ) -> Non: """o  nw sys i""" i = Sysi( oponn=oponn, in=in, vlu=vlu, isp=i.now(), uni=uni, sus=sus, ) slf.is.ppn(i) # uo-sv pioilly (vy 10 is) if ln(slf.is) % 10 == 0: slf.sv() lo.bu(f"o i: {oponn}.{in} = {vlu} {uni}") f ninionsuy(slf) -> InionSuy: """n ophnsiv inion suy""" now = i.now() # nlyz oponn sus oponnsus = slf.nlyzoponnsus() # lul pfon is pfonis = slf.lulpfonis() # n ls ls = slf.nls(oponnsus, pfonis) # n onions onions = slf.nonions( oponnsus, pfonis ) # in ovll sus ovllsus = slf.inovllsus(oponnsus, ls) suy = InionSuy( isp=now, ovllsus=ovllsus, oponnsus=oponnsus, pfonis=pfonis, ls=ls, onions=onions, ) slf.suis.ppn(suy) slf.sv() lo.info(f"n inion suy: {ovllsus}") un suy f nlyzoponnsus(slf) -> i[s, s]: """nlyz sus of h sys oponn""" oponnsus = {} nis = slf.nis(hous=1) # oup is by oponn oponnis = fuli(lis) fo i in nis: oponnis[i.oponn].ppn(i) # nlyz h oponn fo oponn, is in oponnis.is(): if no is: oponnsus[oponn] = "unnown" oninu # h fo iil issus iiloun = su(1 fo  in is if .sus == "iil") wninoun = su(1 fo  in is if .sus == "wnin") noloun = su(1 fo  in is if .sus == "nol") olis = ln(is) if iiloun > 0: sus = "iil" lif wninoun / olis > 0.3: # >30% wnins sus = "wnin" lif noloun / olis > 0.8: # >80% nol sus = "hlhy" ls: sus = "" oponnsus[oponn] = sus un oponnsus f lulpfonis(slf) -> i[s, flo]: """lul y pfon is oss h sys""" nis = slf.nis(hous=24) if no nis: un {} issuy = {} # Ovll sys ffiiny ffiinyis = [  fo  in nis if "ffiiny" in .in.low() ] if ffiinyis: issuy["sysffiiny"] = su( .vlu fo  in ffiinyis ) / ln(ffiinyis) # v possin lny lnyis = [  fo  in nis if "lny" in .in.low() ] if lnyis: issuy["vpossinlny"] = su( .vlu fo  in lnyis ) / ln(lnyis) # houhpu is houhpuis = [  fo  in nis if "houhpu" in .in.low() ] if houhpuis: issuy["vhouhpu"] = su( .vlu fo  in houhpuis ) / ln(houhpuis) # o s ois = [ fo  in nis if "o" in .in.low()] if ois: issuy["o"] = su(.vlu fo  in ois) / ln( ois ) # sou uilizion puis = [ fo  in nis if "pu" in .in.low()] if puis: issuy["vpuuilizion"] = su( .vlu fo  in puis ) / ln(puis) oyis = [  fo  in nis if "oy" in .in.low() ] if oyis: issuy["voyuilizion"] = su( .vlu fo  in oyis ) / ln(oyis) un issuy f nls( slf, oponnsus: i[s, s], pfonis: i[s, flo] ) -> Lis[s]: """n sys ls bs on un sus""" ls = [] # oponn sus ls iiloponns = [ op fo op, sus in oponnsus.is() if sus == "iil" ] if iiloponns: ls.ppn( f" IIL: oponns filin - {', '.join(iiloponns)}" ) wninoponns = [ op fo op, sus in oponnsus.is() if sus == "wnin" ] if wninoponns: ls.ppn( f" ️ WNIN: oponns  - {', '.join(wninoponns)}" ) # Pfon ls if "sysffiiny" in pfonis: ffiiny = pfonis["sysffiiny"] if ffiiny < 0.7: ls.ppn( f" ️ LOW FFIINY: Sys ffiiny  {ffiiny:.1%}" ) if "o" in pfonis: o = pfonis["o"] if o > 0.05: # >5% o  ls.ppn(f" HIH O : {o:.1%} os ") if "vpuuilizion" in pfonis: puus = pfonis["vpuuilizion"] if puus > 0.9: # >90% PU ls.ppn(f" ️ HIH PU US: {puus:.1%} PU uilizion") un ls f nonions( slf, oponnsus: i[s, s], pfonis: i[s, flo] ) -> Lis[s]: """n sys ipovn onions""" onions = [] # oponn-spifi onions fo oponn, sus in oponnsus.is(): if sus == "iil": onions.ppn( f" II: Invsi n pi {oponn}" ) lif sus == "wnin": onions.ppn( f" ONIO: p los wh on {oponn} pfon" ) # Pfon-bs onions if "sysffiiny" in pfonis: ffiiny = pfonis["sysffiiny"] if ffiiny < 0.8: onions.ppn( " OPIIZ: un Vnui bhin opiizion o ipov ffiiny" ) if "vpossinlny" in pfonis: lny = pfonis["vpossinlny"] if lny > 0.1: # >100s onions.ppn( " ‍ ️ SP UP: onsi plll possin o hin opiizions" ) if "o" in pfonis: o = pfonis["o"] if o > 0.02: # >2% onions.ppn( " BU: un silin ss o inify o sous" ) # nl onions if no onions: onions.ppn( " SYS HLHY: ll oponns opin nolly" ) un onions f inovllsus( slf, oponnsus: i[s, s], ls: Lis[s] ) -> s: """in ovll sys sus""" if ny(sus == "iil" fo sus in oponnsus.vlus()): un "IIL" iills = su(1 fo l in ls if " IIL" in l) if iills > 0: un "IIL" wninoponns = su( 1 fo sus in oponnsus.vlus() if sus == "wnin" ) wninls = su(1 fo l in ls if " ️" in l) if wninoponns > 0 o wninls > 0: un "WNIN" if ll( sus in ["hlhy", "unnown"] fo sus in oponnsus.vlus() ): un "HLHY" un "" f nis(slf, hous: in = 24) -> Lis[Sysi]: """ is fo h ls N hous""" uoff = i.now() - il(hous=hous) un [ fo  in slf.is if .isp > uoff] f ophnsivpo(slf) -> s: """n ophnsiv sys po""" if no slf.suis: un "No inion suis vilbl. un ninionsuy() fis." lssuy = slf.suis[-1] polins = [] polins.ppn("VNUI INION SUY PO") polins.ppn("=" * 50) polins.ppn( f"n: {lssuy.isp.sfi('%Y-%-% %H:%:%S')}" ) polins.ppn(f"Ovll Sus: {lssuy.ovllsus}") polins.ppn("") # oponn Sus polins.ppn("OPONN SUS") polins.ppn("-" * 20) fo oponn, sus in lssuy.oponnsus.is(): susion = { "hlhy": " ", "wnin": " ️", "iil": " ", "": " ", "unnown": " ", }.(sus, " ") polins.ppn(f"{susion} {oponn}: {sus.upp()}") polins.ppn("") # Pfon is polins.ppn("PFON IS") polins.ppn("-" * 20) fo i, vlu in lssuy.pfonis.is(): if "" in i o "uilizion" in i: polins.ppn(f"• {i}: {vlu:.1%}") lif "lny" in i: polins.ppn(f"• {i}: {vlu:.3f}s") ls: polins.ppn(f"• {i}: {vlu:.3f}") polins.ppn("") # ls if lssuy.ls: polins.ppn("IV LS") polins.ppn("-" * 15) fo l in lssuy.ls: polins.ppn(f"• {l}") polins.ppn("") # onions if lssuy.onions: polins.ppn("ONIONS") polins.ppn("-" * 15) fo  in lssuy.onions: polins.ppn(f"• {}") polins.ppn("") # Hisoil Suy if ln(slf.suis) > 1: polins.ppn("HISOIL N (Ls 7 Suis)") polins.ppn("-" * 35) nsuis = slf.suis[-7:] susouns = fuli(in) fo suy in nsuis: susouns[suy.ovllsus] += 1 fo sus, oun in susouns.is(): pn = oun / ln(nsuis) * 100 polins.ppn(f"• {sus}: {oun} is ({pn:.1f}%)") un "\n".join(polins) f splis(slf) -> Non: """ spl is fo onsion""" oponns = [ "vnuis", "vnuibhin", "vnuisilin", "vnuish", ] fo oponn in oponns: #  nol is slf.oi(oponn, "ffiiny", no.unifo(0.8, 0.95)) slf.oi( oponn, "lny", no.unifo(0.02, 0.08), "sons" ) slf.oi( oponn, "houhpu", no.unifo(100, 500), "ops/s" ) slf.oi(oponn, "o", no.unifo(0.001, 0.01)) slf.oi(oponn, "puuilizion", no.unifo(0.3, 0.7)) slf.oi( oponn, "oyuilizion", no.unifo(0.4, 0.8) ) lo.info(" spl is fo onsion") # lobl inion suiz insn inionsuiz = VnuiInionSuiz() f nsyspo() -> Non: """n n isply ophnsiv sys po""" pin(" Vnui Inion Suy") pin("=" * 40) #  spl  if no is xis if no inionsuiz.is: inionsuiz.splis() # n suy suy = inionsuiz.ninionsuy() pin(f"Ovll Sus: {suy.ovllsus}") pin(f"oponns: {ln(suy.oponnsus)}") pin(f"iv ls: {ln(suy.ls)}") pin(f"onions: {ln(suy.onions)}") # Show il po po = inionsuiz.ophnsivpo() pin(f"\n Full po ({ln(po.spli())} lins)") pin("-" * 40) pin(po) if n == "in": nsyspo()