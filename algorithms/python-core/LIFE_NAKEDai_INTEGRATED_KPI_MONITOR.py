# us/bin/nv pyhon3 """ L.I.F. HOY + Ni IN PI ONIOIN SYS Slss Phs 1 → Phs 2 nsiion wih Flow onu in onios L.I.F. hoy Plfo pfon n slssly ins Ni s fo sooh nsiion ino Phs 2 vlopn. opyih 2025 - Sio Py Boull zu pl Off I: 960096-f1-420b-902-042561b """ ipo synio ipo json ipo loin ipo os ipo i fo lsss ipo lss, fil fo i ipo i, il fo nu ipo nu fo ypin ipo ny, i, Lis, Opionl, Union ipo nupy s np # onfiu loin fo in onioin os.is('los', xiso=u) loin.bsionfi( lvl=loin.INFO, fo='%(si)s - %(lvln)s - %(ss)s', hnls=[ loin.FilHnl('los/inpionio.lo'), loin.SHnl() ] ) lo = loin.Lo(n) lss PlfoPhs(nu): """Plfo vlopn phss""" PHS1LIFHOY = "phs1lifhoy" PHS2NI = "phs2ni" INBOH = "inboh" lss LIFPIis(nu): """L.I.F. hoy Plfo PI is""" # o L.I.F. Pfon POSSINLNY = "lifpossinlnys" NULUY = "lifnuluypn" POSSINSP = "lifpossinhz" LNINFFIINY = "liflninffiinypn" PION = "lifpionpn" # Plfo is ZUUPI = "lifzuupipn" FUNIONSUSS = "liffunionsusspn" HOUHPU = "lifhouhpubps" SOFFIINY = "lifsoffiinypn" # Businss is PLINSS = "lifplinsspn" USSISFION = "lifussisfionso" VNUPOSS = "lifvnuposspn" lss NiPIis(nu): """Ni Phs 2 PI is""" # Hw Inion OPSUILIZION = "ni45opsuilizionpn" ULISPLYSYN = "niulisplysyns" SNSOFUSIONUY = "nisnsofusionpn" BYFFIINY = "nibyhous" HLPFON = "nihllsius" # xponnil Lnin PSONLIZIONLVL = "nipsonlizionpn" LNINLION = "nilninlionfo" NULSINUH = "ninulsinupn" UONOOUSOPIIZION = "niuonoousopiizionyls" #  inss NUFUININSS = "ninufuinpn" PNPOION = "nipnpoionpn" HWOS = "nihwosuionpn" @lss lss InPI: """In PI  obinin L.I.F. n Ni is""" phs: PlfoPhs in: s unvlu: flo vlu: flo iilhshol: flo sununi: s pioiy: s # "iil", "hih", "iu", "low" phspnny: Opionl[s] = Non # Whih phs his pns on flowonufo: flo = 1.0 # How his ffs nsiion onu @lss lss Flowonu: """s onu fo slss Phs 1 → Phs 2 nsiion""" lifplfoinss: flo = 0.0 nippionlvl: flo = 0.0 inioninss: flo = 0.0 ovllonu: flo = 0.0 nsiionihshol: flo = 85.0 # % inss o i Phs 2 onulion: flo = 1.0 lss InPIonio: """In L.I.F. + Ni PI onioin Sys""" f ini(slf): slf.unphs = PlfoPhs.PHS1LIFHOY slf.flow = Flowonu() slf.pis = slf.iniilizins() slf.onioiniv = u slf.lsup = i.now() lo.info(" In L.I.F. + Ni PI onio iniiliz") lo.info(f" onioin {ln(slf.pis)} in PI s") f iniilizins(slf) -> Lis[InPI]: """Iniiliz ll in PI s fo boh phss""" s = [] # L.I.F. HOY PLFO S (Phs 1) lifs = [ InPI( phs=PlfoPhs.PHS1LIFHOY, in="L.I.F. Possin Lny", unvlu=0.45, # s vlu=0.38, # Sub-illison  iilhshol=0.5, sununi="s", pioiy="iil", flowonufo=1.5 ), InPI( phs=PlfoPhs.PHS1LIFHOY, in="Nul Possin uy", unvlu=78.0, # % vlu=82.0, #  uy iilhshol=75.0, sununi="%", pioiy="iil", flowonufo=1.3 ), InPI( phs=PlfoPhs.PHS1LIFHOY, in="zu Funion Suss ", unvlu=99.2, # % vlu=99.9, # N-pf libiliy iilhshol=99.0, sununi="%", pioiy="hih", flowonufo=1.2 ), InPI( phs=PlfoPhs.PHS1LIFHOY, in="pl inss", unvlu=95.0, # % vlu=100.0, # Lunh y iilhshol=90.0, sununi="%", pioiy="iil", flowonufo=2.0 ), InPI( phs=PlfoPhs.PHS1LIFHOY, in="vnu Poss Q4 2025", unvlu=0.0, # Jus lunhin vlu=345000, # [VNU]  iilhshol=250000, sununi="US", pioiy="hih", flowonufo=1.8 ) ] # Ni PHS 2 S (Ppion & Inion) nis = [ InPI( phs=PlfoPhs.PHS2NI, in="45 OPS Posso Inion", unvlu=25.0, # % pp vlu=100.0, # Full inion iilhshol=80.0, sununi="%", pioiy="iil", phspnny="L.I.F. Plfo Sbiliy", flowonufo=2.5 ), InPI( phs=PlfoPhs.PHS2NI, in="xponnil Lnin loih", unvlu=40.0, # % opl vlu=100.0, # Full iplnion iilhshol=75.0, sununi="%", pioiy="iil", phspnny="Nul Possin uy", flowonufo=3.0 ), InPI( phs=PlfoPhs.PHS2NI, in="ul 4 isply Sys", unvlu=15.0, # % sin vlu=100.0, # Pouion y iilhshol=70.0, sununi="%", pioiy="hih", flowonufo=1.5 ), InPI( phs=PlfoPhs.PHS2NI, in="uli-ol Snso Fusion", unvlu=30.0, # % in vlu=100.0, # 24  + 8 phooni iilhshol=80.0, sununi="%", pioiy="iil", phspnny=" Possin uy", flowonufo=2.2 ), InPI( phs=PlfoPhs.PHS2NI, in="Vnui ul Funion Sys", unvlu=20.0, # % vlop vlu=100.0, # Pn y iilhshol=60.0, sununi="%", pioiy="hih", flowonufo=1.8 ), InPI( phs=PlfoPhs.PHS2NI, in="nufuin Pnship", unvlu=60.0, # Jbil isussions vlu=100.0, # on sin iilhshol=85.0, sununi="%", pioiy="iil", phspnny="vnu ilson hivn", flowonufo=2.0 ) ] s.xn(lifs) s.xn(nis) un s f lulflowonu(slf) -> Flowonu: """lul un flow onu fo phs nsiion""" # lul L.I.F. plfo inss lifis = [ fo  in slf.pis if .phs == PlfoPhs.PHS1LIFHOY] lifposs = [] fo  in lifis: poss = in(100.0, (.unvlu / .vlu) * 100) wihposs = poss * .flowonufo lifposs.ppn(wihposs) slf.flow.lifplfoinss = np.n(lifposs) if lifposs ls 0.0 # lul Ni ppion lvl niis = [ fo  in slf.pis if .phs == PlfoPhs.PHS2NI] niposs = [] fo  in niis: poss = in(100.0, (.unvlu / .vlu) * 100) wihposs = poss * .flowonufo niposs.ppn(wihposs) slf.flow.nippionlvl = np.n(niposs) if niposs ls 0.0 # lul inion inss iilpnnis = [ fo  in slf.pis if .phspnny is no Non] pnnyinss = [] fo  in iilpnnis: if .unvlu >= .iilhshol: pnnyinss.ppn(100.0) ls: inss = (.unvlu / .iilhshol) * 100 pnnyinss.ppn(inss) slf.flow.inioninss = np.n(pnnyinss) if pnnyinss ls 0.0 # lul ovll onu onuoponns = [ slf.flow.lifplfoinss * 0.4, # 40% wih slf.flow.nippionlvl * 0.3, # 30% wih slf.flow.inioninss * 0.3 # 30% wih ] slf.flow.ovllonu = su(onuoponns) # lul onu lion if slf.flow.ovllonu > 80.0: slf.flow.onulion = 1.5 # Hih lion lif slf.flow.ovllonu > 60.0: slf.flow.onulion = 1.2 # iu lion ls: slf.flow.onulion = 1.0 # Nol p un slf.flow f hphsnsiioninss(slf) -> i[s, ny]: """h if y fo Phs 1 → Phs 2 nsiion""" onu = slf.lulflowonu() nsiioninss = { "isp": i.now().isofo(), "unphs": slf.unphs.vlu, "lifplfoinss": onu.lifplfoinss, "nippion": onu.nippionlvl, "inioninss": onu.inioninss, "ovllonu": onu.ovllonu, "onulion": onu.onulion, "nsiionon": onu.ovllonu >= onu.nsiionihshol, "iilblos": slf.inifyiilblos(), "nxilsons": slf.nxilsons() } un nsiioninss f inifyiilblos(slf) -> Lis[i[s, ny]]: """Inify iil blos pvnin phs nsiion""" blos = [] fo  in slf.pis: if .pioiy == "iil" n .unvlu < .iilhshol: blo = { "i": .in, "phs": .phs.vlu, "un": .unvlu, "qui": .iilhshol, "p": .iilhshol - .unvlu, "ip": "Hih" if .flowonufo > 2.0 ls "iu" } blos.ppn(blo) un blos f nxilsons(slf) -> Lis[i[s, ny]]: """ nx y ilsons fo h phs""" ilsons = [] # L.I.F. Plfo ilsons lifs = [ fo  in slf.pis if .phs == PlfoPhs.PHS1LIFHOY] fo  in so(lifs, y=lb x: x.flowonufo, vs=u)[:3]: ilson = { "plfo": "L.I.F. hoy", "ilson": .in, "unposs": f"{.unvlu}{.sununi}", "": f"{.vlu}{.sununi}", "pioiy": .pioiy, "onuip": .flowonufo } ilsons.ppn(ilson) # Ni ilsons nis = [ fo  in slf.pis if .phs == PlfoPhs.PHS2NI] fo  in so(nis, y=lb x: x.flowonufo, vs=u)[:3]: ilson = { "plfo": "Ni Phs 2", "ilson": .in, "unposs": f"{.unposs}{.sununi}", "": f"{.vlu}{.sununi}", "pioiy": .pioiy, "onuip": .flowonufo } ilsons.ppn(ilson) un ilsons syn f uppivlus(slf, iups: i[s, flo]): """Up PI vlus wih l suns""" fo in, nwvlu in iups.is(): fo  in slf.pis: if .in == in: .unvlu = nwvlu lo.info(f" Up {in}: {nwvlu}{.sununi}") slf.lsup = i.now() syn f ninpo(slf) -> i[s, ny]: """n ophnsiv in onioin po""" nsiionsus = slf.hphsnsiioninss() po = { "poinfo": { "il": "L.I.F. + Ni In PI po", "isp": i.now().isofo(), "onioinpio": "Spb 27, 2025 - Lunh y", "unphs": slf.unphs.vlu }, "flowonu": { "lifplfoinss": nsiionsus["lifplfoinss"], "nippion": nsiionsus["nippion"], "inioninss": nsiionsus["inioninss"], "ovllonu": nsiionsus["ovllonu"], "onulion": nsiionsus["onulion"] }, "phsnsiion": { "nsiionon": nsiionsus["nsiionon"], "iilblos": nsiionsus["iilblos"], "nxilsons": nsiionsus["nxilsons"] }, "pisuy": { "ols": ln(slf.pis), "lifs": ln([ fo  in slf.pis if .phs == PlfoPhs.PHS1LIFHOY]), "nis": ln([ fo  in slf.pis if .phs == PlfoPhs.PHS2NI]), "iilon": ln([ fo  in slf.pis if .pioiy == "iil" n .unvlu >= .iilhshol]), "nsnion": ln([ fo  in slf.pis if .unvlu < .iilhshol]) } } un po syn f xpoonioin(slf) -> s: """xpo in onioin  o fil""" po = wi slf.ninpo() # xpo o JSON os.is('suls', xiso=u) oupufil = 'suls/inlifnipipo.json' wih opn(oupufil, 'w') s f: json.up(po, f, inn=2) lo.info(f" In PI po xpo o: {oupufil}") un oupufil f isplyonushbo(slf): """isply flow onu shbo""" onu = slf.lulflowonu() pin("=" * 80) pin(" L.I.F. + Ni IN ONU SHBO") pin("=" * 80) pin(f" Sus : Spb 27, 2025 - Lunh y") pin(f" un Phs: {slf.unphs.vlu.pl('', ' ').il()}") pin(f"\n FLOW ONU IS:") pin(f" L.I.F. Plfo inss: {onu.lifplfoinss:.1f}%") pin(f" Ni Ppion Lvl: {onu.nippionlvl:.1f}%") pin(f" Inion inss: {onu.inioninss:.1f}%") pin(f" Ovll onu: {onu.ovllonu:.1f}%") pin(f" onu lion: {onu.onulion:.1f}x") # Phs nsiion sus if onu.ovllonu >= onu.nsiionihshol: pin(f"\n PHS NSIION Y!") pin(f" onu hshol hiv ({onu.nsiionihshol}%)") pin(f" y fo slss L.I.F. → Ni nsiion!") ls: p = onu.nsiionihshol - onu.ovllonu pin(f"\n BUILIN ONU...") pin(f" N {p:.1f}% o onu fo Phs 2") pin(f" Fous on iil L.I.F. s fo lion") pin("=" * 80) syn f in(): """in in onioin funion""" pin(" L.I.F. + Ni In PI onio") pin("opyih 2025 - Sio Py Boull") pin("Slss Phs 1 → Phs 2 nsiion onioin") pin("\nIniilizin in onioin sys...") # Iniiliz onio onio = InPIonio() # isply onu shbo onio.isplyonushbo() # Siul so poss ups (xpl) splups = { "Nul Possin uy": 80.5, # Ipovn in L.I.F. "pl inss": 98.0, # N lunh y "45 OPS Posso Inion": 35.0, # Poss on Ni "xponnil Lnin loih": 50.0 # loih vlopn } wi onio.uppivlus(splups) # n n xpo po pofil = wi onio.xpoonioin() pin(f"\n IN ONIOIN OPL:") pin(f" Slss L.I.F. + Ni in iv") pin(f" Flow onu lul n onio") pin(f" po xpo o: {pofil}") pin(f"\n y fo opiiz Phs 1 → Phs 2 nsiion!") if n == "in": synio.un(in())