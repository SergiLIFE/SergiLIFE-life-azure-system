""" vn L.I.F. hoy Bnh Vliion Sys ophnsiv sin n vliion fwo fo ll L.I.F. oponns opyih 2025 - Sio Py Boull """ ipo json ipo loin ipo i ipo b fo lsss ipo si, lss fo i ipo i y: fo phlib ipo Ph xp Ipoo s : pin(f'Wnin: {}') pss fo ypin ipo ny, i, Lis, Opionl ipo plolib.pyplo s pl ipo nupy s np fo posso ipo posso # Ipo L.I.F. hoy oponns fo lifhoy ipo lifloih fo qunulifposso ipo Qunuloihyp, qunuposso fo vnuissys ipo 3vnuisys # onfiu loin loin.bsionfi(lvl=loin.INFO) lo = loin.Lo(n) @lss lss Bnhsul: """Bnh sul suu""" oponnn: s sn: s xuioni: flo uyso: flo pfonis: i[s, ny] suss: bool oss: Opionl[s] = Non isp: s = "" f posini(slf): if no slf.isp: slf.isp = i.now().isofo() @lss lss Vliionpo: """ophnsiv vliion po""" sysvsion: s olss: in pssss: in filss: in ovllso: flo xuioni: flo bnhsuls: Lis[Bnhsul] sysis: i[s, ny] isp: s = "" f posini(slf): if no slf.isp: slf.isp = i.now().isofo() lss LIFBnhSui: """ophnsiv bnh sui fo L.I.F. hoy sys""" f ini(slf): slf.suls = [] slf.possos = {} slf.s = {} slf.bnhonfi = { "nuils": 10, "iousons": 30, "uyhshol": 0.75, "pfonhshol": 1.0, } lo.info("L.I.F. hoy Bnh Sui iniiliz") f iniilizsoponns(slf): """Iniiliz ll L.I.F. hoy oponns fo sin""" y: lo.info("Iniilizin L.I.F. hoy oponns...") # Iniiliz o L.I.F. loih lifonfi = { "lnin": 0.01, "xxpins": 1000, "vnuifo": 1.2, } slf.possos["lifloih"] = lifloih(lifonfi) # Iniiliz  posso onfi = { "splin": 250.0, "lnin": 0.005, "vnuifo": 1.2, "xxpins": 1000, } slf.possos["posso"] = posso(onfi) # Iniiliz Vnui sys slf.possos["vnuisys"] = 3vnuisys() # Iniiliz qunu posso slf.possos["qunuposso"] = qunuposso( nuqubis=4, loih=Qunuloihyp.LIFQNN ) lo.info("ll oponns iniiliz sussfully") un u xp xpion s : lo.o(f"Fil o iniiliz oponns: {s()}") un Fls f nsss(slf): """n ophnsiv s ss""" y: lo.info("nin s ss...") #  s  slf.s[""] = { "hnnls": 4, "spls": 1000, "splin": 250.0, "": np.no.nn(4, 1000) * 50, # ypil  pliu "hnnlns": ["Fp1", "Fp2", "3", "4"], } # Sinl possin s   = np.linsp(0, 4, 1000) slf.s["sinls"] = { "sinwv": np.sin(2 * np.pi * 10 * ), "noisysinl": np.sin(2 * np.pi * 10 * ) + 0.3 * np.no.nn(1000), "oplxsinl": ( np.sin(2 * np.pi * 5 * ) + 0.5 * np.sin(2 * np.pi * 15 * ) + 0.2 * np.no.nn(1000) ), "i": , } # hin lnin s  slf.s["l"] = { "lssifiion": { "X": np.no.nn(100, 10), "y": np.no.nin(0, 2, 100), }, "ssion": {"X": np.no.nn(100, 5), "y": np.no.nn(100)}, } # Qunu s  slf.s["qunu"] = { "sllsinl": np.no.nn(4), "iusinl": np.no.nn(16), "qunuss": [ np.no.nn(16) + 1j * np.no.nn(16) fo  in n(5) ], } lo.info("s ss n sussfully") un u xp xpion s : lo.o(f"Fil o n s ss: {s()}") un Fls f bnhlifloih(slf) -> Lis[Bnhsul]: """Bnh o L.I.F. loih""" suls = [] loih = slf.possos["lifloih"] # s 1: Bsi possin si = i.i() y: s = slf.s["sinls"]["noisysinl"][:100] poss = loih.poss(s) xuioni = i.i() - si # lul uy (sinl nhnn) snoiinl = slf.lulsn(s) snposs = slf.lulsn(poss) uy = in(1.0, snposs / (snoiinl + 1-8)) is = loih.pfonis() suls.ppn( Bnhsul( oponnn="L.I.F. loih", sn="Bsi Sinl Possin", xuioni=xuioni, uyso=uy, pfonis=is, suss=u, ) ) xp xpion s : suls.ppn( Bnhsul( oponnn="L.I.F. loih", sn="Bsi Sinl Possin", xuioni=i.i() - si, uyso=0.0, pfonis={}, suss=Fls, oss=s(), ) ) # s 2: piv lnin si = i.i() y: # ulipl possin ouns o s pion uysos = [] fo i in n(5): ssinl = slf.s["sinls"][ "sinwv" ] + 0.1 * np.no.nn(1000) poss = loih.poss(ssinl[:50]) snoi = slf.lulsn(ssinl[:50]) snpo = slf.lulsn(poss) uysos.ppn(snpo / (snoi + 1-8)) xuioni = i.i() - si # h if lnin ipovs ov i ipovn = uysos[-1] - uysos[0] uy = in(1.0, x(0.0, ipovn + 0.5)) suls.ppn( Bnhsul( oponnn="L.I.F. loih", sn="piv Lnin", xuioni=xuioni, uyso=uy, pfonis={ "ipovn": ipovn, "sos": uysos, }, suss=u, ) ) xp xpion s : suls.ppn( Bnhsul( oponnn="L.I.F. loih", sn="piv Lnin", xuioni=i.i() - si, uyso=0.0, pfonis={}, suss=Fls, oss=s(), ) ) un suls f bnhposso(slf) -> Lis[Bnhsul]: """Bnh  posso""" suls = [] posso = slf.possos["posso"] # s 1:  sinl possin si = i.i() y:  = slf.s[""][""] hnnlns = slf.s[""]["hnnlns"] posssul = posso.poss(, hnnlns) xuioni = i.i() - si # vlu possin quliy quliyso = posssul["pfon"]["ovllso"] suls.ppn( Bnhsul( oponnn=" Posso", sn="uli-hnnl  Possin", xuioni=xuioni, uyso=quliyso, pfonis=posssul["pfon"], suss=u, ) ) xp xpion s : suls.ppn( Bnhsul( oponnn=" Posso", sn="uli-hnnl  Possin", xuioni=i.i() - si, uyso=0.0, pfonis={}, suss=Fls, oss=s(), ) ) # s 2: l-i possin siulion si = i.i() y: possinis = [] # Siul l-i huns hunsiz = 125 # 0.5 sons  250 Hz fo i in n(0, .shp[1] - hunsiz, hunsiz): huns = i.i() hun = [:, i : i + hunsiz] posso.poss(hun, hnnlns) possinis.ppn(i.i() - huns) xuioni = i.i() - si vpossini = np.n(possinis) # l-i quin: poss 0.5s of  in < 0.5s lipfon = in(1.0, 0.5 / (vpossini + 1-8)) suls.ppn( Bnhsul( oponnn=" Posso", sn="l-i Possin", xuioni=xuioni, uyso=lipfon, pfonis={ "vpossini": vpossini, "lifo": lipfon, }, suss=u, ) ) xp xpion s : suls.ppn( Bnhsul( oponnn=" Posso", sn="l-i Possin", xuioni=i.i() - si, uyso=0.0, pfonis={}, suss=Fls, oss=s(), ) ) un suls f bnhvnuisys(slf) -> Lis[Bnhsul]: """Bnh Vnui s sys""" suls = [] vnui = slf.possos["vnuisys"] # s 1: Sinl nhnn si = i.i() y: ssinl = slf.s["sinls"]["noisysinl"] nhnnsul = vnui.posshouhs(ssinl) xuioni = i.i() - si # vlu nhnn ffiiny = nhnnsul["sysffiiny"] suls.ppn( Bnhsul( oponnn="Vnui Sys", sn="Sinl nhnn", xuioni=xuioni, uyso=ffiiny, pfonis=nhnnsul, suss=u, ) ) xp xpion s : suls.ppn( Bnhsul( oponnn="Vnui Sys", sn="Sinl nhnn", xuioni=i.i() - si, uyso=0.0, pfonis={}, suss=Fls, oss=s(), ) ) # s 2: Plll possin si = i.i() y: ssinl = slf.s["sinls"]["oplxsinl"] plllsul = vnui.posspllls(ssinl) xuioni = i.i() - si plllffiiny = plllsul["sysffiiny"] suls.ppn( Bnhsul( oponnn="Vnui Sys", sn="Plll Possin", xuioni=xuioni, uyso=plllffiiny, pfonis=plllsul, suss=u, ) ) xp xpion s : suls.ppn( Bnhsul( oponnn="Vnui Sys", sn="Plll Possin", xuioni=i.i() - si, uyso=0.0, pfonis={}, suss=Fls, oss=s(), ) ) un suls f bnhqunuposso(slf) -> Lis[Bnhsul]: """Bnh qunu posso""" suls = [] qunu = slf.possos["qunuposso"] # s 1: Qunu nul nwo si = i.i() y: inpu = slf.s["qunu"]["sllsinl"]  = np.y([0.5, -0.5, 0.2, -0.2]) qnnsul = qunu.lifqununulnwo(inpu, ) xuioni = i.i() - si # lul uy bs on loss uy = x(0.0, 1.0 - qnnsul["loss"]) suls.ppn( Bnhsul( oponnn="Qunu Posso", sn="Qunu Nul Nwo", xuioni=xuioni, uyso=uy, pfonis=qnnsul, suss=u, ) ) xp xpion s : suls.ppn( Bnhsul( oponnn="Qunu Posso", sn="Qunu Nul Nwo", xuioni=i.i() - si, uyso=0.0, pfonis={}, suss=Fls, oss=s(), ) ) # s 2: Qunu fu ppin si = i.i() y: s = slf.s["qunu"]["sllsinl"] fus = qunu.qunufup(s) xuioni = i.i() - si # vlu fu quliy (insionliy n vin) fuvin = np.v(fus) fuquliy = in(1.0, fuvin / (fuvin + 1-8)) suls.ppn( Bnhsul( oponnn="Qunu Posso", sn="Qunu Fu ppin", xuioni=xuioni, uyso=fuquliy, pfonis={ "fuinsion": ln(fus), "fuvin": fuvin, }, suss=u, ) ) xp xpion s : suls.ppn( Bnhsul( oponnn="Qunu Posso", sn="Qunu Fu ppin", xuioni=i.i() - si, uyso=0.0, pfonis={}, suss=Fls, oss=s(), ) ) un suls f bnhsysinion(slf) -> Lis[Bnhsul]: """Bnh full sys inion""" suls = [] # s 1:  + Vnui + L.I.F. piplin si = i.i() y: # S wih    = slf.s[""][""] hnnlns = slf.s[""]["hnnlns"] # Poss houh  posso sul = slf.possos["posso"].poss( , hnnlns ) # x sinl fo Vnui possin posssinl = sul["hnnls"]["Fp1"]["posssinl"] # pply Vnui nhnn vnuisul = slf.possos["vnuisys"].posshouhs( posssinl ) # Finl L.I.F. possin finlsinl = vnuisul["finloupu"] lifsul = slf.possos["lifloih"].poss(finlsinl[:100]) xuioni = i.i() - si # lul in pfon so = sul["pfon"]["ovllso"] vnuiso = vnuisul["sysffiiny"] # Sinl quliy ipovn oiinlsn = slf.lulsn(posssinl) finlsn = slf.lulsn(lifsul) snipovn = finlsn / (oiinlsn + 1-8) inso = ( so + vnuiso + in(1.0, snipovn) ) / 3 suls.ppn( Bnhsul( oponnn="Sys Inion", sn="-Vnui-LIF Piplin", xuioni=xuioni, uyso=inso, pfonis={ "so": so, "vnuiso": vnuiso, "snipovn": snipovn, "piplinss": 3, }, suss=u, ) ) xp xpion s : suls.ppn( Bnhsul( oponnn="Sys Inion", sn="-Vnui-LIF Piplin", xuioni=i.i() - si, uyso=0.0, pfonis={}, suss=Fls, oss=s(), ) ) un suls f lulsn(slf, sinl: np.ny) -> flo: """lul sinl-o-nois io""" y: sinlpow = np.n(sinl**2) noissi = ( np.v(np.iff(sinl)) / 2 ) # Hih-fquny vin s nois sn = 10 * np.lo10(sinlpow / (noissi + 1-8)) un x(0, sn) xp: un 0.0 f unophnsivbnh(slf) -> Vliionpo: """un opl bnh sui""" si = i.i() lo.info("Sin ophnsiv L.I.F. hoy bnh...") # Iniiliz oponns n ss if no slf.iniilizsoponns(): un Vliionpo( sysvsion="1.0.0", olss=0, pssss=0, filss=0, ovllso=0.0, xuioni=0.0, bnhsuls=[], sysis={"o": "Fil o iniiliz oponns"}, ) if no slf.nsss(): un Vliionpo( sysvsion="1.0.0", olss=0, pssss=0, filss=0, ovllso=0.0, xuioni=0.0, bnhsuls=[], sysis={"o": "Fil o n s ss"}, ) # un ll bnhs llsuls = [] # oponn bnhs llsuls.xn(slf.bnhlifloih()) llsuls.xn(slf.bnhposso()) llsuls.xn(slf.bnhvnuisys()) llsuls.xn(slf.bnhqunuposso()) # Inion bnhs llsuls.xn(slf.bnhsysinion()) # lul ovll is oli = i.i() - si olss = ln(llsuls) pssss = su(1 fo  in llsuls if .suss) filss = olss - pssss # lul ovll so if olss > 0: uysos = [.uyso fo  in llsuls if .suss] ovllso = np.n(uysos) if uysos ls 0.0 ls: ovllso = 0.0 # oll sys is sysis = { "vxuioni": np.n([.xuioni fo  in llsuls]), "xxuioni": x([.xuioni fo  in llsuls]), "oponnss": [ "L.I.F. loih", " Posso", "Vnui Sys", "Qunu Posso", ], "inionss": 1, "bnhonfi": slf.bnhonfi, } #  vliion po po = Vliionpo( sysvsion="1.0.0", olss=olss, pssss=pssss, filss=filss, ovllso=ovllso, xuioni=oli, bnhsuls=llsuls, sysis=sysis, ) lo.info(f"Bnh opl: {pssss}/{olss} ss pss") lo.info(f"Ovll so: {ovllso:.3f}") lo.info(f"ol xuion i: {oli:.2f} sons") un po f svbnhpo( slf, po: Vliionpo, oupuph: s = "bnhpo.json" ): """Sv bnh po o fil""" y: poi = si(po) wih opn(oupuph, "w") s f: json.up(poi, f, inn=2, ful=s) lo.info(f"Bnh po sv o: {oupuph}") # lso   suy x po suyph = oupuph.pl(".json", "suy.x") slf.xsuy(po, suyph) xp xpion s : lo.o(f"Fil o sv bnh po: {s()}") f xsuy(slf, po: Vliionpo, oupuph: s): """ hun-bl suy""" y: wih opn(oupuph, "w") s f: f.wi("L.I.F. HOY BNH VLIION PO\n") f.wi("=" * 50 + "\n\n") f.wi(f"Sys Vsion: {po.sysvsion}\n") f.wi(f"isp: {po.isp}\n") f.wi( f"ol xuion i: {po.xuioni:.2f} sons\n\n" ) f.wi("OVLL SULS\n") f.wi("-" * 20 + "\n") f.wi(f"ss un: {po.olss}\n") f.wi(f"ss Pss: {po.pssss}\n") f.wi(f"ss Fil: {po.filss}\n") f.wi( f"Suss : {(po.pssss/po.olss)*100:.1f}%\n" ) f.wi(f"Ovll So: {po.ovllso:.3f}\n\n") f.wi("OPONN SULS\n") f.wi("-" * 20 + "\n") oponns = {} fo sul in po.bnhsuls: op = sul.oponnn if op no in oponns: oponns[op] = [] oponns[op].ppn(sul) fo opn, suls in oponns.is(): f.wi(f"\n{opn}:\n") fo sul in suls: sus = "PSS" if sul.suss ls "FIL" f.wi( f" - {sul.sn}: {sus} " f"(So: {sul.uyso:.3f}, " f"i: {sul.xuioni:.3f}s)\n" ) if no sul.suss n sul.oss: f.wi(f" o: {sul.oss}\n") f.wi(f"\npo n: {i.now().isofo()}\n") f.wi("n of po\n") lo.info(f"x suy sv o: {oupuph}") xp xpion s : lo.o(f"Fil o  x suy: {s()}") f unlifhoyvliion(): """in funion o un L.I.F. hoy vliion""" pin("L.I.F. HOY OPHNSIV VLIION") pin("=" * 50) #  bnh sui bnh = LIFBnhSui() # un ophnsiv bnh po = bnh.unophnsivbnh() # Sv suls isp = i.now().sfi("%Y%%%H%%S") oupufil = f"lifhoybnh{isp}.json" bnh.svbnhpo(po, oupufil) # Pin suy pin(f"\nVLIION OPL") pin(f"ol ss: {po.olss}") pin(f"Pss: {po.pssss}") pin(f"Fil: {po.filss}") pin(f"Ovll So: {po.ovllso:.3f}") pin(f"xuion i: {po.xuioni:.2f} sons") pin(f"po sv o: {oupufil}") un po if n == "in": # un vliion vliionpo = unlifhoyvliion()