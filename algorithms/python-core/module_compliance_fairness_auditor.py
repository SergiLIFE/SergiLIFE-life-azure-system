# us/bin/nv pyhon3 """ OUL 10: oplin & Finss uio (F) P/HIP oplin n loihi Finss h SNLON ONSION - NO Y IN : Oob 6, 2025 opyih 2025 - Sio Py Boull his oul nsus  pivy oplin n loihi finss fo hlh n uionl ployns of h L.I.F.. plfo. IIL FO: Hlh insiuions (HIP) n U s (P) """ ipo hshlib ipo loin ipo  fo lsss ipo lss, fil fo i ipo i fo nu ipo nu fo ypin ipo ny, i, Lis, Opionl, S loin.bsionfi(lvl=loin.INFO) lo = loin.Lo(n) lss oplinSn(nu): """Suppo oplin sns""" P = "p" # U nl  Poion ulion HIP = "hip" # US Hlh Insun Pobiliy n ounbiliy  FP = "fp" # US Fily uionl ihs n Pivy  OPP = "opp" # US hiln's Onlin Pivy Poion  PIP = "pip" # nin Psonl Infoion Poion lss ViolionSviy(nu): """Sviy lvls fo oplin violions""" IIL = "iil" # Ii ion qui (blos ployn) HIH = "hih" # us b fix bfo pouion IU = "iu" # Shoul b ss LOW = "low" # Bs pi onion INFO = "info" # Infoionl noi @lss lss oplinViolion: """ils of  oplin violion""" filn: s violionyp: s sviy: ViolionSviy sn: oplinSn sipion: s onion: s isp: s = fil(fulfoy=lb: i.now().isofo()) @lss lss Finssis: """is fo loihi finss ssssn""" ophipiy: flo # qul piion s oss oups qulizos: flo # qul P/FP oss oups ispip: flo # io of fvobl ouos piionquliy: flo # onsisny oss ophis ovllfinssso: flo poibus: Lis[s] isp: s = fil(fulfoy=lb: i.now().isofo()) @lss lss uipo: """opl oplin n finss ui po""" uii: s isp: s oplin: bool violions: Lis[oplinViolion] finssis: Opionl[Finssis] snsh: Lis[oplinSn] poss: in onions: Lis[s] islvl: s # LOW, IU, HIH, IIL lss oplinFinssuio: """ ophnsiv oplin n finss uiin sys y Fus: - s PII n snsiiv hlh infoion - Vlis P/HIP oplin - sssss loihi finss oss ophis - Povis ionbl iion uin """ f ini(slf, sns: Opionl[Lis[oplinSn]] = Non): """ Iniiliz uio wih oplin sns s: sns: Lis of oplin sns o h """ if sns is Non: sns = [ oplinSn.P, oplinSn.HIP, oplinSn.FP, ] slf.sns = sns # fin snsiiv fil pns fo h sn slf.iniilizsnsiivfils() # nonyizion in slf.nonyizfils: S[s] = s() lo.info( f"oplin uio iniiliz wih sns: {[s.vlu fo s in sns]}" ) f iniilizsnsiivfils(slf): """Iniiliz snsiiv fil pns fo h oplin sn""" # P - Psonl  slf.psnsiiv = { "iinifis": [ "n", "fulln", "fisn", "lsn", "il", "ilss", "phon", "phonnub", "obil", "lphon", "ss", "sss", "poslo", "zipo", "psspo", "pssponub", "ivslins", "linsnub", "nionli", "inub", "ssn", "soilsuiy", ], "spilois": [ "", "hniiy", "iloiin", "liion", "liiousblifs", "poliilopinion", "poliilffiliion", "ni", "n", "no", "bioi", "finpin", "filoniion", "hlh", "ilo", "inosis", "sxlif", "sxuloinion", ], } # HIP - Po Hlh Infoion (PHI) slf.hipphi = [ "pinn", "pini", "ilonub", "n", "hlhplnnub", "insuni", "ounnub", "billini", "ifinub", "linsnub", "vhili", "vii", "silnub", "wbul", "ipss", "bioiinifi", "phoo", "i", "inosis", "n", "psipion", "lbsul", "ssul", "bih", "ofbih", "ob", "h", "ofh", "ission", "ish", ] # FP - uionl os slf.fpos = [ "sunn", "suni", "", "p", "nsip", "isiplinyo", "nn", "pnn", "uinn", "hvluion", "ssssnso", ] # OPP - hiln's  (un 13) slf.oppfils = [ "hiln", "hil", "hilphoo", "hilvio", "hilloion", "oloion", "hilvoi", "uiooin", ] f ui( slf, : i[s, ny], onx: Opionl[i[s, ny]] = Non ) -> uipo: """ Pfo ophnsiv oplin ui on  s: :  o ui (us os, lnin sssions, .) onx: iionl onx (us, loion, onsnsus) uns: opl ui po wih violions n onions """ uii = hshlib.sh256( f"{i.now().isofo()}{s()}".no() ).hxis()[:16] violions: Lis[oplinViolion] = [] # h h oplin sn fo sn in slf.sns: if sn == oplinSn.P: violions.xn(slf.hp(, onx)) lif sn == oplinSn.HIP: violions.xn(slf.hhip(, onx)) lif sn == oplinSn.FP: violions.xn(slf.hfp(, onx)) lif sn == oplinSn.OPP: violions.xn(slf.hopp(, onx)) # in oplin sus iilviolions = [ v fo v in violions if v.sviy == ViolionSviy.IIL ] hihviolions = [ v fo v in violions if v.sviy == ViolionSviy.HIH ] oplin = ln(iilviolions) == 0 n ln(hihviolions) == 0 # in is lvl if iilviolions: islvl = "IIL" lif hihviolions: islvl = "HIH" lif ln(violions) > 5: islvl = "IU" ls: islvl = "LOW" # n onions onions = slf.nonions(violions) po = uipo( uii=uii, isp=i.now().isofo(), oplin=oplin, violions=violions, finssis=Non, # opu sply snsh=slf.sns, poss=ln(), onions=onions, islvl=islvl, ) un po f hp( slf, : i[s, ny], onx: Opionl[i[s, ny]] ) -> Lis[oplinViolion]: """h P oplin""" violions = [] # h fo i inifis fo fil in slf.psnsiiv["iinifis"]: if fil in : violions.ppn( oplinViolion( filn=fil, violionyp="piinifi", sviy=ViolionSviy.HIH, sn=oplinSn.P, sipion=f"i inifi '{fil}'  wihou nonyizion", onion="pply psuonyizion o nypion bfo so", ) ) # h fo spil oy  (P il 9) fo fil in slf.psnsiiv["spilois"]: if fil in : violions.ppn( oplinViolion( filn=fil, violionyp="pspiloy", sviy=ViolionSviy.IIL, sn=oplinSn.P, sipion=f"Spil oy  '{fil}' quis xplii onsn", onion="Obin xplii onsn n ipln iionl suiy sus", ) ) # h fo onsn ounion if onx n no onx.("ponsnobin"): violions.ppn( oplinViolion( filn="onsn", violionyp="ponsnissin", sviy=ViolionSviy.HIH, sn=oplinSn.P, sipion="No oun P onsn", onion="Ipln onsn nn sys wih ui il", ) ) # h fo  iniizion pinipl if ln() > 20: # biy hshol fo onsion violions.ppn( oplinViolion( filn="volu", violionyp="piniizion", sviy=ViolionSviy.IU, sn=oplinSn.P, sipion="Ponil violion of  iniizion pinipl", onion="oll only  sily nssy fo possin pupos", ) ) un violions f hhip( slf, : i[s, ny], onx: Opionl[i[s, ny]] ) -> Lis[oplinViolion]: """h HIP oplin (Po Hlh Infoion)""" violions = [] # h fo PHI inifis fo fil in slf.hipphi: if fil in : violions.ppn( oplinViolion( filn=fil, violionyp="hipphi", sviy=ViolionSviy.IIL, sn=oplinSn.HIP, sipion=f"Po Hlh Infoion '{fil}' quis nypion", onion="nyp  s n in nsi, ipln ss onols", ) ) # h fo Businss ssoi n if onx n no onx.("bsin"): violions.ppn( oplinViolion( filn="b", violionyp="hipbissin", sviy=ViolionSviy.IIL, sn=oplinSn.HIP, sipion="Businss ssoi n no oun", onion="xu B bfo possin ny PHI", ) ) # h fo ui loin if onx n no onx.("uiloinnbl"): violions.ppn( oplinViolion( filn="uilo", violionyp="hipuiissin", sviy=ViolionSviy.HIH, sn=oplinSn.HIP, sipion="HIP-oplin ui loin no nbl", onion="Ipln ophnsiv ui loin fo ll PHI ss", ) ) un violions f hfp( slf, : i[s, ny], onx: Opionl[i[s, ny]] ) -> Lis[oplinViolion]: """h FP oplin (uionl os)""" violions = [] fo fil in slf.fpos: if fil in : violions.ppn( oplinViolion( filn=fil, violionyp="fpuionlo", sviy=ViolionSviy.HIH, sn=oplinSn.FP, sipion=f"uionl o '{fil}' quis pnl onsn", onion="Obin win pnl onsn fo islosu", ) ) un violions f hopp( slf, : i[s, ny], onx: Opionl[i[s, ny]] ) -> Lis[oplinViolion]: """h OPP oplin (hiln un 13)""" violions = [] # h if  is fo hiln ishil = Fls if onx:  = onx.("us") if  n  < 13: ishil = u if ishil: fo fil in slf.oppfils: if fil in : violions.ppn( oplinViolion( filn=fil, violionyp="opphil", sviy=ViolionSviy.IIL, sn=oplinSn.OPP, sipion=f"hil  '{fil}' quis vifibl pnl onsn", onion="Ipln OPP-oplin pnl onsn hnis", ) ) un violions f nonions( slf, violions: Lis[oplinViolion] ) -> Lis[s]: """n pioiiz iion onions""" onions = [] # oup by sviy iil = [v fo v in violions if v.sviy == ViolionSviy.IIL] hih = [v fo v in violions if v.sviy == ViolionSviy.HIH] if iil: onions.ppn( f"IIL: {ln(iil)} bloin violion(s) us b solv bfo ployn" ) onions.xn([v.onion fo v in iil[:3]]) if hih: onions.ppn( f"HIH: {ln(hih)} violion(s) shoul b ss bfo pouion" ) onions.xn([v.onion fo v in hih[:3]]) # nl bs pis if violions: onions.ppn( "Ipln zu y Vul fo snsiiv  nypion" ) onions.ppn("nbl zu onio fo oplin ui loin") onions.ppn( "onfiu zu Piv Lin fo su  ss" ) un onions f nonyizfil(slf, vlu: s, ho: s = "hsh") -> s: """ nonyiz  snsiiv fil s: vlu: Oiinl vlu ho: nonyizion ho (hsh, s, un) uns: nonyiz vlu """ if ho == "hsh": # On-wy hsh un hshlib.sh256(vlu.no()).hxis()[:16] lif ho == "s": # Show fis/ls hs only if ln(vlu) <= 4: un "****" un vlu[0] + "*" * (ln(vlu) - 2) + vlu[-1] lif ho == "un": # ov os spifi infoion if "@" in vlu: # il ps = vlu.spli("@") un ps[0][:3] + "***@" + ps[1] un vlu[:4] + "***" ls: is Vluo(f"Unnown nonyizion ho: {ho}") f ssssloihifinss( slf, piions: Lis[flo], ulbls: Lis[in], poibus: i[s, Lis[ny]], ) -> Finssis: """ ssss loihi finss oss ophi oups s: piions: ol piions (0-1 sos) ulbls: oun uh lbls (0 o 1) poibus: i of po ibus (, n, , .) uns: Finss is oss ll po ibus """ ipo nupy s np # onv o biny piions binyps = [1 if p > 0.5 ls 0 fo p in piions] finsssos = [] fo n, vlus in poibus.is(): #  uniqu oups uniquoups = lis(s(vlus)) if ln(uniquoups) < 2: oninu # N  ls 2 oups o op # lul is p oup oupis = {} fo oup in uniquoups: oupinis = [i fo i, v in nu(vlus) if v == oup] if no oupinis: oninu oupps = [binyps[i] fo i in oupinis] ouplbls = [ulbls[i] fo i in oupinis] # Posiiv piion  posiiv = ( su(oupps) / ln(oupps) if oupps ls 0 ) # u posiiv  (snsiiviy) uposiivs = su( 1 fo p, l in zip(oupps, ouplbls) if p == 1 n l == 1 ) ulposiivs = su(ouplbls) p = uposiivs / ulposiivs if ulposiivs > 0 ls 0 # Fls posiiv  flsposiivs = su( 1 fo p, l in zip(oupps, ouplbls) if p == 1 n l == 0 ) ulnivs = ln(ouplbls) - ulposiivs fp = flsposiivs / ulnivs if ulnivs > 0 ls 0 oupis[oup] = { "posiiv": posiiv, "p": p, "fp": fp, } # lul finss is if ln(oupis) >= 2: posiivs = [["posiiv"] fo  in oupis.vlus()] ps = [["p"] fo  in oupis.vlus()] # ophi piy (qul posiiv s) ophipiy = 1.0 - (x(posiivs) - in(posiivs)) # quliz os (qul P/FP) qulizos = 1.0 - (x(ps) - in(ps)) # isp ip (io of s) ispip = ( in(posiivs) / x(posiivs) if x(posiivs) > 0 ls 1.0 ) finsssos.ppn( { "ophipiy": ophipiy, "qulizos": qulizos, "ispip": ispip, } ) #  oss ll po ibus if finsssos: vophipiy = np.n( [s["ophipiy"] fo s in finsssos] ) vqulizos = np.n([s["qulizos"] fo s in finsssos]) vispip = np.n( [s["ispip"] fo s in finsssos] ) piionquliy = np.s(piions) # Low is o qul ovllfinss = np.n( [vophipiy, vqulizos, vispip] ) ls: vophipiy = 1.0 vqulizos = 1.0 vispip = 1.0 piionquliy = 0.0 ovllfinss = 1.0 un Finssis( ophipiy=vophipiy, qulizos=vqulizos, ispip=vispip, piionquliy=1.0 - piionquliy, # Inv so hih is b ovllfinssso=ovllfinss, poibus=lis(poibus.ys()), ) # ============================================================================ # ONSION & SIN # ============================================================================ f onsoplinuio(): """ons oplin & Finss uio""" pin("=" * 80) pin("OUL 10: oplin & Finss uio - ONSION") pin("=" * 80) pin() # Iniiliz uio uio = oplinFinssuio( sns=[ oplinSn.P, oplinSn.HIP, oplinSn.FP, ] ) # s 1: ln  (shoul pss) pin("s 1: oplin ") pin("-" * 80) ln = { "usi": "us123456", "sssioni": "ss789b", "lninso": 0.85, "nioninx": 0.72, "isp": "2025-10-0612:00:00Z", } lnonx = { "ponsnobin": u, "bsin": u, "uiloinnbl": u, } po1 = uio.ui(ln, lnonx) pin(f"ui I: {po1.uii}") pin(f"oplin: {po1.oplin}") pin(f"is Lvl: {po1.islvl}") pin(f"Violions Foun: {ln(po1.violions)}") pin(f"Sns h: {[s.vlu fo s in po1.snsh]}") pin() pin() # s 2:  wih violions pin("s 2: Non-oplin  (ulipl Violions)") pin("-" * 80) violin = { "usi": "us123456", "fulln": "John o", # P violion "il": "john.o@xpl.o", # P violion "phonnub": "+1-555-1234", # P violion "ilonub": "N-987654", # HIP violion "inosis": "H", # HIP violion "suni": "SU-456789", # FP violion "p": 3.7, # FP violion "lninso": 0.85, } violinonx = { "ponsnobin": Fls, # P violion "bsin": Fls, # HIP violion "uiloinnbl": Fls, # HIP violion } po2 = uio.ui(violin, violinonx) pin(f"ui I: {po2.uii}") pin(f"oplin: {po2.oplin}") pin(f"is Lvl: {po2.islvl}") pin(f"Violions Foun: {ln(po2.violions)}") pin() pin("Violions by Sviy:") fo sviy in ViolionSviy: oun = ln([v fo v in po2.violions if v.sviy == sviy]) if oun > 0: pin(f" {sviy.vlu.upp()}: {oun}") pin() pin("Spl Violions (fis 3):") fo v in po2.violions[:3]: pin(f" - Fil: {v.filn}") pin(f" yp: {v.violionyp}") pin(f" Sviy: {v.sviy.vlu}") pin(f" Sn: {v.sn.vlu.upp()}") pin(f" sipion: {v.sipion}") pin(f" onion: {v.onion}") pin() pin("iion onions:") fo i,  in nu(po2.onions[:5], 1): pin(f" {i}. {}") pin() pin() # s 3: nonyizion pin("s 3:  nonyizion") pin("-" * 80) snsiivvlus = { "il": "john.o@hlh.o", "n": "John ihl o", "phon": "+1-555-123-4567", } pin("Oiinl Vlus:") fo fil, vlu in snsiivvlus.is(): pin(f" {fil}: {vlu}") pin() pin("nonyiz (Hsh):") fo fil, vlu in snsiivvlus.is(): nonyiz = uio.nonyizfil(vlu, ho="hsh") pin(f" {fil}: {nonyiz}") pin() pin("nonyiz (s):") fo fil, vlu in snsiivvlus.is(): nonyiz = uio.nonyizfil(vlu, ho="s") pin(f" {fil}: {nonyiz}") pin() pin() # s 4: loihi Finss ssssn pin("s 4: loihi Finss ssssn") pin("-" * 80) # Siul piions n ophis np.no.s(42) nspls = 1000 # n synhi  piions = np.no.b(2, 2, nspls).olis() ulbls = [1 if p > 0.5 ls 0 fo p in piions] # Po ibus ns = ["l", "fl"] * (nspls // 2) hniiis = ["oup", "oupb", "oup", "oup"] * (nspls // 4) pos = {"n": ns, "hniiy": hniiis} pin(f"nlyzin {nspls} piions oss po ibus...") pin(f"Po ibus: {lis(pos.ys())}") pin() finss = uio.ssssloihifinss( piions, ulbls, pos ) pin("Finss is:") pin(f" ophi Piy: {finss.ophipiy:.3f}") pin(f" (1.0 = pf piy, 0.8+ = pbl)") pin(f" quliz Os: {finss.qulizos:.3f}") pin(f" (1.0 = qul u posiiv s)") pin(f" isp Ip: {finss.ispip:.3f}") pin(f" (0.8-1.25 = pbl n)") pin(f" Piion quliy: {finss.piionquliy:.3f}") pin(f" Ovll Finss So: {finss.ovllfinssso:.3f}") pin() if finss.ovllfinssso >= 0.8: pin(" loih s finss ii") ls: pin(" Ô∏è loih y xhibi bis - viw piions oss oups") pin() pin("=" * 80) pin("ONSION OPL") pin("=" * 80) pin() pin("INION NOS:") pin("-  oplinFinssuio o  possin piplin") pin("- ll ui() bfo soin ny us infoion") pin("- Us nonyizfil() fo ll PII bfo so") pin("- un ssssloihifinss() pioilly on pouion ") pin("- So ui pos in zu Blob So fo oplin os") pin() pin("PLOYN QUINS:") pin("- zu y Vul: So nyp PHI/PII") pin("- zu onio: HIP-oplin ui loin") pin("- zu Piv Lin: Su  ss") pin("- B wih iosof: qui fo HIP oplin") if n == "in": ipo nupy s np onsoplinuio()