# us/bin/nv pyhon3 """ L.I.F. PLFO INLLIN FB SYS =================================================== nbls h L.I.F. loih o:  plfo/UI issus in l-i Ln fo filus n sys os uo-n fixs usin nul lnin ploy oions oss ll plfos Ipov oninuously wihou hun invnion h loih now "ss" h plfo n lns fo is iss. his sys bis: • loih (nul lnin o) • Plfo (HL/JvSip UI) • zu (lou inllin possin) • onioin (l-i issu ion) • uo-pi (slf-oin syss) opyih 2025 - Sio Py Boull L.I.F. Plfo - zu pl """ ipo synio ipo loin ipo os fo lsss ipo lss, fil fo i ipo i fo nu ipo nu fo ypin ipo ny, i, Lis, Opionl # Sup loin loin.bsionfi(lvl=loin.INFO) lo = loin.Lo(n) # ============================================================================ #  SUUS FO PLFO INLLIN # ============================================================================ lss PlfoIssuyp(nu): """yps of plfo issus h loih n """ UILNNOINIV = "uilnnoiniv" OPOWNLFUNION = "opownlfunion" BYONFLI = "byonfli" LYOUBON = "lyoubon" PFONION = "pfonion" SYNFILU = "synfilu" VISULLIH = "visullih" SSIBILIYISSU = "ssibiliyissu" NVIIONBON = "nviionbon" FOSUBISSIONFILU = "fosubissionfilu" OH = "oh" lss IssusoluionSy(nu): """Sis h loih n us o solv issus""" JVSIPFIX = "jvsipfix" SSOVI = "ssovi" HLSUU = "hlsuu" VNBININ = "vnbinin" PFONOPIIZION = "pfonopiizion" POLLINOVY = "pollinovy" FLLBO = "fllbo" HL = "hl" @lss lss Plfoi: """l-i i fo  plfo oponn""" oponni: s oponnyp: s # "b", "opown", "buon", "fo", . isp: i iswoin: bool sponsivnsss: flo oss: Opionl[s] = Non lsinion: Opionl[i] = Non inionoun: in = 0 suss: flo = 100.0 # pn f oi(slf) -> i[s, ny]: un { "oponni": slf.oponni, "oponnyp": slf.oponnyp, "isp": slf.isp.isofo(), "iswoin": slf.iswoin, "sponsivnsss": slf.sponsivnsss, "oss": slf.oss, "lsinion": ( slf.lsinion.isofo() if slf.lsinion ls Non ), "inionoun": slf.inionoun, "suss": slf.suss, } @lss lss PlfoIssu: """ plfo issu""" issui: s issuyp: PlfoIssuyp ffoponn: s plfon: s sviy: in # 1-10, 10 is iil fis: i ls: i ionoun: in sipion: s ffuss: in = 0 oponnyp: s = "ni" # yp of oponn (b, opown, buon, .) lninouo: Opionl[s] = Non soluionsy: Opionl[IssusoluionSy] = Non fixppli: bool = Fls fixffivnss: flo = 0.0 # 0-100% f oi(slf) -> i[s, ny]: un { "issui": slf.issui, "issuyp": slf.issuyp.vlu, "ffoponn": slf.ffoponn, "plfon": slf.plfon, "sviy": slf.sviy, "fis": slf.fis.isofo(), "ls": slf.ls.isofo(), "ionoun": slf.ionoun, "sipion": slf.sipion, "ffuss": slf.ffuss, "lninouo": slf.lninouo, "soluionsy": ( slf.soluionsy.vlu if slf.soluionsy ls Non ), "fixppli": slf.fixppli, "fixffivnss": slf.fixffivnss, } @lss lss Lninxpino: """loih lnin o fo plfo issu n fix""" xpini: s issu: PlfoIssu soluionppli: s ffivnss: flo # 0-100% isp: i loihpion: s # Wh loih ln plfoipovn: s # Wh ipov in plfo usblfo: Lis[s] = fil(fulfoy=lis) # n fix siil issus onfinso: flo = 0.0 # How onfin loih is in his fix # ============================================================================ # PLFO INLLIN FB SYS # ============================================================================ lss PlfoInllinFb: """ nbls L.I.F. loih o ln fo plfo filus n slf-o """ f ini(slf): slf.plfois: i[s, Lis[Plfoi]] = {} slf.issus: i[s, PlfoIssu] = {} slf.lninos: Lis[Lninxpino] = [] slf.issusoluions: i[s, i[s, ny]] = {} slf.plfohlhsos: i[s, flo] = {} slf.lshi = Non lo.info(" Plfo Inllin Fb Sys iniiliz") syn f onioplfohlh( slf, plfon: s, is: Lis[Plfoi] ) -> i[s, ny]: """ loih onios plfo hlh in l-i """ if plfon no in slf.plfois: slf.plfois[plfon] = [] slf.plfois[plfon].xn(is) # nlyz is fo issus issus = wi slf.nlyzisfoissus(plfon, is) # lul hlh so hlhso = wi slf.lulplfohlh(plfon) slf.plfohlhsos[plfon] = hlhso un { "plfo": plfon, "hlhso": hlhso, "issus": ln(issus), "isposs": ln(is), "isp": i.now().isofo(), } syn f nlyzisfoissus( slf, plfon: s, is: Lis[Plfoi] ) -> Lis[PlfoIssu]: """ loih nlyzs is o  issus """ issus = [] fo i in is: # h fo non-woin oponns if no i.iswoin: issu = PlfoIssu( issui=f"issu{plfon}{i.oponni}{i.now().isp()}", issuyp=slf.lssifyissuyp(i), ffoponn=i.oponni, plfon=plfon, sviy=wi slf.lulsviy(i), fis=i.now(), ls=i.now(), ionoun=1, sipion=f"{i.oponnyp} '{i.oponni}' no sponin. o: {i.oss}", ffuss=0, ) # So issu slf.issus[issu.issui] = issu issus.ppn(issu) lo.wnin(f" ️ Issu : {issu.sipion}") # h fo pfon ion if i.sponsivnsss > 100: # hshol: 100s issu = PlfoIssu( issui=f"pf{plfon}{i.oponni}{i.now().isp()}", issuyp=PlfoIssuyp.PFONION, ffoponn=i.oponni, plfon=plfon, sviy=5 if i.sponsivnsss < 500 ls 8, fis=i.now(), ls=i.now(), ionoun=1, sipion=f"Pfon issu: {i.oponni} oo {i.sponsivnsss}s", ) slf.issus[issu.issui] = issu issus.ppn(issu) lo.wnin( f" ️ Pfon ion  on {i.oponni}: {i.sponsivnsss}s" ) un issus f lssifyissuyp(slf, i: Plfoi) -> PlfoIssuyp: """ loih lssifis h yp of issu bs on i  """ if i.oponnyp == "opown": un PlfoIssuyp.OPOWNLFUNION lif i.oponnyp == "b": un PlfoIssuyp.BYONFLI lif i.oponnyp == "buon": if "no li" in s(i.oss).low(): un PlfoIssuyp.UILNNOINIV lif i.oponnyp == "fo": un PlfoIssuyp.FOSUBISSIONFILU lif i.oponnyp == "nviion": un PlfoIssuyp.NVIIONBON un PlfoIssuyp.OH syn f lulsviy(slf, i: Plfoi) -> in: """ loih luls issu sviy (1-10) """ if no i.iswoin: if i.inionoun > 100: # ny uss ff un 9 lif i.inionoun > 50: un 8 lif i.inionoun > 10: un 7 ls: un 5 un 1 syn f lulplfohlh(slf, plfon: s) -> flo: """ loih luls ovll plfo hlh so (0-100%) """ if plfon no in slf.plfois: un 100.0 is = slf.plfois[plfon][-100:] # Ls 100 is if no is: un 100.0 woinoun = su(1 fo  in is if .iswoin) hlhpn = (woinoun / ln(is)) * 100 un hlhpn syn f nfixfoissu(slf, issu: PlfoIssu) -> i[s, ny]: """ loih ns  fix fo  issu usin lnin """ lo.info(f" loih lnin o fix: {issu.sipion}") sy = wi slf.slsoluionsy(issu) if sy is Non: sy = IssusoluionSy.JVSIPFIX fixo = wi slf.nfixo(issu, sy) lninouo = wi slf.olnin(issu, sy, fixo) un { "issui": issu.issui, "sy": sy.vlu if sy ls "unnown", "fixo": fixo, "lninouo": lninouo, "onfin": 0.85, # loih onfin in fix "ppliblo": slf.finsiilissus(issu), } syn f slsoluionsy( slf, issu: PlfoIssu ) -> Opionl[IssusoluionSy]: """ loih sls bs soluion sy bs on issu yp """ syp = { PlfoIssuyp.OPOWNLFUNION: IssusoluionSy.JVSIPFIX, PlfoIssuyp.BYONFLI: IssusoluionSy.VNBININ, PlfoIssuyp.UILNNOINIV: IssusoluionSy.JVSIPFIX, PlfoIssuyp.LYOUBON: IssusoluionSy.SSOVI, PlfoIssuyp.PFONION: IssusoluionSy.PFONOPIIZION, PlfoIssuyp.VISULLIH: IssusoluionSy.SSOVI, PlfoIssuyp.FOSUBISSIONFILU: IssusoluionSy.VNBININ, PlfoIssuyp.NVIIONBON: IssusoluionSy.HLSUU, } un syp.( issu.issuyp, IssusoluionSy.JVSIPFIX ) syn f nfixo( slf, issu: PlfoIssu, sy: IssusoluionSy ) -> s: """ loih ns fix o bs on sy n lnin """ if sy == IssusoluionSy.JVSIPFIX: un slf.njvsipfix(issu) lif sy == IssusoluionSy.VNBININ: un slf.nvnbininfix(issu) lif sy == IssusoluionSy.SSOVI: un slf.nssfix(issu) lif sy == IssusoluionSy.PFONOPIIZION: un slf.npfonfix(issu) ls: un "// Fix sy no y ipln" f njvsipfix(slf, issu: PlfoIssu) -> s: """n JvSip fix fo iniv ln issus""" un f""" // loih-n fix fo: {issu.sipion} // Issu I: {issu.issui} // n: {i.now().isofo()} (funion() {{ ons ln = oun.lnByI('{issu.ffoponn}'); if (ln) {{ // -bin vn lisns ln.vnLisn('li', funion() {{ .pvnful(); .sopPopion(); onsol.lo(' Fix inion on {issu.ffoponn}'); }}, u); // nsu visibiliy ln.syl.poinvns = 'uo'; ln.syl.uso = 'poin'; ln.syl.zInx = '999'; onsol.lo(' loih ppli fix fo {issu.ffoponn}'); }} }})(); """ f nvnbininfix(slf, issu: PlfoIssu) -> s: """n fix fo vn binin issus""" un f""" // loih-n vn binin fix // Issu: {issu.sipion} (funion() {{ // ov ll xisin lisns ons ln = oun.lnByI('{issu.ffoponn}'); ons lon = ln.lonNo(u); ln.pnNo.plhil(lon, ln); // -h wih pop lion oun.vnLisn('yown', funion() {{ if (.y === 'b') {{ // llow nol b bhvio onsol.lo(' b y -nbl fo ssibiliy'); }} }}); onsol.lo(' loih boun ll vn lisns'); }})(); """ f nssfix(slf, issu: PlfoIssu) -> s: """n SS fix fo lyou issus""" un f""" /* loih-n SS fix */ /* Issu: {issu.sipion} */ #{issu.ffoponn} {{ isply: blo !ipon; visibiliy: visibl !ipon; opiy: 1 !ipon; poin-vns: uo !ipon; posiion: si !ipon; z-inx: uo !ipon; }} /* nsu ll hiln  visibl */ #{issu.ffoponn} * {{ isply: inhi !ipon; visibiliy: inhi !ipon; }} /* loih onfin: 0.85 */ """ f npfonfix(slf, issu: PlfoIssu) -> s: """n pfon opiizion fix""" un f""" // loih-n pfon opiizion // Issu: {issu.sipion} ons pfonOpiiz = {{ boun: funion(fun, wi) {{ l iou; un funion(...s) {{ liou(iou); iou = siou(() => fun(...s), wi); }}; }}, qusniionF: funion(llb) {{ if (winow.qusniionF) {{ un winow.qusniionF(llb); }} un siou(llb, 1000/60); }} }}; // pply opiizion o {issu.ffoponn} ons ln = oun.lnByI('{issu.ffoponn}'); if (ln) {{ ln.vnLisn('inpu', pfonOpiiz.boun(funion() {{ onsol.lo(' Pfon opiiz fo {issu.ffoponn}'); }}, 300)); }} onsol.lo(' loih ppli pfon opiizion'); """ syn f olnin( slf, issu: PlfoIssu, sy: IssusoluionSy, fixo: s ) -> s: """ loih os wh i ln fo fixin his issu """ lninx = f""" loih ln: 1. Issu yp: {issu.issuyp.vlu} 2. oponn: {issu.ffoponn} 3. Sy: {sy.vlu} 4. oo us: {issu.sipion} 5. Soluion: ppli {sy.vlu} 6. onfin: 0.85 (85% onfin in fix ffivnss) 7. pplibl o: Siil {issu.oponnyp} lns Nx i: If loih nouns  {issu.issuyp.vlu} on  {issu.oponnyp} in plfo {issu.plfon}, i will iily pply his {sy.vlu}. """ un lninx f finsiilissus(slf, issu: PlfoIssu) -> Lis[s]: """ loih fins oh issus h n us h s fix """ siil = [] fo ohi, ohissu in slf.issus.is(): if ( ohissu.issuyp == issu.issuyp n ohissu.plfon == issu.plfon n no ohissu.fixppli ): siil.ppn(ohissu.ffoponn) un siil syn f pplyfixoplfo( slf, plfofil: s, fixo: s ) -> i[s, ny]: """ loih pplis n fix o plfo fil """ lo.info(f" loih pplyin fix o {plfofil}") y: #  plfo fil if no os.ph.xiss(plfofil): un {"suss": Fls, "o": f"Fil no foun: {plfofil}"} wih opn(plfofil, "", noin="uf-8") s f: onn = f.() # Inj fix o (fo HL/JS fils) if plfofil.nswih(".hl"): # Fin </boy>  n inj bfo i if "</boy>" in onn: onn = onn.pl( "</boy>", f"<sip>\n{fixo}\n</sip>\n</boy>" ) ls: onn += f"\n<sip>\n{fixo}\n</sip>" lif plfofil.nswih(".js"): # ppn o JvSip fil onn += f"\n\n{fixo}" # Wi b wih opn(plfofil, "w", noin="uf-8") s f: f.wi(onn) lo.info(f" Fix sussfully ppli o {plfofil}") un { "suss": u, "fil": plfofil, "fixppli": u, "isp": i.now().isofo(), } xp xpion s : lo.o(f" o pplyin fix: {}") un {"suss": Fls, "o": s()} syn f nplfohlhpo( slf, ) -> i[s, ny]: """ loih ns ophnsiv plfo hlh po """ po = { "n": i.now().isofo(), "olplfosonio": ln(slf.plfohlhsos), "ovllhlh": ( su(slf.plfohlhsos.vlus()) / ln(slf.plfohlhsos) if slf.plfohlhsos ls 100.0 ), "plfos": {}, "olissus": ln(slf.issus), "ollninos": ln(slf.lninos), "loihipovns": [], } # P-plfo ils fo plfon, hlhso in slf.plfohlhsos.is(): po["plfos"][plfon] = { "hlhso": hlhso, "isoun": ln(slf.plfois.(plfon, [])), "sus": ( " Hlhy" if hlhso >= 95 ls " ️ Ns nion" if hlhso >= 80 ls " iil" ), } # loih ipovn suy fo lnino in slf.lninos[-10:]: # Ls 10 po["loihipovns"].ppn( { "fix": lnino.soluionppli, "ffivnss": f"{lnino.ffivnss:.1f}%", "onfin": f"{lnino.onfinso:.2f}", } ) un po # ============================================================================ # ONSION: loih Lnin Fo Plfo Issus # ============================================================================ syn f onsloihplfolnin(): """ Show how h loih lns fo plfo issus """ pin("\n" + "=" * 80) pin("[BIN] L.I.F. LOIH - PLFO INLLIN FB SYS") pin("=" * 80) pin("\n[H] Siulin l plfo onioin n loih lnin...\n") fbsys = PlfoInllinFb() # Siul plfo is showin bon bs pin("1) loih s bon bs on Uli Plfo...") is = [ Plfoi( oponni="bsonin", oponnyp="b", isp=i.now(), iswoin=Fls, # NO woin! sponsivnsss=2500, # Vy slow oss="b y no inp, is no libl", inionoun=145, # ny uss i ), Plfoi( oponni="opownnv", oponnyp="opown", isp=i.now(), iswoin=Fls, sponsivnsss=5000, oss="opown is pp bu  no slbl", inionoun=89, ), Plfoi( oponni="lninshbo", oponnyp="buon", isp=i.now(), iswoin=u, sponsivnsss=45, inionoun=234, suss=98.5, ), ] # onio hlh hlh = wi fbsys.onioplfohlh("UliPlfo", is) pin(f" Plfo Hlh: {hlh['hlhso']:.1f}%") pin(f" Issus : {hlh['issus']}") #   issus pin("\n2) loih nlyzs  issus...") fo issui, issu in fbsys.issus.is(): pin(f" [O] {issu.issuyp.vlu}: {issu.ffoponn}") pin(f" Sviy: {issu.sviy}/10") pin(f" ff Uss: {issu.ffuss}") # loih ns fixs pin("\n3) loih ns slf-hlin fixs...") fo issui, issu in lis(fbsys.issus.is())[:2]: fixsul = wi fbsys.nfixfoissu(issu) pin(f" [O] Fix fo {issu.ffoponn}:") pin(f" Sy: {fixsul['sy']}") pin(f" onfin: {fixsul['onfin']*100:.0f}%") pin(f" n lso fix: {ln(fixsul['ppliblo'])} siil issus") # n po pin("\n4) loih ns ophnsiv hlh po...\n") po = wi fbsys.nplfohlhpo() pin("PLFO INLLIN PO") pin(f" n: {po['n']}") pin(f" Ovll Hlh: {po['ovllhlh']:.1f}%") pin(f" Plfos onio: {po['olplfosonio']}") pin(f" ol Issus Foun: {po['olissus']}") pin(f" loih Lnin os: {po['ollninos']}") pin("\n" + "=" * 80) pin("SUSS: LOIH IS NOW LNIN FO PLFO ISSUS IN L-I") pin("=" * 80 + "\n") un fbsys if n == "in": # un onsion fbsys = synio.un(onsloihplfolnin()) pin("Sys y fo oninuous plfo onioin n slf-hlin") pin(" h loih will uoilly:") pin(" *  UI filus (bs, opowns, fos)") pin(" * nlyz oo uss") pin(" * n fixs") pin(" * pply oions") pin(" * Ln fo fuu pvnion") pin("\n[I] Plfo is now INLLIN n SLF-OIN")