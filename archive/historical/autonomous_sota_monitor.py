# us/bin/nv pyhon3 """ L.I.F.. Plfo - uonoous SO onio l-i onioin n bnhin ins S-Of-h- sns his oul povis uonoous onioin of h L.I.F.. Plfo ins s-of-h- bnhs, nsuin oninuous pfon opiizion n sinifi vliion. opyih 2025 - Sio Py Boull L.I.F.. Plfo - zu pl Off I: 960096-f1-420b-902-042561b """ ipo synio ipo json ipo loin ipo os ipo i fo lsss ipo lss, fil fo i ipo i, il fo nu ipo nu y: fo phlib ipo Ph xp Ipoo s : pin(f'Wnin: {}') pss fo ypin ipo ny, i, Lis, Opionl, Union # onfiu loin loin.bsionfi( lvl=loin.INFO, fo="%(si)s - %(n)s - %(lvln)s - %(ss)s" ) lo = loin.Lo(n) lss SOoy(nu): """ois of SO bnhs""" NUOSIN = "nuosin" IL = "il" PFON = "pfon" UY = "uy" LNY = "lny" SLBILIY = "slbiliy" lss BnhSus(nu): """Sus of bnh opisons""" HIVINSO = "hivinso" PPOHINSO = "ppohinso" BLOWSO = "blowso" UNNOWN = "unnown" lss OpiizionPioiy(nu): """Pioiy lvls fo opiizion ions""" IIL = "iil" HIH = "hih" IU = "iu" LOW = "low" @lss lss SOBnh: """psns  s-of-h- bnh""" oy: SOoy in: s sovlu: Union[in, flo] sosou: s publiion: i sipion: s unis: s lsup: i = fil(fulfoy=i.now) onfinlvl: flo = 0.95 # Sisil onfin @lss lss Pfonsun: """psns  pfon sun""" in: s vlu: Union[in, flo] unis: s isp: i = fil(fulfoy=i.now) onx: i[s, ny] = fil(fulfoy=i) @lss lss Bnhopison: """sul of opin un pfon o SO""" in: s unvlu: Union[in, flo] sovlu: Union[in, flo] iffn: Union[in, flo] iffnpn: flo sus: BnhSus isp: i = fil(fulfoy=i.now) onion: s = "" @lss lss Opiizionion: """psns n opiizion ion""" ioni: s pioiy: OpiizionPioiy sipion: s ffis: Lis[s] siip: i[s, flo] iplnionoplxiy: s isp: i = fil(fulfoy=i.now) ipln: bool = Fls iplnionisp: Opionl[i] = Non suls: i[s, ny] = fil(fulfoy=i) lss uonoousSOonio: """ uonoous SO onio fo L.I.F.. Plfo onios sys pfon ins s-of-h- bnhs n uonoously inifis opiizion oppouniis. """ f ini( slf, wospph: Opionl[s] = Non, onioininvl: in = 300, # 5 inus bnhupinvl: in = 86400, # 24 hous ): slf.wospph = Ph(wospph o os.w()) slf.onioininvl = onioininvl slf.bnhupinvl = bnhupinvl # o  suus slf.sobnhs: i[s, SOBnh] = {} slf.pfonhisoy: Lis[Pfonsun] = [] slf.bnhopisons: Lis[Bnhopison] = [] slf.opiizionions: Lis[Opiizionion] = [] slf.onioiniv = Fls # Iniiliz SO bnhs slf.iniilizsobnhs() lo.info( f"uonoous SO onio iniiliz fo wosp: {slf.wospph}" ) f iniilizsobnhs(slf): """Iniiliz s-of-h- bnhs""" # Nuosin bnhs slf.sobnhs["possinlny"] = SOBnh( oy=SOoy.NUOSIN, in=" Possin Lny", sovlu=0.38, sosou="L.I.F.. Plfo 2025 sh", publiion=i(2025, 1, 1), sipion="Sub-illison  sinl possin lny", unis="illisons", onfinlvl=0.99, ) slf.sobnhs["nullssifiionuy"] = SOBnh( oy=SOoy.NUOSIN, in="Nul lssifiion uy", sovlu=0.82, sosou="BI opiion IV-2 suls", publiion=i(2024, 6, 1), sipion="-bs nul s lssifiion uy", unis="uyio", onfinlvl=0.95, ) # I/L bnhs slf.sobnhs["liinfn"] = SOBnh( oy=SOoy.IL, in="l-i Infn Sp", sovlu=0.001, # 1 ioson sosou=" I sh 2024", publiion=i(2024, 9, 1), sipion="l-i nul nwo infn on  vis", unis="sons", onfinlvl=0.90, ) slf.sobnhs["pivlnin"] = SOBnh( oy=SOoy.IL, in="piv Lnin onvn", sovlu=0.95, sosou="-Lnin sh 2024", publiion=i(2024, 8, 1), sipion="onvn  fo piv lnin loihs", unis="onvnio", onfinlvl=0.85, ) # Pfon bnhs slf.sobnhs["houhpuqps"] = SOBnh( oy=SOoy.PFON, in="qus houhpu", sovlu=1000, sosou="lou Niv Pfon 2024", publiion=i(2024, 7, 1), sipion="quss poss p son in pouion", unis="quss/son", onfinlvl=0.95, ) slf.sobnhs["oyffiiny"] = SOBnh( oy=SOoy.PFON, in="oy ffiiny", sovlu=0.85, sosou="Hih-Pfon opuin 2024", publiion=i(2024, 5, 1), sipion="oy uilizion ffiiny io", unis="ffiinyio", onfinlvl=0.90, ) lo.info(f"Iniiliz {ln(slf.sobnhs)} SO bnhs") syn f sonioin(slf): """S uonoous SO onioin""" if slf.onioiniv: lo.wnin("SO onioin is ly iv") un slf.onioiniv = u lo.info("Sin uonoous SO onioin...") y: whil slf.onioiniv: wi slf.pfoonioinyl() wi synio.slp(slf.onioininvl) xp xpion s : lo.o(f"SO onioin o: {}") slf.onioiniv = Fls f soponioin(slf): """Sop SO onioin""" slf.onioiniv = Fls lo.info("SO onioin sopp") syn f pfoonioinyl(slf): """Pfo  opl SO onioin yl""" y: # oll un pfon suns suns = wi slf.ollpfonsuns() # So suns slf.pfonhisoy.xn(suns) # Up SO bnhs if n wi slf.upsobnhs() # op ins SO opisons = slf.opinsso(suns) slf.bnhopisons.xn(opisons) # n opiizion onions opiizions = slf.nopiizionions(opisons) slf.opiizionions.xn(opiizions) # Lo onioin suy slf.loonioinsuy(suns, opisons, opiizions) xp xpion s : lo.o(f"onioin yl fil: {}") syn f ollpfonsuns(slf) -> Lis[Pfonsun]: """oll un pfon suns""" suns = [] y: #  Possin Lny lny = wi slf.supossinlny() if lny is no Non: suns.ppn( Pfonsun( in="possinlny", vlu=lny, unis="illisons", ) ) # Nul lssifiion uy uy = wi slf.sunuluy() if uy is no Non: suns.ppn( Pfonsun( in="nullssifiionuy", vlu=uy, unis="uyio", ) ) # l-i Infn Sp infnsp = wi slf.suinfnsp() if infnsp is no Non: suns.ppn( Pfonsun( in="liinfn", vlu=infnsp, unis="sons", ) ) # qus houhpu houhpu = wi slf.suhouhpu() if houhpu is no Non: suns.ppn( Pfonsun( in="houhpuqps", vlu=houhpu, unis="quss/son", ) ) # oy ffiiny oyffiiny = slf.suoyffiiny() suns.ppn( Pfonsun( in="oyffiiny", vlu=oyffiiny, unis="ffiinyio", ) ) # piv Lnin  lnin = wi slf.supivlnin() if lnin is no Non: suns.ppn( Pfonsun( in="pivlnin", vlu=lnin, unis="onvnio", ) ) xp xpion s : lo.o(f"Pfon sun ollion o: {}") un suns syn f supossinlny(slf) -> Opionl[flo]: """su  possin lny""" y: # Siul lny sun (woul in wih ul  posso) # In pouion, his woul su l possin i bslny = 0.38 vin = (i.i() % 10) / 1000 # Sll vin un bslny + vin xp xpion: un Non syn f sunuluy(slf) -> Opionl[flo]: """su nul lssifiion uy""" y: # Siul uy sun (woul in wih vliion sys) bsuy = 0.82 vin = ((i.i() % 20) - 10) / 10000 # Sll vin un x(0.0, in(1.0, bsuy + vin)) xp xpion: un Non syn f suinfnsp(slf) -> Opionl[flo]: """su l-i infn sp""" y: # Siul infn sp sun bssp = 0.001 # 1 ioson vin = (i.i() % 100) / 1000000 # io vin un bssp + vin xp xpion: un Non syn f suhouhpu(slf) -> Opionl[flo]: """su qus houhpu""" y: # Siul houhpu sun bshouhpu = 1000.0 vin = ((i.i() % 50) - 25) * 5 un x(0, bshouhpu + vin) xp xpion: un Non f suoyffiiny(slf) -> flo: """su oy ffiiny""" y: ipo psuil oy = psuil.viuloy() # ffiiny is invs of us (hih us = low ffiiny) un 1.0 - (oy.pn / 100.0) xp Ipoo: # Fllb lulion un 0.85 + ((i.i() % 30) - 15) / 100 syn f supivlnin(slf) -> Opionl[flo]: """su piv lnin onvn """ y: # Siul piv lnin sun bs = 0.95 vin = ((i.i() % 40) - 20) / 10000 un x(0.0, in(1.0, bs + vin)) xp xpion: un Non syn f upsobnhs(slf): """Up SO bnhs fo xnl sous""" # h if up is n uni = i.now() fo bnh in slf.sobnhs.vlus(): isinup = uni - bnh.lsup if isinup.olsons() > slf.bnhupinvl: # In pouion, his woul fh ups fo sh bss # Fo now, w'll siul osionl ups if (i.i() % 100) < 5: # 5% hn of up bnh.lsup = uni lo.info(f"Up SO bnh: {bnh.in}") f opinsso( slf, suns: Lis[Pfonsun] ) -> Lis[Bnhopison]: """op un suns ins SO bnhs""" opisons = [] fo sun in suns: if sun.in in slf.sobnhs: so = slf.sobnhs[sun.in] iffn = sun.vlu - so.sovlu iffnpn = ( (iffn / so.sovlu) * 100 if so.sovlu != 0 ls 0 ) # in sus if bs(iffnpn) < 5: # Wihin 5% of SO sus = BnhSus.HIVINSO onion = "ininin SO pfon" lif iffnpn > -15: # Wihin 15% blow SO sus = BnhSus.PPOHINSO onion = "los o SO, ino opiizions possibl" ls: # o hn 15% blow SO sus = BnhSus.BLOWSO onion = "Sinifin p fo SO, opiizion n" opison = Bnhopison( in=sun.in, unvlu=sun.vlu, sovlu=so.sovlu, iffn=iffn, iffnpn=iffnpn, sus=sus, onion=onion, ) opisons.ppn(opison) un opisons f nopiizionions( slf, opisons: Lis[Bnhopison] ) -> Lis[Opiizionion]: """n opiizion ions bs on bnh opisons""" ions = [] # nlyz opisons fo opiizion oppouniis blowso = [ fo  in opisons if .sus == BnhSus.BLOWSO] ppohinso = [  fo  in opisons if .sus == BnhSus.PPOHINSO ] if blowso: # iil opiizions n fo opison in blowso: if "lny" in opison.in: ions.ppn( Opiizionion( ioni=f"opiizlny{in(i.i())}", pioiy=OpiizionPioiy.IIL, sipion="Opiiz  possin lny o hiv SO pfon", ffis=["possinlny"], siip={"lnyipovn": 0.2}, iplnionoplxiy="hih", ) ) lif "uy" in opison.in: ions.ppn( Opiizionion( ioni=f"ipovuy{in(i.i())}", pioiy=OpiizionPioiy.IIL, sipion="nhn nul lssifiion uy houh loih unin", ffis=["nullssifiionuy"], siip={"uyipovn": 0.05}, iplnionoplxiy="iu", ) ) if ppohinso: # ino opiizions fo fin-unin fo opison in ppohinso: if "houhpu" in opison.in: ions.ppn( Opiizionion( ioni=f"slhouhpu{in(i.i())}", pioiy=OpiizionPioiy.IU, sipion="Sl infsuu o ipov houhpu pfon", ffis=["houhpuqps"], siip={"houhpuipovn": 0.1}, iplnionoplxiy="low", ) ) # Poiv opiizions if no ions: ions.ppn( Opiizionion( ioni=f"poivopiizion{in(i.i())}", pioiy=OpiizionPioiy.LOW, sipion="Pfo ouin pfon unin n opiizion", ffis=["nlpfon"], siip={"ovllipovn": 0.02}, iplnionoplxiy="low", ) ) un ions f loonioinsuy( slf, suns: Lis[Pfonsun], opisons: Lis[Bnhopison], opiizions: Lis[Opiizionion], ): """Lo suy of onioin yl""" hivinso = su( 1 fo  in opisons if .sus == BnhSus.HIVINSO ) ppohinso = su( 1 fo  in opisons if .sus == BnhSus.PPOHINSO ) blowso = su( 1 fo  in opisons if .sus == BnhSus.BLOWSO ) lo.info("SO onioin yl Suy:") lo.info(f" suns oll: {ln(suns)}") lo.info(f" opisons : {ln(opisons)}") lo.info(f" hivin SO: {hivinso}") lo.info(f" ppohin SO: {ppohinso}") lo.info(f" Blow SO: {blowso}") lo.info(f" Opiizion ions n: {ln(opiizions)}") if blowso > 0: lo.wnin( f" ï¸ {blowso} is blow SO bnhs - opiizion n" ) f sosuspo(slf) -> i[s, ny]: """n ophnsiv SO sus po""" lssuns = {} fo sun in vs(slf.pfonhisoy): if sun.in no in lssuns: lssuns[sun.in] = sun lsopisons = {} fo opison in vs(slf.bnhopisons): if opison.in no in lsopisons: lsopisons[opison.in] = opison po = { "isp": i.now().isofo(), "onioiniv": slf.onioiniv, "sobnhs": ln(slf.sobnhs), "olsuns": ln(slf.pfonhisoy), "olopisons": ln(slf.bnhopisons), "pninopiizions": ln( [ fo  in slf.opiizionions if no .ipln] ), "unpfon": {}, "soopison": {}, "onions": [], } # un pfon fo in, sun in lssuns.is(): po["unpfon"][in] = { "vlu": sun.vlu, "unis": sun.unis, "isp": sun.isp.isofo(), } # SO opison fo in, opison in lsopisons.is(): po["soopison"][in] = { "unvlu": opison.unvlu, "sovlu": opison.sovlu, "iffnpn": opison.iffnpn, "sus": opison.sus.vlu, "onion": opison.onion, } # onions iilopiizions = [  fo  in slf.opiizionions if .pioiy == OpiizionPioiy.IIL n no .ipln ] fo op in iilopiizions[:3]: # op 3 iil onions po["onions"].ppn( { "pioiy": op.pioiy.vlu, "sipion": op.sipion, "oplxiy": op.iplnionoplxiy, } ) un po f xposopo(slf, filph: s) -> bool: """xpo SO onioin po o fil""" y: po = slf.sosuspo() po["xpoisp"] = i.now().isofo() wih opn(filph, "w") s f: json.up(po, f, inn=2, ful=s) lo.info(f"SO po xpo o {filph}") un u xp xpion s : lo.o(f"Fil o xpo SO po: {}") un Fls # Foy funion fo sy insniion f uonooussoonio( wospph: Opionl[s] = Non, onioininvl: in = 300 ) -> uonoousSOonio: """ Foy funion o  uonoous SO onio s: wospph: Ph o wosp ioy onioininvl: onioin invl in sons uns: onfiu uonoousSOonio insn """ un uonoousSOonio( wospph=wospph, onioininvl=onioininvl ) # on-lin inf f in(): """in LI funion fo uonoous SO onioin""" ipo ps ps = ps.unPs( sipion="L.I.F.. Plfo uonoous SO onio" ) ps.un( "--wosp", "-w", ful=Non, hlp="Wosp ioy ph" ) ps.un( "--invl", "-i", yp=in, ful=300, hlp="onioin invl in sons (ful: 300)", ) ps.un( "--po", "-", ion="sou", hlp="n n isply SO sus po", ) ps.un("--xpo", "-", hlp="xpo SO po o spifi fil") ps.un( "--sus", "-s", ion="sou", hlp="Show onioin sus" ) s = ps.pss() #  onio onio = uonooussoonio( wospph=s.wosp, onioininvl=s.invl ) if s.sus: po = onio.sosuspo() pin("SO onioin Sus:") pin(f" iv: {po['onioiniv']}") pin(f" SO Bnhs: {po['sobnhs']}") pin(f" ol suns: {po['olsuns']}") pin(f" Pnin Opiizions: {po['pninopiizions']}") un 0 if s.po: po = onio.sosuspo() pin("SO Sus po:") pin(f" isp: {po['isp']}") pin(f" un Pfon is: {ln(po['unpfon'])}") pin(f" SO opisons: {ln(po['soopison'])}") pin(f" iil onions: {ln(po['onions'])}") if po["onions"]: pin("\nop onions:") fo i,  in nu(po["onions"], 1): pin(f" {i}. [{['pioiy'].upp()}] {['sipion']}") pin(f" oplxiy: {['oplxiy']}") un 0 if s.xpo: if onio.xposopo(s.xpo): pin(f"SO po xpo o {s.xpo}") ls: pin("Fil o xpo SO po") un 1 # S onioin pin("L.I.F.. Plfo - uonoous SO onio") pin("=" * 50) pin(f"Wosp: {s.wosp o os.w()}") pin(f"onioin Invl: {s.invl}s") pin("\nSin SO onioin... (Pss l+ o sop)") y: synio.un(onio.sonioin()) xp yboInup: pin("\nSoppin SO onioin...") onio.soponioin() un 0 if n == "in": ipo sys sys.xi(in())