{ "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#", "contentVersion": "1.0.0.0", "parameters": { "lifePlatformName": { "type": "string", "metadata": { "description": "Name of the L.I.F.E Platform deployment" } }, "location": { "type": "string", "defaultValue": "[resourceGroup().location]", "metadata": { "description": "Location for all resources" } }, "pricingTier": { "type": "string", "defaultValue": "professional", "allowedValues": [ "basic", "professional", "enterprise" ], "metadata": { "description": "L.I.F.E Platform pricing tier" } }, "expectedUsers": { "type": "int", "defaultValue": 100, "minValue": 10, "maxValue": 10000, "metadata": { "description": "Expected number of users" } }, "complianceMode": { "type": "string", "defaultValue": "hipaa", "allowedValues": [ "soc2", "hipaa", "ferpa", "fedramp" ], "metadata": { "description": "Compliance mode for the platform" } }, "jitAccessPolicy": { "type": "object", "defaultValue": {}, "metadata": { "description": "JIT access policy configuration" } }, "enableEncryption": { "type": "bool", "defaultValue": true, "metadata": { "description": "Enable Azure Key Vault encryption" } }, "enableAuditLogs": { "type": "bool", "defaultValue": true, "metadata": { "description": "Enable comprehensive audit logging" } } }, "variables": { "storageAccountName": "[concat(parameters('lifePlatformName'), 'storage')]", "keyVaultName": "[concat(parameters('lifePlatformName'), '-kv')]", "functionAppName": "[concat(parameters('lifePlatformName'), '-functions')]", "appServicePlanName": "[concat(parameters('lifePlatformName'), '-plan')]", "applicationInsightsName": "[concat(parameters('lifePlatformName'), '-insights')]", "serviceBusName": "[concat(parameters('lifePlatformName'), '-servicebus')]", "skuTier": "[if(equals(parameters('pricingTier'), 'enterprise'), 'Premium', if(equals(parameters('pricingTier'), 'professional'), 'Standard', 'Basic'))]" }, "resources": [ { "type": "Microsoft.Storage/storageAccounts", "apiVersion": "2021-06-01", "name": "[variables('storageAccountName')]", "location": "[parameters('location')]", "sku": { "name": "Standard_LRS" }, "kind": "StorageV2", "properties": { "supportsHttpsTrafficOnly": true, "encryption": { "services": { "file": { "keyType": "Account", "enabled": "[parameters('enableEncryption')]" }, "blob": { "keyType": "Account", "enabled": "[parameters('enableEncryption')]" } }, "keySource": "Microsoft.Storage" } } }, { "type": "Microsoft.KeyVault/vaults", "apiVersion": "2021-06-01-preview", "name": "[variables('keyVaultName')]", "location": "[parameters('location')]", "condition": "[parameters('enableEncryption')]", "properties": { "sku": { "family": "A", "name": "standard" }, "tenantId": "[subscription().tenantId]", "enabledForDeployment": true, "enabledForTemplateDeployment": true, "enabledForDiskEncryption": true, "enableRbacAuthorization": true, "accessPolicies": [] } }, { "type": "Microsoft.Web/serverfarms", "apiVersion": "2021-02-01", "name": "[variables('appServicePlanName')]", "location": "[parameters('location')]", "sku": { "name": "[if(equals(parameters('pricingTier'), 'enterprise'), 'P1V2', if(equals(parameters('pricingTier'), 'professional'), 'S1', 'B1'))]" }, "kind": "linux", "properties": { "reserved": true } }, { "type": "Microsoft.Web/sites", "apiVersion": "2021-02-01", "name": "[variables('functionAppName')]", "location": "[parameters('location')]", "kind": "functionapp,linux", "dependsOn": [ "[resourceId('Microsoft.Web/serverfarms', variables('appServicePlanName'))]", "[resourceId('Microsoft.Storage/storageAccounts', variables('storageAccountName'))]" ], "properties": { "serverFarmId": "[resourceId('Microsoft.Web/serverfarms', variables('appServicePlanName'))]", "siteConfig": { "linuxFxVersion": "Python|3.11", "appSettings": [ { "name": "AzureWebJobsStorage", "value": "[concat('DefaultEndpointsProtocol=https;AccountName=', variables('storageAccountName'), ';AccountKey=', listKeys(resourceId('Microsoft.Storage/storageAccounts', variables('storageAccountName')), '2021-06-01').keys[0].value)]" }, { "name": "FUNCTIONS_WORKER_RUNTIME", "value": "python" }, { "name": "FUNCTIONS_EXTENSION_VERSION", "value": "~4" }, { "name": "LIFE_PLATFORM_VERSION", "value": "2025.1.0-PRODUCTION" }, { "name": "PRICING_TIER", "value": "[parameters('pricingTier')]" }, { "name": "COMPLIANCE_MODE", "value": "[parameters('complianceMode')]" }, { "name": "EXPECTED_USERS", "value": "[string(parameters('expectedUsers'))]" }, { "name": "AZURE_MARKETPLACE_OFFER_ID", "value": "9a600d96-fe1e-420b-902a-a0c42c561adb" } ] } } }, { "type": "Microsoft.Insights/components", "apiVersion": "2020-02-02", "name": "[variables('applicationInsightsName')]", "location": "[parameters('location')]", "kind": "web", "properties": { "Application_Type": "web", "Request_Source": "rest" } }, { "type": "Microsoft.ServiceBus/namespaces", "apiVersion": "2021-06-01-preview", "name": "[variables('serviceBusName')]", "location": "[parameters('location')]", "sku": { "name": "[variables('skuTier')]" }, "properties": {} } ], "outputs": { "lifePlatformUrl": { "type": "string", "value": "[concat('https://', variables('functionAppName'), '.azurewebsites.net')]" }, "storageAccountName": { "type": "string", "value": "[variables('storageAccountName')]" }, "keyVaultName": { "type": "string", "value": "[variables('keyVaultName')]" }, "jitAccessPolicy": { "type": "object", "value": "[parameters('jitAccessPolicy')]" }, "complianceConfiguration": { "type": "object", "value": { "mode": "[parameters('complianceMode')]", "encryptionEnabled": "[parameters('enableEncryption')]", "auditLogsEnabled": "[parameters('enableAuditLogs')]", "pricingTier": "[parameters('pricingTier')]" } } } }