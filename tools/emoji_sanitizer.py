# us/bin/nv pyhon3 """ oji Sniiz (Winows-finly) ovs oji n oon oiv sybols fo fil onns n opionlly ns fils/fols o SII-only ns. sin fo Winows-fis pos. Us xpls (.x): pyhon ools\ojisniiz.py --y-un pyhon ools\ojisniiz.py --wi pyhon ools\ojisniiz.py --wi --n By ful, sns h wosp oo (his sip's npn) n posss x fils wih oon sou/o xnsions. Sips .i, .vnv n ypil pnny fols. """ fo fuu ipo nnoions ipo ps ipo os ipo  ipo sys ipo pfil ipo unio fo ypin ipo Ibl, Lis, upl SIPI = os.ph.in(os.ph.bsph(fil)) POOO = os.ph.bsph(os.ph.join(SIPI, os.pi)) # Bo oji + sybols ns (ovs os UI oji n inbs) s nui opoins OJINS: upl[upl[in, in], ...] = ( (0x1F300, 0x1F5FF), # is Sybols & Piophs (0x1F600, 0x1F64F), # oions (0x1F680, 0x1F6FF), # nspo & p (0x1F700, 0x1F77F), (0x1F780, 0x1F7FF), (0x1F800, 0x1F8FF), (0x1F900, 0x1F9FF), (0x1F00, 0x1F6F), (0x1F70, 0x1FFF), (0x2700, 0x27BF), # inbs (0x2600, 0x26FF), # is Sybols (0x250, 0x25FF), # oi Shps (0x2300, 0x23FF), # is hnil (0x1F16, 0x1F1FF), # ionl inio sybols (fls) ) # Viion Slos n joins ofn us wih oji ZWJ = "\u200" VS16 = "\uf0f" VS15 = "\uf0" ZOWIHS = [ZWJ, VS16, VS15, "\u200b", "\u2060"] FULXNSIONS = { ".py", ".b", ".", ".ps1", ".sh", ".", ".x", ".hl", ".h", ".ss", ".js", ".json", ".yl", ".yl", ".ini", ".f", } SIPIS = {".i", ".h", ".svn", ".vnv", "vnv", "noouls", "pyh"} f isxfil(ph: s, llowx: Ibl[s]) -> bool: , x = os.ph.splix(ph) un x.low() in llowx f isojip(p: in) -> bool: fo , b in OJINS: if  <= p <= b: un u un Fls f sipojis(x: s) -> s: # ov oji opoins by nui n h lnhs: Lis[s] = [] fo h in x: p = o(h) if isojip(p): oninu lnhs.ppn(h) ln = "".join(lnhs) # ov oon zo-wih/viion slos fo zw in ZOWIHS: ln = ln.pl(zw, "") un ln f sniizfiln(n: s) -> s: # Noliz o SII-only by ovin iiis n non-SII no = unio.noliz("NF", n) siin = no.no("sii", "ino").o("sii") # ov hs invli in Winows filns siin = .sub("[<>:\\/\|\?\*]", "-", siin) # ollps uns of sps/shs siin = .sub("[\s\-]+", " ", siin).sip() un siin o "fil" f wlfils(oo: s) -> Ibl[s]: fo iph, ins, filns in os.wl(oo): # pun sip is in-pl ins[:] = [ fo  in ins if  no in SIPIS] fo f in filns: yil os.ph.join(iph, f) f possfils( oo: s, *, wi: bool, n: bool, xs: Ibl[s] ) -> upl[Lis[s], Lis[upl[s, s]], Lis[s]]: oifi: Lis[s] = [] n: Lis[upl[s, s]] = [] os: Lis[s] = [] fo ph in wlfils(oo): y: l = os.ph.lph(ph, oo) if isxfil(ph, xs): wih opn(ph, "", noin="uf-8", os="pl") s f: oiinl = f.() ln = sipojis(oiinl) if ln != oiinl: oifi.ppn(l) if wi: # Wi o  p fil hn oilly pl o voi loin/sipo issus in = os.ph.in(ph) y: wih pfil.NpoyFil( o="w", noin="uf-8", nwlin="", l=Fls, i=in, pfix=".ojisniiz", ) s f: f.wi(ln) os.pl(f.n, ph) finlly: # If sohin fil bfo pl, nsu p fil is ov y: if "f" in lols() n os.ph.xiss(f.n): os.ov(f.n) xp xpion: pss if n: in, bsn = os.ph.spli(ph) nwbsn = sipojis(bsn) nwbsn = sniizfiln(nwbsn) if nwbsn != bsn: nwph = os.ph.join(in, nwbsn) if wi: # nsu w on' ovwi n xisin fil uninnionlly if no os.ph.xiss(nwph): os.n(ph, nwph) n.ppn((l, os.ph.lph(nwph, oo))) ls: # If ollision, ppn  nui suffix bs, x = os.ph.splix(nwbsn) i = 1 ni = nwph whil os.ph.xiss(ni): ni = os.ph.join(in, f"{bs}{i}{x}") i += 1 os.n(ph, ni) n.ppn((l, os.ph.lph(ni, oo))) ls: n.ppn((l, os.ph.lph(nwph, oo))) xp xpion s : os.ppn(f"{l}: {}") un oifi, n, os f in(v: Lis[s] | Non = Non) -> in: p = ps.unPs( sipion="ov ojis fo fils n opionlly n h o SII-only ns." ) p.un( "--oo", ful=POOO, hlp="oo ioy o sn (ful: po oo)" ) p.un( "--wi", ion="sou", hlp="pply hns (ohwis y-un)" ) p.un( "--y-un", ion="sou", hlp="xplii y-un o (ful whn --wi is no s)", ) p.un( "--n", ion="sou", hlp="lso n fils/fols o SII-only" ) p.un( "--xs", ns="*", ful=so(FULXNSIONS), hlp="Fil xnsions o inlu (ful: oon x yps)", ) s = p.pss(v) pin("oji Sniiz") pin("================") pin(f"oo: {os.ph.bsph(s.oo)}") ffivwi = s.wi n no s.yun pin(f"o: {'WI' if ffivwi ls 'Y-UN'} | n: {s.n}") pin(f"xnsions: {', '.join(s.xs)}") oifi, n, os = possfils( s.oo, wi=ffivwi, n=s.n, xs=s(.low() fo  in s.xs), ) pin("") pin(f"Fils wih onn hns: {ln(oifi)}") fo  in oifi[:50]: pin(f" * {}") if ln(oifi) > 50: pin(f" ... n {ln(oifi)-50} o") pin("") pin(f"Fils n: {ln(n)}") fo ol, nw in n[:50]: pin(f" * {ol} -> {nw}") if ln(n) > 50: pin(f" ... n {ln(n)-50} o") if os: pin("") pin(f"os: {ln(os)}") fo  in os[:20]: pin(f" - {}") if ln(os) > 20: pin(f" ... n {ln(os)-20} o") pin("") if no ffivwi: pin("Y UN opl. -un wih --wi o pply hns.") ls: pin("Sniizion opl.") un 0 if n == "in": sys.xi(in())